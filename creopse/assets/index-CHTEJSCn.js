import{i as E}from"./ckeditor_ckeditor5-vue-CmLqe3wy.js";import{I as xe}from"./iconify_vue-DXPEksg3.js";import{u as et,q as xn,r as En,s as Dn,t as qn,_ as Vn,v as Gn,c as Kn,w as Nn,d as Yn,x as Qn,y as Xn,z as Zn,R as Qt,A as ea,B as ta,C as Xt}from"./main-ViLBltTU.js";import{t as Jt,q as Tn,l as Bn,v as na,w as aa,h as Ae,B as $t,f as On,_ as qt,x as Pn,y as Ln,z as Gt,A as An,C as oa,D as Kt,E as sa,F as zn,k as Rn,r as Mn,G as Un,H as ia,S as la}from"./naive-ui-dfg6Ko-R.js";import{F as Wt,u as jn,_ as ra,a as ca,b as ua}from"./page-CE-Jx-Za.js";import{p as at,d as Zt,f as da}from"./jsondiffpatch-6ukoYq90.js";import{_ as Y}from"./lodash-C_MgVQnG.js";import{v as Be}from"./uuid-8I8R7izr.js";import{u as je}from"./vue-i18n-B92nPylK.js";import{_ as Ct}from"./fawmi_vue-google-maps-yyESU4s0.js";import{a as Hn,o as pa,u as va}from"./vue-router-DS5MTONl.js";import{b as ga,c as ot}from"./vueuse_core-DKs1Kb2a.js";import{u as _a}from"./unhead_vue-ObhOJ4d0.js";function fa(){const S=Jt();return{confirm:s=>new Promise(e=>{S.warning({...s,onPositiveClick:()=>{e("positive")},onNegativeClick:()=>{e("negative")},onClose:()=>{e("close")}})}),info:s=>new Promise(e=>{S.info({...s,onPositiveClick:()=>{e("positive")},onNegativeClick:()=>{e("negative")},onClose:()=>{e("close")}})}),success:s=>new Promise(e=>{S.success({...s,onPositiveClick:()=>{e("positive")},onNegativeClick:()=>{e("negative")},onClose:()=>{e("close")}})}),warning:s=>new Promise(e=>{S.warning({...s,onPositiveClick:()=>{e("positive")},onNegativeClick:()=>{e("negative")},onClose:()=>{e("close")}})}),error:s=>new Promise(e=>{S.error({...s,onPositiveClick:()=>{e("positive")},onNegativeClick:()=>{e("negative")},onClose:()=>{e("close")}})})}}var ke=(S=>(S.RELOAD="reload",S.RELOAD_COMPLETE="reload-complete",S.ENABLE_EDITION_MODE="enable-edition-mode",S.DESELECT_ALL_SECTIONS="deselect-all-sections",S.SELECT_PREVIEW_SECTION="select-preview-section",S.SELECT_SIDEBAR_SECTION="select-sidebar-section",S.SEND_BASE_SECTION_SETTINGS="send-base-section-settings",S.SEND_BASE_SECTION_DATA="send-base-section-data",S.SEND_SECTION_SETTINGS="send-section-settings",S.SEND_SECTION_DATA="send-section-data",S.SEND_PAGE_SECTIONS="send-page-sections",S))(ke||{});const{defineStore:ma}=await E("pinia"),{ref:ge,computed:st}=await E("vue"),tt=ma("visual-editor",()=>{const S=ge(!1),f=ge(!0),c=ge(!1),W=ge("desktop"),w=ge(null),m=ge(!1),s=ge({}),e=ge({}),n=ge({}),d=ge([]),y=ge(null),oe=ge(null),$=ge(!1),z=ge(!1),i=ge(!1),b=ge(!1),L=(t,a,u)=>`${t}+${a}+${u}`,ee=()=>{let t=!1,a=[];for(const u of d.value)(t||!y.value)&&a.push(u),u===y.value&&(t=!0);return a},Q=(t,a,u,p,I)=>{const x=L(t,a,u);I==="data"?s.value[x]={data:Y.cloneDeep(p??{}),date:new Date}:I==="settings"&&(e.value[x]={data:Y.cloneDeep(p??{}),date:new Date})},de=(t,a,u,p,I,x,_,l)=>{const D=L(t,a,u),H=`${D}|${Be()}`;let ne;const P=ee();try{if(_==="data"&&s.value[D]?.data){const ve=Array.isArray(n.value[D])?n.value[D].filter(fe=>fe.type==="data"&&!P.includes(fe.id)).reduce((fe,He)=>at(fe,He.data),Y.cloneDeep(s.value[D].data)):Y.cloneDeep(s.value[D].data);ne=Zt(ve,x)}else if(_==="settings"&&e.value[D]?.data){const ve=Array.isArray(n.value[D])?n.value[D].filter(fe=>fe.type==="settings"&&!P.includes(fe.id)).reduce((fe,He)=>at(fe,He.data),Y.cloneDeep(e.value[D].data)):Y.cloneDeep(e.value[D].data);ne=Zt(ve,x)}const De={id:H,title:p,type:_,pivot:I,data:ne,validator:l,date:new Date};ne&&(Array.isArray(n.value[D])?(Object.keys(n.value).forEach(ve=>{n.value[ve]=n.value[ve].filter(fe=>!P.includes(fe.id))}),n.value[D].push(De)):n.value[D]=[De],d.value=d.value.filter(ve=>!P.includes(ve)),d.value.push(H),i.value=!0,y.value=H)}catch{}},pe=()=>{s.value={},e.value={},n.value={},d.value=[],y.value=null,oe.value=null,$.value=!1,z.value=!1,i.value=!1,b.value=!1},se=(t,a)=>{let u=!1,p=[];for(const _ of d.value)_===t&&(u=!0),u&&p.push(_);let I,x;return Object.keys(n.value).forEach(_=>{n.value[_].find(l=>l.id===t)&&(I=_)}),I&&(x=n.value[I]?.filter(_=>_.type===a&&!p.includes(_.id))?.reduce((_,l)=>at(_,l.data),Y.cloneDeep((a==="data"?s.value[I]?.data:e.value[I]?.data)??{}))),x},ie=()=>{const t={};try{Object.keys(n.value).forEach(a=>{const u=p=>p.type==="data"&&!ee().includes(p.id);t[a]={data:n.value[a]?.filter(u)?.reduce((p,I)=>at(p,I.data),Y.cloneDeep(s.value[a]?.data??{})),pivot:n.value[a].length?n.value[a][0].pivot:null,hasChanges:Array.isArray(n.value[a])&&n.value[a].filter(u).length>0}})}catch{}return t},le=(t,a,u)=>{const p=L(t,a,u);return ie()[p]},j=(t,a,u)=>{const p=L(t,a,u);return Array.isArray(n.value[p])&&n.value[p].filter(I=>I.type==="data").length>0},O=()=>{const t={};return Object.keys(n.value).forEach(a=>{const u=n.value[a].filter(p=>p.type==="data");t[a]=u.length>0?u[u.length-1].validator||(()=>Promise.resolve(!0)):()=>Promise.resolve(!0)}),t},re=()=>{const t={};try{Object.keys(n.value).forEach(a=>{const u=p=>p.type==="settings"&&!ee().includes(p.id);t[a]={data:n.value[a]?.filter(u)?.reduce((p,I)=>at(p,I.data),Y.cloneDeep(e.value[a]?.data??{})),pivot:n.value[a].length?n.value[a][0].pivot:null,hasChanges:Array.isArray(n.value[a])&&n.value[a].filter(u).length>0}})}catch{}return t},T=(t,a,u)=>{const p=L(t,a,u);return re()[p]},k=(t,a,u)=>{const p=L(t,a,u);return Array.isArray(n.value[p])&&n.value[p].filter(I=>I.type==="settings").length>0},h=()=>{const t={};return Object.keys(n.value).forEach(a=>{const u=n.value[a].filter(p=>p.type==="settings");t[a]=u.length>0?u[u.length-1].validator||(()=>Promise.resolve(!0)):()=>Promise.resolve(!0)}),t},J=st(()=>y.value?d.value.indexOf(y.value):-1),te=()=>{i.value=!1,y.value=d.value[J.value-1]||null},q=()=>{i.value=!1,y.value=d.value[J.value+1]},ce=st(()=>J.value>=0),Ee=st(()=>J.value<d.value.length-1),$e=st(()=>{const t=Object.values(n.value).flat();return d.value.map(a=>t.find(u=>u.id===a)).filter(a=>a!==void 0)}),_e=t=>{i.value=!1,y.value=t};return{isOverlayMode:S,showLeftSidebar:f,showRightSidebar:c,currentDeviceType:W,selectedSection:w,showSectionData:m,versionItems:n,versionItemIds:d,versionItemsList:$e,currentVersionId:y,lastSavedVersionId:oe,addVersionBaseSnapshot:Q,addVersionItem:de,getLastSnapshotFrom:se,getDataSnapshotBySections:ie,getSettingsSnapshotBySections:re,sectionHasDataDeltas:j,sectionHasSettingsDeltas:k,getSectionDataSnapshot:le,getSectionSettingsSnapshot:T,getDataValidatorBySections:O,getSettingsValidatorBySections:h,resetVersions:pe,getSectionId:L,currentVersionIndex:J,ignoreDataChangeEffects:$,ignoreSettingsChangeEffects:z,ignoreVersionChangeEffects:i,showVersionsHistory:b,undo:te,redo:q,canUndo:ce,canRedo:Ee,changeVersion:_e,isVersionSelected:t=>st({get:()=>t===y.value,set:a=>{a&&_e(t)}})}}),{unref:Vt}=await E("vue"),{defineComponent:ha}=await E("vue"),{unref:g,resolveComponent:Sa,createVNode:X,withCtx:V,openBlock:Z,createBlock:ye,createCommentVNode:it,toDisplayString:Ye,createTextVNode:Qe,renderList:Nt,Fragment:Fe,createElementBlock:We,normalizeClass:ya,isRef:ba,createSlots:ka,vShow:en,createElementVNode:lt,withDirectives:tn,Transition:nn}=await E("vue"),wa={class:"mb-2 px-3 py-6"},$a={class:"mb-2"},Ca={class:"flex items-center justify-start gap-1"},{storeToRefs:Ia}=await E("pinia"),{ref:Je,inject:xa,computed:Ea,watch:an,reactive:_t,onMounted:Da}=await E("vue"),Va=ha({__name:"Data",props:{page:{}},setup(S,{expose:f}){const c=S,{t:W}=je(),{editKeysToCamelCase:w,tr:m}=et(),s=tt(),{selectedSection:e,showSectionData:n,currentVersionId:d,ignoreDataChangeEffects:y,ignoreVersionChangeEffects:oe}=Ia(s),{addVersionBaseSnapshot:$,getSectionDataSnapshot:z}=s,i=Je({}),b=Je({}),L=Je(),ee=Je(),Q=Je("index"),de=Je(Be()),pe=xa("appConfig"),{data:se,isPending:ie}=xn({slug:e.value?.slug||"",linkId:e.value?.pivot?.dataSourceLinkId,pageId:e.value?.pivot?.dataSourcePageId}),le=Ea({get:()=>{if(i.value)return i.value;{const T={};for(const k in w(se.value?.dataStructure)??{})T[k]={};return T}},set:T=>{i.value=T}});an(()=>se?.value,T=>{const k=z(e.value?.slug||"",e.value?.pivot?.linkId||"",c.page?.id||0)?.data;if(k&&!En(k)){i.value=k;return}const h=Y.cloneDeep(T),J=h?.pages?.length?h?.pages[0].pivot:null;h&&i&&J&&(Y.isObject(J?.data)&&Dn(J?.data)?i.value=_t(J?.data):i.value=_t({}),Y.forIn(w(h.dataStructure),(te,q)=>{(!i.value[q]||Array.isArray(i.value[q])&&i.value[q].length==0)&&(q==="index"?i.value[q]=_t({}):i.value[q]=_t([]))})),b&&i&&setTimeout(()=>{b.value=Y.cloneDeep(i.value),e.value?.slug&&e.value?.pivot?.linkId&&c.page?.id&&($(e.value?.slug,e.value?.pivot?.linkId,c.page?.id,b.value,"data"),j?.contentWindow?.postMessage({type:ke.SEND_BASE_SECTION_DATA,slug:e.value?.slug,linkId:e.value?.pivot?.linkId,pageId:c.page?.id,data:JSON.parse(JSON.stringify(b.value||{}))},pe?.apiBaseUrl??"*"))},500),de.value=Be()},{immediate:!0,deep:!0});let j=null;Da(()=>{j=document.getElementById("preview")}),an(()=>d.value,()=>{oe.value||e.value?.slug&&e.value?.pivot?.linkId&&c.page?.id&&(y.value=!0,i.value=z(e.value?.slug,e.value?.pivot?.linkId,c.page?.id)?.data,j?.contentWindow?.postMessage({type:ke.SEND_SECTION_DATA,slug:e.value?.slug,linkId:e.value?.pivot?.linkId,pageId:c.page?.id,data:JSON.parse(JSON.stringify(i.value||{}))},pe?.apiBaseUrl??"*"),de.value=Be())});const O=Je(!1),re=()=>{O.value=!0,setTimeout(()=>{O.value=!1},3e3)};return f({data:i,initialData:b,formValueValidate1:L,formValueValidate2:ee}),(T,k)=>{const h=Bn,J=Tn,te=xe,q=Ae,ce=$t,Ee=aa,$e=na,_e=On,C=Gt,t=An,a=Ln,u=Pn,p=qt,I=Sa("Draggable"),x=Vn;return g(ie)?(Z(),ye(J,{key:0,align:"center",justify:"center",class:"min-h-[50vh]"},{default:V(()=>[X(h)]),_:1})):(Z(),We(Fe,{key:1},[X($e,{value:g(Q),"onUpdate:value":k[2]||(k[2]=_=>ba(Q)?Q.value=_:null),type:"card",size:"small",class:"data-tabs"},ka({prefix:V(()=>[X(ce,{secondary:"",size:"tiny",onClick:k[0]||(k[0]=()=>{n.value=!1}),class:"!h-full"},{icon:V(()=>[X(q,null,{default:V(()=>[X(te,{icon:"carbon:close"})]),_:1})]),_:1})]),default:V(()=>[g(w)(g(se)?.dataStructure)?(Z(),We(Fe,{key:0},[g(w)(g(se)?.dataStructure).index?(Z(),ye(Ee,{key:0,name:"index"},{default:V(()=>[X(q,{class:"mr-1"},{default:V(()=>[X(te,{icon:"carbon:types"})]),_:1}),Qe(" "+Ye(g(W)("general")),1)]),_:1})):it("",!0),(Z(!0),We(Fe,null,Nt(g(qn)(g(w)(g(se)?.dataStructure),["index"]),(_,l)=>(Z(),ye(Ee,{key:l,name:String(l)},{default:V(()=>[Qe(Ye(g(m)(_.title)),1)]),_:2},1032,["name"]))),128))],64)):it("",!0)]),_:2},[g(Q)!=="index"?{name:"suffix",fn:V(()=>[X(ce,{secondary:"",size:"tiny",class:ya(["!h-full",{"btn-blink":g(O)}]),onClick:k[1]||(k[1]=()=>{g(i)[g(Q)].push({}),de.value=("uuidv4"in T?T.uuidv4:Vt(Be))()})},{icon:V(()=>[X(q,null,{default:V(()=>[X(te,{icon:"carbon:add-alt"})]),_:1})]),_:1},8,["class"])]),key:"0"}:void 0]),1032,["value"]),X(x,{appear:"",name:"slide-fade"},{default:V(()=>[lt("section",null,[(Z(!0),We(Fe,null,Nt(g(w)(g(se)?.dataStructure)||{},(_,l)=>(Z(),We(Fe,{key:l},[String(l)==="index"?(Z(),ye(nn,{key:0,name:"slide-fade",mode:"out-in"},{default:V(()=>[tn(lt("div",wa,[g(w)(g(se)?.dataStructure).index?.length?(Z(),We(Fe,{key:0},[g(le)[l]?(Z(),ye(Wt,{key:`${g(de)}-${l}-form-1`,modelValue:g(le)[l],"onUpdate:modelValue":D=>g(le)[l]=D,items:_,"form-size":"small","label-placement":"top",onUpdate:(D,H)=>{L.value=H}},null,8,["modelValue","onUpdate:modelValue","items","onUpdate"])):it("",!0)],64)):(Z(),ye(_e,{key:1,type:"warning","show-icon":""},{default:V(()=>[Qe(Ye(g(W)("noFieldDefinedHere")),1)]),_:1}))],512),[[en,g(Q)==="index"]])]),_:2},1024)):(Z(),ye(nn,{key:1,name:"slide-fade",mode:"out-in"},{default:V(()=>[tn(lt("div",$a,[g(i)&&g(i)[l]&&Array.isArray(g(i)[l])&&g(i)[l].length?(Z(),ye(I,{key:0,list:g(i)[l],onChange:k[3]||(k[3]=D=>{de.value=("uuidv4"in T?T.uuidv4:Vt(Be))()}),class:"w-full"},{default:V(()=>[(Z(!0),We(Fe,null,Nt(g(i)[l],(D,H)=>(Z(),ye(p,{key:H,size:"small",class:"mb-2","content-class":"!px-3"},{default:V(()=>[X(u,{"default-expanded-names":["1"],"display-directive":"show"},{"header-extra":V(({collapsed:ne})=>[X(J,{align:"center",justify:"space-between"},{default:V(()=>[X(ce,{secondary:"",type:"error",size:"tiny",onClick:()=>{g(i)[l].splice(H,1),de.value=("uuidv4"in T?T.uuidv4:Vt(Be))()}},{icon:V(()=>[X(q,null,{default:V(()=>[X(te,{icon:"carbon:trash-can"})]),_:1})]),_:1},8,["onClick"]),X(q,null,{default:V(()=>[ne?(Z(),ye(te,{key:0,icon:"fa-solid:chevron-left"})):(Z(),ye(te,{key:1,icon:"fa-solid:chevron-down"}))]),_:2},1024)]),_:2},1024)]),arrow:V(()=>[...k[5]||(k[5]=[lt("span",null,null,-1)])]),default:V(()=>[X(a,{name:"1"},{header:V(({collapsed:ne})=>[lt("div",Ca,[X(q,{size:"14",class:"cursor-move"},{default:V(()=>[X(te,{icon:"fa-solid:grip-lines"})]),_:1}),X(C,{size:"small",type:"info"},{default:V(()=>[Qe(Ye(String(H+1)),1)]),_:2},1024),ne?(Z(),ye(t,{key:0,"line-clamp":1,"expand-trigger":"click",class:"text-sm max-w-[90%]"},{default:V(()=>[Qe(Ye(g(Gn)(g(i)[l][H],g(m),"")),1)]),_:2},1024)):it("",!0)])]),default:V(()=>[g(i)&&g(i)[l][H]?(Z(),ye(Wt,{key:`${g(de)}-${l}-${H}-form-2`,modelValue:g(i)[l][H],"onUpdate:modelValue":ne=>g(i)[l][H]=ne,items:_.items,"form-size":"small","label-placement":"top",onUpdate:(ne,P)=>{ee.value=P}},null,8,["modelValue","onUpdate:modelValue","items","onUpdate"])):it("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["list"])):(Z(),ye(_e,{key:1,type:"info",class:"cursor-pointer","show-icon":"",onClick:k[4]||(k[4]=D=>re())},{default:V(()=>[Qe(Ye(g(W)("emptyCollectionInfoMessage")),1)]),_:1}))],512),[[en,g(Q)===String(l)]])]),_:2},1024))],64))),128))])]),_:1})],64))}}}),Na=Ct(Va,[["__scopeId","data-v-ac28e442"]]),{defineComponent:Ta}=await E("vue"),{unref:r,openBlock:Ce,createBlock:on,createCommentVNode:sn,renderList:ln,Fragment:Tt,createElementBlock:Pe,resolveComponent:Ba,createVNode:M,withModifiers:rn,withCtx:ae,toDisplayString:rt,createTextVNode:ft,normalizeClass:mt,createElementVNode:Me,normalizeStyle:Oa}=await E("vue"),Pa={class:"p-2"},La={key:0},Aa={key:1},za={key:0},Ra=["onClick"],Ma={class:"flex items-center"},Ua={class:"absolute top-[-10px] right-[-10px] z-[10]"},ja={class:"flex items-center justify-center cursor-pointer gap-2 text-sm"},Ha={key:1},Fa={class:"text-center"},Wa={class:"mt-2"},{storeToRefs:Ja}=await E("pinia"),{inject:cn,useTemplateRef:un,computed:ct,h:qe,onMounted:dn}=await E("vue"),qa=Ta({__name:"LeftSidebar",setup(S,{expose:f}){const{t:c}=je(),{isSmScreen:W,isMdScreen:w,pickByTheme:m,appPrimaryColor:s}=et(),{showLeftSidebar:e,isOverlayMode:n,selectedSection:d,showSectionData:y}=Ja(tt()),oe=cn("appConfig"),$=cn("currentPageSlug"),{page:z,isLoadingPage:i,pageSections:b,initialPageSections:L,pageSectionsEnabled:ee,initialPageSectionsEnabled:Q,getPageSectionTitle:de,dataSourcePagesOptions:pe,confirmUpdateDataSourcePage:se,submitRemoveSection:ie,submitDuplicateSection:le,submitFillInFakeData:j}=jn($?.value||""),O=un("sectionData"),re=un("sectionActions"),T=ct(()=>Y.isEqual(O.value?.data,O.value?.initialData)&&Y.isEqual(b.value,L.value)&&Y.isEqual(ee.value,Q.value)),k=C=>()=>qe(Ae,null,{default:()=>qe(xe,{icon:C})}),h=C=>[{label:c("copyData"),key:"copy-data",icon:k("carbon:copy")},{label:c("fillInFakeData"),key:"fill-in-fake-data",icon:k("carbon:magic-wand")},{label:c("duplicateSection"),key:"duplicate-section",icon:k("carbon:partition-same")},{label:c("removeSection"),key:"remove-section",icon:k("carbon:close")},{key:"first-divider",type:"divider"},{key:"display-section",type:"render",render:()=>qe(Rn,{checked:ee.value[`${C.slug}__${C.pivot?.linkId}`],"onUpdate:checked":t=>{ee.value[`${C.slug}__${C.pivot?.linkId}`]=t},size:"small",class:"px-3 py-1",onClick:t=>t.stopPropagation()},{default:()=>qe("span",{class:"ml-1"},{default:()=>c("displaySection")})})},{key:"second-divider",type:"divider"},{key:"data-source",type:"render",render:()=>qe("div",{class:"px-3 py-1"},[qe("div",{class:"text-sm font-semibold mb-1"},c("dataSource")),qe(Mn,{value:`${C.pivot?.dataSourcePageId}__${C.pivot?.dataSourceLinkId}`,options:pe(C.pages||[],C),placeholder:c("select"),labelField:"label",valueField:"value",filterable:!0,size:"small",class:"!w-[225px]","onUpdate:value":t=>se(C,t,T.value)})])}],J=(C,t)=>{switch(C){case"copy-data":re.value?.copyData(t);break;case"fill-in-fake-data":j(t);break;case"duplicate-section":le(t);break;case"remove-section":ie(t);break}};let te=null;dn(()=>{setTimeout(()=>{d.value=null,y.value=!1},500),te=document.getElementById("preview")});const q=C=>{C.slug==d.value?.slug&&C.pivot?.linkId==d.value?.pivot?.linkId?y.value=!0:(d.value=C,y.value=!1),te?.contentWindow?.postMessage({type:ke.SELECT_SIDEBAR_SECTION,slug:C.slug,linkId:C.pivot?.linkId},oe?.apiBaseUrl??"*")};dn(()=>{window.addEventListener("message",C=>{if(C.data?.type===ke.SELECT_PREVIEW_SECTION){const t=b.value.find(a=>a.slug==C.data?.slug&&a.pivot?.linkId==C.data?.linkId);t?.slug==d.value?.slug&&t?.pivot?.linkId==d.value?.pivot?.linkId?y.value=!0:(d.value=t,y.value=!1)}})});const ce=ct(()=>O.value?.data),Ee=ct(()=>O.value?.initialData),$e=ct(()=>O.value?.formValueValidate1),_e=ct(()=>O.value?.formValueValidate2);return f({sectionData:ce,initialSectionData:Ee,formValueValidate1:$e,formValueValidate2:_e,pageSections:b,initialPageSections:L,pageSectionsEnabled:ee,initialPageSectionsEnabled:Q,isEverythingUnchanged:T}),(C,t)=>{const a=oa,u=Gt,p=Kt,I=An,x=sa,_=qt,l=$t,D=Ba("Draggable"),H=zn,ne=Vn;return Ce(),Pe("aside",{class:mt(["sidebar-left absolute left-0 top-0 h-full z-30 w-74 bg-white dark:bg-[#18181b] border-r border-gray-200 dark:border-gray-800 overflow-y-auto transition-all duration-300 ease-in-out",{"translate-x-0":r(e),"-translate-x-full":!r(e),"shadow-xl":(r(n)||r(W)||r(w))&&r(e)}])},[r(d)&&r(y)?(Ce(),on(Na,{ref_key:"sectionData",ref:O,key:`${r(d)?.slug}-${r(d)?.pivot?.linkId}-data`,page:r(z)},null,8,["page"])):(Ce(),Pe(Tt,{key:1},[Me("div",Pa,[M(ne,{appear:"",name:"slide-fade"},{default:ae(()=>[Me("section",null,[r(i)?(Ce(),Pe("section",La,[(Ce(),Pe(Tt,null,ln(7,P=>M(a,{key:P,width:"100%",height:"42px",sharp:!1,class:"mb-2"})),64))])):(Ce(),Pe("section",Aa,[r(z)&&Array.isArray(r(z).sections)&&r(z).sections.length?(Ce(),Pe("section",za,[M(D,{list:r(b)},{default:ae(()=>[(Ce(!0),Pe(Tt,null,ln(r(b),(P,De)=>(Ce(),Pe("section",{key:P.id},[M(_,{hoverable:"",embedded:r(ee)[`${P.slug}__${P.pivot?.linkId}`],bordered:"",size:"small",class:"my-0.5",style:Oa(`${r(d)?.slug==P?.slug&&r(d)?.pivot?.linkId==P?.pivot?.linkId?"border: 1px solid "+r(s):""}`),"header-class":"!pr-2.5 !pl-2"},{header:ae(()=>[Me("div",{class:"flex items-center justify-between cursor-pointer",onClick:ve=>q(P)},[Me("div",Ma,[M(r(Ae),{size:"14",class:"cursor-move mr-1",onClick:t[0]||(t[0]=rn(()=>{},["stop"]))},{default:ae(()=>[M(r(xe),{icon:"fa-solid:grip-lines"})]),_:1}),M(u,{size:"tiny",type:"info"},{default:ae(()=>[ft(rt(De+1),1)]),_:2},1024),M(p,{vertical:"",class:mt(r(m)("!bg-zinc-400","!bg-slate-500"))},null,8,["class"]),M(I,{"line-clamp":1,class:"text-sm"},{default:ae(()=>[ft(rt(r(de)(P)),1)]),_:2},1024)]),M(x,{size:"small",trigger:"click",options:h(P),onSelect:ve=>J(ve,P)},{default:ae(()=>[M(r(Ae),{class:"cursor-pointer px-1",onClick:t[1]||(t[1]=rn(()=>{},["stop"]))},{default:ae(()=>[M(r(xe),{icon:"carbon:overflow-menu-vertical"})]),_:1})]),_:1},8,["options","onSelect"])],8,Ra)]),_:2},1032,["embedded","style"]),De<r(b).length-1?(Ce(),Pe("div",{key:0,class:mt(`relative border-dashed border-y-2 h-1.5  ${r(m)("!border-zinc-300","!border-zinc-600")}`)},[Me("div",Ua,[M(l,{size:"tiny",type:"info",title:r(c)("insertSections"),onClick:ve=>r(re)?.openInsertSectionsDialog(De+1)},{icon:ae(()=>[M(r(Ae),null,{default:ae(()=>[M(r(xe),{icon:"carbon:insert-page"})]),_:1})]),_:1},8,["title","onClick"])])],2)):sn("",!0)]))),128))]),_:1},8,["list"]),M(_,{size:"small",class:"mb-2 !border-dashed !border-2",onClick:t[2]||(t[2]=P=>r(re)?.openToggleSectionsDialog())},{default:ae(()=>[Me("div",ja,[M(r(Ae),{size:"16"},{default:ae(()=>[M(r(xe),{icon:"carbon:row"})]),_:1}),ft(" "+rt(r(c)("insertOrRemoveSections")),1)])]),_:1})])):(Ce(),Pe("section",Ha,[M(_,{size:"small",class:mt(`mb-2 !border-dashed !border-2 ${r(m)("!border-zinc-300","!border-zinc-600")}`)},{default:ae(()=>[M(H,null,{icon:ae(()=>[M(r(Ae),null,{default:ae(()=>[M(r(xe),{icon:"carbon:page-break"})]),_:1})]),extra:ae(()=>[Me("div",Wa,[M(l,{size:"small",secondary:"",onClick:t[3]||(t[3]=P=>r(re)?.openToggleSectionsDialog())},{icon:ae(()=>[M(r(Ae),null,{default:ae(()=>[M(r(xe),{icon:"carbon:row"})]),_:1})]),default:ae(()=>[ft(" "+rt(r(c)("insertSections")),1)]),_:1})])]),default:ae(()=>[Me("p",Fa,rt(r(c)("noSectionOnThisPage")),1)]),_:1})]),_:1},8,["class"])]))]))])]),_:1})]),r($)?(Ce(),on(ra,{key:0,ref_key:"sectionActions",ref:re,page:r(z),slug:r($),"page-sections":r(b)},null,8,["page","slug","page-sections"])):sn("",!0)],64))],2)}}}),Ga=Ct(qa,[["__scopeId","data-v-b9ded999"]]),{defineComponent:Ka}=await E("vue"),{unref:Bt,normalizeStyle:Ya,openBlock:pn,createElementBlock:vn,createCommentVNode:Qa,renderSlot:Xa}=await E("vue"),{ref:gn,onUnmounted:Za}=await E("vue"),eo={class:"relative"},to=Ka({__name:"ProgressBarWrapper",props:{color:{default:"blue"}},setup(S,{expose:f}){const c=S,W=gn(!1),w=gn(0);let m;const s=()=>{W.value=!0,w.value=0;const d=[{until:30,step:10,interval:100},{until:60,step:5,interval:200},{until:80,step:2,interval:300},{until:95,step:.5,interval:500}];let y=0;const oe=()=>{const $=d[y];w.value<$.until?w.value=Math.min(w.value+$.step,$.until):y<d.length-1&&(y++,window.clearInterval(m),m=window.setInterval(oe,d[y].interval))};m=window.setInterval(oe,d[0].interval)},e=()=>{m&&(clearInterval(m),m=void 0),w.value=100,setTimeout(()=>{W.value=!1,w.value=0},300)},n=()=>{m&&(clearInterval(m),m=void 0),W.value=!1,w.value=0};return Za(()=>{m&&clearInterval(m)}),f({start:s,complete:e,reset:n}),(d,y)=>(pn(),vn("div",eo,[Bt(W)?(pn(),vn("div",{key:0,class:"absolute top-0 left-0 h-0.5 z-50 transition-all ease-out",style:Ya({width:Bt(w)+"%",transitionDuration:Bt(w)>=95?"0s":"500ms",backgroundColor:c.color})},null,4)):Qa("",!0),Xa(d.$slots,"default")]))}}),Fn=()=>{const{t:S}=je();return{deviceOptions:[{type:"desktop",name:S("desktop"),icon:"carbon:screen",width:1440,height:"auto"},{type:"laptop",name:S("laptop"),icon:"carbon:laptop",width:1024,height:"auto"},{type:"tablet",name:S("tablet"),icon:"carbon:tablet",width:768,height:"auto"},{type:"mobile",name:S("mobile"),icon:"carbon:mobile",width:375,height:667}]}},{defineComponent:no}=await E("vue"),{unref:o,toDisplayString:be,createElementVNode:K,resolveComponent:Vs,createVNode:B,withCtx:N,normalizeClass:ao,withModifiers:_n,openBlock:Ge,createElementBlock:ht,createTextVNode:Ot,normalizeStyle:Pt,renderList:oo,Fragment:so,createBlock:Lt,isRef:io,createSlots:lo}=await E("vue"),ro={class:"text-sm text-gray-700 dark:text-gray-400"},co={class:"flex items-center gap-x-2"},uo=["src"],po={key:1,class:"w-full h-full flex items-center justify-center"},vo={class:"mb-8 mt-2"},go={class:"flex items-center justify-between"},_o={class:"text-base flex items-center gap-2"},fo={class:"text-xs font-semibold mt-1"},mo={class:"text-sm"},ho={class:"text-xs font-normal"},So=["innerHTML"],yo={class:"flex items-center justify-between"},bo={class:"text-base font-semibold"},{storeToRefs:fn}=await E("pinia"),{inject:Xe,computed:At,onMounted:mn,ref:ko,useTemplateRef:wo,onUnmounted:$o}=await E("vue"),Co=no({__name:"Preview",setup(S,{expose:f}){const{t:c,locale:W}=je(),{deviceOptions:w}=Fn(),{tr:m,isSmScreen:s,isMdScreen:e,appPrimaryColor:n}=et(),d=Hn(),{accessToken:y}=fn(Kn()),oe=tt(),{undo:$,redo:z,changeVersion:i,isVersionSelected:b,getLastSnapshotFrom:L}=oe,{isOverlayMode:ee,showLeftSidebar:Q,showRightSidebar:de,showVersionsHistory:pe,currentDeviceType:se,selectedSection:ie,showSectionData:le,versionItemsList:j,canUndo:O,canRedo:re}=fn(oe),T=Xe("pages"),k=Xe("appConfig"),h=Xe("headerHeight"),J=Xe("footerHeight"),te=Xe("windowHeight"),q=Xe("everythingIsSaved"),ce=At(()=>w.find(_=>_.type===se.value)),Ee=At(()=>`${k?.apiBaseUrl}/editor-page/s/${d.query.page}?token=${y.value}`),$e=At(()=>!h||!J||!te?0:te.value-(h.value+J.value+100));let _e=null;mn(()=>{_e=document.getElementById("preview"),_e?.addEventListener("load",function(){C()})});const C=()=>{_e?.contentWindow?.postMessage({type:ke.ENABLE_EDITION_MODE,primaryColor:n.value},k?.apiBaseUrl??"*")},t=()=>{_e?.contentWindow?.postMessage({type:ke.DESELECT_ALL_SECTIONS},k?.apiBaseUrl??"*"),ie.value=null,le.value=!1},a=ko(!1),u=wo("progressBar");let p=null;const I=()=>{const _=document.querySelector(".restart-icon");if(_){const l=()=>{a.value=!1,u.value?.complete(),p=null};_.addEventListener("animationiteration",l,{once:!0}),p=()=>{_.removeEventListener("animationiteration",l)}}else a.value=!1,u.value?.complete()},x=()=>{_e?.contentWindow?.postMessage({type:ke.RELOAD},k?.apiBaseUrl??"*"),a.value=!0,u.value?.start(),setTimeout(()=>{I()},15e3)};return mn(()=>{window.addEventListener("message",_=>{_.data?.type===ke.RELOAD_COMPLETE&&I()})}),$o(()=>{p&&p()}),f({deselectAllSections:t,enableEditionMode:C,reloadPreview:x}),(_,l)=>{const D=xe,H=Ae,ne=$t,P=Un,De=On,ve=to,fe=Gt,He=Kt,It=Ln,xt=Pn,pt=Rn,Ke=qt,Et=la,Dt=zn,vt=ia;return Ge(),ht("main",{class:"flex-1 w-full h-full overflow-auto bg-gray-100 dark:bg-[#09090b] flex items-center justify-center px-2 transition-all duration-300 ease-in-out",style:Pt({marginLeft:!o(ee)&&!(o(s)||o(e))&&o(Q)?"278px":"0px",marginRight:!o(ee)&&!(o(s)||o(e))&&o(de)?"270px":"0px"})},[K("div",{class:"bg-white dark:bg-[#18181b] rounded-xl shadow-md overflow-hidden transition-all duration-300",style:Pt({width:o(ce)?.width+"px",maxWidth:"100%"})},[B(ve,{color:o(n),ref_key:"progressBar",ref:u},{default:N(()=>[K("div",{class:"border-b border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-[#18181b] py-2 px-4 flex items-center justify-between",onClick:l[1]||(l[1]=_n(()=>{},["stop"]))},[K("span",ro,be(o(ce)?.name)+" ("+be(o(ce)?.width)+"px) ",1),K("div",co,[B(P,{trigger:"hover"},{trigger:N(()=>[B(ne,{secondary:"",onClick:l[0]||(l[0]=F=>pe.value=!0)},{icon:N(()=>[B(H,null,{default:N(()=>[B(D,{icon:"carbon:recently-viewed"})]),_:1})]),_:1})]),default:N(()=>[K("span",null,be(o(c)("history")),1)]),_:1}),B(P,{trigger:"hover"},{trigger:N(()=>[B(ne,{secondary:"",disabled:!o(O),onClick:o($)},{icon:N(()=>[B(H,null,{default:N(()=>[B(D,{icon:"carbon:undo"})]),_:1})]),_:1},8,["disabled","onClick"])]),default:N(()=>[K("span",null,be(o(c)("undo")),1)]),_:1}),B(P,{trigger:"hover"},{trigger:N(()=>[B(ne,{secondary:"",disabled:!o(re),onClick:o(z)},{icon:N(()=>[B(H,null,{default:N(()=>[B(D,{icon:"carbon:redo"})]),_:1})]),_:1},8,["disabled","onClick"])]),default:N(()=>[K("span",null,be(o(c)("redo")),1)]),_:1}),l[6]||(l[6]=K("div",{class:"w-px h-6 bg-gray-300 dark:bg-gray-700 mx-1"},null,-1)),B(P,{trigger:"hover"},{trigger:N(()=>[B(ne,{secondary:"",disabled:!o(q),onClick:x},{icon:N(()=>[B(H,null,{default:N(()=>[B(D,{icon:"carbon:restart",class:ao(["restart-icon",{spin:o(a)}])},null,8,["class"])]),_:1})]),_:1},8,["disabled"])]),default:N(()=>[K("span",null,be(o(c)("refresh")),1)]),_:1})])]),K("div",{class:"p-2 min-h-[580px] editor-container",style:Pt(`height: ${o(ce)?.height=="auto"||o(ce)?.height&&o(ce)?.height>o($e)?o($e):o(ce)?.height}px`)},[o(d).query.page&&o(T)?.find(F=>F.slug==o(d).query.page)?(Ge(),ht("iframe",{key:0,id:"preview",frameborder:"0",src:o(Ee),class:"w-full h-full"},null,8,uo)):(Ge(),ht("div",po,[B(De,{type:"warning","show-icon":""},{default:N(()=>[Ot(be(o(c)("noPreviewAvailable")),1)]),_:1})]))],4)]),_:1},8,["color"])],4),B(vt,{show:o(pe),"onUpdate:show":l[5]||(l[5]=F=>io(pe)?pe.value=F:null),preset:"card",style:{width:"600px"},bordered:!1,"show-icon":!1,"mask-closable":!1,title:o(c)("history")},lo({default:N(()=>[K("section",vo,[o(j)?.length?(Ge(),Lt(Et,{key:0,style:{"max-height":"400px"}},{default:N(()=>[(Ge(!0),ht(so,null,oo(o(j).reverse(),(F,gt)=>(Ge(),Lt(Ke,{key:F.id,hoverable:"",embedded:"",size:"small",class:"mb-2 cursor-pointer",onClick:nt=>o(i)(F.id)},{default:N(()=>[K("div",go,[K("div",null,[K("div",_o,[B(fe,{size:"tiny",type:"primary"},{default:N(()=>[Ot(be(o(j)?.length-gt),1)]),_:2},1024),Ot(" "+be(`${F.type=="data"?o(c)("changeOfDataFrom"):o(c)("changeOfSettingsFrom")} "${o(m)(F.title)}"`),1)]),K("div",fo,be(o(Nn)(F.date,{locale:o(W),outPattern:"DD MMMM - HH:mm:ss"})),1),B(He,{class:"!my-2"}),B(xt,{"arrow-placement":"right"},{default:N(()=>[B(It,{name:"1",onClick:l[2]||(l[2]=_n(()=>{},["stop"]))},{header:N(()=>[K("span",mo,be(o(c)("details")),1)]),default:N(()=>[K("section",null,[K("div",ho,be(F.id),1),K("div",{innerHTML:da(F.data,o(L)(F.id,F.type))},null,8,So)])]),_:2},1024)]),_:2},1024)]),B(pt,{checked:o(b)(F.id).value,"onUpdate:checked":nt=>o(b)(F.id).value=nt,size:"medium"},null,8,["checked","onUpdate:checked"])])]),_:2},1032,["onClick"]))),128)),B(Ke,{hoverable:"",embedded:"",size:"small",class:"cursor-pointer",onClick:l[4]||(l[4]=F=>o(i)(null))},{default:N(()=>[K("div",yo,[K("div",bo,be(o(c)("startOfChanges")),1),B(pt,{checked:o(b)(null).value,"onUpdate:checked":l[3]||(l[3]=F=>o(b)(null).value=F),size:"medium"},null,8,["checked"])])]),_:1})]),_:1})):(Ge(),Lt(Dt,{key:1,description:o(c)("noActionTaken"),class:"my-10"},{icon:N(()=>[B(H,null,{default:N(()=>[B(D,{icon:"carbon:row"})]),_:1})]),_:1},8,["description"]))])]),_:2},[o(j).length?{name:"footer",fn:N(()=>[K("div",null,be(`${o(j).length} ${o(j).length==1?o(c)("action").toLowerCase():o(c)("actions").toLowerCase()}`),1)]),key:"0"}:void 0]),1032,["show","title"])],4)}}}),Io=Ct(Co,[["__scopeId","data-v-156629a2"]]),{defineComponent:xo}=await E("vue"),{unref:Le,resolveComponent:Ns,createVNode:zt,withCtx:hn,openBlock:Ze,createBlock:Sn,createCommentVNode:Eo,renderList:Do,Fragment:Vo,createElementBlock:St,toDisplayString:yn,createElementVNode:bn}=await E("vue"),No={key:1},To={class:"font-bold"},Bo={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400 flex flex-col items-center"},{storeToRefs:Oo}=await E("pinia"),{ref:yt,inject:kn,computed:Po,watch:wn,reactive:Rt,onMounted:Lo}=await E("vue"),Ao=xo({__name:"Settings",setup(S,{expose:f}){const{t:c}=je(),{tr:W,editKeysToCamelCase:w}=et(),m=tt(),{selectedSection:s,currentVersionId:e,ignoreSettingsChangeEffects:n,ignoreVersionChangeEffects:d}=Oo(m),{addVersionBaseSnapshot:y,getSectionSettingsSnapshot:oe}=m,$=yt({}),z=yt({}),i=yt(),b=yt(Be()),L=kn("page"),ee=kn("appConfig"),{data:Q,isPending:de}=xn({slug:s.value?.slug||"",linkId:s.value?.pivot?.dataSourceLinkId,pageId:s.value?.pivot?.dataSourcePageId}),pe=Po({get:()=>{if($.value)return $.value;{const ie={};for(const le in w(Q.value?.settingsStructure)??{})ie[le]={};return ie}},set:ie=>{$.value=ie}});wn(()=>Q?.value,ie=>{const le=oe(s.value?.slug||"",s.value?.pivot?.linkId||"",L?.value?.id||0)?.data;if(le&&!En(le)){$.value=le;return}const j=Y.cloneDeep(ie),O=j?.pages?.length?j?.pages[0].pivot:null;j&&$&&(Y.isObject(O?.settings)&&Dn(O?.settings)?$.value=Rt(O?.settings):$.value=Rt({}),Y.forIn(w(j.settingsStructure),(re,T)=>{$.value[T]||($.value[T]=Rt({}))})),z&&$&&setTimeout(()=>{z.value=Y.cloneDeep($.value),s.value?.slug&&s.value?.pivot?.linkId&&L?.value?.id&&(y(s.value?.slug,s.value?.pivot?.linkId,L?.value?.id,z.value,"settings"),se?.contentWindow?.postMessage({type:ke.SEND_BASE_SECTION_SETTINGS,slug:s.value?.slug,linkId:s.value?.pivot?.linkId,pageId:L?.value?.id,settings:JSON.parse(JSON.stringify(z.value||{}))},ee?.apiBaseUrl??"*"))},500),b.value=Be()},{immediate:!0,deep:!0});let se=null;return Lo(()=>{se=document.getElementById("preview")}),wn(()=>e.value,()=>{d.value||s.value?.slug&&s.value?.pivot?.linkId&&L?.value?.id&&(n.value=!0,$.value=oe(s.value?.slug,s.value?.pivot?.linkId,L?.value?.id)?.data,se?.contentWindow?.postMessage({type:ke.SEND_SECTION_SETTINGS,slug:s.value?.slug,linkId:s.value?.pivot?.linkId,pageId:L?.value?.id,settings:JSON.parse(JSON.stringify($.value||{}))},ee?.apiBaseUrl??"*"),b.value=Be())}),f({settings:$,initialSettings:z,formValueValidate:i}),(ie,le)=>{const j=Bn,O=Tn,re=Kt,T=xe;return Le(de)?(Ze(),Sn(O,{key:0,align:"center",justify:"center",class:"min-h-[50vh]"},{default:hn(()=>[zt(j)]),_:1})):(Ze(),St("div",No,[Le(Q)?.settingsStructure?(Ze(!0),St(Vo,{key:0},Do(Le(w)(Le(Q)?.settingsStructure),(k,h)=>(Ze(),St("section",{key:h},[zt(re,{"title-placement":"right",class:"!my-1"},{default:hn(()=>[bn("span",To,yn(Le(W)(k.title)),1)]),_:2},1024),Le(pe)[h]?(Ze(),Sn(Wt,{key:`${Le(b)}-${h}-settings-form`,modelValue:Le(pe)[h],"onUpdate:modelValue":J=>Le(pe)[h]=J,items:k.items,"form-size":"small","label-placement":"top",onUpdate:(J,te)=>{i.value=te}},null,8,["modelValue","onUpdate:modelValue","items","onUpdate"])):Eo("",!0)]))),128)):(Ze(),St("div",Bo,[zt(T,{icon:"carbon:settings-adjust",class:"text-3xl mb-2"}),bn("p",null,yn(Le(c)("noSettingsDefinedForThisSection")),1)]))]))}}}),{defineComponent:zo}=await E("vue"),{unref:Ne,toDisplayString:$n,createElementVNode:Mt,openBlock:Ut,createBlock:Ro,resolveComponent:Ts,createVNode:Mo,createElementBlock:Cn,normalizeClass:Uo}=await E("vue"),jo={class:"p-4"},Ho={class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"},Fo={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400 flex flex-col items-center"},{storeToRefs:Wo}=await E("pinia"),{useTemplateRef:Jo,computed:jt}=await E("vue"),qo=zo({__name:"RightSidebar",setup(S,{expose:f}){const{t:c}=je(),{isSmScreen:W,isMdScreen:w}=et(),{showRightSidebar:m,isOverlayMode:s,selectedSection:e}=Wo(tt()),n=Jo("sectionSettings"),d=jt(()=>n.value?.settings),y=jt(()=>n.value?.initialSettings),oe=jt(()=>n.value?.formValueValidate);return f({sectionSettings:d,initialSectionSettings:y,formValueValidate:oe}),($,z)=>{const i=xe;return Ut(),Cn("aside",{class:Uo(["sidebar-right absolute right-0 top-0 h-full z-30 w-72 bg-white dark:bg-[#18181b] border-l border-gray-200 dark:border-gray-800 overflow-y-auto transition-all duration-300 ease-in-out",{"translate-x-0":Ne(m),"translate-x-full":!Ne(m),"shadow-xl":(Ne(s)||Ne(W)||Ne(w))&&Ne(m)}])},[Mt("div",jo,[Mt("h2",Ho,$n(Ne(c)("settings")),1),Ne(e)?(Ut(),Ro(Ao,{ref_key:"sectionSettings",ref:n,key:`${Ne(e)?.slug}-${Ne(e)?.pivot?.linkId}-settings`})):(Ut(),Cn("div",Fo,[Mo(i,{icon:"carbon:cursor-1",class:"text-3xl mb-2"}),Mt("p",null,$n(Ne(c)("selectSectionToEditItsProperties")),1)]))])],2)}}}),Go=Ct(qo,[["__scopeId","data-v-fc6d5938"]]),{onMounted:Ko,onBeforeUnmount:Yo}=await E("vue"),Qo=S=>{const{t:f}=je(),c=Jt(),W=()=>new Promise(m=>{let s=!1;const e=n=>{s||(s=!0,m(n))};c.warning({title:f("unsavedChanges"),content:f("unsavedChangesWarningMessage"),positiveText:f("leave"),negativeText:f("cancel"),onPositiveClick:()=>e(!0),onNegativeClick:()=>e(!1),onClose:()=>e(!1)})});pa(async(m,s,e)=>{if(!S())return e();await W()?e():e(!1)});const w=m=>{S()&&(m.preventDefault(),m.returnValue="")};Ko(()=>{window.addEventListener("beforeunload",w)}),Yo(()=>{window.removeEventListener("beforeunload",w)})},{defineComponent:Xo}=await E("vue"),{resolveComponent:Bs,createVNode:U,withCtx:A,unref:v,toDisplayString:we,createElementVNode:ue,openBlock:Te,createElementBlock:Ue,createCommentVNode:ut,createBlock:Ht,renderList:Zo,Fragment:bt,createTextVNode:kt,withModifiers:wt}=await E("vue"),es={class:"flex items-center"},ts={class:"layout-topbar-logo ml-2"},ns=["src","alt"],as={key:0,class:"ml-2 text-base font-bold"},os={class:"flex items-center gap-x-2"},ss={class:"flex items-center gap-x-2"},is={class:"flex flex-1 overflow-hidden relative main-container"},ls={class:"font-medium"},rs={key:0},cs={class:"font-medium"},us={key:1},{inject:ds,computed:In,useTemplateRef:dt,ref:ps,h:vs,onMounted:gs,watch:Ft,provide:Ie}=await E("vue"),{storeToRefs:_s}=await E("pinia"),Os=Xo({__name:"index",setup(S){const{t:f,locale:c}=je(),{warning:W}=fa(),{deviceOptions:w}=Fn(),{getSettingValue:m}=Yn(),{tr:s,icon:e,isSmScreen:n,isMdScreen:d}=et(),y=Hn(),oe=va(),$=Jt(),z=ds("appConfig"),i=In(()=>y.query.page||""),{page:b}=jn(i?.value||""),{data:L}=Qn(),{data:ee}=Xn(),{data:Q,isPending:de}=Zn(),{mutate:pe,isPending:se}=ca(),{mutate:ie,isPending:le}=ua(),j=tt(),{isOverlayMode:O,showLeftSidebar:re,showRightSidebar:T,currentDeviceType:k,selectedSection:h,currentVersionId:J,lastSavedVersionId:te,ignoreDataChangeEffects:q,ignoreSettingsChangeEffects:ce}=_s(j),{addVersionItem:Ee,resetVersions:$e,getDataSnapshotBySections:_e,getDataValidatorBySections:C,getSettingsSnapshotBySections:t,getSettingsValidatorBySections:a}=j,u=dt("header"),p=dt("footer"),I=dt("preview"),x=dt("leftSidebar"),_=dt("rightSidebar"),{height:l}=ga(),{height:D}=ot(u),{height:H}=ot(p),{width:ne}=ot(I),{width:P}=ot(x),{width:De}=ot(_),ve=ps(Be()),fe=()=>{re.value=!re.value},He=()=>{T.value=!T.value},It=()=>{I.value&&I.value.deselectAllSections()},xt=G=>{if(G==i.value)return;const R=`${ea(ta())}/${(m("basePath")||"creopse")+Qt.VISUAL_EDITOR.PATH}`;Xt(R,{page:G},{target:"_self",method:"GET"})},pt=G=>vs("span",{},{default:()=>s(G.title)}),Ke=In(()=>J.value==te.value&&Y.isEqual(x.value?.pageSections,x.value?.initialPageSections)&&Y.isEqual(x.value?.pageSectionsEnabled,x.value?.initialPageSectionsEnabled)),Et=async()=>{const G=_e(),R=C(),he=t(),ze=a(),Oe=[...new Set([...Object.keys(G),...Object.keys(he)])];let Ve=[];for(const Se of Oe){const me=G[Se],Re=he[Se];if(me.hasChanges||Re.hasChanges){const Wn=await R[Se](),Jn=await ze[Se](),Yt=async()=>{ie({slug:Se.split("+")[0],dataSourceLinkId:me.pivot?me.pivot?.dataSourceLinkId:Re.pivot?Re.pivot?.dataSourceLinkId:null,dataSourcePageId:me.pivot?me.pivot?.dataSourcePageId:Re.pivot?Re.pivot?.dataSourcePageId:null,...me&&{data:me.data},...Re&&{settings:Re.data},hideSuccessMessage:!0})};Wn&&Jn?(await Yt(),Ve.push(Se)):await W({title:f("confirm"),content:f("mandatoryFieldsNotFilledInConfirmation"),positiveText:f("yes"),negativeText:f("cancel")})=="positive"&&(await Yt(),Ve.push(Se))}}pe({slug:i.value,sectionsOrder:x.value?.pageSections?.map(Se=>`${Se.slug}__${Se.pivot?.linkId}`),sectionsDisabled:Object.keys(x.value?.pageSectionsEnabled).filter(Se=>!x.value?.pageSectionsEnabled[Se]),hideSuccessMessage:Ve.length!==Oe.length}),Ve.length===Oe.length&&$e(),setTimeout(()=>{I.value?.enableEditionMode()},3500)},Dt=()=>{const G=Q.value?.find(R=>R.pageId==b.value?.id);if(G){const R=`${z?.apiBaseUrl}${G.path}`;Xt(R,{},{target:"_blank",method:"GET"})}else $.warning({title:f("previewUnavailable"),content:f("publishThisPage"),positiveText:f("ok")})},vt="Creopse";_a({title:()=>(s(y?.meta?.title)?s(y?.meta?.title)+" - ":"")+vt}),Qo(()=>!Ke.value);let F=null;gs(()=>{setTimeout(()=>{$e()},500),F=document.getElementById("preview")}),Ft(()=>[x.value?.pageSections,x.value?.pageSectionsEnabled],([G,R])=>{F?.contentWindow?.postMessage({type:ke.SEND_PAGE_SECTIONS,sectionsList:JSON.parse(JSON.stringify(G)),sectionsOrder:JSON.parse(JSON.stringify(G?.map(he=>`${he.slug}__${he.pivot?.linkId}`))),sectionsDisabled:JSON.parse(JSON.stringify(Object.keys(R).filter(he=>!R[he])))},z?.apiBaseUrl??"*")},{deep:!0});let gt;Ft(()=>x.value?.sectionData,G=>{G&&(clearTimeout(gt),gt=setTimeout(()=>{if(h.value?.slug&&h.value?.pivot?.linkId&&b.value?.id){if(q.value){q.value=!1;return}Ee(h.value?.slug,h.value?.pivot?.linkId,b.value?.id,h.value?.title,h.value?.pivot,G,"data",async()=>await x.value?.formValueValidate1?.()&&await x.value?.formValueValidate2?.()),F?.contentWindow?.postMessage({type:ke.SEND_SECTION_DATA,slug:h.value?.slug,linkId:h.value?.pivot?.linkId,pageId:b.value?.id,data:JSON.parse(JSON.stringify(G||{}))},z?.apiBaseUrl??"*")}},432))},{deep:!0});let nt;return Ft(()=>_.value?.sectionSettings,G=>{G&&(clearTimeout(nt),nt=setTimeout(()=>{if(h.value?.slug&&h.value?.pivot?.linkId&&b.value?.id){if(ce.value){ce.value=!1;return}Ee(h.value?.slug,h.value?.pivot?.linkId,b.value?.id,h.value?.title,h.value?.pivot,G,"settings",async()=>await _.value?.formValueValidate?.()),F?.contentWindow?.postMessage({type:ke.SEND_SECTION_SETTINGS,slug:h.value?.slug,linkId:h.value?.pivot?.linkId,pageId:b.value?.id,settings:JSON.parse(JSON.stringify(G||{}))},z?.apiBaseUrl??"*")}},432))},{deep:!0}),Ie("page",b),Ie("pages",L),Ie("sections",ee),Ie("currentPageSlug",i),Ie("headerHeight",D),Ie("footerHeight",H),Ie("windowHeight",l),Ie("previewWidth",ne),Ie("leftSidebarWidth",P),Ie("rightSidebarWidth",De),Ie("globalRefreshKey",ve),Ie("everythingIsSaved",Ke),(G,R)=>{const he=xe,ze=Ae,Oe=$t,Ve=Un,Se=Mn;return Te(),Ue("div",{class:"h-screen flex flex-col overflow-hidden bg-[#f1f5f9] dark:bg-[#09090b]",onClick:It},[ue("header",{ref_key:"header",ref:u,class:"bg-white dark:bg-[#18181b] border-b border-gray-200 dark:border-gray-800 px-4 py-2 flex items-center justify-between z-20 relative",onClick:R[2]||(R[2]=wt(()=>{},["stop"]))},[ue("div",es,[U(Ve,{trigger:"hover"},{trigger:A(()=>[U(Oe,{secondary:"",onClick:fe},{icon:A(()=>[U(ze,{size:"24"},{default:A(()=>[U(he,{icon:"carbon:menu"})]),_:1})]),_:1})]),default:A(()=>[ue("span",null,we(v(f)("details")),1)]),_:1}),ue("div",ts,[ue("img",{class:"cursor-pointer h-12",src:v(e),alt:v(vt),onClick:R[0]||(R[0]=me=>v(oe).push(v(Qt).DASHBOARD.PATH))},null,8,ns)]),v(n)?ut("",!0):(Te(),Ue("div",as,we(v(f)("visualEditor")),1))]),ue("div",os,[v(n)||v(d)?ut("",!0):(Te(),Ht(Se,{key:0,value:v(i),options:v(L),"render-label":pt,"label-field":"title","value-field":"slug",size:"medium",filterable:"","onUpdate:value":xt},null,8,["value","options"])),(Te(!0),Ue(bt,null,Zo(v(w),me=>(Te(),Ht(Ve,{key:me.type,trigger:"hover"},{trigger:A(()=>[U(Oe,{onClick:Re=>k.value=me.type,secondary:"",type:v(k)===me.type?"primary":"default"},{icon:A(()=>[U(ze,null,{default:A(()=>[U(he,{icon:me.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["onClick","type"])]),default:A(()=>[ue("span",null,we(me.name),1)]),_:2},1024))),128))]),ue("div",ss,[v(n)||v(d)?ut("",!0):(Te(),Ue(bt,{key:0},[U(Ve,{trigger:"hover"},{trigger:A(()=>[U(Oe,{secondary:"",onClick:R[1]||(R[1]=me=>O.value=!v(O)),type:v(O)?"primary":"default"},{icon:A(()=>[U(ze,null,{default:A(()=>[U(he,{icon:v(O)?"carbon:layers":"carbon:panel-expansion"},null,8,["icon"])]),_:1})]),_:1},8,["type"])]),default:A(()=>[ue("span",null,we(v(O)?v(f)("overlayMode"):v(f)("dockedMode")),1)]),_:1}),R[6]||(R[6]=ue("div",{class:"w-px h-6 bg-gray-300 dark:bg-gray-700 mx-1"},null,-1))],64)),U(Ve,{trigger:"hover",disabled:!v(n)},{trigger:A(()=>[U(Oe,{secondary:"",type:"success",disabled:v(Ke),loading:v(se)||v(le),onClick:Et},{icon:A(()=>[U(ze,null,{default:A(()=>[U(he,{icon:"carbon:save-annotation"})]),_:1})]),default:A(()=>[v(n)?ut("",!0):(Te(),Ue(bt,{key:0},[kt(we(v(f)("publish")),1)],64))]),_:1},8,["disabled","loading"])]),default:A(()=>[ue("span",null,we(v(f)("publish")),1)]),_:1},8,["disabled"]),U(Ve,{trigger:"hover",disabled:!v(n)},{trigger:A(()=>[U(Oe,{secondary:"",type:"info",disabled:v(de),onClick:Dt},{icon:A(()=>[U(ze,null,{default:A(()=>[U(he,{icon:"carbon:launch"})]),_:1})]),default:A(()=>[v(n)?ut("",!0):(Te(),Ue(bt,{key:0},[kt(we(v(f)("preview")),1)],64))]),_:1},8,["disabled"])]),default:A(()=>[ue("span",null,we(v(f)("preview")),1)]),_:1},8,["disabled"]),U(Ve,{trigger:"hover"},{trigger:A(()=>[U(Oe,{secondary:"",type:"primary",onClick:He},{icon:A(()=>[U(ze,null,{default:A(()=>[U(he,{icon:"carbon:settings"})]),_:1})]),_:1})]),default:A(()=>[ue("span",null,we(v(f)("settings")),1)]),_:1})])],512),ue("div",is,[U(Ga,{ref_key:"leftSidebar",ref:x,onClick:R[3]||(R[3]=wt(()=>{},["stop"]))},null,512),U(Io,{ref_key:"preview",ref:I},null,512),(Te(),Ht(Go,{key:`${v(h)?.slug}-${v(h)?.pivot?.linkId}-sidebar-right`,ref_key:"rightSidebar",ref:_,onClick:R[4]||(R[4]=wt(()=>{},["stop"]))}))]),ue("footer",{ref_key:"footer",ref:p,class:"bg-white dark:bg-[#18181b] border-t border-gray-200 dark:border-gray-800 px-4 py-2 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 z-20 relative",onClick:R[5]||(R[5]=wt(()=>{},["stop"]))},[ue("div",null,[ue("span",ls,we(v(x)?.pageSections?.length??"0"),1),kt(" "+we(v(f)("sectionsOnPage")),1)]),v(b)?.updatedAt?(Te(),Ue("div",rs,[kt(we(v(f)("lastBackup"))+": ",1),ue("span",cs,we(v(Nn)(v(b).updatedAt,{locale:v(c),inPattern:"YYYY-MM-DD HH:mm:ss",outPattern:"DD MMMM YYYY - HH:mm"})),1)])):(Te(),Ue("div",us))],512)])}}});export{Os as default};
