import{i as M}from"./ckeditor_ckeditor5-vue-D9YIFk5Z.js";import{d as _n,u as mn}from"./vueuse_core-aA8IVeLX.js";import{u as yt,K as fn,_ as vn,L as ht,y as tt,M as yn,N as gt,O as hn,c as gn}from"./index-5sSKf-sJ.js";import{a0 as kt,a as Qe,l as kn,B as We,q as Ke,t as bn,J as wn,a3 as bt,C as wt,x as Ct,a5 as Cn,a6 as $n,aa as xn,D as Mn,M as Sn,O as $t,R as Un,ab as In,Z as Fn,o as xt,$ as Bn,ac as Vn,ai as Tn,n as Nn,at as En,u as Dn,ad as zn,ae as An,K as Ln,Q as On,aj as Rn,ao as jn}from"./naive-ui-U3LV0D3Q.js";import{u as Pn,M as p,a as Hn,b as qn,c as Gn,d as he,n as Yn,f as Qn,h as Wn,i as Kn,k as Jn,_ as Zn,m as Xn}from"./media-file-dGaUbt6f.js";import{I as Je}from"./iconify_vue-DK9FHL8l.js";import{v as Me}from"./uuid-8I8R7izr.js";import{r as eo}from"./vueuse_shared-x2l23lLx.js";import{u as Ve}from"./vue-i18n-DGGON2e6.js";import{_ as nt}from"./validator-DwVK3abb.js";import{a as to}from"./axios-ELK0WRh1.js";const{defineComponent:no}=await M("vue"),{unref:X,renderSlot:Ae,createCommentVNode:ot,normalizeStyle:lt,createElementVNode:oo,resolveComponent:Hl,isRef:lo,withCtx:Le,openBlock:ao,createBlock:so}=await M("vue"),{computed:at,ref:io,watch:st,nextTick:co,useSlots:uo}=await M("vue"),ro=no({__name:"NFullscreenModal",props:{modelValue:{type:Boolean},maskClosable:{type:Boolean,default:!1},closeOnEsc:{type:Boolean,default:!0},segmented:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},bordered:{type:Boolean,default:!1},title:{default:""},onClose:{type:Function,default:void 0}},emits:["update:modelValue","onSizeChange"],setup(G,{emit:h}){const s=G,m=h,{width:n,height:B}=_n(),U=at({get(){return s.modelValue},set($){m("update:modelValue",$)}}),f=io(0),V=()=>{const $=document.querySelector(".fullscreen-modal-header");if(!$)return;const z=window.getComputedStyle($);f.value=parseFloat(z.height),m("onSizeChange",{windowWidth:n.value,windowHeight:B.value,headerHeight:f.value,contentHeight:B.value-f.value})};st(()=>s.modelValue,$=>{$&&co(()=>V())}),st(()=>[n.value,B.value],()=>V());const v=uo(),C=at(()=>!!v.header||!!v["header-extra"]),{pickByTheme:D}=yt();return($,z)=>{const T=kt;return ao(),so(T,{show:X(U),"onUpdate:show":z[0]||(z[0]=Y=>lo(U)?U.value=Y:null),preset:"card",closable:s.closable,segmented:s.segmented,bordered:s.bordered,"mask-closable":s.maskClosable,"close-on-esc":s.closeOnEsc,title:s.title,style:lt(`width: ${X(n)}px; min-height: ${X(B)}px`),"header-style":`background-color: ${X(D)("white","rgba(24, 24, 28, 1)")}`,"header-class":`fullscreen-modal-header ${X(C)?"fixed top-0 w-full z-50":""} `,"content-class":"!p-0 fullscreen-modal-content",onClose:$.onClose},{header:Le(()=>[X(v).header?Ae($.$slots,"header",{key:0}):ot("",!0)]),"header-extra":Le(()=>[X(v)["header-extra"]?Ae($.$slots,"header-extra",{key:0}):ot("",!0)]),default:Le(()=>[oo("section",{style:lt(`margin-top: ${X(C)?X(f):"0"}px`)},[Ae($.$slots,"default")],4)]),_:3},8,["show","closable","segmented","bordered","mask-closable","close-on-esc","title","style","header-style","header-class","onClose"])}}}),{defineComponent:po}=await M("vue"),{unref:_o,renderSlot:mo,Teleport:fo,openBlock:vo,createBlock:yo,createCommentVNode:ho}=await M("vue"),{ref:go,onMounted:ko,onUnmounted:bo}=await M("vue"),Mt=po({__name:"MountedTeleport",props:{to:{}},setup(G){const h=G,s=go(!1);return ko(()=>{s.value=!0}),bo(()=>{s.value=!1}),(m,n)=>_o(s)?(vo(),yo(fo,{key:0,to:h.to},[mo(m.$slots,"default")],8,["to"])):ho("",!0)}}),Te=Symbol(),{unref:it}=await M("vue"),{defineComponent:wo}=await M("vue"),{unref:e,toDisplayString:d,createElementVNode:u,resolveComponent:ql,createVNode:a,withCtx:l,createTextVNode:le,openBlock:c,createElementBlock:_,createCommentVNode:F,isRef:ee,createBlock:N,renderList:Oe,Fragment:ue}=await M("vue"),Co={class:"px-10"},$o={key:0,class:"flex items-center gap-3"},xo={key:1,class:"flex items-center gap-3"},Mo={class:"flex justify-between items-center"},So={class:"flex items-center gap-3"},Uo={key:0},Io={key:0},Fo={key:1},Bo={key:2},Vo={key:3},To={key:4},No={key:0},Eo={class:"flex items-center justify-center h-[200px] relative"},Do={class:"text-center text-dimgray text-sm"},zo={class:"flex items-center gap-2"},Ao={class:"flex items-center gap-2"},Lo={key:1,class:"flex items-center justify-center"},Oo={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},Ro=["src"],jo={id:"video",autoplay:"",controls:"",style:{width:"100%"}},Po=["src"],Ho={class:"w-[30%]"},qo={key:0},Go={key:1},Yo={key:2},Qo={key:3},Wo={key:4},Ko={key:0},Jo={key:1},Zo={key:2},Xo={key:3},el={key:4},tl={key:5},nl={key:6},{inject:ol,ref:x,computed:Se,h:ll,watch:ct,onMounted:al}=await M("vue"),sl=wo({__name:"MediaLibrary",emits:["validate"],setup(G,{emit:h}){const s=ol(Te),m=h,{t:n,locale:B}=Ve(),{getVideoThumbnail:U}=yt(),f=Qe(),V=kn(),{mediaFileTypes:v}=Pn(),C=x(Me()),D=x(""),$=x(null),z=eo(D,500),T=x([]),Y=x(!1),E=x({}),I=x([]),K=Se(()=>v.filter(o=>o.value==p.DOCUMENT&&s?.displayDocuments||o.value==p.IMAGE&&s?.displayImages||o.value==p.VIDEO&&s?.displayVideos||o.value==p.AUDIO&&s?.displayAudios||o.value==p.OTHER&&s?.displayOtherTypes)),r=x([]),k=x(v.length===K.value.length?0:K.value[0].value),J=o=>ll("span",{},{default:()=>tt(o.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:B.value})}),L=x(0),Z=x(12),Q=x(1),me=Se(()=>({pageSize:Z.value,query:z.value,page:Q.value,type:k.value,months:r.value})),oe=o=>{Q.value=o,O()},se=o=>{Z.value=o,O()},{data:fe,refetch:O,isPending:re}=Hn(me);ct(()=>fe.value,o=>{T.value=o?.mediaFiles||[],L.value=o?.meta?.total||0,Q.value=o?.meta?.currentPage||1;let i=!0;T.value.length===0&&(i=!1);for(const y of T.value)if(y.id&&!E.value[y.id]){i=!1;break}Y.value=i,C.value=Me()},{deep:!0,immediate:!0});const{data:R}=qn(),{data:pe}=Gn(),{data:St}=he(p.IMAGE),{data:Ut}=he(p.VIDEO),{data:It}=he(p.AUDIO),{data:Ft}=he(p.DOCUMENT),{data:Bt}=he(p.OTHER),{mutateAsync:Vt}=Yn(),ke=Se(()=>(R.value||[]).map(o=>({label:o,value:o})));al(async()=>{if(s?.preselectedMediaList&&Array.isArray(s?.preselectedMediaList)){I.value=await Vt({ids:s?.preselectedMediaList}),E.value={};for(const o of I.value)o.id&&(E.value[o.id]=!0)}});const{mutate:Tt}=Qn(),Nt=async o=>{V.warning({title:n("confirm"),content:n("confirmDeleteMediaFile"),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:()=>{Tt(o)}})},{copy:Et,copied:Dt,isSupported:zt}=mn(),At=async o=>{o.url&&Et(o.url)};ct(()=>Dt.value,o=>{o&&f.success(n("mediaLinkCopied"))});const ve=x(null),be=x(!1),we=x(!1),Lt=async o=>{switch(ve.value=o,o.type){case p.IMAGE:break;case p.VIDEO:we.value=!0;break;case p.AUDIO:be.value=!0;break;case p.DOCUMENT:window.open(o.url);break;default:f.info(n("cannotOpenThisFile"));break}},g=x(null),Ce=x(!1),Ot=async o=>{g.value=o,Ce.value=!0},Ne=x(null),ie=x(null),ce=x(!1),{mutate:Rt}=fn(),{mutate:jt}=Wn(),{mutate:Pt}=Kn(),Ht=async o=>{ie.value=o,Rt(o.path,{onSuccess(i,y,b){Ne.value=i,ce.value=!0}})},qt=async(o,i)=>{var y=yn(i);y=await gt(y,{maxSizeMB:1});const b=new FormData;b.append("file",y),V.warning({title:n("registration"),content:n("confirmReplaceCurrentFile"),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:async()=>{ie.value&&b.append("filename",ie.value?.name),jt({id:ie.value?.id,data:b},{onSuccess(A,ye,Ee){ce.value=!1}})},onNegativeClick:async()=>{ie.value&&b.append("filename",hn(6)+"-"+ie.value?.name),Pt(b,{onSuccess(A,ye,Ee){ce.value=!1}})}})},$e=Se(()=>{let o=0;for(const i in E.value)E.value[i]&&o++;return o}),Gt=o=>{const i=!s?.selectionMultiple,y=s?.selectionMultiple&&!s?.selectionLimit,b=s?.selectionMultiple&&s?.selectionLimit&&I.value.length<s?.selectionLimit,A=s?.selectionMultiple&&s?.selectionLimit&&o.id&&E.value[o.id];return i||y||A||b},Yt=()=>{let o=I.value;s?.selectionType=="url"?o=I.value.map(i=>i.url):s?.selectionType=="path"&&(o=I.value.map(i=>i.path)),m("validate",s?.selectionMultiple?o:o[0])},Ze=()=>{E.value={},I.value=[],O()},{mutate:Qt}=Jn(),Wt=async()=>($e.value?V.warning({title:n("confirm"),content:n("deleteSelectionWarningMessage",[$e.value]),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:async()=>{Qt({selectedItems:E.value},{onSuccess:()=>{Ze()}})}}):f.warning(n("noItemSelected")),!1);return(o,i)=>{const y=Je,b=Ke,A=We,ye=wn,Ee=bn,Kt=wt,Jt=bt,Zt=Mt,Xe=$n,Xt=Cn,De=Ct,en=In,tn=Zn,nn=Un,on=$t,ln=vn,an=Sn,sn=Mn,cn=xn,un=Fn,dn=xt,rn=Bn,xe=kt,et=Vn,pn=Xn;return c(),_(ue,null,[u("section",Co,[a(Zt,{to:"#actions"},{default:l(()=>[e($e)>0?(c(),_("section",$o,[u("span",null,d(e(n)("nbItemsSelected",[e($e)])),1),a(A,{type:"success",size:"small",secondary:"",onClick:Yt},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:checkmark"})]),_:1})]),default:l(()=>[le(" "+d(e(n)("validateSelection")),1)]),_:1}),a(A,{type:"error",size:"small",secondary:"",onClick:Wt},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:trash-can"})]),_:1})]),default:l(()=>[le(" "+d(e(n)("deleteSelection")),1)]),_:1}),a(A,{type:"warning",size:"small",secondary:"",onClick:Ze},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:close"})]),_:1})]),default:l(()=>[le(" "+d(e(n)("cancelSelection")),1)]),_:1})])):(c(),_("section",xo,[a(Ee,{value:e(r),"onUpdate:value":[i[1]||(i[1]=t=>ee(r)?r.value=t:null),i[2]||(i[2]=t=>e(O)())],"render-label":J,options:e(ke),placeholder:e(n)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:l(()=>[a(ye,{size:"large",class:"w-full","default-checked":e(ke).length&&e(r).length===e(ke).length,"onUpdate:checked":i[0]||(i[0]=t=>{t?r.value=e(ke).map(H=>H.value):r.value=[],e(O)()})},{default:l(()=>[le(d(e(n)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),a(Jt,{class:"!w-[250px]"},{default:l(()=>[a(Kt,{ref_key:"searchInputRef",ref:$,value:e(D),"onUpdate:value":[i[3]||(i[3]=t=>ee(D)?D.value=t:null),i[4]||(i[4]=t=>{t||e(O)()})],clearable:!0,placeholder:e(n)("search")},null,8,["value","placeholder"]),a(A,{type:"primary",secondary:"",onClick:i[5]||(i[5]=t=>e(O)())},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})]))]),_:1}),a(De,{size:"small",class:"mb-5"},{default:l(()=>[u("div",Mo,[u("div",So,[e(s)?.selectionMultiple&&!e(s)?.selectionLimit?(c(),N(ye,{key:0,checked:e(Y),"onUpdate:checked":[i[6]||(i[6]=t=>ee(Y)?Y.value=t:null),i[7]||(i[7]=t=>{for(const H of e(T))H.id&&(e(E)[H.id]=t,e(I).findIndex(q=>q.id==H.id)===-1&&e(I).push(H));C.value=("uuidv4"in o?o.uuidv4:it(Me))()})]},{default:l(()=>[le(d(e(n)("selectAll")),1)]),_:1},8,["checked"])):F("",!0)]),a(Xt,{value:e(k),"onUpdate:value":[i[8]||(i[8]=t=>ee(k)?k.value=t:null),i[9]||(i[9]=t=>e(O)())],name:"filtertyperadiobuttongroup",size:"medium"},{default:l(()=>[e(v).length===e(K).length?(c(),N(Xe,{key:0,value:0},{default:l(()=>[le(d(e(n)("all"))+"  ",1),e(pe)?(c(),_("span",Uo," ("+d(e(pe))+") ",1)):F("",!0)]),_:1})):F("",!0),(c(!0),_(ue,null,Oe(e(K),t=>(c(),N(Xe,{key:t.value,value:t.value},{default:l(()=>[le(d(t.label)+"  ",1),t.value==e(p).IMAGE?(c(),_("span",Io," ("+d(e(St))+") ",1)):t.value==e(p).VIDEO?(c(),_("span",Fo," ("+d(e(Ut))+") ",1)):t.value==e(p).AUDIO?(c(),_("span",Bo," ("+d(e(It))+") ",1)):t.value==e(p).DOCUMENT?(c(),_("span",Vo," ("+d(e(Ft))+") ",1)):(c(),_("span",To,"("+d(e(Bt))+")",1))]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),_:1}),a(De,{embedded:"",class:"py-2"},{default:l(()=>[e(T).length&&!e(re)?(c(),_("section",No,[a(cn,{"show-toolbar-tooltip":""},{default:l(()=>[a(sn,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:4 900:4 1400:6"},{default:l(()=>[(c(!0),_(ue,null,Oe(e(T),(t,H)=>(c(),N(an,{key:H},{default:l(()=>[a(ln,{name:"slide-fade",appear:""},{default:l(()=>[a(De,{bordered:"",hoverable:""},{cover:l(()=>[u("div",Eo,[t.type==e(p).IMAGE?(c(),_(ue,{key:0},[t.url?(c(),N(en,{key:0,src:t.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):F("",!0)],64)):t.type==e(p).VIDEO?(c(),_(ue,{key:1},[t.url?(c(),N(tn,{key:0,load:()=>e(U)(t.url??""),class:"w-full h-[200px] object-cover"},{fallback:l(()=>[a(b,{size:"96"},{default:l(()=>[a(y,{icon:"carbon:document-video"})]),_:1})]),_:2},1032,["load"])):F("",!0)],64)):t.type==e(p).AUDIO?(c(),N(b,{key:2,size:"96"},{default:l(()=>[a(y,{icon:"carbon:document-audio"})]),_:1})):t.type==e(p).DOCUMENT?(c(),N(b,{key:3,size:"96"},{default:l(()=>[a(y,{icon:"carbon:document"})]),_:1})):(c(),N(b,{key:4,size:"96"},{default:l(()=>[a(y,{icon:"carbon:document-unknown"})]),_:1}))])]),header:l(()=>[u("div",Do,[a(nn,{"line-clamp":1},{default:l(()=>[t.id?(c(),_(ue,{key:0},[Gt(t)?(c(),N(ye,{key:e(C),checked:e(E)[t.id],"onUpdate:checked":[q=>e(E)[t.id]=q,q=>{e(s)?.selectionMultiple?q?e(I).findIndex(ze=>ze.id==t.id)===-1&&e(I).push(t):I.value=e(I).filter(ze=>ze.id!=t.id):t&&t.id&&(I.value=[t],E.value={[t.id]:q}),C.value=("uuidv4"in o?o.uuidv4:it(Me))()}],class:"mr-1"},null,8,["checked","onUpdate:checked"])):F("",!0)],64)):F("",!0),le(" "+d(t.name),1)]),_:2},1024)])]),action:l(()=>[a(on,{justify:"space-between",align:"center"},{default:l(()=>[u("div",zo,[t.type!=e(p).IMAGE?(c(),N(A,{key:0,ternary:"",circle:"",title:e(n)("preview"),onClick:q=>Lt(t)},{icon:l(()=>[a(b,null,{default:l(()=>[[e(p).AUDIO,e(p).VIDEO].includes(t.type)?(c(),N(y,{key:0,icon:"carbon:play-filled-alt"})):(c(),N(y,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):F("",!0),a(A,{ternary:"",circle:"",title:e(n)("details"),onClick:q=>Ot(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:information-filled"})]),_:1})]),_:2},1032,["title","onClick"])]),u("div",Ao,[e(zt)?(c(),N(A,{key:0,ternary:"",circle:"",title:e(n)("copy"),onClick:q=>At(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:copy"})]),_:1})]),_:2},1032,["title","onClick"])):F("",!0),t.type==e(p).IMAGE?(c(),N(A,{key:1,ternary:"",circle:"",title:e(n)("edit"),onClick:q=>Ht(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:edit"})]),_:1})]),_:2},1032,["title","onClick"])):F("",!0),a(A,{ternary:"",circle:"",title:e(n)("delete"),onClick:q=>Nt(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:trash-can"})]),_:1})]),_:2},1032,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(un,{page:e(Q),"onUpdate:page":[i[10]||(i[10]=t=>ee(Q)?Q.value=t:null),oe],class:"mt-10 justify-center","show-size-picker":"","page-size":e(Z),"page-sizes":[8,12,24,36,48,60],"page-count":Math.ceil(e(L)/e(Z)),"onUpdate:pageSize":se},null,8,["page","page-size","page-count"])])):e(re)?(c(),_("section",Lo,[a(dn,{size:"medium"})])):(c(),N(rn,{key:2,description:e(n)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),a(xe,{show:e(be),"onUpdate:show":i[11]||(i[11]=t=>ee(be)?be.value=t:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ve)?.name},{default:l(()=>[u("audio",Oo,[u("source",{src:e(ve)?.url},null,8,Ro)])]),_:1},8,["show","title"]),a(xe,{show:e(we),"onUpdate:show":i[12]||(i[12]=t=>ee(we)?we.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ve)?.name},{default:l(()=>[u("video",jo,[u("source",{src:e(ve)?.url},null,8,Po)])]),_:1},8,["show","title"]),a(xe,{show:e(Ce),"onUpdate:show":i[13]||(i[13]=t=>ee(Ce)?Ce.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(g)?.name},{default:l(()=>[e(g)?(c(),N(et,{key:0,striped:"","single-line":!1,size:"small"},{default:l(()=>[u("tbody",null,[u("tr",null,[u("td",Ho,d(e(n)("name")),1),u("td",null,d(e(g).name),1)]),u("tr",null,[u("td",null,d(e(n)("link")),1),u("td",null,[u("small",null,d(e(g).url),1)])]),u("tr",null,[u("td",null,d(e(n)("type")),1),u("td",null,[e(g).type==e(p).IMAGE?(c(),_("span",qo,d(e(n)("image")),1)):e(g).type==e(p).VIDEO?(c(),_("span",Go,d(e(n)("video")),1)):e(g).type==e(p).AUDIO?(c(),_("span",Yo,d(e(n)("audio")),1)):e(g).type==e(p).DOCUMENT?(c(),_("span",Qo,d(e(n)("document")),1)):(c(),_("span",Wo,d(e(n)("other")),1))])]),e(g).size?(c(),_("tr",Ko,[u("td",null,d(e(n)("size")),1),u("td",null,d(e(ht)(e(g).size,!0)),1)])):F("",!0),e(g).mimeType?(c(),_("tr",Jo,[u("td",null,d(e(n)("mimeType")),1),u("td",null,d(e(g).mimeType),1)])):F("",!0),e(g).sender?(c(),_("tr",Zo,[u("td",null,d(e(n)("sendBy")),1),u("td",null,d(e(g).sender.fullname),1)])):F("",!0),e(g).title?(c(),_("tr",Xo,[u("td",null,d(e(n)("title")),1),u("td",null,d(e(g).title),1)])):F("",!0),e(g).description?(c(),_("tr",el,[u("td",null,d(e(n)("description")),1),u("td",null,[u("small",null,d(e(g).description),1)])])):F("",!0),e(g).createdAt?(c(),_("tr",tl,[u("td",null,d(e(n)("date")),1),u("td",null,d(e(tt)(e(g).createdAt)),1)])):F("",!0),e(g).additionalMetadata?(c(),_("tr",nl,[u("td",null,d(e(n)("metadata")),1),u("td",null,[a(et,{striped:"","single-line":"",size:"small"},{default:l(()=>[u("tbody",null,[(c(!0),_(ue,null,Oe(e(g).additionalMetadata||[],(t,H)=>(c(),_("tr",{key:H},[u("td",null,d(H),1),u("td",null,d(t),1)]))),128))])]),_:1})])])):F("",!0)])]),_:1})):F("",!0)]),_:1},8,["show","title"]),a(xe,{show:e(ce),"onUpdate:show":i[15]||(i[15]=t=>ee(ce)?ce.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ie)?.name},{default:l(()=>[a(pn,{"cropper-ratio":void 0,"round-preview":!1,src:e(Ne)?e(Ne):void 0,onCancel:i[14]||(i[14]=t=>ce.value=!1),onSave:qt},null,8,["src"])]),_:1},8,["show","title"])],64)}}}),{unref:ut}=await M("vue"),{defineComponent:il}=await M("vue"),{unref:S,resolveComponent:Gl,isRef:dt,createVNode:W,withCtx:te,toDisplayString:Re,createTextVNode:je,openBlock:ge,createElementBlock:Pe,createCommentVNode:rt,createBlock:pt}=await M("vue"),cl={class:"px-10"},ul={key:0},dl={key:0,class:"text-end"},{inject:rl,ref:_t}=await M("vue"),pl=il({__name:"AddFromAnUrl",emits:["validate"],setup(G,{emit:h}){const{t:s}=Ve(),m=Qe(),n=rl(Te),B=h,U=_t(""),f=_t([]);return(V,v)=>{const C=Tn,D=Nn,$=Je,z=Ke,T=We,Y=En,E=wt,I=bt,K=Ct;return ge(),Pe("section",cl,[W(K,null,{default:te(()=>[S(n)?.selectionMultiple?(ge(),Pe("section",ul,[W(C,{value:S(f),"onUpdate:value":v[0]||(v[0]=r=>dt(f)?f.value=r:null),placeholder:S(s)("fileUrl"),min:1,max:S(n).selectionLimit||void 0},null,8,["value","placeholder","max"]),S(f).length>0?(ge(),Pe("div",dl,[W(D),W(T,{type:"primary",secondary:"",disabled:S(f).length!=S(f).filter(r=>r.trim()).length,onClick:v[1]||(v[1]=()=>{const r=S(f).map(k=>encodeURI(k));r.findIndex(k=>!("_v"in V?V._v:ut(nt)).isURL(k))>-1?S(m).error(S(s)("invalidUrl")):B("validate",r),B("validate",S(f))})},{icon:te(()=>[W(z,null,{default:te(()=>[W($,{icon:"carbon:checkmark"})]),_:1})]),default:te(()=>[je(" "+Re(S(s)("validate")),1)]),_:1},8,["disabled"])])):rt("",!0)])):(ge(),pt(I,{key:1},{default:te(()=>[W(Y,null,{default:te(()=>[je(Re(S(s)("fileUrl")),1)]),_:1}),W(E,{value:S(U),"onUpdate:value":v[2]||(v[2]=r=>dt(U)?U.value=r:null)},null,8,["value"]),S(U)?(ge(),pt(T,{key:0,type:"primary",secondary:"",onClick:v[3]||(v[3]=()=>{const r=encodeURI(S(U));("_v"in V?V._v:ut(nt)).isURL(r)?B("validate",r):S(m).error(S(s)("invalidUrl"))})},{icon:te(()=>[W(z,null,{default:te(()=>[W($,{icon:"carbon:checkmark"})]),_:1})]),default:te(()=>[je(" "+Re(S(s)("validate")),1)]),_:1})):rt("",!0)]),_:1}))]),_:1})])}}}),{defineComponent:_l}=await M("vue"),{unref:w,resolveComponent:Yl,createVNode:j,withCtx:P,toDisplayString:ne,createTextVNode:He,openBlock:ae,createBlock:ml,createCommentVNode:fl,createElementVNode:Ue,createElementBlock:de}=await M("vue"),vl={class:"px-10"},yl={class:"flex justify-between items-center"},hl={style:{"margin-bottom":"12px"}},gl={key:0,class:"text-xs"},kl={key:1,class:"text-xs"},bl={key:2,class:"text-xs"},wl={key:3,class:"text-xs"},Cl={key:4,class:"text-xs"},$l={key:5,class:"text-xs"},{inject:mt,ref:qe,onMounted:xl,onUnmounted:Ml}=await M("vue"),Sl=_l({__name:"UploadFiles",setup(G){const h=mt(Te),s=mt("appConfig"),{t:m}=Ve(),n=Qe(),B=Dn(),U=qe(),f=qe([]),V=qe(!1),v=gn(),C=s?.apiRequestHeaders;C&&(C.Authorization=`Bearer ${v.accessToken}`);const D=async()=>{U.value.submit()},$=()=>{U.value?.clear(),f.value=[]},z=r=>{const k=r.file.file;if(h?.uploadConfig?.maxSize&&k&&k.size){const L=k.size/1024/1024<=h?.uploadConfig?.maxSize;return L||n.error(m("fileSizeNotAllowed")),L}const J=k?.name.split(".").pop();return J&&h?.uploadConfig?.excludedExtensions.map(L=>L.toLowerCase()).includes(J.toLowerCase())?(n.error(m("fileTypeNotAllowed")),!1):!0},T=r=>{f.value=r.fileList},Y=({file:r})=>r,E=()=>{if(h?.uploadConfig?.limit)return h?.uploadConfig.limit},I=async({file:r,data:k,headers:J,action:L,onFinish:Z,onError:Q,onProgress:me})=>{const oe=new FormData;k&&Object.keys(k).forEach(R=>{oe.append(R,k[R])});const se=r.file,fe=se?.name.split(".").pop(),O=se?.name.replace("."+fe,""),re=await gt(se,{maxSizeMB:1});oe.append("file",re,O),oe.append("folder",h?.uploadConfig?.folder),V.value=!0,B.start(),to.post(L,oe,{headers:J,onUploadProgress:R=>{if(R.total!==void 0){const pe=Math.round(R.loaded*100/R.total);me({percent:pe})}}}).then(async()=>{Z();const R=f.value.findIndex(pe=>pe.id===r.id);R!==-1&&f.value.splice(R,1),n.success(m("success")),B.finish(),V.value=!1}).catch(R=>{n.error(m("anErrorOccurred")),Q(),B.finish(),V.value=!1})},K=console.warn;return xl(()=>{console.warn=r=>{typeof r=="string"&&r.includes('Non-function value encountered for slot "default"')||K(r)}}),Ml(()=>{console.warn=K}),(r,k)=>{const J=Je,L=Ke,Z=We,Q=$t,me=Mt,oe=Ln,se=On,fe=An,O=zn,re=xt;return ae(),de("section",vl,[j(me,{to:"#actions"},{default:P(()=>[Ue("div",yl,[w(f).length?(ae(),ml(Q,{key:0,align:"center"},{default:P(()=>[j(Z,{secondary:"",disabled:w(f).length==0,onClick:$},{icon:P(()=>[j(L,null,{default:P(()=>[j(J,{icon:"carbon:close"})]),_:1})]),default:P(()=>[He(" "+ne(w(m)("clearList")),1)]),_:1},8,["disabled"]),j(Z,{type:"primary",secondary:"",disabled:w(f).length==0,onClick:D},{default:P(()=>[He(ne(w(m)("launchImport")),1)]),_:1},8,["disabled"])]),_:1})):fl("",!0)])]),_:1}),j(re,{show:!1},{default:P(()=>[j(O,{ref_key:"upload",ref:U,multiple:"","directory-dnd":"","list-type":"image",max:E(),"default-upload":!1,headers:w(C),"custom-request":I,action:w(h)?.uploadConfig?.baseUrl||w(s)?.apiUrl+"/media-files/upload",onBeforeUpload:z,onChange:T,onFinish:Y},{default:P(()=>[j(fe,{class:"h-[250px] flex flex-col items-center justify-center"},{default:P(()=>[Ue("div",hl,[j(L,{size:"48",depth:3},{default:P(()=>[j(J,{icon:"mdi:file-upload"})]),_:1})]),j(oe,{style:{"font-size":"16px"}},{default:P(()=>[He(ne(w(m)("uploadAreaTitle")),1)]),_:1}),j(se,{depth:"3",class:"mt-4"},{default:P(()=>[w(h)?.uploadConfig?.limit?(ae(),de("span",gl,ne(w(m)("limitToTheNumberOfFilesToSend",[w(h)?.uploadConfig.limit])),1)):(ae(),de("span",kl,ne(w(m)("noLimitToTheNumberOfFilesToSend")),1)),k[0]||(k[0]=Ue("br",null,null,-1)),w(h)?.uploadConfig?.maxSize?(ae(),de("span",bl,ne(w(m)("limitToTheSizeOfFilesToSend",[w(ht)(w(h)?.uploadConfig.maxSize)])),1)):(ae(),de("span",wl,ne(w(m)("noLimitToTheSizeOfFilesToSend")),1)),k[1]||(k[1]=Ue("br",null,null,-1)),w(h)?.uploadConfig?.excludedExtensions.length?(ae(),de("span",Cl,ne(w(m)("extensionsAreNotAllowed",[w(h)?.uploadConfig.excludedExtensions.join(", ")])),1)):(ae(),de("span",$l,ne(w(m)("allFileExtensionsAreAllowed")),1))]),_:1,__:[0,1]})]),_:1})]),_:1},8,["max","headers","action"])]),_:1})])}}}),{useModel:ft,mergeModels:vt,defineComponent:Ul}=await M("vue"),{unref:Ge,createVNode:Ie,resolveComponent:Ql,withCtx:_e,openBlock:Fe,createBlock:Be,createCommentVNode:Ye,createElementVNode:Il}=await M("vue"),{defineComponent:Fl,provide:Bl}=await M("vue"),Vl=Fl({name:"MediaPicker"}),Wl=Ul({...Vl,props:vt({enableUploadFiles:{type:Boolean,default:!0},enableMediaLibrary:{type:Boolean,default:!0},enableAddFromAnUrl:{type:Boolean,default:!0},displayImages:{type:Boolean,default:!0},displayVideos:{type:Boolean,default:!0},displayAudios:{type:Boolean,default:!0},displayDocuments:{type:Boolean,default:!0},displayOtherTypes:{type:Boolean,default:!0},preselectedMediaList:{default:null},selectionType:{default:"path"},selectionMultiple:{type:Boolean,default:!1},selectionLimit:{default:0},title:{default:""},uploadConfig:{default:()=>({folder:"uploads",limit:0,maxSize:0,baseUrl:null,excludedExtensions:[]})}},{show:{type:Boolean,required:!0,default:!1},showModifiers:{},tab:{default:"media-library"},tabModifiers:{}}),emits:vt(["submit"],["update:show","update:tab"]),setup(G,{emit:h}){const{t:s}=Ve(),m=G;Bl(Te,m);const n=ft(G,"show"),B=ft(G,"tab"),U=h,f=v=>{U("submit",v),n.value=!1},V=v=>{U("submit",v),n.value=!1};return(v,C)=>{const D=jn,$=Rn,z=ro;return Fe(),Be(z,{modelValue:n.value,"onUpdate:modelValue":C[1]||(C[1]=T=>n.value=T),title:v.title,class:"w-full"},{default:_e(()=>[Ie($,{value:B.value,"onUpdate:value":C[0]||(C[0]=T=>B.value=T),type:"card",size:"large",animated:""},{suffix:_e(()=>C[2]||(C[2]=[Il("div",{id:"actions",class:"pr-10"},null,-1)])),default:_e(()=>[m.enableUploadFiles?(Fe(),Be(D,{key:0,name:"upload-files",tab:Ge(s)("uploadFiles")},{default:_e(()=>[Ie(Sl)]),_:1},8,["tab"])):Ye("",!0),m.enableMediaLibrary?(Fe(),Be(D,{key:1,name:"media-library",tab:Ge(s)("mediaLibrary")},{default:_e(()=>[Ie(sl,{onValidate:f})]),_:1},8,["tab"])):Ye("",!0),m.enableAddFromAnUrl?(Fe(),Be(D,{key:2,name:"add-from-an-url",tab:Ge(s)("addFromAnUrl")},{default:_e(()=>[Ie(pl,{onValidate:V})]),_:1},8,["tab"])):Ye("",!0)]),_:1},8,["value"])]),_:1},8,["modelValue","title"])}}});export{Mt as _,Wl as a,ro as b};
