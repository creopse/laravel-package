import{P as g,d as c}from"./ckeditor_ckeditor5-core-Ck1E_gMX.js";import{g as p,U as m}from"./ckeditor_ckeditor5-utils-CWV6iAXC.js";import"./ckeditor_ckeditor5-engine-Bp3orBjd.js";import{B as E}from"./ckeditor_ckeditor5-ui-0Cf30f_5.js";import"./color-name-B0-kzB5j.js";import"./color-convert-CPcGJsTp.js";import"./vanilla-colorful-CgSCOLsm.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function V(s){const e=[{name:"address",isVoid:!1},{name:"article",isVoid:!1},{name:"aside",isVoid:!1},{name:"blockquote",isVoid:!1},{name:"br",isVoid:!0},{name:"details",isVoid:!1},{name:"dialog",isVoid:!1},{name:"dd",isVoid:!1},{name:"div",isVoid:!1},{name:"dl",isVoid:!1},{name:"dt",isVoid:!1},{name:"fieldset",isVoid:!1},{name:"figcaption",isVoid:!1},{name:"figure",isVoid:!1},{name:"footer",isVoid:!1},{name:"form",isVoid:!1},{name:"h1",isVoid:!1},{name:"h2",isVoid:!1},{name:"h3",isVoid:!1},{name:"h4",isVoid:!1},{name:"h5",isVoid:!1},{name:"h6",isVoid:!1},{name:"header",isVoid:!1},{name:"hgroup",isVoid:!1},{name:"hr",isVoid:!0},{name:"input",isVoid:!0},{name:"li",isVoid:!1},{name:"main",isVoid:!1},{name:"nav",isVoid:!1},{name:"ol",isVoid:!1},{name:"p",isVoid:!1},{name:"section",isVoid:!1},{name:"table",isVoid:!1},{name:"tbody",isVoid:!1},{name:"td",isVoid:!1},{name:"textarea",isVoid:!1},{name:"th",isVoid:!1},{name:"thead",isVoid:!1},{name:"tr",isVoid:!1},{name:"ul",isVoid:!1}],t=e.map(o=>o.name).join("|"),a=s.replace(new RegExp(`</?(${t})( .*?)?>`,"g"),`
$&
`).split(`
`);let i=0;return a.filter(o=>o.length).map(o=>b(o,e)?l(o,i++):w(o,e)?l(o,--i):l(o,i)).join(`
`)}function b(s,e){return e.some(t=>!(t.isVoid||!new RegExp(`<${t.name}( .*?)?>`).test(s)))}function w(s,e){return e.some(t=>new RegExp(`</${t.name}>`).test(s))}function l(s,e,t="    "){return`${t.repeat(Math.max(0,e))}${s}`}const R='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 0 5 4.5v15.003h-16V0h11zM3 1.5v3.25l-1.497 1-.003 8 1.5 1v3.254L7.685 18l-.001 1.504H17.5V8.002L16 9.428l-.004-4.22-4.222-3.692L3 1.5z"/><path d="M4.06 6.64a.75.75 0 0 1 .958 1.15l-.085.07L2.29 9.75l2.646 1.89c.302.216.4.62.232.951l-.058.095a.75.75 0 0 1-.951.232l-.095-.058-3.5-2.5V9.14l3.496-2.5zm4.194 6.22a.75.75 0 0 1-.958-1.149l.085-.07 2.643-1.89-2.646-1.89a.75.75 0 0 1-.232-.952l.058-.095a.75.75 0 0 1 .95-.232l.096.058 3.5 2.5v1.22l-3.496 2.5zm7.644-.836 2.122 2.122-5.825 5.809-2.125-.005.003-2.116zm2.539-1.847 1.414 1.414a.5.5 0 0 1 0 .707l-1.06 1.06-2.122-2.12 1.061-1.061a.5.5 0 0 1 .707 0z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const u="SourceEditingMode";class k extends g{static get pluginName(){return"SourceEditing"}static get requires(){return[c]}constructor(e){super(e),this.set("isSourceEditingMode",!1),this._elementReplacer=new p,this._replacedRoots=new Map,this._dataFromRoots=new Map}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add("sourceEditing",a=>{const i=new E(a);return i.set({label:t("Source"),icon:R,tooltip:!0,withText:!0,class:"ck-source-editing-button"}),i.bind("isOn").to(this,"isSourceEditingMode"),i.bind("isEnabled").to(this,"isEnabled",e,"isReadOnly",e.plugins.get(c),"hasAny",(o,n,d)=>!(!o||n||d)),this.listenTo(i,"execute",()=>{this.isSourceEditingMode=!this.isSourceEditingMode}),i}),this._isAllowedToHandleSourceEditingMode()&&(this.on("change:isSourceEditingMode",(a,i,o)=>{o?(this._showSourceEditing(),this._disableCommands()):(this._hideSourceEditing(),this._enableCommands())}),this.on("change:isEnabled",(a,i,o)=>this._handleReadOnlyMode(!o)),this.listenTo(e,"change:isReadOnly",(a,i,o)=>this._handleReadOnlyMode(o))),e.data.on("get",()=>{this.isSourceEditingMode&&this.updateEditorData()},{priority:"high"})}afterInit(){const e=this.editor;["RealTimeCollaborativeEditing","CommentsEditing","TrackChangesEditing","RevisionHistory"].some(a=>e.plugins.has(a))&&console.warn("You initialized the editor with the source editing feature and at least one of the collaboration features. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the collaboration features."),e.plugins.has("RestrictedEditingModeEditing")&&console.warn("You initialized the editor with the source editing feature and restricted editing feature. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the restricted editing feature.")}updateEditorData(){const e=this.editor,t={};for(const[a,i]of this._replacedRoots){const o=this._dataFromRoots.get(a),n=i.dataset.value;o!==n&&(t[a]=n)}Object.keys(t).length&&e.data.set(t,{batchType:{isUndoable:!0}})}_showSourceEditing(){const e=this.editor,t=e.editing.view,a=e.model;a.change(i=>{i.setSelection(null),i.removeSelectionAttribute(a.document.selection.getAttributeKeys())});for(const[i,o]of t.domRoots){const n=S(e.data.get({rootName:i})),d=m(o.ownerDocument,"textarea",{rows:"1","aria-label":"Source code editing area"}),r=m(o.ownerDocument,"div",{class:"ck-source-editing-area","data-value":n},[d]);d.value=n,d.setSelectionRange(0,0),d.addEventListener("input",()=>{r.dataset.value=d.value,e.ui.update()}),t.change(f=>{const h=t.document.getRoot(i);f.addClass("ck-hidden",h)}),e.ui.setEditableElement("sourceEditing:"+i,d),this._replacedRoots.set(i,r),this._elementReplacer.replace(o,r),this._dataFromRoots.set(i,n)}this._focusSourceEditing()}_hideSourceEditing(){const t=this.editor.editing.view;this.updateEditorData(),t.change(a=>{for(const[i]of this._replacedRoots)a.removeClass("ck-hidden",t.document.getRoot(i))}),this._elementReplacer.restore(),this._replacedRoots.clear(),this._dataFromRoots.clear(),t.focus()}_focusSourceEditing(){const e=this.editor,[t]=this._replacedRoots.values(),a=t.querySelector("textarea");e.editing.view.document.isFocused=!1,a.focus()}_disableCommands(){const e=this.editor;for(const t of e.commands.commands())t.forceDisabled(u)}_enableCommands(){const e=this.editor;for(const t of e.commands.commands())t.clearForceDisabled(u)}_handleReadOnlyMode(e){if(this.isSourceEditingMode)for(const[,t]of this._replacedRoots)t.querySelector("textarea").readOnly=e}_isAllowedToHandleSourceEditingMode(){const t=this.editor.ui.view.editable;return t&&!t.hasExternalElement}}function S(s){return v(s)?V(s):s}function v(s){return s.startsWith("<")}export{k as S};
