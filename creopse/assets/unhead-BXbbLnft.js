import{D as H}from"./unhead_dom-CuizlKK3.js";import{I as _,d as f,h as P,t as y,H as w,a as C,N as h,b as v,S as b,p as u,r as m,n as M}from"./unhead_shared-C2Qklalk.js";import{c as S}from"./hookable-B8xFkYCm.js";const $=new Set(["templateParams","htmlAttrs","bodyAttrs"]),x=f({hooks:{"tag:normalise":({tag:t})=>{t.props.hid&&(t.key=t.props.hid,delete t.props.hid),t.props.vmid&&(t.key=t.props.vmid,delete t.props.vmid),t.props.key&&(t.key=t.props.key,delete t.props.key);const s=C(t);s&&!s.startsWith("meta:og:")&&!s.startsWith("meta:twitter:")&&delete t.key;const o=s||(t.key?`${t.tag}:${t.key}`:!1);o&&(t._d=o)},"tags:resolve":t=>{const s=Object.create(null);for(const e of t.tags){const n=(e.key?`${e.tag}:${e.key}`:e._d)||P(e),a=s[n];if(a){let l=e?.tagDuplicateStrategy;if(!l&&$.has(e.tag)&&(l="merge"),l==="merge"){const r=a.props;r.style&&e.props.style&&(r.style[r.style.length-1]!==";"&&(r.style+=";"),e.props.style=`${r.style} ${e.props.style}`),r.class&&e.props.class?e.props.class=`${r.class} ${e.props.class}`:r.class&&(e.props.class=r.class),s[n].props={...r,...e.props};continue}else if(e._e===a._e){a._duped=a._duped||[],e._d=`${a._d}:${a._duped.length+1}`,a._duped.push(e);continue}else if(y(e)>y(a))continue}if(!(e.innerHTML||e.textContent||Object.keys(e.props).length!==0)&&w.has(e.tag)){delete s[n];continue}s[n]=e}const o=[];for(const e in s){const n=s[e],a=n._duped;o.push(n),a&&(delete n._duped,o.push(...a))}t.tags=o,t.tags=t.tags.filter(e=>!(e.tag==="meta"&&(e.props.name||e.props.property)&&!e.props.content))}}}),E=new Set(["script","link","bodyAttrs"]),L=f(t=>({hooks:{"tags:resolve":s=>{for(const o of s.tags){if(!E.has(o.tag))continue;const e=o.props;for(const n in e){if(n[0]!=="o"||n[1]!=="n"||!Object.prototype.hasOwnProperty.call(e,n))continue;const a=e[n];typeof a=="function"&&(t.ssr&&h.has(n)?e[n]=`this.dataset.${n}fired = true`:delete e[n],o._eventHandlers=o._eventHandlers||{},o._eventHandlers[n]=a)}t.ssr&&o._eventHandlers&&(o.props.src||o.props.href)&&(o.key=o.key||v(o.props.src||o.props.href))}},"dom:renderTag":({$el:s,tag:o})=>{const e=s?.dataset;if(e)for(const n in e){if(!n.endsWith("fired"))continue;const a=n.slice(0,-5);h.has(a)&&o._eventHandlers?.[a]?.call(s,new Event(a.substring(2)))}}}})),O=new Set(["link","style","script","noscript"]),W=f({hooks:{"tag:normalise":({tag:t})=>{t.key&&O.has(t.tag)&&(t.props["data-hid"]=t._h=v(t.key))}}}),j=f({mode:"server",hooks:{"tags:beforeResolve":t=>{const s={};let o=!1;for(const e of t.tags)e._m!=="server"||e.tag!=="titleTemplate"&&e.tag!=="templateParams"&&e.tag!=="title"||(s[e.tag]=e.tag==="title"||e.tag==="titleTemplate"?e.textContent:e.props,o=!0);o&&t.tags.push({tag:"script",innerHTML:JSON.stringify(s),props:{id:"unhead:payload",type:"application/json"}})}}}),A=f({hooks:{"tags:resolve":t=>{for(const s of t.tags)if(typeof s.tagPriority=="string")for(const{prefix:o,offset:e}of b){if(!s.tagPriority.startsWith(o))continue;const n=s.tagPriority.substring(o.length),a=t.tags.find(i=>i._d===n)?._p;if(a!==void 0){s._p=a+e;break}}t.tags.sort((s,o)=>{const e=y(s),n=y(o);return e<n?-1:e>n?1:s._p-o._p})}}}),D={meta:"content",link:"href",htmlAttrs:"lang"},R=["innerHTML","textContent"],I=f(t=>({hooks:{"tags:resolve":s=>{const{tags:o}=s;let e;for(let i=0;i<o.length;i+=1)o[i].tag==="templateParams"&&(e=s.tags.splice(i,1)[0].props,i-=1);const n=e||{},a=n.separator||"|";delete n.separator,n.pageTitle=u(n.pageTitle||o.find(i=>i.tag==="title")?.textContent||"",n,a);for(const i of o){if(i.processTemplateParams===!1)continue;const l=D[i.tag];if(l&&typeof i.props[l]=="string")i.props[l]=u(i.props[l],n,a);else if(i.processTemplateParams||i.tag==="titleTemplate"||i.tag==="title")for(const r of R)typeof i[r]=="string"&&(i[r]=u(i[r],n,a,i.tag==="script"&&i.props.type.endsWith("json")))}t._templateParams=n,t._separator=a},"tags:afterResolve":({tags:s})=>{let o;for(let e=0;e<s.length;e+=1){const n=s[e];n.tag==="title"&&n.processTemplateParams!==!1&&(o=n)}o?.textContent&&(o.textContent=u(o.textContent,t._templateParams,t._separator))}}})),K=f({hooks:{"tags:resolve":t=>{const{tags:s}=t;let o,e;for(let n=0;n<s.length;n+=1){const a=s[n];a.tag==="title"?o=a:a.tag==="titleTemplate"&&(e=a)}if(e&&o){const n=m(e.textContent,o.textContent);n!==null?o.textContent=n||o.textContent:t.tags.splice(t.tags.indexOf(o),1)}else if(e){const n=m(e.textContent);n!==null&&(e.textContent=n,e.tag="title",e=void 0)}e&&t.tags.splice(t.tags.indexOf(e),1)}}}),N=f({hooks:{"tags:afterResolve":t=>{for(const s of t.tags)typeof s.innerHTML=="string"&&(s.innerHTML&&(s.props.type==="application/ld+json"||s.props.type==="application/json")?s.innerHTML=s.innerHTML.replace(/</g,"\\u003C"):s.innerHTML=s.innerHTML.replace(new RegExp(`</${s.tag}`,"g"),`<\\/${s.tag}`))}}});let T;function X(t={}){const s=B(t);return s.use(H()),T=s}function k(t,s){return!t||t==="server"&&s||t==="client"&&!s}function B(t={}){const s=S();s.addHooks(t.hooks||{}),t.document=t.document||(_?document:void 0);const o=!t.document,e=()=>{l.dirty=!0,s.callHook("entries:updated",l)};let n=0,a=[];const i=[],l={plugins:i,dirty:!1,resolvedOptions:t,hooks:s,headEntries(){return a},use(r){const p=typeof r=="function"?r(l):r;(!p.key||!i.some(c=>c.key===p.key))&&(i.push(p),k(p.mode,o)&&s.addHooks(p.hooks||{}))},push(r,p){delete p?.head;const c={_i:n++,input:r,...p};return k(c.mode,o)&&(a.push(c),e()),{dispose(){a=a.filter(g=>g._i!==c._i),e()},patch(g){for(const d of a)d._i===c._i&&(d.input=c.input=g);e()}}},async resolveTags(){const r={tags:[],entries:[...a]};await s.callHook("entries:resolve",r);for(const p of r.entries){const c=p.resolvedInput||p.input;if(p.resolvedInput=await(p.transform?p.transform(c):c),p.resolvedInput)for(const g of await M(p)){const d={tag:g,entry:p,resolvedOptions:l.resolvedOptions};await s.callHook("tag:normalise",d),r.tags.push(d.tag)}}return await s.callHook("tags:beforeResolve",r),await s.callHook("tags:resolve",r),await s.callHook("tags:afterResolve",r),r.tags},ssr:o};return[x,j,L,W,A,I,K,N,...t?.plugins||[]].forEach(r=>l.use(r)),l.hooks.callHook("init",l),l}function q(){return T}export{X as c,q as g};
