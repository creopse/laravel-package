import{i as C}from"./ckeditor_ckeditor5-vue-D9YIFk5Z.js";import{_ as ae}from"./PageLayout.vue_vue_type_script_setup_true_lang-BBrh_5H0.js";import{_ as oe}from"./NaiveMobileTableAdapter.vue_vue_type_script_setup_true_lang-DIMfp6Ce.js";import{t as U,u as B,f as V,e as q,aq as ne,y as S,ao as $,R as re}from"./index-BictNpzW.js";import{I as h}from"./iconify_vue-DK9FHL8l.js";import{u as I}from"./vue-i18n-DGGON2e6.js";import{a as R,u as le,l as ie,Y as ue,B as D,q as N,C as L,a4 as de,O as ce,a0 as pe,z as me,A as fe,t as _e}from"./naive-ui-U3LV0D3Q.js";import{_ as b}from"./lodash-BQQkJTn-.js";const ve=v=>{const{displayFormErrors:f}=B(),{request:p}=q(),{t:c}=I(),r=R();return U({queryKey:["roles"],operation:"insert",getItemId:o=>o.id??`temp-${crypto.randomUUID()}`,mutationFn:async o=>{const d=await p({method:"post",url:"/roles",data:o});if(d.failure&&d.error)throw new Error(d.error);return d.result.data},mutationOptions:{onSuccess:()=>{r.success(c("success"))},onError:o=>{o?.response?.data?.errorCode===V.FORM_INVALID_DATA?f(o?.response?.data?.data):r.error(c("anErrorOccurred"))},...v}})},ye=v=>{const{displayFormErrors:f}=B(),{request:p}=q(),{t:c}=I(),r=R();return U({queryKey:["roles"],operation:"update",getItemId:o=>o.id??`temp-${crypto.randomUUID()}`,mutationFn:async o=>{const d=await p({method:"put",url:`/roles/${o.id}`,data:o});if(d.failure&&d.error)throw new Error(d.error);return d.result.data},mutationOptions:{onSuccess:()=>{r.success(c("success"))},onError:o=>{o?.response?.data?.errorCode===V.FORM_INVALID_DATA?f(o?.response?.data?.data):r.error(c("anErrorOccurred"))},...v}})},ge=v=>{const{request:f}=q(),{t:p}=I(),c=R();return U({queryKey:["roles"],operation:"remove",getItemId:r=>r.id??`temp-${crypto.randomUUID()}`,mutationFn:async({id:r})=>{const o=await f({method:"delete",url:`/roles/${r}`});if(!o.success)throw new Error(o.error);return o.result.data},mutationOptions:{onSuccess:()=>{c.success(p("success"))},onError:r=>{c.error(p("anErrorOccurred"))},...v}})},{defineComponent:we}=await C("vue"),{unref:e,createVNode:l,withCtx:u,toDisplayString:he,createTextVNode:Ne,resolveComponent:Fe,isRef:z,Fragment:be,openBlock:Ce,createElementBlock:Ie}=await C("vue"),{h:i}=await C("vue"),{defineComponent:Re,ref:_,computed:T,watchEffect:ke}=await C("vue"),xe=Re({name:re.ROLES_MANAGEMENT.NAME}),Se=we({...xe,setup(v){const f=le(),p=R(),c=ie(),{rolesQuery:r,permissionsQuery:o}=ne(),{mutate:d}=ge(),{mutate:P}=ve(),{mutate:K}=ye(),{t,locale:M}=I(),y=_(""),k=_(),Q={pageSize:12},j=[{title:t("name"),key:"displayName",resizable:!0,width:150,ellipsis:{tooltip:!0},fixed:"left",sortOrder:!1,sorter:"default"},{title:t("description"),key:"description",resizable:!0,width:250,ellipsis:{tooltip:!0}},{title:t("permissionList"),key:"permissions",resizable:!0,width:300,render(a){return i("div",{},{default:()=>a.permissions?.map(E=>i(ue,{class:"mx-1 my-1",size:"small",type:"info",round:!1,strong:!0,bordered:!1},{default:()=>E.displayName}))})},sortOrder:!1,sorter:"default"},{title:t("lastEdition"),key:"updatedAt",width:150,render(a){return i("div",{},{default:()=>S(a.updatedAt,{locale:M.value})})}},{title:t("creation"),key:"createdAt",width:150,render(a){return i("div",{},{default:()=>S(a.createdAt,{locale:M.value})})}},{title:()=>i(L,{ref:k,placeholder:t("search"),value:y.value,onInput:a=>{y.value=a}},{suffix:()=>i(N,{},{default:()=>i(h,{icon:"carbon:search"})})}),key:"actions",width:180,render(a){return i("div",{class:"flex justify-end items-center w-full"},[i(D,{size:"small",type:"warning",secondary:!0,onClick:()=>{F(a)},renderIcon:()=>i(N,null,{default:()=>i(h,{icon:"carbon:edit"})})},{default:()=>t("edit")}),i("div",{class:"w-2"}),i(D,{size:"small",type:"error",secondary:!0,onClick:()=>{c.warning({title:t("confirm"),content:t("confirmDeleteRole"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{a.id&&d({id:a.id})}})},renderIcon:()=>i(N,null,{default:()=>i(h,{icon:"carbon:trash-can"})})})])},fixed:"right"}],G=T(()=>{if(!y.value)return r.data.value?.filter(s=>s.name!==$.SUPER_ADMIN);const a=r.data.value?.filter(s=>s.name!==$.SUPER_ADMIN&&(s.name.toLowerCase().includes(y.value.toLowerCase())||s.displayName.toLowerCase().includes(y.value.toLowerCase())||s.description.toLowerCase().includes(y.value.toLowerCase())));return k.value&&k.value.focus(),a}),H=_(!1),g=_(!1),w=_(null),O=_(null),n=_({name:"",displayName:"",description:"",permissions:[]}),Y={name:[{required:!0,message:t("fillRequired")}],displayName:[{required:!0,message:t("fillRequired")}]},F=a=>{w.value=b.cloneDeep(a),a?n.value=b.cloneDeep(a):n.value={name:"",displayName:"",description:"",permissions:[]},g.value=!0},J=async()=>(O.value?.validate(async a=>{a||(w.value?w.value.name!==n.value.name&&(r.data.value||[]).findIndex(s=>s.name==n.value.name)>-1?p.error(t("sameRoleNameMessage")):K({id:w.value.id,displayName:n.value.displayName,description:n.value.description,permissions:n.value.permissions},{onSuccess:()=>{}}):(r.data.value||[]).findIndex(s=>s.name==b.kebabCase(n.value.displayName))>-1?p.error(t("sameRoleNameMessage")):P({name:b.kebabCase(n.value.displayName),displayName:n.value.displayName,description:n.value.description,permissions:n.value.permissions},{onSuccess:()=>{}}),g.value=!1)}),!1),x=T({get(){try{return n.value.permissions?.map(a=>a.name)}catch{return[]}},set(a){n.value.permissions=(o.data.value||[]).filter(s=>a.includes(s.name))}});return ke(()=>{r.isFetching.value||o.isFetching.value?f.start():f.finish()}),(a,s)=>{const E=ce,W=de,X=oe,Z=ae,A=fe,ee=_e,te=me,se=pe;return Ce(),Ie(be,null,[l(Z,null,{"header-extra":u(()=>[l(E,null,{default:u(()=>[l(e(D),{type:"primary",secondary:"",onClick:s[0]||(s[0]=m=>F(null))},{icon:u(()=>[l(e(N),{size:"18"},{default:u(()=>[l(e(h),{icon:"carbon:add-alt"})]),_:1})]),default:u(()=>[Ne(" "+he(e(t)("add")),1)]),_:1})]),_:1})]),default:u(()=>[l(X,null,{default:u(()=>[l(W,{columns:j,data:e(G),pagination:Q,loading:e(r).isLoading.value||e(o).isLoading.value,"single-line":!1,"scroll-x":1200,striped:""},null,8,["data","loading"])]),_:1})]),_:1}),l(se,{show:e(g),"onUpdate:show":s[4]||(s[4]=m=>z(g)?g.value=m:null),loading:e(H),preset:"dialog",style:{width:"500px"},bordered:!1,"show-icon":!1,"mask-closable":!1,title:e(w)?e(t)("edit"):e(t)("add"),"positive-text":e(t)("validate"),"negative-text":e(t)("cancel"),onPositiveClick:J,onNegativeClick:s[5]||(s[5]=m=>g.value=!1)},{default:u(()=>[l(te,{ref_key:"formRef",ref:O,model:e(n),rules:Y,"show-require-mark":!1,size:"medium"},{default:u(()=>[l(A,{label:e(t)("name"),path:"displayName"},{default:u(()=>[l(e(L),{value:e(n).displayName,"onUpdate:value":s[1]||(s[1]=m=>e(n).displayName=m),placeholder:e(t)("name"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),l(A,{label:e(t)("description"),path:"description"},{default:u(()=>[l(e(L),{value:e(n).description,"onUpdate:value":s[2]||(s[2]=m=>e(n).description=m),placeholder:e(t)("description"),type:"textarea",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),l(A,{label:e(t)("permissionList"),path:"permissions"},{default:u(()=>[l(ee,{value:e(x),"onUpdate:value":s[3]||(s[3]=m=>z(x)?x.value=m:null),options:e(o).data.value||[],placeholder:e(t)("permissionList"),"max-tag-count":4,placement:"bottom",filterable:"",multiple:"","value-field":"name","label-field":"displayName",class:"w-full"},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show","loading","title","positive-text","negative-text"])],64)}}});export{Se as default};
