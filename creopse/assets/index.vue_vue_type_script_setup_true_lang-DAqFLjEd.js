import{i as x}from"./ckeditor_ckeditor5-vue-CmLqe3wy.js";import{b as _n,u as mn}from"./vueuse_core-DLnQCT4A.js";import{u as yt,K as fn,_ as vn,L as ht,y as tt,M as yn,N as gt,O as hn,c as gn}from"./main-BFQh8EtE.js";import{K as kt,u as We,F as kn,B as Qe,h as Ke,r as bn,k as wn,O as bt,c as wt,_ as Ct,Q as Cn,R as $n,W as xn,d as Mn,o as Sn,q as $t,w as In,X as Un,I as Fn,l as xt,J as Bn,Y as Vn,a3 as Tn,C as Nn,ae as En,p as zn,Z as Dn,$ as An,m as Ln,v as On,a4 as Rn,a9 as jn}from"./naive-ui-BrWbllCz.js";import{u as Pn,M as p,a as Hn,b as Yn,c as qn,d as he,n as Gn,f as Wn,h as Qn,i as Kn,k as Jn,_ as Xn,m as Zn}from"./media-file-CyAQ76A9.js";import{I as Je}from"./iconify_vue-DXPEksg3.js";import{v as Me}from"./uuid-8I8R7izr.js";import{r as eo}from"./vueuse_shared-CcT-C3Xm.js";import{u as Ve}from"./vue-i18n-B92nPylK.js";import{_ as nt}from"./validator-DC79P2ge.js";import{a as to}from"./axios-DeS043Oz.js";const{defineComponent:no}=await x("vue"),{unref:Z,renderSlot:Ae,createCommentVNode:ot,normalizeStyle:lt,createElementVNode:oo,resolveComponent:Hl,isRef:lo,withCtx:Le,openBlock:ao,createBlock:so}=await x("vue"),{computed:at,ref:io,watch:st,nextTick:co,useSlots:uo}=await x("vue"),ro=no({__name:"NFullscreenModal",props:{modelValue:{type:Boolean},maskClosable:{type:Boolean,default:!1},closeOnEsc:{type:Boolean,default:!0},segmented:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},bordered:{type:Boolean,default:!1},title:{default:""},onClose:{type:Function,default:void 0}},emits:["update:modelValue","onSizeChange"],setup(L,{emit:h}){const s=L,m=h,{width:n,height:B}=_n(),I=at({get(){return s.modelValue},set(M){m("update:modelValue",M)}}),f=io(0),V=()=>{const M=document.querySelector(".fullscreen-modal-header");if(!M)return;const D=window.getComputedStyle(M);f.value=parseFloat(D.height),m("onSizeChange",{windowWidth:n.value,windowHeight:B.value,headerHeight:f.value,contentHeight:B.value-f.value})};st(()=>s.modelValue,M=>{M&&co(()=>V())}),st(()=>[n.value,B.value],()=>V());const v=uo(),C=at(()=>!!v.header||!!v["header-extra"]),{pickByTheme:z}=yt();return(M,D)=>{const T=kt;return ao(),so(T,{show:Z(I),"onUpdate:show":D[0]||(D[0]=G=>lo(I)?I.value=G:null),preset:"card",closable:s.closable,segmented:s.segmented,bordered:s.bordered,"mask-closable":s.maskClosable,"close-on-esc":s.closeOnEsc,title:s.title,style:lt(`width: ${Z(n)}px; min-height: ${Z(B)}px`),"header-style":`background-color: ${Z(z)("white","rgba(24, 24, 28, 1)")}`,"header-class":`fullscreen-modal-header ${Z(C)?"fixed top-0 w-full z-50":""} `,"content-class":"!p-0 fullscreen-modal-content",onClose:L.onClose},{header:Le(()=>[Z(v).header?Ae(M.$slots,"header",{key:0}):ot("",!0)]),"header-extra":Le(()=>[Z(v)["header-extra"]?Ae(M.$slots,"header-extra",{key:0}):ot("",!0)]),default:Le(()=>[oo("section",{style:lt(`margin-top: ${Z(C)?Z(f):"0"}px`)},[Ae(M.$slots,"default")],4)]),_:3},8,["show","closable","segmented","bordered","mask-closable","close-on-esc","title","style","header-style","header-class","onClose"])}}}),{defineComponent:po}=await x("vue"),{unref:_o,renderSlot:mo,Teleport:fo,openBlock:vo,createBlock:yo,createCommentVNode:ho}=await x("vue"),{ref:go,onMounted:ko,onUnmounted:bo}=await x("vue"),Mt=po({__name:"MountedTeleport",props:{to:{}},setup(L){const h=L,s=go(!1);return ko(()=>{s.value=!0}),bo(()=>{s.value=!1}),(m,n)=>_o(s)?(vo(),yo(fo,{key:0,to:h.to},[mo(m.$slots,"default")],8,["to"])):ho("",!0)}}),Te=Symbol(),{unref:it}=await x("vue"),{defineComponent:wo}=await x("vue"),{unref:e,toDisplayString:d,createElementVNode:u,resolveComponent:Yl,createVNode:a,withCtx:l,createTextVNode:le,openBlock:c,createElementBlock:_,createCommentVNode:F,isRef:ee,createBlock:N,renderList:Oe,Fragment:ue}=await x("vue"),Co={class:"px-10"},$o={key:0,class:"flex items-center gap-3"},xo={key:1,class:"flex items-center gap-3"},Mo={class:"flex justify-between items-center"},So={class:"flex items-center gap-3"},Io={key:0},Uo={key:0},Fo={key:1},Bo={key:2},Vo={key:3},To={key:4},No={key:0},Eo={class:"flex items-center justify-center h-[200px] relative"},zo={class:"text-center text-dimgray text-sm"},Do={class:"flex items-center gap-2"},Ao={class:"flex items-center gap-2"},Lo={key:1,class:"flex items-center justify-center"},Oo={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},Ro=["src"],jo={id:"video",autoplay:"",controls:"",style:{width:"100%"}},Po=["src"],Ho={class:"w-[30%]"},Yo={key:0},qo={key:1},Go={key:2},Wo={key:3},Qo={key:4},Ko={key:0},Jo={key:1},Xo={key:2},Zo={key:3},el={key:4},tl={key:5},nl={key:6},{inject:ol,ref:$,computed:Se,h:ll,watch:ct,onMounted:al}=await x("vue"),sl=wo({__name:"MediaLibrary",emits:["validate"],setup(L,{emit:h}){const s=ol(Te),m=h,{t:n,locale:B}=Ve(),{getVideoThumbnail:I}=yt(),f=We(),V=kn(),{mediaFileTypes:v}=Pn(),C=$(Me()),z=$(""),M=$(null),D=eo(z,500),T=$([]),G=$(!1),E=$({}),U=$([]),K=Se(()=>v.filter(o=>o.value==p.DOCUMENT&&s?.displayDocuments||o.value==p.IMAGE&&s?.displayImages||o.value==p.VIDEO&&s?.displayVideos||o.value==p.AUDIO&&s?.displayAudios||o.value==p.OTHER&&s?.displayOtherTypes)),r=$([]),k=$(v.length===K.value.length?0:K.value[0].value),J=o=>ll("span",{},{default:()=>tt(o.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:B.value})}),O=$(0),X=$(48),W=$(1),me=Se(()=>({pageSize:X.value,query:D.value,page:W.value,type:k.value,months:r.value})),oe=o=>{W.value=o,R()},se=o=>{X.value=o,R()},{data:fe,refetch:R,isPending:re}=Hn(me);ct(()=>fe.value,o=>{T.value=o?.mediaFiles||[],O.value=o?.meta?.total||0,W.value=o?.meta?.currentPage||1;let i=!0;T.value.length===0&&(i=!1);for(const y of T.value)if(y.id&&!E.value[y.id]){i=!1;break}G.value=i,C.value=Me()},{deep:!0,immediate:!0});const{data:j}=Yn(),{data:pe}=qn(),{data:St}=he(p.IMAGE),{data:It}=he(p.VIDEO),{data:Ut}=he(p.AUDIO),{data:Ft}=he(p.DOCUMENT),{data:Bt}=he(p.OTHER),{mutateAsync:Vt}=Gn(),ke=Se(()=>(j.value||[]).map(o=>({label:o,value:o})));al(async()=>{if(s?.preselectedMediaList&&Array.isArray(s?.preselectedMediaList)){U.value=await Vt({ids:s?.preselectedMediaList}),E.value={};for(const o of U.value)o.id&&(E.value[o.id]=!0)}});const{mutate:Tt}=Wn(),Nt=async o=>{V.warning({title:n("confirm"),content:n("confirmDeleteMediaFile"),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:()=>{Tt(o)}})},{copy:Et,copied:zt,isSupported:Dt}=mn(),At=async o=>{o.url&&Et(o.url)};ct(()=>zt.value,o=>{o&&f.success(n("mediaLinkCopied"))});const ve=$(null),be=$(!1),we=$(!1),Lt=async o=>{switch(ve.value=o,o.type){case p.IMAGE:break;case p.VIDEO:we.value=!0;break;case p.AUDIO:be.value=!0;break;case p.DOCUMENT:window.open(o.url);break;default:f.info(n("cannotOpenThisFile"));break}},g=$(null),Ce=$(!1),Ot=async o=>{g.value=o,Ce.value=!0},Ne=$(null),ie=$(null),ce=$(!1),{mutate:Rt}=fn(),{mutate:jt}=Qn(),{mutate:Pt}=Kn(),Ht=async o=>{ie.value=o,Rt(o.path,{onSuccess(i,y,b){Ne.value=i,ce.value=!0}})},Yt=async(o,i)=>{var y=yn(i);y=await gt(y,{maxSizeMB:1});const b=new FormData;b.append("file",y),V.warning({title:n("registration"),content:n("confirmReplaceCurrentFile"),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:async()=>{ie.value&&b.append("filename",ie.value?.name),jt({id:ie.value?.id,data:b},{onSuccess(A,ye,Ee){ce.value=!1}})},onNegativeClick:async()=>{ie.value&&b.append("filename",hn(6)+"-"+ie.value?.name),Pt(b,{onSuccess(A,ye,Ee){ce.value=!1}})}})},$e=Se(()=>{let o=0;for(const i in E.value)E.value[i]&&o++;return o}),qt=o=>{const i=!s?.selectionMultiple,y=s?.selectionMultiple&&!s?.selectionLimit,b=s?.selectionMultiple&&s?.selectionLimit&&U.value.length<s?.selectionLimit,A=s?.selectionMultiple&&s?.selectionLimit&&o.id&&E.value[o.id];return i||y||A||b},Gt=()=>{let o=U.value;s?.selectionType=="url"?o=U.value.map(i=>i.url):s?.selectionType=="path"&&(o=U.value.map(i=>i.path)),m("validate",s?.selectionMultiple?o:o[0])},Xe=()=>{E.value={},U.value=[],R()},{mutate:Wt}=Jn(),Qt=async()=>($e.value?V.warning({title:n("confirm"),content:n("deleteSelectionWarningMessage",[$e.value]),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:async()=>{Wt({selectedItems:E.value},{onSuccess:()=>{Xe()}})}}):f.warning(n("noItemSelected")),!1);return(o,i)=>{const y=Je,b=Ke,A=Qe,ye=wn,Ee=bn,Kt=wt,Jt=bt,Xt=Mt,Ze=$n,Zt=Cn,ze=Ct,en=Un,tn=Xn,nn=In,on=$t,ln=vn,an=Sn,sn=Mn,cn=xn,un=Fn,dn=xt,rn=Bn,xe=kt,et=Vn,pn=Zn;return c(),_(ue,null,[u("section",Co,[a(Xt,{to:"#actions"},{default:l(()=>[e($e)>0?(c(),_("section",$o,[u("span",null,d(e(n)("nbItemsSelected",[e($e)])),1),a(A,{type:"success",size:"small",secondary:"",onClick:Gt},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:checkmark"})]),_:1})]),default:l(()=>[le(" "+d(e(n)("validateSelection")),1)]),_:1}),a(A,{type:"error",size:"small",secondary:"",onClick:Qt},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:trash-can"})]),_:1})]),default:l(()=>[le(" "+d(e(n)("deleteSelection")),1)]),_:1}),a(A,{type:"warning",size:"small",secondary:"",onClick:Xe},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:close"})]),_:1})]),default:l(()=>[le(" "+d(e(n)("cancelSelection")),1)]),_:1})])):(c(),_("section",xo,[a(Ee,{value:e(r),"onUpdate:value":[i[1]||(i[1]=t=>ee(r)?r.value=t:null),i[2]||(i[2]=t=>e(R)())],"render-label":J,options:e(ke),placeholder:e(n)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:l(()=>[a(ye,{size:"large",class:"w-full","default-checked":e(ke).length&&e(r).length===e(ke).length,"onUpdate:checked":i[0]||(i[0]=t=>{t?r.value=e(ke).map(Y=>Y.value):r.value=[],e(R)()})},{default:l(()=>[le(d(e(n)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),a(Jt,{class:"!w-[250px]"},{default:l(()=>[a(Kt,{ref_key:"searchInputRef",ref:M,value:e(z),"onUpdate:value":[i[3]||(i[3]=t=>ee(z)?z.value=t:null),i[4]||(i[4]=t=>{t||e(R)()})],clearable:!0,placeholder:e(n)("search")},null,8,["value","placeholder"]),a(A,{type:"primary",secondary:"",onClick:i[5]||(i[5]=t=>e(R)())},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})]))]),_:1}),a(ze,{size:"small",class:"mb-5"},{default:l(()=>[u("div",Mo,[u("div",So,[e(s)?.selectionMultiple&&!e(s)?.selectionLimit?(c(),N(ye,{key:0,checked:e(G),"onUpdate:checked":[i[6]||(i[6]=t=>ee(G)?G.value=t:null),i[7]||(i[7]=t=>{for(const Y of e(T))Y.id&&(e(E)[Y.id]=t,e(U).findIndex(q=>q.id==Y.id)===-1&&e(U).push(Y));C.value=("uuidv4"in o?o.uuidv4:it(Me))()})]},{default:l(()=>[le(d(e(n)("selectAll")),1)]),_:1},8,["checked"])):F("",!0)]),a(Zt,{value:e(k),"onUpdate:value":[i[8]||(i[8]=t=>ee(k)?k.value=t:null),i[9]||(i[9]=t=>e(R)())],name:"filtertyperadiobuttongroup",size:"medium"},{default:l(()=>[e(v).length===e(K).length?(c(),N(Ze,{key:0,value:0},{default:l(()=>[le(d(e(n)("all"))+"  ",1),e(pe)?(c(),_("span",Io," ("+d(e(pe))+") ",1)):F("",!0)]),_:1})):F("",!0),(c(!0),_(ue,null,Oe(e(K),t=>(c(),N(Ze,{key:t.value,value:t.value},{default:l(()=>[le(d(t.label)+"  ",1),t.value==e(p).IMAGE?(c(),_("span",Uo," ("+d(e(St))+") ",1)):t.value==e(p).VIDEO?(c(),_("span",Fo," ("+d(e(It))+") ",1)):t.value==e(p).AUDIO?(c(),_("span",Bo," ("+d(e(Ut))+") ",1)):t.value==e(p).DOCUMENT?(c(),_("span",Vo," ("+d(e(Ft))+") ",1)):(c(),_("span",To,"("+d(e(Bt))+")",1))]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),_:1}),a(ze,{embedded:"",class:"py-2"},{default:l(()=>[e(T).length&&!e(re)?(c(),_("section",No,[a(cn,{"show-toolbar-tooltip":""},{default:l(()=>[a(sn,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:4 900:4 1400:6"},{default:l(()=>[(c(!0),_(ue,null,Oe(e(T),(t,Y)=>(c(),N(an,{key:Y},{default:l(()=>[a(ln,{name:"slide-fade",appear:""},{default:l(()=>[a(ze,{bordered:"",hoverable:""},{cover:l(()=>[u("div",Eo,[t.type==e(p).IMAGE?(c(),_(ue,{key:0},[t.url?(c(),N(en,{key:0,src:t.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):F("",!0)],64)):t.type==e(p).VIDEO?(c(),_(ue,{key:1},[t.url?(c(),N(tn,{key:0,load:()=>e(I)(t.url??""),class:"w-full h-[200px] object-cover"},{fallback:l(()=>[a(b,{size:"96"},{default:l(()=>[a(y,{icon:"carbon:document-video"})]),_:1})]),_:1},8,["load"])):F("",!0)],64)):t.type==e(p).AUDIO?(c(),N(b,{key:2,size:"96"},{default:l(()=>[a(y,{icon:"carbon:document-audio"})]),_:1})):t.type==e(p).DOCUMENT?(c(),N(b,{key:3,size:"96"},{default:l(()=>[a(y,{icon:"carbon:document"})]),_:1})):(c(),N(b,{key:4,size:"96"},{default:l(()=>[a(y,{icon:"carbon:document-unknown"})]),_:1}))])]),header:l(()=>[u("div",zo,[a(nn,{"line-clamp":1},{default:l(()=>[t.id?(c(),_(ue,{key:0},[qt(t)?(c(),N(ye,{key:e(C),checked:e(E)[t.id],"onUpdate:checked":[q=>e(E)[t.id]=q,q=>{e(s)?.selectionMultiple?q?e(U).findIndex(De=>De.id==t.id)===-1&&e(U).push(t):U.value=e(U).filter(De=>De.id!=t.id):t&&t.id&&(U.value=[t],E.value={[t.id]:q}),C.value=("uuidv4"in o?o.uuidv4:it(Me))()}],class:"mr-1"},null,8,["checked","onUpdate:checked"])):F("",!0)],64)):F("",!0),le(" "+d(t.name),1)]),_:2},1024)])]),action:l(()=>[a(on,{justify:"space-between",align:"center"},{default:l(()=>[u("div",Do,[t.type!=e(p).IMAGE?(c(),N(A,{key:0,ternary:"",circle:"",title:e(n)("preview"),onClick:q=>Lt(t)},{icon:l(()=>[a(b,null,{default:l(()=>[[e(p).AUDIO,e(p).VIDEO].includes(t.type)?(c(),N(y,{key:0,icon:"carbon:play-filled-alt"})):(c(),N(y,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):F("",!0),a(A,{ternary:"",circle:"",title:e(n)("details"),onClick:q=>Ot(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:information-filled"})]),_:1})]),_:1},8,["title","onClick"])]),u("div",Ao,[e(Dt)?(c(),N(A,{key:0,ternary:"",circle:"",title:e(n)("copy"),onClick:q=>At(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:copy"})]),_:1})]),_:1},8,["title","onClick"])):F("",!0),t.type==e(p).IMAGE?(c(),N(A,{key:1,ternary:"",circle:"",title:e(n)("edit"),onClick:q=>Ht(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:edit"})]),_:1})]),_:1},8,["title","onClick"])):F("",!0),a(A,{ternary:"",circle:"",title:e(n)("delete"),onClick:q=>Nt(t)},{icon:l(()=>[a(b,null,{default:l(()=>[a(y,{icon:"carbon:trash-can"})]),_:1})]),_:1},8,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(un,{page:e(W),"onUpdate:page":[i[10]||(i[10]=t=>ee(W)?W.value=t:null),oe],class:"mt-10 justify-center","show-size-picker":"","page-size":e(X),"page-sizes":[12,24,36,48,60],"page-count":Math.ceil(e(O)/e(X)),"onUpdate:pageSize":se},null,8,["page","page-size","page-count"])])):e(re)?(c(),_("section",Lo,[a(dn,{size:"medium"})])):(c(),N(rn,{key:2,description:e(n)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),a(xe,{show:e(be),"onUpdate:show":i[11]||(i[11]=t=>ee(be)?be.value=t:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ve)?.name},{default:l(()=>[u("audio",Oo,[u("source",{src:e(ve)?.url},null,8,Ro)])]),_:1},8,["show","title"]),a(xe,{show:e(we),"onUpdate:show":i[12]||(i[12]=t=>ee(we)?we.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ve)?.name},{default:l(()=>[u("video",jo,[u("source",{src:e(ve)?.url},null,8,Po)])]),_:1},8,["show","title"]),a(xe,{show:e(Ce),"onUpdate:show":i[13]||(i[13]=t=>ee(Ce)?Ce.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(g)?.name},{default:l(()=>[e(g)?(c(),N(et,{key:0,striped:"","single-line":!1,size:"small"},{default:l(()=>[u("tbody",null,[u("tr",null,[u("td",Ho,d(e(n)("name")),1),u("td",null,d(e(g).name),1)]),u("tr",null,[u("td",null,d(e(n)("link")),1),u("td",null,[u("small",null,d(e(g).url),1)])]),u("tr",null,[u("td",null,d(e(n)("type")),1),u("td",null,[e(g).type==e(p).IMAGE?(c(),_("span",Yo,d(e(n)("image")),1)):e(g).type==e(p).VIDEO?(c(),_("span",qo,d(e(n)("video")),1)):e(g).type==e(p).AUDIO?(c(),_("span",Go,d(e(n)("audio")),1)):e(g).type==e(p).DOCUMENT?(c(),_("span",Wo,d(e(n)("document")),1)):(c(),_("span",Qo,d(e(n)("other")),1))])]),e(g).size?(c(),_("tr",Ko,[u("td",null,d(e(n)("size")),1),u("td",null,d(e(ht)(e(g).size,!0)),1)])):F("",!0),e(g).mimeType?(c(),_("tr",Jo,[u("td",null,d(e(n)("mimeType")),1),u("td",null,d(e(g).mimeType),1)])):F("",!0),e(g).sender?(c(),_("tr",Xo,[u("td",null,d(e(n)("sendBy")),1),u("td",null,d(e(g).sender.fullname),1)])):F("",!0),e(g).title?(c(),_("tr",Zo,[u("td",null,d(e(n)("title")),1),u("td",null,d(e(g).title),1)])):F("",!0),e(g).description?(c(),_("tr",el,[u("td",null,d(e(n)("description")),1),u("td",null,[u("small",null,d(e(g).description),1)])])):F("",!0),e(g).createdAt?(c(),_("tr",tl,[u("td",null,d(e(n)("date")),1),u("td",null,d(e(tt)(e(g).createdAt)),1)])):F("",!0),e(g).additionalMetadata?(c(),_("tr",nl,[u("td",null,d(e(n)("metadata")),1),u("td",null,[a(et,{striped:"","single-line":"",size:"small"},{default:l(()=>[u("tbody",null,[(c(!0),_(ue,null,Oe(e(g).additionalMetadata||[],(t,Y)=>(c(),_("tr",{key:Y},[u("td",null,d(Y),1),u("td",null,d(t),1)]))),128))])]),_:1})])])):F("",!0)])]),_:1})):F("",!0)]),_:1},8,["show","title"]),a(xe,{show:e(ce),"onUpdate:show":i[15]||(i[15]=t=>ee(ce)?ce.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ie)?.name},{default:l(()=>[a(pn,{"cropper-ratio":void 0,"round-preview":!1,src:e(Ne)?e(Ne):void 0,onCancel:i[14]||(i[14]=t=>ce.value=!1),onSave:Yt},null,8,["src"])]),_:1},8,["show","title"])],64)}}}),{unref:ut}=await x("vue"),{defineComponent:il}=await x("vue"),{unref:S,resolveComponent:ql,isRef:dt,createVNode:Q,withCtx:te,toDisplayString:Re,createTextVNode:je,openBlock:ge,createElementBlock:Pe,createCommentVNode:rt,createBlock:pt}=await x("vue"),cl={class:"px-10"},ul={key:0},dl={key:0,class:"text-end"},{inject:rl,ref:_t}=await x("vue"),pl=il({__name:"AddFromAnUrl",emits:["validate"],setup(L,{emit:h}){const{t:s}=Ve(),m=We(),n=rl(Te),B=h,I=_t(""),f=_t([]);return(V,v)=>{const C=Tn,z=Nn,M=Je,D=Ke,T=Qe,G=En,E=wt,U=bt,K=Ct;return ge(),Pe("section",cl,[Q(K,null,{default:te(()=>[S(n)?.selectionMultiple?(ge(),Pe("section",ul,[Q(C,{value:S(f),"onUpdate:value":v[0]||(v[0]=r=>dt(f)?f.value=r:null),placeholder:S(s)("fileUrl"),min:1,max:S(n).selectionLimit||void 0},null,8,["value","placeholder","max"]),S(f).length>0?(ge(),Pe("div",dl,[Q(z),Q(T,{type:"primary",secondary:"",disabled:S(f).length!=S(f).filter(r=>r.trim()).length,onClick:v[1]||(v[1]=()=>{const r=S(f).map(k=>encodeURI(k));r.findIndex(k=>!("_v"in V?V._v:ut(nt)).isURL(k))>-1?S(m).error(S(s)("invalidUrl")):B("validate",r),B("validate",S(f))})},{icon:te(()=>[Q(D,null,{default:te(()=>[Q(M,{icon:"carbon:checkmark"})]),_:1})]),default:te(()=>[je(" "+Re(S(s)("validate")),1)]),_:1},8,["disabled"])])):rt("",!0)])):(ge(),pt(U,{key:1},{default:te(()=>[Q(G,null,{default:te(()=>[je(Re(S(s)("fileUrl")),1)]),_:1}),Q(E,{value:S(I),"onUpdate:value":v[2]||(v[2]=r=>dt(I)?I.value=r:null)},null,8,["value"]),S(I)?(ge(),pt(T,{key:0,type:"primary",secondary:"",onClick:v[3]||(v[3]=()=>{const r=encodeURI(S(I));("_v"in V?V._v:ut(nt)).isURL(r)?B("validate",r):S(m).error(S(s)("invalidUrl"))})},{icon:te(()=>[Q(D,null,{default:te(()=>[Q(M,{icon:"carbon:checkmark"})]),_:1})]),default:te(()=>[je(" "+Re(S(s)("validate")),1)]),_:1})):rt("",!0)]),_:1}))]),_:1})])}}}),{defineComponent:_l}=await x("vue"),{unref:w,resolveComponent:Gl,createVNode:P,withCtx:H,toDisplayString:ne,createTextVNode:He,openBlock:ae,createBlock:ml,createCommentVNode:fl,createElementVNode:Ie,createElementBlock:de}=await x("vue"),vl={class:"px-10"},yl={class:"flex justify-between items-center"},hl={style:{"margin-bottom":"12px"}},gl={key:0,class:"text-xs"},kl={key:1,class:"text-xs"},bl={key:2,class:"text-xs"},wl={key:3,class:"text-xs"},Cl={key:4,class:"text-xs"},$l={key:5,class:"text-xs"},{inject:mt,ref:Ye,onMounted:xl,onUnmounted:Ml}=await x("vue"),Sl=_l({__name:"UploadFiles",setup(L){const h=mt(Te),s=mt("appConfig"),{t:m}=Ve(),n=We(),B=zn(),I=Ye(),f=Ye([]),V=Ye(!1),v=gn(),C=s?.apiRequestHeaders;C&&(C.Authorization=`Bearer ${v.accessToken}`);const z=async()=>{I.value.submit()},M=()=>{I.value?.clear(),f.value=[]},D=r=>{const k=r.file.file;if(h?.uploadConfig?.maxSize&&k&&k.size){const O=k.size/1024/1024<=h?.uploadConfig?.maxSize;return O||n.error(m("fileSizeNotAllowed")),O}const J=k?.name.split(".").pop();return J&&h?.uploadConfig?.excludedExtensions.map(O=>O.toLowerCase()).includes(J.toLowerCase())?(n.error(m("fileTypeNotAllowed")),!1):!0},T=r=>{f.value=r.fileList},G=({file:r})=>r,E=()=>{if(h?.uploadConfig?.limit)return h?.uploadConfig.limit},U=async({file:r,data:k,headers:J,action:O,onFinish:X,onError:W,onProgress:me})=>{const oe=new FormData;k&&Object.keys(k).forEach(j=>{oe.append(j,k[j])});const se=r.file,fe=se?.name.split(".").pop(),R=se?.name.replace("."+fe,""),re=await gt(se,{maxSizeMB:1});oe.append("file",re,R),oe.append("folder",h?.uploadConfig?.folder),V.value=!0,B.start(),to.post(O,oe,{headers:J,onUploadProgress:j=>{if(j.total!==void 0){const pe=Math.round(j.loaded*100/j.total);me({percent:pe})}}}).then(async()=>{X();const j=f.value.findIndex(pe=>pe.id===r.id);j!==-1&&f.value.splice(j,1),n.success(m("success")),B.finish(),V.value=!1}).catch(j=>{n.error(m("anErrorOccurred")),W(),B.finish(),V.value=!1})},K=console.warn;return xl(()=>{console.warn=r=>{typeof r=="string"&&r.includes('Non-function value encountered for slot "default"')||K(r)}}),Ml(()=>{console.warn=K}),(r,k)=>{const J=Je,O=Ke,X=Qe,W=$t,me=Mt,oe=Ln,se=On,fe=An,R=Dn,re=xt;return ae(),de("section",vl,[P(me,{to:"#actions"},{default:H(()=>[Ie("div",yl,[w(f).length?(ae(),ml(W,{key:0,align:"center"},{default:H(()=>[P(X,{secondary:"",disabled:w(f).length==0,onClick:M},{icon:H(()=>[P(O,null,{default:H(()=>[P(J,{icon:"carbon:close"})]),_:1})]),default:H(()=>[He(" "+ne(w(m)("clearList")),1)]),_:1},8,["disabled"]),P(X,{type:"primary",secondary:"",disabled:w(f).length==0,onClick:z},{default:H(()=>[He(ne(w(m)("launchImport")),1)]),_:1},8,["disabled"])]),_:1})):fl("",!0)])]),_:1}),P(re,{show:!1},{default:H(()=>[P(R,{ref_key:"upload",ref:I,multiple:"","directory-dnd":"","list-type":"image",max:E(),"default-upload":!1,headers:w(C),"custom-request":U,action:w(h)?.uploadConfig?.baseUrl||w(s)?.apiUrl+"/media-files/upload",onBeforeUpload:D,onChange:T,onFinish:G},{default:H(()=>[P(fe,{class:"h-[250px] flex flex-col items-center justify-center"},{default:H(()=>[Ie("div",hl,[P(O,{size:"48",depth:3},{default:H(()=>[P(J,{icon:"mdi:file-upload"})]),_:1})]),P(oe,{style:{"font-size":"16px"}},{default:H(()=>[He(ne(w(m)("uploadAreaTitle")),1)]),_:1}),P(se,{depth:"3",class:"mt-4"},{default:H(()=>[w(h)?.uploadConfig?.limit?(ae(),de("span",gl,ne(w(m)("limitToTheNumberOfFilesToSend",[w(h)?.uploadConfig.limit])),1)):(ae(),de("span",kl,ne(w(m)("noLimitToTheNumberOfFilesToSend")),1)),k[0]||(k[0]=Ie("br",null,null,-1)),w(h)?.uploadConfig?.maxSize?(ae(),de("span",bl,ne(w(m)("limitToTheSizeOfFilesToSend",[w(ht)(w(h)?.uploadConfig.maxSize)])),1)):(ae(),de("span",wl,ne(w(m)("noLimitToTheSizeOfFilesToSend")),1)),k[1]||(k[1]=Ie("br",null,null,-1)),w(h)?.uploadConfig?.excludedExtensions.length?(ae(),de("span",Cl,ne(w(m)("extensionsAreNotAllowed",[w(h)?.uploadConfig.excludedExtensions.join(", ")])),1)):(ae(),de("span",$l,ne(w(m)("allFileExtensionsAreAllowed")),1))]),_:1})]),_:1})]),_:1},8,["max","headers","action"])]),_:1})])}}}),{useModel:ft,mergeModels:vt,defineComponent:Il}=await x("vue"),{unref:qe,createVNode:Ue,resolveComponent:Wl,withCtx:_e,openBlock:Fe,createBlock:Be,createCommentVNode:Ge,createElementVNode:Ul}=await x("vue"),{defineComponent:Fl,provide:Bl}=await x("vue"),Vl=Fl({name:"MediaPicker"}),Ql=Il({...Vl,props:vt({enableUploadFiles:{type:Boolean,default:!0},enableMediaLibrary:{type:Boolean,default:!0},enableAddFromAnUrl:{type:Boolean,default:!0},displayImages:{type:Boolean,default:!0},displayVideos:{type:Boolean,default:!0},displayAudios:{type:Boolean,default:!0},displayDocuments:{type:Boolean,default:!0},displayOtherTypes:{type:Boolean,default:!0},preselectedMediaList:{default:null},selectionType:{default:"path"},selectionMultiple:{type:Boolean,default:!1},selectionLimit:{default:0},title:{default:""},uploadConfig:{default:()=>({folder:"uploads",limit:0,maxSize:0,baseUrl:null,excludedExtensions:[]})}},{show:{type:Boolean,required:!0,default:!1},showModifiers:{},tab:{default:"media-library"},tabModifiers:{}}),emits:vt(["submit"],["update:show","update:tab"]),setup(L,{emit:h}){const{t:s}=Ve(),m=L;Bl(Te,m);const n=ft(L,"show"),B=ft(L,"tab"),I=h,f=v=>{I("submit",v),n.value=!1},V=v=>{I("submit",v),n.value=!1};return(v,C)=>{const z=jn,M=Rn,D=ro;return Fe(),Be(D,{modelValue:n.value,"onUpdate:modelValue":C[1]||(C[1]=T=>n.value=T),title:L.title,class:"w-full"},{default:_e(()=>[Ue(M,{value:B.value,"onUpdate:value":C[0]||(C[0]=T=>B.value=T),type:"card",size:"large",animated:""},{suffix:_e(()=>[...C[2]||(C[2]=[Ul("div",{id:"actions",class:"pr-10"},null,-1)])]),default:_e(()=>[m.enableUploadFiles?(Fe(),Be(z,{key:0,name:"upload-files",tab:qe(s)("uploadFiles")},{default:_e(()=>[Ue(Sl)]),_:1},8,["tab"])):Ge("",!0),m.enableMediaLibrary?(Fe(),Be(z,{key:1,name:"media-library",tab:qe(s)("mediaLibrary")},{default:_e(()=>[Ue(sl,{onValidate:f})]),_:1},8,["tab"])):Ge("",!0),m.enableAddFromAnUrl?(Fe(),Be(z,{key:2,name:"add-from-an-url",tab:qe(s)("addFromAnUrl")},{default:_e(()=>[Ue(pl,{onValidate:V})]),_:1},8,["tab"])):Ge("",!0)]),_:1},8,["value"])]),_:1},8,["modelValue","title"])}}});export{Mt as _,Ql as a,ro as b};
