import{i as I}from"./css-render_vue3-ssr-Vbotx5Ir.js";import{c as tn,b as nn}from"./vueuse_core-C-qbfbRJ.js";import{u as gt,_ as ln,l as kt,r as lt,e as on,m as an,n as sn,o as bt,p as cn,c as un}from"./index-B2LlKIv2.js";import{a3 as wt,a as $t,b as Qe,c as rn,B as Ze,N as et,j as dn,M as pn,a6 as Ct,F as xt,A as Mt,a8 as _n,a9 as mn,ab as fn,G as vn,R as yn,g as St,X as hn,ac as gn,a1 as kn,O as It,a2 as bn,ad as wn,ai as $n,V as Cn,ar as xn,ae as Mn,af as Sn,P as In,W as Un,ak as Tn,am as En}from"./naive-ui-CrTIpLJ9.js";import{u as Vn,M as r,_ as zn,a as Bn}from"./media-library-DmBw0Umg.js";import{I as tt}from"./iconify_vue-BwapRRpV.js";import{v as ze}from"./uuid-8I8R7izr.js";import{u as Oe}from"./vue-i18n-CWrb4u3f.js";import{_ as ot}from"./validator-QVVspsrX.js";import{a as Nn}from"./axios-ChUjVlRB.js";const{defineComponent:Dn}=await I("vue"),{unref:te,renderSlot:je,createCommentVNode:at,normalizeStyle:st,createElementVNode:An,resolveComponent:go,isRef:On,withCtx:Pe,openBlock:Fn,createBlock:Ln}=await I("vue"),{computed:it,ref:Rn,watch:ct,nextTick:jn,useSlots:Pn}=await I("vue"),Hn=Dn({__name:"NFullscreenModal",props:{modelValue:{type:Boolean},maskClosable:{type:Boolean,default:!1},closeOnEsc:{type:Boolean,default:!0},segmented:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},bordered:{type:Boolean,default:!1},title:{default:""},onClose:{type:Function,default:void 0}},emits:["update:modelValue","onSizeChange"],setup(Q,{emit:$}){const i=Q,f=$,{width:t,height:z}=tn(),_=it({get(){return i.modelValue},set(C){f("update:modelValue",C)}}),h=Rn(0),b=()=>{const C=document.querySelector(".fullscreen-modal-header");if(!C)return;const V=window.getComputedStyle(C);h.value=parseFloat(V.height),f("onSizeChange",{windowWidth:t.value,windowHeight:z.value,headerHeight:h.value,contentHeight:z.value-h.value})};ct(()=>i.modelValue,C=>{C&&jn(()=>b())}),ct(()=>[t.value,z.value],()=>b());const m=Pn(),U=it(()=>!!m.header||!!m["header-extra"]),{pickByTheme:j}=gt();return(C,V)=>{const A=wt;return Fn(),Ln(A,{show:te(_),"onUpdate:show":V[0]||(V[0]=ee=>On(_)?_.value=ee:null),preset:"card",closable:i.closable,segmented:i.segmented,bordered:i.bordered,"mask-closable":i.maskClosable,"close-on-esc":i.closeOnEsc,title:i.title,style:st(`width: ${te(t)}px; min-height: ${te(z)}px`),"header-style":`background-color: ${te(j)("white","rgba(24, 24, 28, 1)")}`,"header-class":`fullscreen-modal-header ${te(U)?"fixed top-0 w-full z-50":""} `,"content-class":"!p-0 fullscreen-modal-content",onClose:C.onClose},{header:Pe(()=>[te(m).header?je(C.$slots,"header",{key:0}):at("",!0)]),"header-extra":Pe(()=>[te(m)["header-extra"]?je(C.$slots,"header-extra",{key:0}):at("",!0)]),default:Pe(()=>[An("section",{style:st(`margin-top: ${te(U)?te(h):"0"}px`)},[je(C.$slots,"default")],4)]),_:3},8,["show","closable","segmented","bordered","mask-closable","close-on-esc","title","style","header-style","header-class","onClose"])}}}),{defineComponent:Gn}=await I("vue"),{unref:Yn,renderSlot:qn,Teleport:Wn,openBlock:Kn,createBlock:Xn,createCommentVNode:Jn}=await I("vue"),{ref:Qn,onMounted:Zn,onUnmounted:el}=await I("vue"),Ut=Gn({__name:"MountedTeleport",props:{to:{}},setup(Q){const $=Q,i=Qn(!1);return Zn(()=>{i.value=!0}),el(()=>{i.value=!1}),(f,t)=>Yn(i)?(Kn(),Xn(Wn,{key:0,to:$.to},[qn(f.$slots,"default")],8,["to"])):Jn("",!0)}}),Fe=Symbol(),{unref:ut}=await I("vue"),{defineComponent:tl}=await I("vue"),{unref:e,toDisplayString:d,createElementVNode:u,resolveComponent:ko,createVNode:s,withCtx:a,createTextVNode:re,openBlock:c,createElementBlock:y,createCommentVNode:T,isRef:ne,createBlock:N,renderList:He,Fragment:fe}=await I("vue"),nl={class:"px-10"},ll={key:0,class:"flex items-center gap-3"},ol={key:1,class:"flex items-center gap-3"},al={class:"flex justify-between items-center"},sl={class:"flex items-center gap-3"},il={key:0},cl={key:0},ul={key:0},rl={class:"flex items-center justify-center h-[200px] relative"},dl={class:"text-center text-dimgray text-sm"},pl={class:"flex items-center gap-2"},_l={class:"flex items-center gap-2"},ml={key:1,class:"flex items-center justify-center"},fl={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},vl=["src"],yl={id:"video",autoplay:"",controls:"",style:{width:"100%"}},hl=["src"],gl={class:"w-[30%]"},kl={key:0},bl={key:1},wl={key:2},$l={key:3},Cl={key:4},xl={key:0},Ml={key:1},Sl={key:2},Il={key:3},Ul={key:4},Tl={key:5},El={key:6},{inject:Vl,ref:k,computed:rt,h:zl,watch:Bl}=await I("vue"),Nl=tl({__name:"MediaLibrary",emits:["validate"],setup(Q,{emit:$}){const i=Vl(Fe),f=$,{t,locale:z}=Oe(),{request:_}=on(),{getVideoThumbnail:h}=gt(),b=$t(),m=Qe(),U=rn(),{mediaFileTypes:j}=Vn(),C=k(ze()),V=k(!1),A=k(!1),ee=k(0),ae=k(""),ke=k(null),K=k([]),p=k({[r.DOCUMENT]:0,[r.IMAGE]:0,[r.VIDEO]:0,[r.AUDIO]:0,[r.OTHER]:0}),M=k(!1),P=k([]),F=rt(()=>j.filter(l=>l.value==r.DOCUMENT&&i?.displayDocuments||l.value==r.IMAGE&&i?.displayImages||l.value==r.VIDEO&&i?.displayVideos||l.value==r.AUDIO&&i?.displayAudios||l.value==r.OTHER&&i?.displayOtherTypes)),Y=k([]),se=k(j.length===F.value.length?0:F.value[0].value),H=l=>{let o=`${l}&query=${ae.value}&type=${se.value}`;for(const v of Y.value)o+=`&months[]=${v}`;return o},ie=l=>zl("span",{},{default:()=>lt(l.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:z.value})}),ce=k(0),D=k(12),L=k(1),be=l=>{B(H(`/media-files?pageSize=${D.value}&page=${l}`))},G=l=>{D.value=l,B(H(`/media-files?pageSize=${D.value}`))},B=async(l=null,o=!1)=>{A.value=!0,b.start();const v=await _({url:l||H(`/media-files?pageSize=${D.value}`)});if(v.success&&v.result&&(K.value=v.result.data?.mediaFiles||[],ce.value=v.result.data?.meta?.total||0,L.value=v.result.data?.meta?.currentPage||1),o){const w=await _({url:"/media-files/list/months"});w.success&&w.result&&(P.value=(w.result.data||[]).map(ue=>({label:ue,value:ue})));const me=await _({url:"/count/media-files"});me.success&&me.result&&(ee.value=me.result.data);const $e=await _({url:`/count/media-files/type/${r.IMAGE}`});$e.success&&$e.result&&(p.value[r.IMAGE]=$e.result.data);const Ce=await _({url:`/count/media-files/type/${r.VIDEO}`});Ce.success&&Ce.result&&(p.value[r.VIDEO]=Ce.result.data);const xe=await _({url:`/count/media-files/type/${r.AUDIO}`});xe.success&&xe.result&&(p.value[r.AUDIO]=xe.result.data);const Me=await _({url:`/count/media-files/type/${r.OTHER}`});Me.success&&Me.result&&(p.value[r.OTHER]=Me.result.data);const ye=await _({url:`/count/media-files/type/${r.DOCUMENT}`});if(ye.success&&ye.result&&(p.value[r.DOCUMENT]=ye.result.data),i?.preselectedMediaList&&Array.isArray(i?.preselectedMediaList)){const ue=await _({url:"/media-files/list",method:"post",data:{ids:i?.preselectedMediaList}});if(ue.success&&ue.result){O.value=ue.result.data,R.value={};for(const he of O.value)he.id&&(R.value[he.id]=!0)}}}let g=!0;K.value.length===0&&(g=!1);for(const w of K.value)if(w.id&&!R.value[w.id]){g=!1;break}M.value=g,C.value=ze(),b.finish(),A.value=!1};B(null,!0);const Tt=async l=>{U.warning({title:t("confirm"),content:t("confirmDeleteMediaFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{(await _({method:"delete",url:`/media-files/${l.id}`})).success?(m.success(t("success")),B(H(`/media-files?pageSize=${D.value}&page=${L.value}`),!0)):m.error(t("anErrorOccurred"))}})},{copy:Et,copied:Vt,isSupported:zt}=nn(),Bt=async l=>{l.url&&Et(l.url)};Bl(()=>Vt.value,l=>{l&&m.success(t("mediaLinkCopied"))});const we=k(null),Ie=k(!1),Ue=k(!1),Nt=async l=>{switch(we.value=l,l.type){case r.IMAGE:break;case r.VIDEO:Ue.value=!0;break;case r.AUDIO:Ie.value=!0;break;case r.DOCUMENT:window.open(l.url);break;default:m.info(t("cannotOpenThisFile"));break}},x=k(null),Te=k(!1),Dt=async l=>{x.value=l,Te.value=!0},Le=k(null),pe=k(null),_e=k(!1),At=async l=>{pe.value=l,b.start();const o=await _({url:"/file/download",method:"post",data:{path:l.path},responseType:"blob"});o.success&&o.result&&(Le.value=await an(o.result)),b.finish(),_e.value=!0},Ot=async(l,o)=>{var v=sn(o);v=await bt(v,{maxSizeMB:1});const g=new FormData;g.append("file",v),U.warning({title:t("registration"),content:t("confirmReplaceCurrentFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{V.value=!0,b.start(),pe.value&&g.append("filename",pe.value?.name);const w=await _({url:`/media-files/replace/${pe.value?.id}`,method:"post",data:g});w.success&&w.result?(_e.value=!1,B(H(`/media-files?pageSize=${D.value}&page=${L.value}`),!0)):m.error(t("anErrorOccurred")),b.finish(),V.value=!1},onNegativeClick:async()=>{V.value=!0,b.start(),pe.value&&g.append("filename",cn(6)+"-"+pe.value?.name);const w=await _({url:"/media-files/upload",method:"post",data:g});w.success&&w.result?(_e.value=!1,B(H(`/media-files?pageSize=${D.value}&page=${L.value}`),!0)):m.error(t("anErrorOccurred")),b.finish(),V.value=!1}})},R=k({}),O=k([]),Ee=rt(()=>{let l=0;for(const o in R.value)R.value[o]&&l++;return l}),Ft=l=>{const o=!i?.selectionMultiple,v=i?.selectionMultiple&&!i?.selectionLimit,g=i?.selectionMultiple&&i?.selectionLimit&&O.value.length<i?.selectionLimit,w=i?.selectionMultiple&&i?.selectionLimit&&l.id&&R.value[l.id];return o||v||w||g},Lt=()=>{let l=O.value;i?.selectionType=="url"?l=O.value.map(o=>o.url):i?.selectionType=="path"&&(l=O.value.map(o=>o.path)),f("validate",i?.selectionMultiple?l:l[0])},Rt=()=>{R.value={},O.value=[],B(H(`/media-files?pageSize=${D.value}&page=${L.value}`))},jt=async()=>(Ee.value?U.warning({title:t("confirm"),content:t("deleteSelectionWarningMessage",[Ee.value]),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{V.value=!0,b.start();for(const l in R.value)R.value[l]&&await _({url:`/media-files/${l}`,method:"delete"});b.finish(),V.value=!1,m.success(t("success")),R.value={},O.value=[],B(null,!0)}}):m.warning(t("noItemSelected")),!1);return(l,o)=>{const v=tt,g=et,w=Ze,me=pn,$e=dn,Ce=xt,xe=Ct,Me=Ut,ye=mn,ue=_n,he=Mt,Pt=gn,Ht=zn,Gt=hn,Yt=St,qt=ln,Wt=yn,Kt=vn,Xt=fn,Jt=kn,Qt=It,Zt=bn,Ve=wt,nt=wn,en=Bn;return c(),y(fe,null,[u("section",nl,[s(Me,{to:"#actions"},{default:a(()=>[e(Ee)>0?(c(),y("section",ll,[u("span",null,d(e(t)("nbItemsSelected",[e(Ee)])),1),s(w,{type:"success",size:"small",onClick:Lt},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:checkmark"})]),_:1})]),default:a(()=>[re(" "+d(e(t)("validateSelection")),1)]),_:1}),s(w,{type:"error",size:"small",onClick:jt},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:trash-can"})]),_:1})]),default:a(()=>[re(" "+d(e(t)("deleteSelection")),1)]),_:1}),s(w,{type:"warning",size:"small",onClick:Rt},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:close"})]),_:1})]),default:a(()=>[re(" "+d(e(t)("cancelSelection")),1)]),_:1})])):(c(),y("section",ol,[s($e,{value:e(Y),"onUpdate:value":[o[1]||(o[1]=n=>ne(Y)?Y.value=n:null),o[2]||(o[2]=n=>B())],"render-label":ie,options:e(P),placeholder:e(t)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:a(()=>[s(me,{size:"large",class:"w-full","default-checked":e(P).length&&e(Y).length===e(P).length,"onUpdate:checked":o[0]||(o[0]=n=>{n?Y.value=e(P).map(X=>X.value):Y.value=[],B()})},{default:a(()=>[re(d(e(t)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),s(xe,{class:"!w-[250px]"},{default:a(()=>[s(Ce,{ref_key:"searchInputRef",ref:ke,value:e(ae),"onUpdate:value":[o[3]||(o[3]=n=>ne(ae)?ae.value=n:null),o[4]||(o[4]=n=>{n||B(H(`/media-files?pageSize=${e(D)}&page=${e(L)}`))})],clearable:!0,placeholder:e(t)("search")},null,8,["value","placeholder"]),s(w,{type:"primary",onClick:o[5]||(o[5]=n=>B(H(`/media-files?pageSize=${e(D)}&page=${e(L)}`)))},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})]))]),_:1}),s(he,{size:"small",class:"mb-5"},{default:a(()=>[u("div",al,[u("div",sl,[e(i)?.selectionMultiple&&!e(i)?.selectionLimit?(c(),N(me,{key:0,checked:e(M),"onUpdate:checked":[o[6]||(o[6]=n=>ne(M)?M.value=n:null),o[7]||(o[7]=n=>{for(const X of e(K))X.id&&(e(R)[X.id]=n,e(O).findIndex(J=>J.id==X.id)===-1&&e(O).push(X));C.value=("uuidv4"in l?l.uuidv4:ut(ze))()})]},{default:a(()=>[re(d(e(t)("selectAll")),1)]),_:1},8,["checked"])):T("",!0)]),s(ue,{value:e(se),"onUpdate:value":[o[8]||(o[8]=n=>ne(se)?se.value=n:null),o[9]||(o[9]=n=>B())],name:"filtertyperadiobuttongroup",size:"medium"},{default:a(()=>[e(j).length===e(F).length?(c(),N(ye,{key:0,value:0},{default:a(()=>[re(d(e(t)("all"))+"  ",1),e(ee)?(c(),y("span",il," ("+d(e(ee))+") ",1)):T("",!0)]),_:1})):T("",!0),(c(!0),y(fe,null,He(e(F),n=>(c(),N(ye,{key:n.value,value:n.value},{default:a(()=>[re(d(n.label)+"  ",1),e(p)[n.value]?(c(),y("span",cl," ("+d(e(p)[n.value])+") ",1)):T("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),_:1}),s(he,{embedded:"",class:"py-2"},{default:a(()=>[e(K).length&&!e(A)?(c(),y("section",ul,[s(Xt,{"show-toolbar-tooltip":""},{default:a(()=>[s(Kt,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:4 900:4 1400:6"},{default:a(()=>[(c(!0),y(fe,null,He(e(K),(n,X)=>(c(),N(Wt,{key:X},{default:a(()=>[s(qt,{name:"slide-fade",appear:""},{default:a(()=>[s(he,{bordered:"",hoverable:""},{cover:a(()=>[u("div",rl,[n.type==e(r).IMAGE?(c(),y(fe,{key:0},[n.url?(c(),N(Pt,{key:0,src:n.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):T("",!0)],64)):n.type==e(r).VIDEO?(c(),y(fe,{key:1},[n.url?(c(),N(Ht,{key:0,load:()=>e(h)(n.url??""),class:"w-full h-[200px] object-cover",size:"large"},{fallback:a(()=>[s(g,{size:"96"},{default:a(()=>[s(v,{icon:"carbon:document-video"})]),_:1})]),_:2},1032,["load"])):T("",!0)],64)):n.type==e(r).AUDIO?(c(),N(g,{key:2,size:"96"},{default:a(()=>[s(v,{icon:"carbon:document-audio"})]),_:1})):n.type==e(r).DOCUMENT?(c(),N(g,{key:3,size:"96"},{default:a(()=>[s(v,{icon:"carbon:document"})]),_:1})):(c(),N(g,{key:4,size:"96"},{default:a(()=>[s(v,{icon:"carbon:document-unknown"})]),_:1}))])]),header:a(()=>[u("div",dl,[s(Gt,{"line-clamp":1},{default:a(()=>[n.id?(c(),y(fe,{key:0},[Ft(n)?(c(),N(me,{key:e(C),checked:e(R)[n.id],"onUpdate:checked":[J=>e(R)[n.id]=J,J=>{e(i)?.selectionMultiple?J?e(O).findIndex(Re=>Re.id==n.id)===-1&&e(O).push(n):O.value=e(O).filter(Re=>Re.id!=n.id):n&&n.id&&(O.value=[n],R.value={[n.id]:J}),C.value=("uuidv4"in l?l.uuidv4:ut(ze))()}],class:"mr-1"},null,8,["checked","onUpdate:checked"])):T("",!0)],64)):T("",!0),re(" "+d(n.name),1)]),_:2},1024)])]),action:a(()=>[s(Yt,{justify:"space-between",align:"center"},{default:a(()=>[u("div",pl,[n.type!=e(r).IMAGE?(c(),N(w,{key:0,ternary:"",circle:"",title:e(t)("preview"),onClick:J=>Nt(n)},{icon:a(()=>[s(g,null,{default:a(()=>[[e(r).AUDIO,e(r).VIDEO].includes(n.type)?(c(),N(v,{key:0,icon:"carbon:play-filled-alt"})):(c(),N(v,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):T("",!0),s(w,{ternary:"",circle:"",title:e(t)("details"),onClick:J=>Dt(n)},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:information-filled"})]),_:1})]),_:2},1032,["title","onClick"])]),u("div",_l,[e(zt)?(c(),N(w,{key:0,ternary:"",circle:"",title:e(t)("copy"),onClick:J=>Bt(n)},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:copy"})]),_:1})]),_:2},1032,["title","onClick"])):T("",!0),n.type==e(r).IMAGE?(c(),N(w,{key:1,ternary:"",circle:"",title:e(t)("edit"),onClick:J=>At(n)},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:edit"})]),_:1})]),_:2},1032,["title","onClick"])):T("",!0),s(w,{ternary:"",circle:"",title:e(t)("delete"),onClick:J=>Tt(n)},{icon:a(()=>[s(g,null,{default:a(()=>[s(v,{icon:"carbon:trash-can"})]),_:1})]),_:2},1032,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(Jt,{page:e(L),"onUpdate:page":[o[10]||(o[10]=n=>ne(L)?L.value=n:null),be],class:"mt-10 justify-center","show-size-picker":"","page-size":e(D),"page-sizes":[8,12,24,36,48,60],"page-count":Math.ceil(e(ce)/e(D)),"onUpdate:pageSize":G},null,8,["page","page-size","page-count"])])):e(A)?(c(),y("section",ml,[s(Qt,{size:"medium"})])):(c(),N(Zt,{key:2,description:e(t)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),s(Ve,{show:e(Ie),"onUpdate:show":o[11]||(o[11]=n=>ne(Ie)?Ie.value=n:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(we)?.name},{default:a(()=>[u("audio",fl,[u("source",{src:e(we)?.url},null,8,vl)])]),_:1},8,["show","title"]),s(Ve,{show:e(Ue),"onUpdate:show":o[12]||(o[12]=n=>ne(Ue)?Ue.value=n:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(we)?.name},{default:a(()=>[u("video",yl,[u("source",{src:e(we)?.url},null,8,hl)])]),_:1},8,["show","title"]),s(Ve,{show:e(Te),"onUpdate:show":o[13]||(o[13]=n=>ne(Te)?Te.value=n:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(x)?.name},{default:a(()=>[e(x)?(c(),N(nt,{key:0,striped:"","single-line":!1,size:"small"},{default:a(()=>[u("tbody",null,[u("tr",null,[u("td",gl,d(e(t)("name")),1),u("td",null,d(e(x).name),1)]),u("tr",null,[u("td",null,d(e(t)("link")),1),u("td",null,[u("small",null,d(e(x).url),1)])]),u("tr",null,[u("td",null,d(e(t)("type")),1),u("td",null,[e(x).type==e(r).IMAGE?(c(),y("span",kl,d(e(t)("image")),1)):e(x).type==e(r).VIDEO?(c(),y("span",bl,d(e(t)("video")),1)):e(x).type==e(r).AUDIO?(c(),y("span",wl,d(e(t)("audio")),1)):e(x).type==e(r).DOCUMENT?(c(),y("span",$l,d(e(t)("document")),1)):(c(),y("span",Cl,d(e(t)("other")),1))])]),e(x).size?(c(),y("tr",xl,[u("td",null,d(e(t)("size")),1),u("td",null,d(e(kt)(e(x).size,!0)),1)])):T("",!0),e(x).mimeType?(c(),y("tr",Ml,[u("td",null,d(e(t)("mimeType")),1),u("td",null,d(e(x).mimeType),1)])):T("",!0),e(x).sender?(c(),y("tr",Sl,[u("td",null,d(e(t)("sendBy")),1),u("td",null,d(e(x).sender.fullname),1)])):T("",!0),e(x).title?(c(),y("tr",Il,[u("td",null,d(e(t)("title")),1),u("td",null,d(e(x).title),1)])):T("",!0),e(x).description?(c(),y("tr",Ul,[u("td",null,d(e(t)("description")),1),u("td",null,[u("small",null,d(e(x).description),1)])])):T("",!0),e(x).createdAt?(c(),y("tr",Tl,[u("td",null,d(e(t)("date")),1),u("td",null,d(e(lt)(e(x).createdAt)),1)])):T("",!0),e(x).additionalMetadata?(c(),y("tr",El,[u("td",null,d(e(t)("metadata")),1),u("td",null,[s(nt,{striped:"","single-line":"",size:"small"},{default:a(()=>[u("tbody",null,[(c(!0),y(fe,null,He(e(x).additionalMetadata||[],(n,X)=>(c(),y("tr",{key:X},[u("td",null,d(X),1),u("td",null,d(n),1)]))),128))])]),_:1})])])):T("",!0)])]),_:1})):T("",!0)]),_:1},8,["show","title"]),s(Ve,{show:e(_e),"onUpdate:show":o[15]||(o[15]=n=>ne(_e)?_e.value=n:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(pe)?.name},{default:a(()=>[s(en,{"cropper-ratio":void 0,"round-preview":!1,src:e(Le)?e(Le):void 0,onCancel:o[14]||(o[14]=n=>_e.value=!1),onSave:Ot},null,8,["src"])]),_:1},8,["show","title"])],64)}}}),{unref:dt}=await I("vue"),{defineComponent:Dl}=await I("vue"),{unref:E,resolveComponent:bo,isRef:pt,createVNode:Z,withCtx:le,toDisplayString:Ge,createTextVNode:Ye,openBlock:Se,createElementBlock:qe,createCommentVNode:_t,createBlock:mt}=await I("vue"),Al={class:"px-10"},Ol={key:0},Fl={key:0,class:"text-end"},{inject:Ll,ref:ft}=await I("vue"),Rl=Dl({__name:"AddFromAnUrl",emits:["validate"],setup(Q,{emit:$}){const{t:i}=Oe(),f=Qe(),t=Ll(Fe),z=$,_=ft(""),h=ft([]);return(b,m)=>{const U=$n,j=Cn,C=tt,V=et,A=Ze,ee=xn,ae=xt,ke=Ct,K=Mt;return Se(),qe("section",Al,[Z(K,null,{default:le(()=>[E(t)?.selectionMultiple?(Se(),qe("section",Ol,[Z(U,{value:E(h),"onUpdate:value":m[0]||(m[0]=p=>pt(h)?h.value=p:null),placeholder:E(i)("fileUrl"),min:1,max:E(t).selectionLimit||void 0},null,8,["value","placeholder","max"]),E(h).length>0?(Se(),qe("div",Fl,[Z(j),Z(A,{type:"primary",disabled:E(h).length!=E(h).filter(p=>p.trim()).length,onClick:m[1]||(m[1]=()=>{const p=E(h).map(M=>encodeURI(M));p.findIndex(M=>!("_v"in b?b._v:dt(ot)).isURL(M))>-1?E(f).error(E(i)("invalidUrl")):z("validate",p),z("validate",E(h))})},{icon:le(()=>[Z(V,null,{default:le(()=>[Z(C,{icon:"carbon:checkmark"})]),_:1})]),default:le(()=>[Ye(" "+Ge(E(i)("validate")),1)]),_:1},8,["disabled"])])):_t("",!0)])):(Se(),mt(ke,{key:1},{default:le(()=>[Z(ee,null,{default:le(()=>[Ye(Ge(E(i)("fileUrl")),1)]),_:1}),Z(ae,{value:E(_),"onUpdate:value":m[2]||(m[2]=p=>pt(_)?_.value=p:null)},null,8,["value"]),E(_)?(Se(),mt(A,{key:0,type:"primary",onClick:m[3]||(m[3]=()=>{const p=encodeURI(E(_));("_v"in b?b._v:dt(ot)).isURL(p)?z("validate",p):E(f).error(E(i)("invalidUrl"))})},{icon:le(()=>[Z(V,null,{default:le(()=>[Z(C,{icon:"carbon:checkmark"})]),_:1})]),default:le(()=>[Ye(" "+Ge(E(i)("validate")),1)]),_:1})):_t("",!0)]),_:1}))]),_:1})])}}}),{defineComponent:jl}=await I("vue"),{unref:S,resolveComponent:wo,createVNode:q,withCtx:W,toDisplayString:oe,createTextVNode:We,openBlock:de,createBlock:Pl,createCommentVNode:Hl,createElementVNode:Be,createElementBlock:ve}=await I("vue"),Gl={class:"px-10"},Yl={class:"flex justify-between items-center"},ql={style:{"margin-bottom":"12px"}},Wl={key:0,class:"text-xs"},Kl={key:1,class:"text-xs"},Xl={key:2,class:"text-xs"},Jl={key:3,class:"text-xs"},Ql={key:4,class:"text-xs"},Zl={key:5,class:"text-xs"},{inject:vt,ref:Ke,onMounted:eo,onUnmounted:to}=await I("vue"),no=jl({__name:"UploadFiles",setup(Q){const $=vt(Fe),i=vt("appConfig"),{t:f}=Oe(),t=Qe(),z=$t(),_=Ke(),h=Ke([]),b=Ke(!1),m=un(),U=i?.apiRequestHeaders;U&&(U.Authorization=`Bearer ${m.accessToken}`);const j=async()=>{_.value.submit()},C=()=>{_.value?.clear(),h.value=[]},V=p=>{const M=p.file.file;if($?.uploadConfig?.maxSize&&M&&M.size){const F=M.size/1024/1024<=$?.uploadConfig?.maxSize;return F||t.error(f("fileSizeNotAllowed")),F}const P=M?.name.split(".").pop();return P&&$?.uploadConfig?.excludedExtensions.map(F=>F.toLowerCase()).includes(P.toLowerCase())?(t.error(f("fileTypeNotAllowed")),!1):!0},A=p=>{h.value=p.fileList},ee=({file:p})=>p,ae=()=>{if($?.uploadConfig?.limit)return $?.uploadConfig.limit},ke=async({file:p,data:M,headers:P,action:F,onFinish:Y,onError:se,onProgress:H})=>{const ie=new FormData;M&&Object.keys(M).forEach(G=>{ie.append(G,M[G])});const ce=p.file,D=ce?.name.split(".").pop(),L=ce?.name.replace("."+D,""),be=await bt(ce,{maxSizeMB:1});ie.append("file",be,L),ie.append("folder",$?.uploadConfig?.folder),b.value=!0,z.start(),Nn.post(F,ie,{headers:P,onUploadProgress:G=>{if(G.total!==void 0){const B=Math.round(G.loaded*100/G.total);H({percent:B})}}}).then(async()=>{Y();const G=h.value.findIndex(B=>B.id===p.id);G!==-1&&h.value.splice(G,1),t.success(f("success")),z.finish(),b.value=!1}).catch(G=>{console.log(G),t.error(f("anErrorOccurred")),se(),z.finish(),b.value=!1})},K=console.warn;return eo(()=>{console.warn=p=>{typeof p=="string"&&p.includes('Non-function value encountered for slot "default"')||K(p)}}),to(()=>{console.warn=K}),(p,M)=>{const P=tt,F=et,Y=Ze,se=St,H=Ut,ie=In,ce=Un,D=Sn,L=Mn,be=It;return de(),ve("section",Gl,[q(H,{to:"#actions"},{default:W(()=>[Be("div",Yl,[S(h).length?(de(),Pl(se,{key:0,align:"center"},{default:W(()=>[q(Y,{disabled:S(h).length==0,onClick:C},{icon:W(()=>[q(F,null,{default:W(()=>[q(P,{icon:"carbon:close"})]),_:1})]),default:W(()=>[We(" "+oe(S(f)("clearList")),1)]),_:1},8,["disabled"]),q(Y,{type:"primary",disabled:S(h).length==0,onClick:j},{default:W(()=>[We(oe(S(f)("launchImport")),1)]),_:1},8,["disabled"])]),_:1})):Hl("",!0)])]),_:1}),q(be,{show:!1},{default:W(()=>[q(L,{ref_key:"upload",ref:_,multiple:"","directory-dnd":"","list-type":"image",max:ae(),"default-upload":!1,headers:S(U),"custom-request":ke,action:S($)?.uploadConfig?.baseUrl||S(i)?.apiUrl+"/media-files/upload",onBeforeUpload:V,onChange:A,onFinish:ee},{default:W(()=>[q(D,{class:"h-[250px] flex flex-col items-center justify-center"},{default:W(()=>[Be("div",ql,[q(F,{size:"48",depth:3},{default:W(()=>[q(P,{icon:"mdi:file-upload"})]),_:1})]),q(ie,{style:{"font-size":"16px"}},{default:W(()=>[We(oe(S(f)("uploadAreaTitle")),1)]),_:1}),q(ce,{depth:"3",class:"mt-4"},{default:W(()=>[S($)?.uploadConfig?.limit?(de(),ve("span",Wl,oe(S(f)("limitToTheNumberOfFilesToSend",[S($)?.uploadConfig.limit])),1)):(de(),ve("span",Kl,oe(S(f)("noLimitToTheNumberOfFilesToSend")),1)),M[0]||(M[0]=Be("br",null,null,-1)),S($)?.uploadConfig?.maxSize?(de(),ve("span",Xl,oe(S(f)("limitToTheSizeOfFilesToSend",[S(kt)(S($)?.uploadConfig.maxSize)])),1)):(de(),ve("span",Jl,oe(S(f)("noLimitToTheSizeOfFilesToSend")),1)),M[1]||(M[1]=Be("br",null,null,-1)),S($)?.uploadConfig?.excludedExtensions.length?(de(),ve("span",Ql,oe(S(f)("extensionsAreNotAllowed",[S($)?.uploadConfig.excludedExtensions.join(", ")])),1)):(de(),ve("span",Zl,oe(S(f)("allFileExtensionsAreAllowed")),1))]),_:1})]),_:1})]),_:1},8,["max","headers","action"])]),_:1})])}}}),{useModel:yt,mergeModels:ht,defineComponent:lo}=await I("vue"),{unref:Xe,createVNode:Ne,resolveComponent:$o,withCtx:ge,openBlock:De,createBlock:Ae,createCommentVNode:Je,createElementVNode:oo}=await I("vue"),{defineComponent:ao,provide:so}=await I("vue"),io=ao({name:"MediaPicker"}),Co=lo({...io,props:ht({enableUploadFiles:{type:Boolean,default:!0},enableMediaLibrary:{type:Boolean,default:!0},enableAddFromAnUrl:{type:Boolean,default:!0},displayImages:{type:Boolean,default:!0},displayVideos:{type:Boolean,default:!0},displayAudios:{type:Boolean,default:!0},displayDocuments:{type:Boolean,default:!0},displayOtherTypes:{type:Boolean,default:!0},preselectedMediaList:{default:null},selectionType:{default:"path"},selectionMultiple:{type:Boolean,default:!1},selectionLimit:{default:0},title:{default:""},uploadConfig:{default:()=>({folder:"uploads",limit:0,maxSize:0,baseUrl:null,excludedExtensions:[]})}},{show:{type:Boolean,required:!0,default:!1},showModifiers:{},tab:{default:"media-library"},tabModifiers:{}}),emits:ht(["submit"],["update:show","update:tab"]),setup(Q,{emit:$}){const{t:i}=Oe(),f=Q;so(Fe,f);const t=yt(Q,"show"),z=yt(Q,"tab"),_=$,h=m=>{_("submit",m),t.value=!1},b=m=>{_("submit",m),t.value=!1};return(m,U)=>{const j=En,C=Tn,V=Hn;return De(),Ae(V,{modelValue:t.value,"onUpdate:modelValue":U[1]||(U[1]=A=>t.value=A),title:m.title,class:"w-full"},{default:ge(()=>[Ne(C,{value:z.value,"onUpdate:value":U[0]||(U[0]=A=>z.value=A),type:"card",size:"large",animated:""},{suffix:ge(()=>U[2]||(U[2]=[oo("div",{id:"actions",class:"pr-10"},null,-1)])),default:ge(()=>[f.enableUploadFiles?(De(),Ae(j,{key:0,name:"upload-files",tab:Xe(i)("uploadFiles")},{default:ge(()=>[Ne(no)]),_:1},8,["tab"])):Je("",!0),f.enableMediaLibrary?(De(),Ae(j,{key:1,name:"media-library",tab:Xe(i)("mediaLibrary")},{default:ge(()=>[Ne(Nl,{onValidate:h})]),_:1},8,["tab"])):Je("",!0),f.enableAddFromAnUrl?(De(),Ae(j,{key:2,name:"add-from-an-url",tab:Xe(i)("addFromAnUrl")},{default:ge(()=>[Ne(Rl,{onValidate:b})]),_:1},8,["tab"])):Je("",!0)]),_:1},8,["value"])]),_:1},8,["modelValue","title"])}}});export{Ut as _,Co as a,Hn as b};
