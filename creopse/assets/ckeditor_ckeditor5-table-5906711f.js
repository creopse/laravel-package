import{C as A,P as v,i as y}from"./ckeditor_ckeditor5-core-c8d003a2.js";import{f as et,C as ke,K as ie,R as re,a as tt,W as Bt,T as Ee}from"./ckeditor_ckeditor5-utils-df07b536.js";import{D as Lt,e as Ht,h as Nt,m as Ft,i as ot,f as Mt,n as nt,o as zt,g as lt}from"./ckeditor_ckeditor5-engine-af85ebf5.js";import{a as st,t as Wt,W as Ot,i as Dt,c as Pe}from"./ckeditor_ckeditor5-widget-96b25423.js";import{V as E,z as Ut,B as x,c as X,x as $t,S as jt,b as _e,M as it,f as Ae,F as Se,A as Gt,l as Kt,g as rt,s as at,j as k,L as R,G as ct,h as B,T as he,u as qt,v as ee,q as te,r as oe,w as dt}from"./ckeditor_ckeditor5-ui-b7ac7aa2.js";import"./color-convert-eee2eef5.js";import"./vanilla-colorful-3f59310b.js";import{d as Xt,f as ut}from"./lodash-es-a215867d.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Re(s,e){const{modelAttribute:t,styleName:o,viewElement:n,defaultValue:l,reduceBoxSides:i=!1,shouldUpcast:r=()=>!0}=e;s.for("upcast").attributeToAttribute({view:{name:n,styles:{[o]:/[\s\S]+/}},model:{key:t,value:a=>{if(!r(a))return;const c=a.getNormalizedStyle(o),d=i?Y(c):c;if(l!==d)return d}}})}function me(s,e,t,o){s.for("upcast").add(n=>n.on("element:"+e,(l,i,r)=>{if(!i.modelRange)return;const a=["border-top-width","border-top-color","border-top-style","border-bottom-width","border-bottom-color","border-bottom-style","border-right-width","border-right-color","border-right-style","border-left-width","border-left-color","border-left-style"].filter(m=>i.viewItem.hasStyle(m));if(!a.length)return;const c={styles:a};if(!r.consumable.test(i.viewItem,c))return;const d=[...i.modelRange.getItems({shallow:!0})].pop();r.consumable.consume(i.viewItem,c);const u={style:i.viewItem.getNormalizedStyle("border-style"),color:i.viewItem.getNormalizedStyle("border-color"),width:i.viewItem.getNormalizedStyle("border-width")},h={style:Y(u.style),color:Y(u.color),width:Y(u.width)};h.style!==o.style&&r.writer.setAttribute(t.style,h.style,d),h.color!==o.color&&r.writer.setAttribute(t.color,h.color,d),h.width!==o.width&&r.writer.setAttribute(t.width,h.width,d)}))}function O(s,e){const{modelElement:t,modelAttribute:o,styleName:n}=e;s.for("downcast").attributeToAttribute({model:{name:t,key:o},view:l=>({key:"style",value:{[n]:l}})})}function J(s,e){const{modelAttribute:t,styleName:o}=e;s.for("downcast").add(n=>n.on(`attribute:${t}:table`,(l,i,r)=>{const{item:a,attributeNewValue:c}=i,{mapper:d,writer:u}=r;if(!r.consumable.consume(i.item,l.name))return;const h=[...d.toViewElement(a).getChildren()].find(m=>m.is("element","table"));c?u.setStyle(o,c,h):u.removeStyle(o,h)}))}function Y(s){if(!s)return;const e=["top","right","bottom","left"];if(!e.every(l=>s[l]))return s;const o=s.top;return e.every(l=>s[l]===o)?o:s}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function T(s,e,t,o,n=1){e!=null&&n!==void 0&&n!==null&&e>n?o.setAttribute(s,e,t):o.removeAttribute(s,t)}function H(s,e,t={}){const o=s.createElement("tableCell",t);return s.insertElement("paragraph",o),s.insert(o,e),o}function be(s,e){const t=e.parent.parent,o=parseInt(t.getAttribute("headingColumns")||"0"),{column:n}=s.getCellLocation(e);return!!o&&n<o}function Q(s,e,t){const{modelAttribute:o}=t;s.extend("tableCell",{allowAttributes:[o]}),Re(e,{viewElement:/^(td|th)$/,...t}),O(e,{modelElement:"tableCell",...t})}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Jt(){return s=>{s.on("element:figure",(e,t,o)=>{if(!o.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const n=Zt(t.viewItem);if(!n||!o.consumable.test(n,{name:!0}))return;o.consumable.consume(t.viewItem,{name:!0,classes:"table"});const l=o.convertItem(n,t.modelCursor),i=et(l.modelRange.getItems());if(!i){o.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}o.convertChildren(t.viewItem,o.writer.createPositionAt(i,"end")),o.updateConversionResult(i,t)})}}function Yt(){return s=>{s.on("element:table",(e,t,o)=>{const n=t.viewItem;if(!o.consumable.test(n,{name:!0}))return;const{rows:l,headingRows:i,headingColumns:r}=eo(n),a={};r&&(a.headingColumns=r),i&&(a.headingRows=i);const c=o.writer.createElement("table",a);if(o.safeInsert(c,t.modelCursor)){if(o.consumable.consume(n,{name:!0}),l.forEach(d=>o.convertItem(d,o.writer.createPositionAt(c,"end"))),o.convertChildren(n,o.writer.createPositionAt(c,"end")),c.isEmpty){const d=o.writer.createElement("tableRow");o.writer.insert(d,o.writer.createPositionAt(c,"end")),H(o.writer,o.writer.createPositionAt(d,"end"))}o.updateConversionResult(c,t)}})}}function Qt(){return s=>{s.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&e.stop()},{priority:"high"})}}function Be(s){return e=>{e.on(`element:${s}`,(t,o,{writer:n})=>{if(!o.modelRange)return;const l=o.modelRange.start.nodeAfter,i=n.createPositionAt(l,0);if(o.viewItem.isEmpty){n.insertElement("paragraph",i);return}const r=Array.from(l.getChildren());if(r.every(a=>a.is("element","$marker"))){const a=n.createElement("paragraph");n.insert(a,n.createPositionAt(l,0));for(const c of r)n.move(n.createRangeOn(c),n.createPositionAt(a,"end"))}},{priority:"low"})}}function Zt(s){for(const e of s.getChildren())if(e.is("element","table"))return e}function eo(s){let e=0,t;const o=[],n=[];let l;for(const i of Array.from(s.getChildren())){if(i.name!=="tbody"&&i.name!=="thead"&&i.name!=="tfoot")continue;i.name==="thead"&&!l&&(l=i);const r=Array.from(i.getChildren()).filter(a=>a.is("element","tr"));for(const a of r)if(l&&i===l||i.name==="tbody"&&Array.from(a.getChildren()).length&&Array.from(a.getChildren()).every(c=>c.is("element","th")))e++,o.push(a);else{n.push(a);const c=to(a);(!t||c<t)&&(t=c)}}return{headingRows:e,headingColumns:t||0,rows:[...o,...n]}}function to(s){let e=0,t=0;const o=Array.from(s.getChildren()).filter(n=>n.name==="th"||n.name==="td");for(;t<o.length&&o[t].name==="th";){const n=o[t],l=parseInt(n.getAttribute("colspan")||"1");e=e+l,t++}return e}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class C{constructor(e,t={}){this._table=e,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){const e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0,value:void 0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const o=this._getSpanned();if(o)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(o.cell,o.row,o.column));else{const n=e.getChild(this._cellIndex);if(!n)return this._advanceToNextRow();const l=parseInt(n.getAttribute("colspan")||"1"),i=parseInt(n.getAttribute("rowspan")||"1");(l>1||i>1)&&this._recordSpans(n,i,l),this._shouldSkipSlot()||(t=this._formatOutValue(n)),this._nextCellAtColumn=this._column+l}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(e,t=this._row,o=this._column){return{done:!1,value:new oo(this,e,t,o)}}_shouldSkipSlot(){const e=this._skipRows.has(this._row),t=this._row<this._startRow,o=this._column<this._startColumn,n=this._endColumn!==void 0&&this._column>this._endColumn;return e||t||o||n}_getSpanned(){const e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,o){const n={cell:e,row:this._row,column:this._column};for(let l=this._row;l<this._row+t;l++)for(let i=this._column;i<this._column+o;i++)(l!=this._row||i!=this._column)&&this._markSpannedCell(l,i,n)}_markSpannedCell(e,t,o){this._spannedCells.has(e)||this._spannedCells.set(e,new Map),this._spannedCells.get(e).set(t,o)}}class oo{constructor(e,t,o,n){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=o,this.cellAnchorColumn=n,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Le(s,e){return(t,{writer:o})=>{const n=t.getAttribute("headingRows")||0,l=o.createContainerElement("table",null,[]),i=o.createContainerElement("figure",{class:"table"},l);n>0&&o.insert(o.createPositionAt(l,"end"),o.createContainerElement("thead",null,o.createSlot(r=>r.is("element","tableRow")&&r.index<n))),n<s.getRows(t)&&o.insert(o.createPositionAt(l,"end"),o.createContainerElement("tbody",null,o.createSlot(r=>r.is("element","tableRow")&&r.index>=n)));for(const{positionOffset:r,filter:a}of e.additionalSlots)o.insert(o.createPositionAt(l,r),o.createSlot(a));return o.insert(o.createPositionAt(l,"after"),o.createSlot(r=>r.is("element","tableRow")?!1:!e.additionalSlots.some(({filter:a})=>a(r)))),e.asWidget?lo(i,o):i}}function no(){return(s,{writer:e})=>s.isEmpty?e.createEmptyElement("tr"):e.createContainerElement("tr")}function He(s={}){return(e,{writer:t})=>{const o=e.parent,n=o.parent,l=n.getChildIndex(o),i=new C(n,{row:l}),r=n.getAttribute("headingRows")||0,a=n.getAttribute("headingColumns")||0;let c=null;for(const d of i)if(d.cell==e){const h=d.row<r||d.column<a?"th":"td";c=s.asWidget?st(t.createEditableElement(h),t):t.createContainerElement(h);break}return c}}function Ne(s={}){return(e,{writer:t})=>{if(!e.parent.is("element","tableCell")||!ht(e))return null;if(s.asWidget)return t.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const o=t.createContainerElement("p");return t.setCustomProperty("dataPipeline:transparentRendering",!0,o),o}}}function ht(s){return s.parent.childCount==1&&!so(s)}function lo(s,e){return e.setCustomProperty("table",!0,s),Wt(s,e,{hasSelectionHandle:!0})}function so(s){return!s.getAttributeKeys().next().done}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class io extends A{refresh(){const e=this.editor.model,t=e.document.selection,o=e.schema;this.isEnabled=ro(t,o)}execute(e={}){const t=this.editor,o=t.model,n=t.plugins.get("TableUtils"),l=t.config.get("table.defaultHeadings.rows"),i=t.config.get("table.defaultHeadings.columns");e.headingRows===void 0&&l&&(e.headingRows=l),e.headingColumns===void 0&&i&&(e.headingColumns=i),o.change(r=>{const a=n.createTable(r,e);o.insertObject(a,null,null,{findOptimalPosition:"auto"}),r.setSelection(r.createPositionAt(a.getNodeByPath([0,0,0]),0))})}}function ro(s,e){const t=s.getFirstPosition().parent,o=t===t.root?t:t.parent;return e.checkChild(o,"table")}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fe extends A{constructor(e,t={}){super(e),this.order=t.order||"below"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),n=this.order==="above",l=o.getSelectionAffectedTableCells(t),i=o.getRowIndexes(l),r=n?i.first:i.last,a=l[0].findAncestor("table");o.insertRows(a,{at:n?r:r+1,copyStructureFromAbove:!n})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Me extends A{constructor(e,t={}){super(e),this.order=t.order||"right"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),n=this.order==="left",l=o.getSelectionAffectedTableCells(t),i=o.getColumnIndexes(l),r=n?i.first:i.last,a=l[0].findAncestor("table");o.insertColumns(a,{columns:1,at:n?r:r+1})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ze extends A{constructor(e,t={}){super(e),this.direction=t.direction||"horizontally"}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length===1}execute(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?e.splitCellHorizontally(t,2):e.splitCellVertically(t,2)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function mt(s,e,t){const{startRow:o,startColumn:n,endRow:l,endColumn:i}=e,r=t.createElement("table"),a=l-o+1;for(let d=0;d<a;d++)t.insertElement("tableRow",r,"end");const c=[...new C(s,{startRow:o,endRow:l,startColumn:n,endColumn:i,includeAllSlots:!0})];for(const{row:d,column:u,cell:h,isAnchor:m,cellAnchorRow:f,cellAnchorColumn:b}of c){const p=d-o,g=r.getChild(p);if(!m)(f<o||b<n)&&H(t,t.createPositionAt(g,"end"));else{const w=t.cloneElement(h);t.append(w,g),wt(w,d,u,l,i,t)}}return ao(r,s,o,n,t),r}function bt(s,e,t=0){const o=[],n=new C(s,{startRow:t,endRow:e-1});for(const l of n){const{row:i,cellHeight:r}=l,a=i+r-1;i<e&&e<=a&&o.push(l)}return o}function gt(s,e,t){const o=s.parent,n=o.parent,l=o.index,i=parseInt(s.getAttribute("rowspan")),r=e-l,a={},c=i-r;c>1&&(a.rowspan=c);const d=parseInt(s.getAttribute("colspan")||"1");d>1&&(a.colspan=d);const u=l,h=u+r,m=[...new C(n,{startRow:u,endRow:h,includeAllSlots:!0})];let f=null,b;for(const p of m){const{row:g,column:w,cell:S}=p;S===s&&b===void 0&&(b=w),b!==void 0&&b===w&&g===h&&(f=H(t,p.getPositionBefore(),a))}return T("rowspan",r,s,t),f}function ft(s,e){const t=[],o=new C(s);for(const n of o){const{column:l,cellWidth:i}=n,r=l+i-1;l<e&&e<=r&&t.push(n)}return t}function pt(s,e,t,o){const n=parseInt(s.getAttribute("colspan")),l=t-e,i={},r=n-l;r>1&&(i.colspan=r);const a=parseInt(s.getAttribute("rowspan")||"1");a>1&&(i.rowspan=a);const c=H(o,o.createPositionAfter(s),i);return T("colspan",l,s,o),c}function wt(s,e,t,o,n,l){const i=parseInt(s.getAttribute("colspan")||"1"),r=parseInt(s.getAttribute("rowspan")||"1");if(t+i-1>n){const d=n-t+1;T("colspan",d,s,l,1)}if(e+r-1>o){const d=o-e+1;T("rowspan",d,s,l,1)}}function ao(s,e,t,o,n){const l=parseInt(e.getAttribute("headingRows")||"0");if(l>0){const r=l-t;T("headingRows",r,s,n,0)}const i=parseInt(e.getAttribute("headingColumns")||"0");if(i>0){const r=i-o;T("headingColumns",r,s,n,0)}}function ge(s,e){const t=e.getColumns(s),o=new Array(t).fill(0);for(const{column:l}of new C(s))o[l]++;const n=o.reduce((l,i,r)=>i?l:[...l,r],[]);if(n.length>0){const l=n[n.length-1];return e.removeColumns(s,{at:l}),!0}return!1}function fe(s,e){const t=[],o=e.getRows(s);for(let n=0;n<o;n++)s.getChild(n).isEmpty&&t.push(n);if(t.length>0){const n=t[t.length-1];return e.removeRows(s,{at:n}),!0}return!1}function Ve(s,e){ge(s,e)||fe(s,e)}function Ct(s,e){const t=Array.from(new C(s,{startColumn:e.firstColumn,endColumn:e.lastColumn,row:e.lastRow}));if(t.every(({cellHeight:l})=>l===1))return e.lastRow;const n=t[0].cellHeight-1;return e.lastRow+n}function Tt(s,e){const t=Array.from(new C(s,{startRow:e.firstRow,endRow:e.lastRow,column:e.lastColumn}));if(t.every(({cellWidth:l})=>l===1))return e.lastColumn;const n=t[0].cellWidth-1;return e.lastColumn+n}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class G extends A{constructor(e,t){super(e),this.direction=t.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,t=e.document,n=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(t.selection)[0],l=this.value,i=this.direction;e.change(r=>{const a=i=="right"||i=="down",c=a?n:l,d=a?l:n,u=d.parent;ho(d,c,r);const h=this.isHorizontal?"colspan":"rowspan",m=parseInt(n.getAttribute(h)||"1"),f=parseInt(l.getAttribute(h)||"1");r.setAttribute(h,m+f,c),r.setSelection(r.createRangeIn(c));const b=this.editor.plugins.get("TableUtils"),p=u.findAncestor("table");Ve(p,b)})}_getMergeableCell(){const t=this.editor.model.document,o=this.editor.plugins.get("TableUtils"),n=o.getTableCellsContainingSelection(t.selection)[0];if(!n)return;const l=this.isHorizontal?co(n,this.direction,o):uo(n,this.direction,o);if(!l)return;const i=this.isHorizontal?"rowspan":"colspan",r=parseInt(n.getAttribute(i)||"1");if(parseInt(l.getAttribute(i)||"1")===r)return l}}function co(s,e,t){const n=s.parent.parent,l=e=="right"?s.nextSibling:s.previousSibling,i=(n.getAttribute("headingColumns")||0)>0;if(!l)return;const r=e=="right"?s:l,a=e=="right"?l:s,{column:c}=t.getCellLocation(r),{column:d}=t.getCellLocation(a),u=parseInt(r.getAttribute("colspan")||"1"),h=be(t,r),m=be(t,a);return i&&h!=m?void 0:c+u===d?l:void 0}function uo(s,e,t){const o=s.parent,n=o.parent,l=n.getChildIndex(o);if(e=="down"&&l===t.getRows(n)-1||e=="up"&&l===0)return null;const i=parseInt(s.getAttribute("rowspan")||"1"),r=n.getAttribute("headingRows")||0,a=e=="down"&&l+i===r,c=e=="up"&&l===r;if(r&&(a||c))return null;const d=parseInt(s.getAttribute("rowspan")||"1"),u=e=="down"?l+d:l,h=[...new C(n,{endRow:u})],f=h.find(p=>p.cell===s).column,b=h.find(({row:p,cellHeight:g,column:w})=>w!==f?!1:e=="down"?p===u:u===p+g);return b&&b.cell?b.cell:null}function ho(s,e,t){We(s)||(We(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(s),t.createPositionAt(e,"end"))),t.remove(s)}function We(s){const e=s.getChild(0);return s.childCount==1&&e.is("element","paragraph")&&e.isEmpty}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mo extends A{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const n=o.findAncestor("table"),i=e.getRows(n)-1,r=e.getRowIndexes(t),a=r.first===0&&r.last===i;this.isEnabled=!a}else this.isEnabled=!1}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(o),l=o[0],i=l.findAncestor("table"),r=t.getCellLocation(l).column;e.change(a=>{const c=n.last-n.first+1;t.removeRows(i,{at:n.first,rows:c});const d=bo(i,n.first,r,t.getRows(i));a.setSelection(a.createPositionAt(d,0))})}}function bo(s,e,t,o){const n=s.getChild(Math.min(e,o-1));let l=n.getChild(0),i=0;for(const r of n.getChildren()){if(i>t)return l;l=r,i+=parseInt(r.getAttribute("colspan")||"1")}return l}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class go extends A{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const n=o.findAncestor("table"),l=e.getColumns(n),{first:i,last:r}=e.getColumnIndexes(t);this.isEnabled=r-i<l-1}else this.isEnabled=!1}execute(){const e=this.editor.plugins.get("TableUtils"),[t,o]=po(this.editor.model.document.selection,e),n=t.parent.parent,l=[...new C(n)],i={first:l.find(a=>a.cell===t).column,last:l.find(a=>a.cell===o).column},r=fo(l,t,o,i);this.editor.model.change(a=>{const c=i.last-i.first+1;e.removeColumns(n,{at:i.first,columns:c}),a.setSelection(a.createPositionAt(r,0))})}}function fo(s,e,t,o){return parseInt(t.getAttribute("colspan")||"1")>1?t:e.previousSibling||t.nextSibling?t.nextSibling||e.previousSibling:o.first?s.reverse().find(({column:l})=>l<o.first).cell:s.reverse().find(({column:l})=>l>o.last).cell}function po(s,e){const t=e.getSelectionAffectedTableCells(s),o=t[0],n=t.pop(),l=[o,n];return o.isBefore(n)?l:l.reverse()}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wo extends A{refresh(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection),n=o.length>0;this.isEnabled=n,this.value=n&&o.every(l=>this._isInHeading(l,l.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,n=t.getSelectionAffectedTableCells(o.document.selection),l=n[0].findAncestor("table"),{first:i,last:r}=t.getRowIndexes(n),a=this.value?i:r+1,c=l.getAttribute("headingRows")||0;o.change(d=>{if(a){const u=a>c?c:0,h=bt(l,a,u);for(const{cell:m}of h)gt(m,a,d)}T("headingRows",a,l,d,0)})}_isInHeading(e,t){const o=parseInt(t.getAttribute("headingRows")||"0");return!!o&&e.parent.index<o}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Co extends A{refresh(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=o.length>0;this.isEnabled=n,this.value=n&&o.every(l=>be(t,l))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,n=t.getSelectionAffectedTableCells(o.document.selection),l=n[0].findAncestor("table"),{first:i,last:r}=t.getColumnIndexes(n),a=this.value?i:r+1;o.change(c=>{if(a){const d=ft(l,a);for(const{cell:u,column:h}of d)pt(u,h,a,c)}T("headingColumns",a,l,c,0)})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _ extends v{static get pluginName(){return"TableUtils"}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){const t=e.parent,o=t.parent,n=o.getChildIndex(t),l=new C(o,{row:n});for(const{cell:i,row:r,column:a}of l)if(i===e)return{row:r,column:a};/* istanbul ignore next -- @preserve */}createTable(e,t){const o=e.createElement("table"),n=t.rows||2,l=t.columns||2;return ue(e,o,0,n,l),t.headingRows&&T("headingRows",Math.min(t.headingRows,n),o,e,0),t.headingColumns&&T("headingColumns",Math.min(t.headingColumns,l),o,e,0),o}insertRows(e,t={}){const o=this.editor.model,n=t.at||0,l=t.rows||1,i=t.copyStructureFromAbove!==void 0,r=t.copyStructureFromAbove?n-1:n,a=this.getRows(e),c=this.getColumns(e);if(n>a)throw new ke("tableutils-insertrows-insert-out-of-range",this,{options:t});o.change(d=>{const u=e.getAttribute("headingRows")||0;if(u>n&&T("headingRows",u+l,e,d,0),!i&&(n===0||n===a)){ue(d,e,n,l,c);return}const h=i?Math.max(n,r):n,m=new C(e,{endRow:h}),f=new Array(c).fill(1);for(const{row:b,column:p,cellHeight:g,cellWidth:w,cell:S}of m){const z=b+g-1,$=b<n&&n<=z,de=b<=r&&r<=z;$?(d.setAttribute("rowspan",g+l,S),f[p]=-w):i&&de&&(f[p]=w)}for(let b=0;b<l;b++){const p=d.createElement("tableRow");d.insert(p,e,n);for(let g=0;g<f.length;g++){const w=f[g],S=d.createPositionAt(p,"end");w>0&&H(d,S,w>1?{colspan:w}:void 0),g+=Math.abs(w)-1}}})}insertColumns(e,t={}){const o=this.editor.model,n=t.at||0,l=t.columns||1;o.change(i=>{const r=e.getAttribute("headingColumns");n<r&&i.setAttribute("headingColumns",r+l,e);const a=this.getColumns(e);if(n===0||a===n){for(const d of e.getChildren())d.is("element","tableRow")&&W(l,i,i.createPositionAt(d,n?"end":0));return}const c=new C(e,{column:n,includeAllSlots:!0});for(const d of c){const{row:u,cell:h,cellAnchorColumn:m,cellAnchorRow:f,cellWidth:b,cellHeight:p}=d;if(m<n){i.setAttribute("colspan",b+l,h);const g=f+p-1;for(let w=u;w<=g;w++)c.skipRow(w)}else W(l,i,d.getPositionBefore())}})}removeRows(e,t){const o=this.editor.model,n=t.rows||1,l=this.getRows(e),i=t.at,r=i+n-1;if(r>l-1)throw new ke("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});o.change(a=>{const c={first:i,last:r},{cellsToMove:d,cellsToTrim:u}=yo(e,c);if(d.size){const h=r+1;_o(e,h,d,a)}for(let h=r;h>=i;h--)a.remove(e.getChild(h));for(const{rowspan:h,cell:m}of u)T("rowspan",h,m,a);vo(e,c,a),ge(e,this)||fe(e,this)})}removeColumns(e,t){const o=this.editor.model,n=t.at,l=t.columns||1,i=t.at+l-1;o.change(r=>{To(e,{first:n,last:i},r);for(let a=i;a>=n;a--)for(const{cell:c,column:d,cellWidth:u}of[...new C(e)])d<=a&&u>1&&d+u>a?T("colspan",u-1,c,r):d===a&&r.remove(c);fe(e,this)||ge(e,this)})}splitCellVertically(e,t=2){const o=this.editor.model,l=e.parent.parent,i=parseInt(e.getAttribute("rowspan")||"1"),r=parseInt(e.getAttribute("colspan")||"1");o.change(a=>{if(r>1){const{newCellsSpan:c,updatedSpan:d}=Oe(r,t);T("colspan",d,e,a);const u={};c>1&&(u.colspan=c),i>1&&(u.rowspan=i);const h=r>t?t-1:r-1;W(h,a,a.createPositionAfter(e),u)}if(r<t){const c=t-r,d=[...new C(l)],{column:u}=d.find(({cell:b})=>b===e),h=d.filter(({cell:b,cellWidth:p,column:g})=>{const w=b!==e&&g===u,S=g<u&&g+p>u;return w||S});for(const{cell:b,cellWidth:p}of h)a.setAttribute("colspan",p+c,b);const m={};i>1&&(m.rowspan=i),W(c,a,a.createPositionAfter(e),m);const f=l.getAttribute("headingColumns")||0;f>u&&T("headingColumns",f+c,l,a)}})}splitCellHorizontally(e,t=2){const o=this.editor.model,n=e.parent,l=n.parent,i=l.getChildIndex(n),r=parseInt(e.getAttribute("rowspan")||"1"),a=parseInt(e.getAttribute("colspan")||"1");o.change(c=>{if(r>1){const d=[...new C(l,{startRow:i,endRow:i+r-1,includeAllSlots:!0})],{newCellsSpan:u,updatedSpan:h}=Oe(r,t);T("rowspan",h,e,c);const{column:m}=d.find(({cell:b})=>b===e),f={};u>1&&(f.rowspan=u),a>1&&(f.colspan=a);for(const b of d){const{column:p,row:g}=b,w=g>=i+h,S=p===m,z=(g+i+h)%u===0;w&&S&&z&&W(1,c,b.getPositionBefore(),f)}}if(r<t){const d=t-r,u=[...new C(l,{startRow:0,endRow:i})];for(const{cell:f,cellHeight:b,row:p}of u)if(f!==e&&p+b>i){const g=b+d;c.setAttribute("rowspan",g,f)}const h={};a>1&&(h.colspan=a),ue(c,l,i+1,d,1,h);const m=l.getAttribute("headingRows")||0;m>i&&T("headingRows",m+d,l,c)}})}getColumns(e){return[...e.getChild(0).getChildren()].reduce((o,n)=>{const l=parseInt(n.getAttribute("colspan")||"1");return o+l},0)}getRows(e){return Array.from(e.getChildren()).reduce((t,o)=>o.is("element","tableRow")?t+1:t,0)}createTableWalker(e,t={}){return new C(e,t)}getSelectedTableCells(e){const t=[];for(const o of this.sortRanges(e.getRanges())){const n=o.getContainedElement();n&&n.is("element","tableCell")&&t.push(n)}return t}getTableCellsContainingSelection(e){const t=[];for(const o of e.getRanges()){const n=o.start.findAncestor("tableCell");n&&t.push(n)}return t}getSelectionAffectedTableCells(e){const t=this.getSelectedTableCells(e);return t.length?t:this.getTableCellsContainingSelection(e)}getRowIndexes(e){const t=e.map(o=>o.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(e){const t=e[0].findAncestor("table"),n=[...new C(t)].filter(l=>e.includes(l.cell)).map(l=>l.column);return this._getFirstLastIndexesObject(n)}isSelectionRectangular(e){if(e.length<2||!this._areCellInTheSameTableSection(e))return!1;const t=new Set,o=new Set;let n=0;for(const i of e){const{row:r,column:a}=this.getCellLocation(i),c=parseInt(i.getAttribute("rowspan"))||1,d=parseInt(i.getAttribute("colspan"))||1;t.add(r),o.add(a),c>1&&t.add(r+c-1),d>1&&o.add(a+d-1),n+=c*d}return So(t,o)==n}sortRanges(e){return Array.from(e).sort(Ao)}_getFirstLastIndexesObject(e){const t=e.sort((l,i)=>l-i),o=t[0],n=t[t.length-1];return{first:o,last:n}}_areCellInTheSameTableSection(e){const t=e[0].findAncestor("table"),o=this.getRowIndexes(e),n=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(o,n))return!1;const l=this.getColumnIndexes(e),i=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(l,i)}_areIndexesInSameSection({first:e,last:t},o){const n=e<o,l=t<o;return n===l}}function ue(s,e,t,o,n,l={}){for(let i=0;i<o;i++){const r=s.createElement("tableRow");s.insert(r,e,t),W(n,s,s.createPositionAt(r,"end"),l)}}function W(s,e,t,o={}){for(let n=0;n<s;n++)H(e,t,o)}function Oe(s,e){if(s<e)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(s/e),o=s-t*e+t;return{newCellsSpan:t,updatedSpan:o}}function To(s,e,t){const o=s.getAttribute("headingColumns")||0;if(o&&e.first<o){const n=Math.min(o-1,e.last)-e.first+1;t.setAttribute("headingColumns",o-n,s)}}function vo(s,{first:e,last:t},o){const n=s.getAttribute("headingRows")||0;if(e<n){const l=t<n?n-(t-e+1):e;T("headingRows",l,s,o,0)}}function yo(s,{first:e,last:t}){const o=new Map,n=[];for(const{row:l,column:i,cellHeight:r,cell:a}of new C(s,{endRow:t})){const c=l+r-1;if(l>=e&&l<=t&&c>t){const h=t-l+1,m=r-h;o.set(i,{cell:a,rowspan:m})}if(l<e&&c>=e){let h;c>=t?h=t-e+1:h=c-e+1,n.push({cell:a,rowspan:r-h})}}return{cellsToMove:o,cellsToTrim:n}}function _o(s,e,t,o){const l=[...new C(s,{includeAllSlots:!0,row:e})],i=s.getChild(e);let r;for(const{column:a,cell:c,isAnchor:d}of l)if(t.has(a)){const{cell:u,rowspan:h}=t.get(a),m=r?o.createPositionAfter(r):o.createPositionAt(i,0);o.move(o.createRangeOn(u),m),T("rowspan",h,u,o),r=u}else d&&(r=c)}function Ao(s,e){const t=s.start,o=e.start;return t.isBefore(o)?-1:1}function So(s,e){const t=Array.from(s.values()),o=Array.from(e.values()),n=Math.max(...t),l=Math.min(...t),i=Math.max(...o),r=Math.min(...o);return(n-l+1)*(i-r+1)}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ro extends A{refresh(){const e=this.editor.plugins.get(_),t=e.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=e.isSelectionRectangular(t)}execute(){const e=this.editor.model,t=this.editor.plugins.get(_);e.change(o=>{const n=t.getSelectedTableCells(e.document.selection),l=n.shift(),{mergeWidth:i,mergeHeight:r}=xo(l,n,t);T("colspan",i,l,o),T("rowspan",r,l,o);for(const c of n)Vo(c,l,o);const a=l.findAncestor("table");Ve(a,t),o.setSelection(l,"in")})}}function Vo(s,e,t){De(s)||(De(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(s),t.createPositionAt(e,"end"))),t.remove(s)}function De(s){const e=s.getChild(0);return s.childCount==1&&e.is("element","paragraph")&&e.isEmpty}function xo(s,e,t){let o=0,n=0;for(const c of e){const{row:d,column:u}=t.getCellLocation(c);o=Ue(c,u,o,"colspan"),n=Ue(c,d,n,"rowspan")}const{row:l,column:i}=t.getCellLocation(s),r=o-i,a=n-l;return{mergeWidth:r,mergeHeight:a}}function Ue(s,e,t,o){const n=parseInt(s.getAttribute(o)||"1");return Math.max(t,e+n)}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Io extends A{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(o),l=o[0].findAncestor("table"),i=[];for(let r=n.first;r<=n.last;r++)for(const a of l.getChild(r).getChildren())i.push(e.createRangeOn(a));e.change(r=>{r.setSelection(i)})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ko extends A{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection),n=o[0],l=o.pop(),i=n.findAncestor("table"),r=e.getCellLocation(n),a=e.getCellLocation(l),c=Math.min(r.column,a.column),d=Math.max(r.column,a.column),u=[];for(const h of new C(i,{startColumn:c,endColumn:d}))u.push(t.createRangeOn(h.cell));t.change(h=>{h.setSelection(u)})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Eo(s){s.document.registerPostFixer(e=>Po(e,s))}function Po(s,e){const t=e.document.differ.getChanges();let o=!1;const n=new Set;for(const l of t){let i=null;l.type=="insert"&&l.name=="table"&&(i=l.position.nodeAfter),(l.type=="insert"||l.type=="remove")&&(l.name=="tableRow"||l.name=="tableCell")&&(i=l.position.findAncestor("table")),Fo(l)&&(i=l.range.start.findAncestor("table")),i&&!n.has(i)&&(o=Bo(i,s)||o,o=Lo(i,s)||o,n.add(i))}return o}function Bo(s,e){let t=!1;const o=Ho(s);if(o.length){t=!0;for(const n of o)T("rowspan",n.rowspan,n.cell,e,1)}return t}function Lo(s,e){let t=!1;const o=No(s),n=[];for(const[a,c]of o.entries())!c&&s.getChild(a).is("element","tableRow")&&n.push(a);if(n.length){t=!0;for(const a of n.reverse())e.remove(s.getChild(a)),o.splice(a,1)}const l=o.filter((a,c)=>s.getChild(c).is("element","tableRow")),i=l[0];if(!l.every(a=>a===i)){const a=l.reduce((c,d)=>d>c?d:c,0);for(const[c,d]of l.entries()){const u=a-d;if(u){for(let h=0;h<u;h++)H(e,e.createPositionAt(s.getChild(c),"end"));t=!0}}}return t}function Ho(s){const e=parseInt(s.getAttribute("headingRows")||"0"),t=Array.from(s.getChildren()).reduce((n,l)=>l.is("element","tableRow")?n+1:n,0),o=[];for(const{row:n,cell:l,cellHeight:i}of new C(s)){if(i<2)continue;const a=n<e?e:t;if(n+i>a){const c=a-n;o.push({cell:l,rowspan:c})}}return o}function No(s){const e=new Array(s.childCount).fill(0);for(const{rowIndex:t}of new C(s,{includeAllSlots:!0}))e[t]++;return e}function Fo(s){if(s.type!=="attribute")return!1;const e=s.attributeKey;return e==="headingRows"||e==="colspan"||e==="rowspan"}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Mo(s){s.document.registerPostFixer(e=>zo(e,s))}function zo(s,e){const t=e.document.differ.getChanges();let o=!1;for(const n of t)n.type=="insert"&&n.name=="table"&&(o=Wo(n.position.nodeAfter,s)||o),n.type=="insert"&&n.name=="tableRow"&&(o=vt(n.position.nodeAfter,s)||o),n.type=="insert"&&n.name=="tableCell"&&(o=pe(n.position.nodeAfter,s)||o),(n.type=="remove"||n.type=="insert")&&Oo(n)&&(o=pe(n.position.parent,s)||o);return o}function Wo(s,e){let t=!1;for(const o of s.getChildren())o.is("element","tableRow")&&(t=vt(o,e)||t);return t}function vt(s,e){let t=!1;for(const o of s.getChildren())t=pe(o,e)||t;return t}function pe(s,e){if(s.childCount==0)return e.insertElement("paragraph",s),!0;const t=Array.from(s.getChildren()).filter(o=>o.is("$text"));for(const o of t)e.wrap(e.createRangeOn(o),"paragraph");return!!t.length}function Oo(s){return s.position.parent.is("element","tableCell")?s.type=="insert"&&s.name=="$text"||s.type=="remove":!1}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Do(s,e){const t=s.document.differ;for(const o of t.getChanges()){let n,l=!1;if(o.type=="attribute"){const c=o.range.start.nodeAfter;if(!c||!c.is("element","table")||o.attributeKey!="headingRows"&&o.attributeKey!="headingColumns")continue;n=c,l=o.attributeKey=="headingRows"}else(o.name=="tableRow"||o.name=="tableCell")&&(n=o.position.findAncestor("table"),l=o.name=="tableRow");if(!n)continue;const i=n.getAttribute("headingRows")||0,r=n.getAttribute("headingColumns")||0,a=new C(n);for(const c of a){const u=c.row<i||c.column<r?"th":"td",h=e.mapper.toViewElement(c.cell);h&&h.is("element")&&h.name!=u&&e.reconvertItem(l?c.cell.parent:c.cell)}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Uo(s,e){const t=s.document.differ,o=new Set;for(const n of t.getChanges()){const l=n.type=="attribute"?n.range.start.parent:n.position.parent;l.is("element","tableCell")&&o.add(l)}for(const n of o.values()){const l=Array.from(n.getChildren()).filter(i=>$o(i,e.mapper));for(const i of l)e.reconvertItem(i)}}function $o(s,e){if(!s.is("element","paragraph"))return!1;const t=e.toViewElement(s);return t?ht(s)!==t.is("element","span"):!1}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ae extends v{static get pluginName(){return"TableEditing"}static get requires(){return[_]}constructor(e){super(e),this._additionalSlots=[]}init(){const e=this.editor,t=e.model,o=t.schema,n=e.conversion,l=e.plugins.get(_);o.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),o.register("tableRow",{allowIn:"table",isLimit:!0}),o.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),n.for("upcast").add(Jt()),n.for("upcast").add(Yt()),n.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:Le(l,{asWidget:!0,additionalSlots:this._additionalSlots})}),n.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:Le(l,{additionalSlots:this._additionalSlots})}),n.for("upcast").elementToElement({model:"tableRow",view:"tr"}),n.for("upcast").add(Qt()),n.for("downcast").elementToElement({model:"tableRow",view:no()}),n.for("upcast").elementToElement({model:"tableCell",view:"td"}),n.for("upcast").elementToElement({model:"tableCell",view:"th"}),n.for("upcast").add(Be("td")),n.for("upcast").add(Be("th")),n.for("editingDowncast").elementToElement({model:"tableCell",view:He({asWidget:!0})}),n.for("dataDowncast").elementToElement({model:"tableCell",view:He()}),n.for("editingDowncast").elementToElement({model:"paragraph",view:Ne({asWidget:!0}),converterPriority:"high"}),n.for("dataDowncast").elementToElement({model:"paragraph",view:Ne(),converterPriority:"high"}),n.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),n.for("upcast").attributeToAttribute({model:{key:"colspan",value:$e("colspan")},view:"colspan"}),n.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),n.for("upcast").attributeToAttribute({model:{key:"rowspan",value:$e("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new io(e)),e.commands.add("insertTableRowAbove",new Fe(e,{order:"above"})),e.commands.add("insertTableRowBelow",new Fe(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new Me(e,{order:"left"})),e.commands.add("insertTableColumnRight",new Me(e,{order:"right"})),e.commands.add("removeTableRow",new mo(e)),e.commands.add("removeTableColumn",new go(e)),e.commands.add("splitTableCellVertically",new ze(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new ze(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new Ro(e)),e.commands.add("mergeTableCellRight",new G(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new G(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new G(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new G(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new Co(e)),e.commands.add("setTableRowHeader",new wo(e)),e.commands.add("selectTableRow",new Io(e)),e.commands.add("selectTableColumn",new ko(e)),Eo(t),Mo(t),this.listenTo(t.document,"change:data",()=>{Do(t,e.editing),Uo(t,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function $e(s){return e=>{const t=parseInt(e.getAttribute(s));return Number.isNaN(t)||t<=0?null:t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class jo extends E{constructor(e){super(e);const t=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new ie,this.focusTracker=new re,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(o,n)=>`${n} × ${o}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:t.to("label")}]}],on:{mousedown:t.to(o=>{o.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(o,n)=>{const{row:l,column:i}=n.target.dataset;this.items.get((parseInt(l,10)-1)*10+(parseInt(i,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(o,n,l)=>{if(!l)return;const{row:i,column:r}=l.dataset;this.set({rows:parseInt(i),columns:parseInt(r)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),Ut({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const e of this.items)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const e=this.rows,t=this.columns;this.items.map((o,n)=>{const l=Math.floor(n/10),i=n%10,r=l<e&&i<t;o.set("isOn",r)})}_createGridButton(e,t,o,n){const l=new x(e);return l.set({label:n,class:"ck-insert-table-dropdown-grid-box"}),l.extendTemplate({attributes:{"data-row":t,"data-column":o}}),l}_createGridCollection(){const e=[];for(let t=0;t<100;t++){const o=Math.floor(t/10),n=t%10,l=`${o+1} × ${n+1}`;e.push(this._createGridButton(this.locale,o+1,n+1,l))}return this.createCollection(e)}}const Go='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 6v3h4V6H3zm0 4v3h4v-3H3zm0 4v3h4v-3H3zm5 3h4v-3H8v3zm5 0h4v-3h-4v3zm4-4v-3h-4v3h4zm0-4V6h-4v3h4zm1.5 8a1.5 1.5 0 0 1-1.5 1.5H3A1.5 1.5 0 0 1 1.5 17V4c.222-.863 1.068-1.5 2-1.5h13c.932 0 1.778.637 2 1.5v13zM12 13v-3H8v3h4zm0-4V6H8v3h4z"/></svg>',Ko='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',qo='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',Xo='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jo extends v{static get pluginName(){return"TableUI"}init(){const e=this.editor,t=this.editor.t,n=e.locale.contentLanguageDirection==="ltr";e.ui.componentFactory.add("insertTable",l=>{const i=e.commands.get("insertTable"),r=X(l);r.bind("isEnabled").to(i),r.buttonView.set({icon:Go,label:t("Insert table"),tooltip:!0});let a;return r.on("change:isOpen",()=>{a||(a=new jo(l),r.panelView.children.add(a),a.delegate("execute").to(r),r.on("execute",()=>{e.execute("insertTable",{rows:a.rows,columns:a.columns}),e.editing.view.focus()}))}),r}),e.ui.componentFactory.add("tableColumn",l=>{const i=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:n?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:n?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),Ko,i,l)}),e.ui.componentFactory.add("tableRow",l=>{const i=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),qo,i,l)}),e.ui.componentFactory.add("mergeTableCells",l=>{const i=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:n?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:n?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),Xo,i,l)})}_prepareDropdown(e,t,o,n){const l=this.editor,i=X(n),r=this._fillDropdownWithListOptions(i,o);return i.buttonView.set({label:e,icon:t,tooltip:!0}),i.bind("isEnabled").toMany(r,"isEnabled",(...a)=>a.some(c=>c)),this.listenTo(i,"execute",a=>{l.execute(a.source.commandName),a.source instanceof $t||l.editing.view.focus()}),i}_prepareMergeSplitButtonDropdown(e,t,o,n){const l=this.editor,i=X(n,jt),r="mergeTableCells",a=l.commands.get(r),c=this._fillDropdownWithListOptions(i,o);return i.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),i.bind("isEnabled").toMany([a,...c],"isEnabled",(...d)=>d.some(u=>u)),this.listenTo(i.buttonView,"execute",()=>{l.execute(r),l.editing.view.focus()}),this.listenTo(i,"execute",d=>{l.execute(d.source.commandName),l.editing.view.focus()}),i}_fillDropdownWithListOptions(e,t){const o=this.editor,n=[],l=new tt;for(const i of t)Yo(i,o,n,l);return _e(e,l),n}}function Yo(s,e,t,o){if(s.type==="button"||s.type==="switchbutton"){const n=s.model=new it(s.model),{commandName:l,bindIsOn:i}=s.model,r=e.commands.get(l);t.push(r),n.set({commandName:l}),n.bind("isEnabled").to(r),i&&n.bind("isOn").to(r,"value"),n.set({withText:!0})}o.add(s)}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class L extends v{static get pluginName(){return"TableSelection"}static get requires(){return[_,_]}init(){const e=this.editor,t=e.model,o=e.editing.view;this.listenTo(t,"deleteContent",(n,l)=>this._handleDeleteContent(n,l),{priority:"high"}),this.listenTo(o.document,"insertText",(n,l)=>this._handleInsertTextEvent(n,l),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const e=this.editor.plugins.get(_),t=this.editor.model.document.selection,o=e.getSelectedTableCells(t);return o.length==0?null:o}getSelectionAsFragment(){const e=this.editor.plugins.get(_),t=this.getSelectedTableCells();return t?this.editor.model.change(o=>{const n=o.createDocumentFragment(),{first:l,last:i}=e.getColumnIndexes(t),{first:r,last:a}=e.getRowIndexes(t),c=t[0].findAncestor("table");let d=a,u=i;if(e.isSelectionRectangular(t)){const f={firstColumn:l,lastColumn:i,firstRow:r,lastRow:a};d=Ct(c,f),u=Tt(c,f)}const m=mt(c,{startRow:r,startColumn:l,endRow:d,endColumn:u},o);return o.insert(m,n,0),n}):null}setCellSelection(e,t){const o=this._getCellsToSelect(e,t);this.editor.model.change(n=>{n.setSelection(o.cells.map(l=>n.createRangeOn(l)),{backward:o.backward})})}getFocusCell(){const o=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return o&&o.is("element","tableCell")?o:null}getAnchorCell(){const e=this.editor.model.document.selection,o=et(e.getRanges()).getContainedElement();return o&&o.is("element","tableCell")?o:null}_defineSelectionConverter(){const e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(n=>n.on("selection",(l,i,r)=>{const a=r.writer;o(a);const c=this.getSelectedTableCells();if(!c)return;for(const u of c){const h=r.mapper.toViewElement(u);a.addClass("ck-editor__editable_selected",h),t.add(h)}const d=r.mapper.toViewElement(c[c.length-1]);a.setSelection(d,0)},{priority:"lowest"}));function o(n){for(const l of t)n.removeClass("ck-editor__editable_selected",l);t.clear()}}_enablePluginDisabling(){const e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;e.model.change(o=>{const n=o.createPositionAt(t[0],0),l=e.model.schema.getNearestSelectionRange(n);o.setSelection(l)})}})}_handleDeleteContent(e,t){const o=this.editor.plugins.get(_),n=t[0],l=t[1],i=this.editor.model,r=!l||l.direction=="backward",a=o.getSelectedTableCells(n);a.length&&(e.stop(),i.change(c=>{const d=a[r?a.length-1:0];i.change(h=>{for(const m of a)i.deleteContent(h.createSelection(m,"in"))});const u=i.schema.getNearestSelectionRange(c.createPositionAt(d,0));n.is("documentSelection")?c.setSelection(u):n.setTo(u)}))}_handleInsertTextEvent(e,t){const o=this.editor,n=this.getSelectedTableCells();if(!n)return;const l=o.editing.view,i=o.editing.mapper,r=n.map(a=>l.createRangeOn(i.toViewElement(a)));t.selection=l.createSelection(r)}_getCellsToSelect(e,t){const o=this.editor.plugins.get("TableUtils"),n=o.getCellLocation(e),l=o.getCellLocation(t),i=Math.min(n.row,l.row),r=Math.max(n.row,l.row),a=Math.min(n.column,l.column),c=Math.max(n.column,l.column),d=new Array(r-i+1).fill(null).map(()=>[]),u={startRow:i,endRow:r,startColumn:a,endColumn:c};for(const{row:f,cell:b}of new C(e.findAncestor("table"),u))d[f-i].push(b);const h=l.row<n.row,m=l.column<n.column;return h&&d.reverse(),m&&d.forEach(f=>f.reverse()),{cells:d.flat(),backward:h||m}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Qo extends v{static get pluginName(){return"TableClipboard"}static get requires(){return[L,_]}init(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"copy",(o,n)=>this._onCopyCut(o,n)),this.listenTo(t,"cut",(o,n)=>this._onCopyCut(o,n)),this.listenTo(e.model,"insertContent",(o,[n,l])=>this._onInsertContent(o,n,l),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(e,t){const o=this.editor.plugins.get(L);if(!o.getSelectedTableCells()||e.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection))return;t.preventDefault(),e.stop();const n=this.editor.data,l=this.editor.editing.view.document,i=n.toView(o.getSelectionAsFragment());l.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:i,method:e.name})}_onInsertContent(e,t,o){if(o&&!o.is("documentSelection"))return;const n=this.editor.model,l=this.editor.plugins.get(_);let i=this.getTableIfOnlyTableInContent(t,n);if(!i)return;const r=l.getSelectionAffectedTableCells(n.document.selection);if(!r.length){Ve(i,l);return}e.stop(),n.change(a=>{const c={width:l.getColumns(i),height:l.getRows(i)},d=Zo(r,c,a,l),u=d.lastRow-d.firstRow+1,h=d.lastColumn-d.firstColumn+1,m={startRow:0,startColumn:0,endRow:Math.min(u,c.height)-1,endColumn:Math.min(h,c.width)-1};i=mt(i,m,a);const f=r[0].findAncestor("table"),b=this._replaceSelectedCellsWithPasted(i,c,f,d,a);if(this.editor.plugins.get("TableSelection").isEnabled){const p=l.sortRanges(b.map(g=>a.createRangeOn(g)));a.setSelection(p)}else a.setSelection(b[0],0)})}_replaceSelectedCellsWithPasted(e,t,o,n,l){const{width:i,height:r}=t,a=tn(e,i,r),c=[...new C(o,{startRow:n.firstRow,endRow:n.lastRow,startColumn:n.firstColumn,endColumn:n.lastColumn,includeAllSlots:!0})],d=[];let u;for(const p of c){const{row:g,column:w}=p;w===n.firstColumn&&(u=p.getPositionBefore());const S=g-n.firstRow,z=w-n.firstColumn,$=a[S%r][z%i],de=$?l.cloneElement($):null,j=this._replaceTableSlotCell(p,de,u,l);j&&(wt(j,g,w,n.lastRow,n.lastColumn,l),d.push(j),u=l.createPositionAfter(j))}const h=parseInt(o.getAttribute("headingRows")||"0"),m=parseInt(o.getAttribute("headingColumns")||"0"),f=n.firstRow<h&&h<=n.lastRow,b=n.firstColumn<m&&m<=n.lastColumn;if(f){const p={first:n.firstColumn,last:n.lastColumn},g=we(o,h,p,l,n.firstRow);d.push(...g)}if(b){const p={first:n.firstRow,last:n.lastRow},g=Ce(o,m,p,l);d.push(...g)}return d}_replaceTableSlotCell(e,t,o,n){const{cell:l,isAnchor:i}=e;return i&&n.remove(l),t?(n.insert(t,o),t):null}getTableIfOnlyTableInContent(e,t){if(!e.is("documentFragment")&&!e.is("element"))return null;if(e.is("element","table"))return e;if(e.childCount==1&&e.getChild(0).is("element","table"))return e.getChild(0);const o=t.createRangeIn(e);for(const n of o.getItems())if(n.is("element","table")){const l=t.createRange(o.start,t.createPositionBefore(n));if(t.hasContent(l,{ignoreWhitespaces:!0}))return null;const i=t.createRange(t.createPositionAfter(n),o.end);return t.hasContent(i,{ignoreWhitespaces:!0})?null:n}return null}}function Zo(s,e,t,o){const n=s[0].findAncestor("table"),l=o.getColumnIndexes(s),i=o.getRowIndexes(s),r={firstColumn:l.first,lastColumn:l.last,firstRow:i.first,lastRow:i.last},a=s.length===1;return a&&(r.lastRow+=e.height-1,r.lastColumn+=e.width-1,en(n,r.lastRow+1,r.lastColumn+1,o)),a||!o.isSelectionRectangular(s)?on(n,r,t):(r.lastRow=Ct(n,r),r.lastColumn=Tt(n,r)),r}function en(s,e,t,o){const n=o.getColumns(s),l=o.getRows(s);t>n&&o.insertColumns(s,{at:n,columns:t-n}),e>l&&o.insertRows(s,{at:l,rows:e-l})}function tn(s,e,t){const o=new Array(t).fill(null).map(()=>new Array(e).fill(null));for(const{column:n,row:l,cell:i}of new C(s))o[l][n]=i;return o}function on(s,e,t){const{firstRow:o,lastRow:n,firstColumn:l,lastColumn:i}=e,r={first:o,last:n},a={first:l,last:i};Ce(s,l,r,t),Ce(s,i+1,r,t),we(s,o,a,t),we(s,n+1,a,t,o)}function we(s,e,t,o,n=0){return e<1?void 0:bt(s,e,n).filter(({column:r,cellWidth:a})=>yt(r,a,t)).map(({cell:r})=>gt(r,e,o))}function Ce(s,e,t,o){return e<1?void 0:ft(s,e).filter(({row:i,cellHeight:r})=>yt(i,r,t)).map(({cell:i,column:r})=>pt(i,r,e,o))}function yt(s,e,t){const o=s+e-1,{first:n,last:l}=t,i=s>=n&&s<=l,r=s<n&&o>=n;return i||r}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nn extends v{static get pluginName(){return"TableKeyboard"}static get requires(){return[L,_]}init(){const t=this.editor.editing.view.document;this.listenTo(t,"arrowKey",(...o)=>this._onArrowKey(...o),{context:"table"}),this.listenTo(t,"tab",(...o)=>this._handleTabOnSelectedTable(...o),{context:"figure"}),this.listenTo(t,"tab",(...o)=>this._handleTab(...o),{context:["th","td"]})}_handleTabOnSelectedTable(e,t){const o=this.editor,l=o.model.document.selection.getSelectedElement();!l||!l.is("element","table")||(t.preventDefault(),t.stopPropagation(),e.stop(),o.model.change(i=>{i.setSelection(i.createRangeIn(l.getChild(0).getChild(0)))}))}_handleTab(e,t){const o=this.editor,n=this.editor.plugins.get(_),l=this.editor.plugins.get("TableSelection"),i=o.model.document.selection,r=!t.shiftKey;let a=n.getTableCellsContainingSelection(i)[0];if(a||(a=l.getFocusCell()),!a)return;t.preventDefault(),t.stopPropagation(),e.stop();const c=a.parent,d=c.parent,u=d.getChildIndex(c),h=c.getChildIndex(a),m=h===0;if(!r&&m&&u===0){o.model.change(g=>{g.setSelection(g.createRangeOn(d))});return}const f=h===c.childCount-1,b=u===n.getRows(d)-1;if(r&&b&&f&&(o.execute("insertTableRowBelow"),u===n.getRows(d)-1)){o.model.change(g=>{g.setSelection(g.createRangeOn(d))});return}let p;if(r&&f)p=d.getChild(u+1).getChild(0);else if(!r&&m){const g=d.getChild(u-1);p=g.getChild(g.childCount-1)}else p=c.getChild(h+(r?1:-1));o.model.change(g=>{g.setSelection(g.createRangeIn(p))})}_onArrowKey(e,t){const o=this.editor,n=t.keyCode,l=Bt(n,o.locale.contentLanguageDirection);this._handleArrowKeys(l,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){const o=this.editor.plugins.get(_),n=this.editor.plugins.get("TableSelection"),l=this.editor.model,i=l.document.selection,r=["right","down"].includes(e),a=o.getSelectedTableCells(i);if(a.length){let d;return t?d=n.getFocusCell():d=r?a[a.length-1]:a[0],this._navigateFromCellInDirection(d,e,t),!0}const c=i.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!c)return!1;if(!i.isCollapsed)if(t){if(i.isBackward==r&&!i.containsEntireContent(c))return!1}else{const d=i.getSelectedElement();if(!d||!l.schema.isObject(d))return!1}return this._isSelectionAtCellEdge(i,c,r)?(this._navigateFromCellInDirection(c,e,t),!0):!1}_isSelectionAtCellEdge(e,t,o){const n=this.editor.model,l=this.editor.model.schema,i=o?e.getLastPosition():e.getFirstPosition();if(!l.getLimitElement(i).is("element","tableCell"))return n.createPositionAt(t,o?"end":0).isTouching(i);const r=n.createSelection(i);return n.modifySelection(r,{direction:o?"forward":"backward"}),i.isEqual(r.focus)}_navigateFromCellInDirection(e,t,o=!1){const n=this.editor.model,l=e.findAncestor("table"),i=[...new C(l,{includeAllSlots:!0})],{row:r,column:a}=i[i.length-1],c=i.find(({cell:w})=>w==e);let{row:d,column:u}=c;switch(t){case"left":u--;break;case"up":d--;break;case"right":u+=c.cellWidth;break;case"down":d+=c.cellHeight;break}const h=d<0||d>r,m=u<0&&d<=0,f=u>a&&d>=r;if(h||m||f){n.change(w=>{w.setSelection(w.createRangeOn(l))});return}u<0?(u=o?0:a,d--):u>a&&(u=o?a:0,d++);const b=i.find(w=>w.row==d&&w.column==u).cell,p=["right","down"].includes(t),g=this.editor.plugins.get("TableSelection");if(o&&g.isEnabled){const w=g.getAnchorCell()||e;g.setCellSelection(w,b)}else{const w=n.createPositionAt(b,p?0:"end");n.change(S=>{S.setSelection(w)})}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ln extends Lt{constructor(){super(...arguments),this.domEventType=["mousemove","mouseleave"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sn extends v{static get pluginName(){return"TableMouse"}static get requires(){return[L,_]}init(){this.editor.editing.view.addObserver(ln),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const e=this.editor,t=e.plugins.get(_);let o=!1;const n=e.plugins.get(L);this.listenTo(e.editing.view.document,"mousedown",(l,i)=>{const r=e.model.document.selection;if(!this.isEnabled||!n.isEnabled||!i.domEvent.shiftKey)return;const a=n.getAnchorCell()||t.getTableCellsContainingSelection(r)[0];if(!a)return;const c=this._getModelTableCellFromDomEvent(i);c&&je(a,c)&&(o=!0,n.setCellSelection(a,c),i.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{o=!1}),this.listenTo(e.editing.view.document,"selectionChange",l=>{o&&l.stop()},{priority:"highest"})}_enableMouseDragSelection(){const e=this.editor;let t,o,n=!1,l=!1;const i=e.plugins.get(L);this.listenTo(e.editing.view.document,"mousedown",(r,a)=>{!this.isEnabled||!i.isEnabled||a.domEvent.shiftKey||a.domEvent.ctrlKey||a.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(a))}),this.listenTo(e.editing.view.document,"mousemove",(r,a)=>{if(!a.domEvent.buttons||!t)return;const c=this._getModelTableCellFromDomEvent(a);c&&je(t,c)&&(o=c,!n&&o!=t&&(n=!0)),n&&(l=!0,i.setCellSelection(t,o),a.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{n=!1,l=!1,t=null,o=null}),this.listenTo(e.editing.view.document,"selectionChange",r=>{l&&r.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){const t=e.target,o=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(o).parent.findAncestor("tableCell",{includeSelf:!0})}}function je(s,e){return s.parent.parent==e.parent.parent}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class al extends v{static get requires(){return[ae,Jo,L,sn,nn,Qo,Ot]}static get pluginName(){return"Table"}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function rn(s){s.document.registerPostFixer(e=>an(e,s))}function an(s,e){const t=e.document.differ.getChanges();let o=!1;for(const n of t){if(n.type!="insert")continue;const l=n.position.parent;if(l.is("element","table")||n.name=="table"){const i=n.name=="table"?n.position.nodeAfter:l,r=Array.from(i.getChildren()).filter(c=>c.is("element","caption")),a=r.shift();if(!a)continue;for(const c of r)s.move(s.createRangeIn(c),a,"end"),s.remove(c);a.nextSibling&&(s.move(s.createRangeOn(a),i,"end"),o=!0),o=!!r.length||o}}return o}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ge(s){return!!s&&s.is("element","table")}function Te(s){for(const e of s.getChildren())if(e.is("element","caption"))return e;return null}function cn(s){const e=Z(s);return e?Te(e):null}function dn(s){const e=s.parent;return s.name=="figcaption"&&e&&e.is("element","figure")&&e.hasClass("table")?{name:!0}:s.name=="caption"&&e&&e.is("element","table")?{name:!0}:null}function Z(s){const e=s.getSelectedElement();return e&&e.is("element","table")?e:s.getFirstPosition().findAncestor("table")}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class un extends A{refresh(){const e=this.editor,t=Z(e.model.document.selection);this.isEnabled=!!t,this.isEnabled?this.value=!!Te(t):this.value=!1}execute({focusCaptionOnShow:e=!1}={}){this.editor.model.change(t=>{this.value?this._hideTableCaption(t):this._showTableCaption(t,e)})}_showTableCaption(e,t){const o=this.editor.model,n=Z(o.document.selection),r=this.editor.plugins.get("TableCaptionEditing")._getSavedCaption(n)||e.createElement("caption");o.insertContent(r,n,"end"),t&&e.setSelection(r,"in")}_hideTableCaption(e){const t=this.editor.model,o=Z(t.document.selection),n=this.editor.plugins.get("TableCaptionEditing"),l=Te(o);n._saveCaption(o,l),t.deleteContent(e.createSelection(l,"on"))}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hn extends v{static get pluginName(){return"TableCaptionEditing"}constructor(e){super(e),this._savedCaptionsMap=new WeakMap}init(){const e=this.editor,t=e.model.schema,o=e.editing.view,n=e.t;t.isRegistered("caption")?t.extend("caption",{allowIn:"table"}):t.register("caption",{allowIn:"table",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleTableCaption",new un(this.editor)),e.conversion.for("upcast").elementToElement({view:dn,model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(l,{writer:i})=>Ge(l.parent)?i.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(l,{writer:i})=>{if(!Ge(l.parent))return null;const r=i.createEditableElement("figcaption");return i.setCustomProperty("tableCaption",!0,r),Ht({view:o,element:r,text:n("Enter table caption"),keepOnFocus:!0}),st(r,i)}}),rn(e.model)}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?Nt.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mn extends v{static get pluginName(){return"TableCaptionUI"}init(){const e=this.editor,t=e.editing.view,o=e.t;e.ui.componentFactory.add("toggleTableCaption",n=>{const l=e.commands.get("toggleTableCaption"),i=new x(n);return i.set({icon:y.caption,tooltip:!0,isToggleable:!0}),i.bind("isOn","isEnabled").to(l,"value","isEnabled"),i.bind("label").to(l,"value",r=>o(r?"Toggle caption off":"Toggle caption on")),this.listenTo(i,"execute",()=>{if(e.execute("toggleTableCaption",{focusCaptionOnShow:!0}),l.value){const r=cn(e.model.document.selection),a=e.editing.mapper.toViewElement(r);if(!a)return;t.scrollToTheSelection(),t.change(c=>{c.addClass("table__caption_highlighted",a)})}e.editing.view.focus()}),i})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cl extends v{static get pluginName(){return"TableCaption"}static get requires(){return[hn,mn]}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bn extends E{constructor(e,t){super(e),this.set("value",""),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isEmpty",!0),this.options=t,this.focusTracker=new re,this._focusables=new Ae,this.dropdownView=this._createDropdownView(),this.inputView=this._createInputTextView(),this.keystrokes=new ie,this._stillTyping=!1,this._focusCycler=new Se({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-input-color"]},children:[this.dropdownView,this.inputView]}),this.on("change:value",(o,n,l)=>this._setInputValue(l))}render(){super.render(),this.keystrokes.listenTo(this.dropdownView.panelView.element)}focus(){this.inputView.focus()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createDropdownView(){const e=this.locale,t=e.t,o=this.bindTemplate,n=this._createColorGrid(e),l=X(e),i=new E,r=this._createRemoveColorButton();return i.setTemplate({tag:"span",attributes:{class:["ck","ck-input-color__button__preview"],style:{backgroundColor:o.to("value")}},children:[{tag:"span",attributes:{class:["ck","ck-input-color__button__preview__no-color-indicator",o.if("value","ck-hidden",a=>a!="")]}}]}),l.buttonView.extendTemplate({attributes:{class:"ck-input-color__button"}}),l.buttonView.children.add(i),l.buttonView.label=t("Color picker"),l.buttonView.tooltip=!0,l.panelPosition=e.uiLanguageDirection==="rtl"?"se":"sw",l.panelView.children.add(r),l.panelView.children.add(n),l.bind("isEnabled").to(this,"isReadOnly",a=>!a),this._focusables.add(r),this._focusables.add(n),this.focusTracker.add(r.element),this.focusTracker.add(n.element),l}_createInputTextView(){const e=this.locale,t=new Gt(e);return t.extendTemplate({on:{blur:t.bindTemplate.to("blur")}}),t.value=this.value,t.bind("isReadOnly","hasError").to(this),this.bind("isFocused","isEmpty").to(t),t.on("input",()=>{const o=t.element.value,n=this.options.colorDefinitions.find(l=>o===l.label);this._stillTyping=!0,this.value=n&&n.color||o}),t.on("blur",()=>{this._stillTyping=!1,this._setInputValue(t.element.value)}),t.delegate("input").to(this),t}_createRemoveColorButton(){const e=this.locale,t=e.t,o=new x(e),n=this.options.defaultColorValue||"",l=t(n?"Restore default":"Remove color");return o.class="ck-input-color__remove-color",o.withText=!0,o.icon=y.eraser,o.label=l,o.on("execute",()=>{this.value=n,this.dropdownView.isOpen=!1,this.fire("input")}),o}_createColorGrid(e){const t=new Kt(e,{colorDefinitions:this.options.colorDefinitions,columns:this.options.columns});return t.on("execute",(o,n)=>{this.value=n.value,this.dropdownView.isOpen=!1,this.fire("input")}),t.bind("selectedColor").to(this,"value"),t}_setInputValue(e){if(!this._stillTyping){const t=Ke(e),o=this.options.colorDefinitions.find(n=>t===Ke(n.color));o?this.inputView.value=o.label:this.inputView.value=e||""}}}function Ke(s){return s.replace(/([(,])\s+/g,"$1").replace(/^\s+|\s+(?=[),\s]|$)/g,"").replace(/,|\s/g," ")}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const xe=s=>s==="";function Ie(s){return{none:s("None"),solid:s("Solid"),dotted:s("Dotted"),dashed:s("Dashed"),double:s("Double"),groove:s("Groove"),ridge:s("Ridge"),inset:s("Inset"),outset:s("Outset")}}function _t(s){return s('The color is invalid. Try "#FF0000" or "rgb(255,0,0)" or "red".')}function At(s){return s('The value is invalid. Try "10px" or "2em" or simply "2".')}function ne(s){return s=s.trim(),xe(s)||Ft(s)}function D(s){return s=s.trim(),xe(s)||Vt(s)||ot(s)||Mt(s)}function St(s){return s=s.trim(),xe(s)||Vt(s)||ot(s)}function Rt(s,e){const t=new tt,o=Ie(s.t);for(const n in o){const l={type:"button",model:new it({_borderStyleValue:n,label:o[n],role:"menuitemradio",withText:!0})};n==="none"?l.model.bind("isOn").to(s,"borderStyle",i=>e==="none"?!i:i===n):l.model.bind("isOn").to(s,"borderStyle",i=>i===n),t.add(l)}return t}function ve(s){const{view:e,icons:t,toolbar:o,labels:n,propertyName:l,nameToValue:i,defaultValue:r}=s;for(const a in n){const c=new x(e.locale);c.set({label:n[a],icon:t[a],tooltip:n[a]});const d=i?i(a):a;c.bind("isOn").to(e,l,u=>{let h=u;return u===""&&r&&(h=r),d===h}),c.on("execute",()=>{e[l]=d}),o.items.add(c)}}const le=[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}];function se(s){return(e,t,o)=>{const n=new bn(e.locale,{colorDefinitions:gn(s.colorConfig),columns:s.columns,defaultColorValue:s.defaultColorValue});return n.inputView.set({id:t,ariaDescribedById:o}),n.bind("isReadOnly").to(e,"isEnabled",l=>!l),n.bind("hasError").to(e,"errorText",l=>!!l),n.on("input",()=>{e.errorText=null}),e.bind("isEmpty","isFocused").to(n),n}}function Vt(s){const e=parseFloat(s);return!Number.isNaN(e)&&s===String(e)}function gn(s){return s.map(e=>({color:e.model,label:e.label,options:{hasBorder:e.hasBorder}}))}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class V extends E{constructor(e,t={}){super(e);const o=this.bindTemplate;this.set("class",t.class||null),this.children=this.createCollection(),t.children&&t.children.forEach(n=>this.children.add(n)),this.set("_role",null),this.set("_ariaLabelledBy",null),t.labelView&&this.set({_role:"group",_ariaLabelledBy:t.labelView.id}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__row",o.to("class")],role:o.to("_role"),"aria-labelledby":o.to("_ariaLabelledBy")},children:this.children})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const qe={left:y.alignLeft,center:y.alignCenter,right:y.alignRight,justify:y.alignJustify,top:y.alignTop,middle:y.alignMiddle,bottom:y.alignBottom};class fn extends E{constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",padding:"",backgroundColor:"",width:"",height:"",horizontalAlignment:"",verticalAlignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:n,borderColorInput:l,borderRowLabel:i}=this._createBorderFields(),{backgroundRowLabel:r,backgroundInput:a}=this._createBackgroundFields(),{widthInput:c,operatorLabel:d,heightInput:u,dimensionsLabel:h}=this._createDimensionFields(),{horizontalAlignmentToolbar:m,verticalAlignmentToolbar:f,alignmentLabel:b}=this._createAlignmentFields();this.focusTracker=new re,this.keystrokes=new ie,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=n,this.borderColorInput=l,this.backgroundInput=a,this.paddingInput=this._createPaddingField(),this.widthInput=c,this.heightInput=u,this.horizontalAlignmentToolbar=m,this.verticalAlignmentToolbar=f;const{saveButtonView:p,cancelButtonView:g}=this._createActionButtons();this.saveButtonView=p,this.cancelButtonView=g,this._focusables=new Ae,this._focusCycler=new Se({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new rt(e,{label:this.t("Cell properties")})),this.children.add(new V(e,{labelView:i,children:[i,o,l,n],class:"ck-table-form__border-row"})),this.children.add(new V(e,{labelView:r,children:[r,a],class:"ck-table-form__background-row"})),this.children.add(new V(e,{children:[new V(e,{labelView:h,children:[h,c,d,u],class:"ck-table-form__dimensions-row"}),new V(e,{children:[this.paddingInput],class:"ck-table-cell-properties-form__padding-row"})]})),this.children.add(new V(e,{labelView:b,children:[b,m,f],class:"ck-table-cell-properties-form__alignment-row"})),this.children.add(new V(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-cell-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),at({view:this}),[this.borderStyleDropdown,this.borderColorInput,this.borderColorInput.fieldView.dropdownView.buttonView,this.borderWidthInput,this.backgroundInput,this.backgroundInput.fieldView.dropdownView.buttonView,this.widthInput,this.heightInput,this.paddingInput,this.horizontalAlignmentToolbar,this.verticalAlignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableCellProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=se({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color}),n=this.locale,l=this.t,i=l("Style"),r=new k(n);r.text=l("Border");const a=Ie(l),c=new R(n,ct);c.set({label:i,class:"ck-table-form__border-style"}),c.fieldView.buttonView.set({ariaLabel:i,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:i}),c.fieldView.buttonView.bind("label").to(this,"borderStyle",h=>a[h||"none"]),c.fieldView.on("execute",h=>{this.borderStyle=h.source._borderStyleValue}),c.bind("isEmpty").to(this,"borderStyle",h=>!h),_e(c.fieldView,Rt(this,t.style),{role:"menu",ariaLabel:i});const d=new R(n,B);d.set({label:l("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",K),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const u=new R(n,o);return u.set({label:l("Color"),class:"ck-table-form__border-color"}),u.fieldView.bind("value").to(this,"borderColor"),u.bind("isEnabled").to(this,"borderStyle",K),u.fieldView.on("input",()=>{this.borderColor=u.fieldView.value}),this.on("change:borderStyle",(h,m,f,b)=>{K(f)||(this.borderColor="",this.borderWidth=""),K(b)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:r,borderStyleDropdown:c,borderColorInput:u,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new k(e);o.text=t("Background");const n=se({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableCellProperties.backgroundColor}),l=new R(e,n);return l.set({label:t("Color"),class:"ck-table-cell-properties-form__background"}),l.fieldView.bind("value").to(this,"backgroundColor"),l.fieldView.on("input",()=>{this.backgroundColor=l.fieldView.value}),{backgroundRowLabel:o,backgroundInput:l}}_createDimensionFields(){const e=this.locale,t=this.t,o=new k(e);o.text=t("Dimensions");const n=new R(e,B);n.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),n.fieldView.bind("value").to(this,"width"),n.fieldView.on("input",()=>{this.width=n.fieldView.element.value});const l=new E(e);l.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const i=new R(e,B);return i.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),i.fieldView.bind("value").to(this,"height"),i.fieldView.on("input",()=>{this.height=i.fieldView.element.value}),{dimensionsLabel:o,widthInput:n,operatorLabel:l,heightInput:i}}_createPaddingField(){const e=this.locale,t=this.t,o=new R(e,B);return o.set({label:t("Padding"),class:"ck-table-cell-properties-form__padding"}),o.fieldView.bind("value").to(this,"padding"),o.fieldView.on("input",()=>{this.padding=o.fieldView.element.value}),o}_createAlignmentFields(){const e=this.locale,t=this.t,o=new k(e);o.text=t("Table cell text alignment");const n=new he(e),l=e.contentLanguageDirection==="rtl";n.set({isCompact:!0,ariaLabel:t("Horizontal text alignment toolbar")}),ve({view:this,icons:qe,toolbar:n,labels:this._horizontalAlignmentLabels,propertyName:"horizontalAlignment",nameToValue:r=>{if(l){if(r==="left")return"right";if(r==="right")return"left"}return r},defaultValue:this.options.defaultTableCellProperties.horizontalAlignment});const i=new he(e);return i.set({isCompact:!0,ariaLabel:t("Vertical text alignment toolbar")}),ve({view:this,icons:qe,toolbar:i,labels:this._verticalAlignmentLabels,propertyName:"verticalAlignment",defaultValue:this.options.defaultTableCellProperties.verticalAlignment}),{horizontalAlignmentToolbar:n,verticalAlignmentToolbar:i,alignmentLabel:o}}_createActionButtons(){const e=this.locale,t=this.t,o=new x(e),n=new x(e),l=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.paddingInput];return o.set({label:t("Save"),icon:y.check,class:"ck-button-save",type:"submit",withText:!0}),o.bind("isEnabled").toMany(l,"errorText",(...i)=>i.every(r=>!r)),n.set({label:t("Cancel"),icon:y.cancel,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:o,cancelButtonView:n}}get _horizontalAlignmentLabels(){const e=this.locale,t=this.t,o=t("Align cell text to the left"),n=t("Align cell text to the center"),l=t("Align cell text to the right"),i=t("Justify cell text");return e.uiLanguageDirection==="rtl"?{right:l,center:n,left:o,justify:i}:{left:o,center:n,right:l,justify:i}}get _verticalAlignmentLabels(){const e=this.t;return{top:e("Align cell text to the top"),middle:e("Align cell text to the middle"),bottom:e("Align cell text to the bottom")}}}function K(s){return s!=="none"}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function pn(s){const e=s.getSelectedElement();return e&&xt(e)?e:null}function ce(s){const e=s.getFirstPosition();if(!e)return null;let t=e.parent;for(;t;){if(t.is("element")&&xt(t))return t;t=t.parent}return null}function xt(s){return!!s.getCustomProperty("table")&&Dt(s)}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const P=qt.defaultPositions,ye=[P.northArrowSouth,P.northArrowSouthWest,P.northArrowSouthEast,P.southArrowNorth,P.southArrowNorthWest,P.southArrowNorthEast,P.viewportStickyNorth];function It(s,e){const t=s.plugins.get("ContextualBalloon");if(ce(s.editing.view.document.selection)){let o;e==="cell"?o=Et(s):o=kt(s),t.updatePosition(o)}}function kt(s){const t=s.model.document.selection.getFirstPosition().findAncestor("table"),o=s.editing.mapper.toViewElement(t);return{target:s.editing.view.domConverter.mapViewToDom(o),positions:ye}}function Et(s){const e=s.editing.mapper,t=s.editing.view.domConverter,o=s.model.document.selection;if(o.rangeCount>1)return{target:()=>wn(o.getRanges(),s),positions:ye};const n=Pt(o.getFirstPosition()),l=e.toViewElement(n);return{target:t.mapViewToDom(l),positions:ye}}function Pt(s){return s.nodeAfter&&s.nodeAfter.is("element","tableCell")?s.nodeAfter:s.findAncestor("tableCell")}function wn(s,e){const t=e.editing.mapper,o=e.editing.view.domConverter,n=Array.from(s).map(l=>{const i=Pt(l.start),r=t.toViewElement(i);return new Ee(o.mapViewToDom(r))});return Ee.getBoundingRect(n)}const Cn='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.105 18-.17 1H2.5A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1h15A1.5 1.5 0 0 1 19 2.5v9.975l-.85-.124-.15-.302V8h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5h3.105zM2 12h5V8H2v4zm10-4H8v4h4V8zM2 2v5h5V2H2zm0 16h5v-5H2v5zM13 7h5V2h-5v5zM8 2v5h4V2H8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM13 6a1 1 0 0 1 1 1v3.172a2.047 2.047 0 0 0-.293.443l-.858 1.736-1.916.28-.151.027A1.976 1.976 0 0 0 9.315 14H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm-1 2H8v4h4V8z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function N(s){if(!s||!Xt(s))return s;const{top:e,right:t,bottom:o,left:n}=s;if(e==t&&t==o&&o==n)return e}function F(s,e){const t=parseFloat(s);return Number.isNaN(t)||String(t)!==String(s)?s:`${t}${e}`}function U(s,e={}){const t={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...s};return e.includeAlignmentProperty&&!t.alignment&&(t.alignment="center"),e.includePaddingProperty&&!t.padding&&(t.padding=""),e.includeVerticalAlignmentProperty&&!t.verticalAlignment&&(t.verticalAlignment="middle"),e.includeHorizontalAlignmentProperty&&!t.horizontalAlignment&&(t.horizontalAlignment=e.isRightToLeftContent?"right":"left"),t}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Tn=500,Xe={borderStyle:"tableCellBorderStyle",borderColor:"tableCellBorderColor",borderWidth:"tableCellBorderWidth",height:"tableCellHeight",width:"tableCellWidth",padding:"tableCellPadding",backgroundColor:"tableCellBackgroundColor",horizontalAlignment:"tableCellHorizontalAlignment",verticalAlignment:"tableCellVerticalAlignment"};class vn extends v{static get requires(){return[ee]}static get pluginName(){return"TableCellPropertiesUI"}constructor(e){super(e),e.config.define("table.tableCellProperties",{borderColors:le,backgroundColors:le})}init(){const e=this.editor,t=e.t;this._defaultTableCellProperties=U(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"}),this._balloon=e.plugins.get(ee),this.view=null,this._isReady=!1,e.ui.componentFactory.add("tableCellProperties",o=>{const n=new x(o);n.set({label:t("Cell properties"),icon:Cn,tooltip:!0}),this.listenTo(n,"execute",()=>this._showView());const l=Object.values(Xe).map(i=>e.commands.get(i));return n.bind("isEnabled").toMany(l,"isEnabled",(...i)=>i.some(r=>r)),n})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,t=e.config.get("table.tableCellProperties"),o=te(t.borderColors),n=oe(e.locale,o),l=te(t.backgroundColors),i=oe(e.locale,l),r=new fn(e.locale,{borderColors:n,backgroundColors:i,defaultTableCellProperties:this._defaultTableCellProperties}),a=e.t;r.render(),this.listenTo(r,"submit",()=>{this._hideView()}),this.listenTo(r,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),r.keystrokes.set("Esc",(u,h)=>{this._hideView(),h()}),dt({emitter:r,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const c=_t(a),d=At(a);return r.on("change:borderStyle",this._getPropertyChangeCallback("tableCellBorderStyle")),r.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:r.borderColorInput,commandName:"tableCellBorderColor",errorText:c,validator:ne})),r.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:r.borderWidthInput,commandName:"tableCellBorderWidth",errorText:d,validator:St})),r.on("change:padding",this._getValidatedPropertyChangeCallback({viewField:r.paddingInput,commandName:"tableCellPadding",errorText:d,validator:D})),r.on("change:width",this._getValidatedPropertyChangeCallback({viewField:r.widthInput,commandName:"tableCellWidth",errorText:d,validator:D})),r.on("change:height",this._getValidatedPropertyChangeCallback({viewField:r.heightInput,commandName:"tableCellHeight",errorText:d,validator:D})),r.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:r.backgroundInput,commandName:"tableCellBackgroundColor",errorText:c,validator:ne})),r.on("change:horizontalAlignment",this._getPropertyChangeCallback("tableCellHorizontalAlignment")),r.on("change:verticalAlignment",this._getPropertyChangeCallback("tableCellVerticalAlignment")),r}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableCellBorderStyle");Object.entries(Xe).map(([o,n])=>{const l=this._defaultTableCellProperties[o]||"";return[o,e.get(n).value||l]}).forEach(([o,n])=>{(o==="borderColor"||o==="borderWidth")&&t.value==="none"||this.view.set(o,n)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:Et(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,t=e.editing.view.document;ce(t.selection)?this._isViewVisible&&It(e,"cell"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,n)=>{this._isReady&&this.editor.execute(e,{value:n,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:n,errorText:l}=e,i=ut(()=>{o.errorText=l},Tn);return(r,a,c)=>{i.cancel(),this._isReady&&(n(c)?(this.editor.execute(t,{value:c,batch:this._undoStepBatch}),o.errorText=null):i())}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class I extends A{constructor(e,t,o){super(e),this.attributeName=t,this._defaultValue=o}refresh(){const e=this.editor,o=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e.model.document.selection);this.isEnabled=!!o.length,this.value=this._getSingleValue(o)}execute(e={}){const{value:t,batch:o}=e,n=this.editor.model,i=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(n.document.selection),r=this._getValueToSet(t);n.enqueueChange(o,a=>{r?i.forEach(c=>a.setAttribute(this.attributeName,r,c)):i.forEach(c=>a.removeAttribute(this.attributeName,c))})}_getAttribute(e){if(!e)return;const t=e.getAttribute(this.attributeName);if(t!==this._defaultValue)return t}_getValueToSet(e){if(e!==this._defaultValue)return e}_getSingleValue(e){const t=this._getAttribute(e[0]);return e.every(n=>this._getAttribute(n)===t)?t:void 0}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yn extends I{constructor(e,t){super(e,"tableCellWidth",t)}_getValueToSet(e){if(e=F(e,"px"),e!==this._defaultValue)return e}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _n extends v{static get pluginName(){return"TableCellWidthEditing"}static get requires(){return[ae]}init(){const e=this.editor,t=U(e.config.get("table.tableCellProperties.defaultProperties"));Q(e.model.schema,e.conversion,{modelAttribute:"tableCellWidth",styleName:"width",defaultValue:t.width}),e.commands.add("tableCellWidth",new yn(e,t.width))}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class An extends I{constructor(e,t){super(e,"tableCellPadding",t)}_getAttribute(e){if(!e)return;const t=N(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=F(e,"px");if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Sn extends I{constructor(e,t){super(e,"tableCellHeight",t)}_getValueToSet(e){const t=F(e,"px");if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Rn extends I{constructor(e,t){super(e,"tableCellBackgroundColor",t)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vn extends I{constructor(e,t){super(e,"tableCellVerticalAlignment",t)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xn extends I{constructor(e,t){super(e,"tableCellHorizontalAlignment",t)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class In extends I{constructor(e,t){super(e,"tableCellBorderStyle",t)}_getAttribute(e){if(!e)return;const t=N(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kn extends I{constructor(e,t){super(e,"tableCellBorderColor",t)}_getAttribute(e){if(!e)return;const t=N(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class En extends I{constructor(e,t){super(e,"tableCellBorderWidth",t)}_getAttribute(e){if(!e)return;const t=N(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=F(e,"px");if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Je=/^(top|middle|bottom)$/,Ye=/^(left|center|right|justify)$/;class Pn extends v{static get pluginName(){return"TableCellPropertiesEditing"}static get requires(){return[ae,_n]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableCellProperties.defaultProperties",{});const n=U(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"});e.data.addStyleProcessorRules(nt),Bn(t,o,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),e.commands.add("tableCellBorderStyle",new In(e,n.borderStyle)),e.commands.add("tableCellBorderColor",new kn(e,n.borderColor)),e.commands.add("tableCellBorderWidth",new En(e,n.borderWidth)),Q(t,o,{modelAttribute:"tableCellHeight",styleName:"height",defaultValue:n.height}),e.commands.add("tableCellHeight",new Sn(e,n.height)),e.data.addStyleProcessorRules(zt),Q(t,o,{modelAttribute:"tableCellPadding",styleName:"padding",reduceBoxSides:!0,defaultValue:n.padding}),e.commands.add("tableCellPadding",new An(e,n.padding)),e.data.addStyleProcessorRules(lt),Q(t,o,{modelAttribute:"tableCellBackgroundColor",styleName:"background-color",defaultValue:n.backgroundColor}),e.commands.add("tableCellBackgroundColor",new Rn(e,n.backgroundColor)),Ln(t,o,n.horizontalAlignment),e.commands.add("tableCellHorizontalAlignment",new xn(e,n.horizontalAlignment)),Hn(t,o,n.verticalAlignment),e.commands.add("tableCellVerticalAlignment",new Vn(e,n.verticalAlignment))}}function Bn(s,e,t){const o={width:"tableCellBorderWidth",color:"tableCellBorderColor",style:"tableCellBorderStyle"};s.extend("tableCell",{allowAttributes:Object.values(o)}),me(e,"td",o,t),me(e,"th",o,t),O(e,{modelElement:"tableCell",modelAttribute:o.style,styleName:"border-style"}),O(e,{modelElement:"tableCell",modelAttribute:o.color,styleName:"border-color"}),O(e,{modelElement:"tableCell",modelAttribute:o.width,styleName:"border-width"})}function Ln(s,e,t){s.extend("tableCell",{allowAttributes:["tableCellHorizontalAlignment"]}),e.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellHorizontalAlignment"},view:o=>({key:"style",value:{"text-align":o}})}),e.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"text-align":Ye}},model:{key:"tableCellHorizontalAlignment",value:o=>{const n=o.getStyle("text-align");return n===t?null:n}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{align:Ye}},model:{key:"tableCellHorizontalAlignment",value:o=>{const n=o.getAttribute("align");return n===t?null:n}}})}function Hn(s,e,t){s.extend("tableCell",{allowAttributes:["tableCellVerticalAlignment"]}),e.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellVerticalAlignment"},view:o=>({key:"style",value:{"vertical-align":o}})}),e.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"vertical-align":Je}},model:{key:"tableCellVerticalAlignment",value:o=>{const n=o.getStyle("vertical-align");return n===t?null:n}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{valign:Je}},model:{key:"tableCellVerticalAlignment",value:o=>{const n=o.getAttribute("valign");return n===t?null:n}}})}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dl extends v{static get pluginName(){return"TableCellProperties"}static get requires(){return[Pn,vn]}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class M extends A{constructor(e,t,o){super(e),this.attributeName=t,this._defaultValue=o}refresh(){const o=this.editor.model.document.selection.getFirstPosition().findAncestor("table");this.isEnabled=!!o,this.value=this._getValue(o)}execute(e={}){const t=this.editor.model,o=t.document.selection,{value:n,batch:l}=e,i=o.getFirstPosition().findAncestor("table"),r=this._getValueToSet(n);t.enqueueChange(l,a=>{r?a.setAttribute(this.attributeName,r,i):a.removeAttribute(this.attributeName,i)})}_getValue(e){if(!e)return;const t=e.getAttribute(this.attributeName);if(t!==this._defaultValue)return t}_getValueToSet(e){if(e!==this._defaultValue)return e}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nn extends M{constructor(e,t){super(e,"tableBackgroundColor",t)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fn extends M{constructor(e,t){super(e,"tableBorderColor",t)}_getValue(e){if(!e)return;const t=N(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mn extends M{constructor(e,t){super(e,"tableBorderStyle",t)}_getValue(e){if(!e)return;const t=N(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zn extends M{constructor(e,t){super(e,"tableBorderWidth",t)}_getValue(e){if(!e)return;const t=N(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=F(e,"px");if(t!==this._defaultValue)return t}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Wn extends M{constructor(e,t){super(e,"tableWidth",t)}_getValueToSet(e){if(e=F(e,"px"),e!==this._defaultValue)return e}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class On extends M{constructor(e,t){super(e,"tableHeight",t)}_getValueToSet(e){if(e=F(e,"px"),e!==this._defaultValue)return e}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Dn extends M{constructor(e,t){super(e,"tableAlignment",t)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Un=/^(left|center|right)$/,$n=/^(left|none|right)$/;class jn extends v{static get pluginName(){return"TablePropertiesEditing"}static get requires(){return[ae]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableProperties.defaultProperties",{});const n=U(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0});e.data.addStyleProcessorRules(nt),Gn(t,o,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),e.commands.add("tableBorderColor",new Fn(e,n.borderColor)),e.commands.add("tableBorderStyle",new Mn(e,n.borderStyle)),e.commands.add("tableBorderWidth",new zn(e,n.borderWidth)),Kn(t,o,n.alignment),e.commands.add("tableAlignment",new Dn(e,n.alignment)),Qe(t,o,{modelAttribute:"tableWidth",styleName:"width",defaultValue:n.width}),e.commands.add("tableWidth",new Wn(e,n.width)),Qe(t,o,{modelAttribute:"tableHeight",styleName:"height",defaultValue:n.height}),e.commands.add("tableHeight",new On(e,n.height)),e.data.addStyleProcessorRules(lt),qn(t,o,{modelAttribute:"tableBackgroundColor",styleName:"background-color",defaultValue:n.backgroundColor}),e.commands.add("tableBackgroundColor",new Nn(e,n.backgroundColor))}}function Gn(s,e,t){const o={width:"tableBorderWidth",color:"tableBorderColor",style:"tableBorderStyle"};s.extend("table",{allowAttributes:Object.values(o)}),me(e,"table",o,t),J(e,{modelAttribute:o.color,styleName:"border-color"}),J(e,{modelAttribute:o.style,styleName:"border-style"}),J(e,{modelAttribute:o.width,styleName:"border-width"})}function Kn(s,e,t){s.extend("table",{allowAttributes:["tableAlignment"]}),e.for("downcast").attributeToAttribute({model:{name:"table",key:"tableAlignment"},view:o=>({key:"style",value:{float:o==="center"?"none":o}}),converterPriority:"high"}),e.for("upcast").attributeToAttribute({view:{name:/^(table|figure)$/,styles:{float:$n}},model:{key:"tableAlignment",value:o=>{let n=o.getStyle("float");return n==="none"&&(n="center"),n===t?null:n}}}).attributeToAttribute({view:{attributes:{align:Un}},model:{name:"table",key:"tableAlignment",value:o=>{const n=o.getAttribute("align");return n===t?null:n}}})}function qn(s,e,t){const{modelAttribute:o}=t;s.extend("table",{allowAttributes:[o]}),Re(e,{viewElement:"table",...t}),J(e,t)}function Qe(s,e,t){const{modelAttribute:o}=t;s.extend("table",{allowAttributes:[o]}),Re(e,{viewElement:/^(table|figure)$/,shouldUpcast:n=>!(n.name=="table"&&n.parent.name=="figure"),...t}),O(e,{modelElement:"table",...t})}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Xn={left:y.objectLeft,center:y.objectCenter,right:y.objectRight};class Jn extends E{constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",alignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:n,borderColorInput:l,borderRowLabel:i}=this._createBorderFields(),{backgroundRowLabel:r,backgroundInput:a}=this._createBackgroundFields(),{widthInput:c,operatorLabel:d,heightInput:u,dimensionsLabel:h}=this._createDimensionFields(),{alignmentToolbar:m,alignmentLabel:f}=this._createAlignmentFields();this.focusTracker=new re,this.keystrokes=new ie,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=n,this.borderColorInput=l,this.backgroundInput=a,this.widthInput=c,this.heightInput=u,this.alignmentToolbar=m;const{saveButtonView:b,cancelButtonView:p}=this._createActionButtons();this.saveButtonView=b,this.cancelButtonView=p,this._focusables=new Ae,this._focusCycler=new Se({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new rt(e,{label:this.t("Table properties")})),this.children.add(new V(e,{labelView:i,children:[i,o,l,n],class:"ck-table-form__border-row"})),this.children.add(new V(e,{labelView:r,children:[r,a],class:"ck-table-form__background-row"})),this.children.add(new V(e,{children:[new V(e,{labelView:h,children:[h,c,d,u],class:"ck-table-form__dimensions-row"}),new V(e,{labelView:f,children:[f,m],class:"ck-table-properties-form__alignment-row"})]})),this.children.add(new V(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),at({view:this}),[this.borderStyleDropdown,this.borderColorInput,this.borderColorInput.fieldView.dropdownView.buttonView,this.borderWidthInput,this.backgroundInput,this.backgroundInput.fieldView.dropdownView.buttonView,this.widthInput,this.heightInput,this.alignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=se({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color}),n=this.locale,l=this.t,i=l("Style"),r=new k(n);r.text=l("Border");const a=Ie(l),c=new R(n,ct);c.set({label:i,class:"ck-table-form__border-style"}),c.fieldView.buttonView.set({ariaLabel:i,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:i}),c.fieldView.buttonView.bind("label").to(this,"borderStyle",h=>a[h||"none"]),c.fieldView.on("execute",h=>{this.borderStyle=h.source._borderStyleValue}),c.bind("isEmpty").to(this,"borderStyle",h=>!h),_e(c.fieldView,Rt(this,t.style),{role:"menu",ariaLabel:i});const d=new R(n,B);d.set({label:l("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",q),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const u=new R(n,o);return u.set({label:l("Color"),class:"ck-table-form__border-color"}),u.fieldView.bind("value").to(this,"borderColor"),u.bind("isEnabled").to(this,"borderStyle",q),u.fieldView.on("input",()=>{this.borderColor=u.fieldView.value}),this.on("change:borderStyle",(h,m,f,b)=>{q(f)||(this.borderColor="",this.borderWidth=""),q(b)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:r,borderStyleDropdown:c,borderColorInput:u,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new k(e);o.text=t("Background");const n=se({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableProperties.backgroundColor}),l=new R(e,n);return l.set({label:t("Color"),class:"ck-table-properties-form__background"}),l.fieldView.bind("value").to(this,"backgroundColor"),l.fieldView.on("input",()=>{this.backgroundColor=l.fieldView.value}),{backgroundRowLabel:o,backgroundInput:l}}_createDimensionFields(){const e=this.locale,t=this.t,o=new k(e);o.text=t("Dimensions");const n=new R(e,B);n.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),n.fieldView.bind("value").to(this,"width"),n.fieldView.on("input",()=>{this.width=n.fieldView.element.value});const l=new E(e);l.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const i=new R(e,B);return i.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),i.fieldView.bind("value").to(this,"height"),i.fieldView.on("input",()=>{this.height=i.fieldView.element.value}),{dimensionsLabel:o,widthInput:n,operatorLabel:l,heightInput:i}}_createAlignmentFields(){const e=this.locale,t=this.t,o=new k(e);o.text=t("Alignment");const n=new he(e);return n.set({isCompact:!0,ariaLabel:t("Table alignment toolbar")}),ve({view:this,icons:Xn,toolbar:n,labels:this._alignmentLabels,propertyName:"alignment",defaultValue:this.options.defaultTableProperties.alignment}),{alignmentLabel:o,alignmentToolbar:n}}_createActionButtons(){const e=this.locale,t=this.t,o=new x(e),n=new x(e),l=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.widthInput,this.heightInput];return o.set({label:t("Save"),icon:y.check,class:"ck-button-save",type:"submit",withText:!0}),o.bind("isEnabled").toMany(l,"errorText",(...i)=>i.every(r=>!r)),n.set({label:t("Cancel"),icon:y.cancel,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:o,cancelButtonView:n}}get _alignmentLabels(){const e=this.locale,t=this.t,o=t("Align table to the left"),n=t("Center table"),l=t("Align table to the right");return e.uiLanguageDirection==="rtl"?{right:l,center:n,left:o}:{left:o,center:n,right:l}}}function q(s){return s!=="none"}const Yn='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 2v5h4V2h1v5h5v1h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5H7v-5H2v-1h5V8H2V7h5V2h1zm4 6H8v4h4V8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM17 1a2 2 0 0 1 2 2v9.475l-.85-.124-.857-1.736a2.048 2.048 0 0 0-.292-.44L17 3H3v14h7.808l.402.392L10.935 19H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Qn=500,Ze={borderStyle:"tableBorderStyle",borderColor:"tableBorderColor",borderWidth:"tableBorderWidth",backgroundColor:"tableBackgroundColor",width:"tableWidth",height:"tableHeight",alignment:"tableAlignment"};class Zn extends v{static get requires(){return[ee]}static get pluginName(){return"TablePropertiesUI"}constructor(e){super(e),this.view=null,e.config.define("table.tableProperties",{borderColors:le,backgroundColors:le})}init(){const e=this.editor,t=e.t;this._defaultTableProperties=U(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0}),this._balloon=e.plugins.get(ee),e.ui.componentFactory.add("tableProperties",o=>{const n=new x(o);n.set({label:t("Table properties"),icon:Yn,tooltip:!0}),this.listenTo(n,"execute",()=>this._showView());const l=Object.values(Ze).map(i=>e.commands.get(i));return n.bind("isEnabled").toMany(l,"isEnabled",(...i)=>i.some(r=>r)),n})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,t=e.config.get("table.tableProperties"),o=te(t.borderColors),n=oe(e.locale,o),l=te(t.backgroundColors),i=oe(e.locale,l),r=new Jn(e.locale,{borderColors:n,backgroundColors:i,defaultTableProperties:this._defaultTableProperties}),a=e.t;r.render(),this.listenTo(r,"submit",()=>{this._hideView()}),this.listenTo(r,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),r.keystrokes.set("Esc",(u,h)=>{this._hideView(),h()}),dt({emitter:r,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const c=_t(a),d=At(a);return r.on("change:borderStyle",this._getPropertyChangeCallback("tableBorderStyle")),r.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:r.borderColorInput,commandName:"tableBorderColor",errorText:c,validator:ne})),r.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:r.borderWidthInput,commandName:"tableBorderWidth",errorText:d,validator:St})),r.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:r.backgroundInput,commandName:"tableBackgroundColor",errorText:c,validator:ne})),r.on("change:width",this._getValidatedPropertyChangeCallback({viewField:r.widthInput,commandName:"tableWidth",errorText:d,validator:D})),r.on("change:height",this._getValidatedPropertyChangeCallback({viewField:r.heightInput,commandName:"tableHeight",errorText:d,validator:D})),r.on("change:alignment",this._getPropertyChangeCallback("tableAlignment")),r}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableBorderStyle");Object.entries(Ze).map(([o,n])=>{const l=o,i=this._defaultTableProperties[l]||"";return[l,e.get(n).value||i]}).forEach(([o,n])=>{(o==="borderColor"||o==="borderWidth")&&t.value==="none"||this.view.set(o,n)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:kt(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,t=e.editing.view.document;ce(t.selection)?this._isViewVisible&&It(e,"table"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,n)=>{this._isReady&&this.editor.execute(e,{value:n,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:n,errorText:l}=e,i=ut(()=>{o.errorText=l},Qn);return(r,a,c)=>{i.cancel(),this._isReady&&(n(c)?(this.editor.execute(t,{value:c,batch:this._undoStepBatch}),o.errorText=null):i())}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ul extends v{static get pluginName(){return"TableProperties"}static get requires(){return[jn,Zn]}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hl extends v{static get requires(){return[Pe]}static get pluginName(){return"TableToolbar"}afterInit(){const e=this.editor,t=e.t,o=e.plugins.get(Pe),n=e.config.get("table.contentToolbar"),l=e.config.get("table.tableToolbar");n&&o.register("tableContent",{ariaLabel:t("Table toolbar"),items:n,getRelatedElement:ce}),l&&o.register("table",{ariaLabel:t("Table toolbar"),items:l,getRelatedElement:pn})}}export{al as T,hl as a,cl as b,ul as c,dl as d};
