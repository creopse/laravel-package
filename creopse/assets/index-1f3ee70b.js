import{u as Ge,b as Ke,a as Qe,c as Ye,y as Ze,P as H,z as Je,R as We,e as Xe,A as ve,r as ae,U as _e,_ as ea}from"./index-21fa1843.js";import{a as aa}from"./index.vue_vue_type_script_setup_true_lang-84b24b9e.js";import{_ as ta}from"./PageLayout.vue_vue_type_script_setup_true_lang-b8ee0a59.js";import{_ as la}from"./NaiveMobileTableAdapter.vue_vue_type_script_setup_true_lang-9060f993.js";import{I as U}from"./iconify_vue-6750bec6.js";import{A as sa}from"./auth-type-5b0d67f1.js";import{R as ge}from"./response-error-code-87d1097e.js";import{u as na}from"./profile-type-9bad28bb.js";import{a as ra}from"./pinia-5dd13ed8.js";import{_ as ye}from"./lodash-a9971f22.js";import{_ as oa}from"./validator-c0254ba9.js";import{v as be}from"./uuid-cf522c50.js";import{d as Ae,i as ia,p as ke,w as ua,o as w,c as G,Y as n,aO as r,F as pa,h as u,P as O,l as he,Q as we,a as E}from"./vue_runtime-core-4f5fb440.js";import{a as da,b as ma,c as ca,a4 as fa,e as K,Z as Ee,E as Q,_ as V,N as P,a5 as va,g as _a,a7 as ga,a1 as ya,R as ba,H as ka,I as ha,F as wa,j as Ea,aq as Sa,al as Aa,M as xa,G as $a,k as Da,L as Ia}from"./naive-ui-0caedd43.js";import{u as za}from"./vue-i18n-84a05dd5.js";import{r as p,u as e,c as j}from"./vue_reactivity-852d8377.js";import{t as q,n as Se}from"./vue_shared-7dcc3b7f.js";import"./browser-image-compression-a3ab6596.js";import"./fawmi_vue-google-maps-52673af8.js";import"./vue_runtime-dom-c0cb2070.js";import"./googlemaps_markerclusterer-b718980f.js";import"./fast-deep-equal-1db9e660.js";import"./axios-96fb5abd.js";import"./process-93c0ea83.js";import"./supercluster-6504d485.js";import"./kdbush-ac640998.js";import"./moment-ea709ccd.js";import"./slugify-ce681755.js";import"./vueuse_core-e3c6c607.js";import"./vueuse_shared-d1f69174.js";import"./parse-domain-a3f3f4d5.js";import"./is-ip-33949ce5.js";import"./ip-regex-e6f9cbd8.js";import"./super-regex-a8a38319.js";import"./function-timeout-8f7724f6.js";import"./clone-regexp-3bc3d90c.js";import"./is-regexp-5fa9e804.js";import"./vue-router-e670704e.js";import"./unhead_vue-71da354f.js";import"./unhead-a4367481.js";import"./hookable-e7fd869b.js";import"./unhead_dom-b5f3dd9b.js";import"./unhead_shared-56c99682.js";import"./ckeditor_ckeditor5-vue-13667b6e.js";import"./vue-83614a91.js";import"./strip-json-comments-680ed425.js";import"./vue-draggable-next-d31a77b2.js";import"./pinia_colada-25af8b56.js";import"./vue-shepherd-6780f0ef.js";import"./shepherd.js-8a3687f6.js";import"./vue-tel-input-40ca5c5d.js";import"./vue3-map-chart-612bd6db.js";import"./crypto-js-eb39eca1.js";import"./pinia-persistence-plugin-50ba422c.js";/* empty css                    *//* empty css               *//* empty css                                      */import"./date-fns-eed65714.js";import"./seemly-5e1e6f41.js";import"./vueuc-b49649f7.js";import"./evtd-b614532e.js";import"./css-render_vue3-ssr-b91bc731.js";import"./vooks-3c892a1c.js";import"./vdirs-b0483831.js";import"./juggle_resize-observer-41516555.js";import"./css-render-9b607bf6.js";import"./emotion_hash-8a8e73f6.js";import"./lodash-es-a215867d.js";import"./treemate-25c27bff.js";import"./date-fns-tz-6c300683.js";import"./async-validator-dc9a4891.js";import"./css-render_plugin-bem-9dde7ffe.js";import"./vue-demi-71ba0ef2.js";import"./intlify_shared-f7876323.js";import"./intlify_core-base-c423e336.js";import"./intlify_message-compiler-48af4dac.js";import"./media-library-ab314cca.js";import"./vue-advanced-cropper-7a0dcf27.js";var S=(L=>(L[L.DISABLED=0]="DISABLED",L[L.ENABLED=1]="ENABLED",L))(S||{});const Na={key:0,class:"text-6xl"},Ta={class:"flex justify-center mb-5"},Ca={key:0},Ua={key:1},Pa=Ae({name:We.USERS_MANAGEMENT.NAME}),rl=Ae({...Pa,setup(L){const g=da(),y=ma(),Y=ca(),{pickByTheme:te,fileUrl:xe,displayFormErrors:$e}=Ge(),{profileTypes:le,getProfileTypeLabel:De}=na(),{defaultPrefs:Z}=Ke(),{userIsAbleTo:J}=Qe(),{request:z}=Xe(),{t,locale:W}=za(),Ie=Ye(),X=Ze(),{roles:ze}=ra(X),Ne=ia("appConfig"),f=p(""),Te=p(),F=p([]),ee=p(!1),R=p(!1),se=p(0),B=p(Z.value),Ce=ke(()=>[{title:t("n_"),key:"no",width:50,fixed:"left"},{title:t("avatar"),key:"avatar",width:75,fixed:"left",render(l){return l.avatar?u(K,{size:"medium",src:l.avatarUrl}):u(K,{size:"medium",style:{width:"36px",height:"36px",display:"block"}},{default:()=>ve(l.fullname)})}},{title:t("lastnameAndFirstname_s"),key:"name",resizable:!0,width:200,ellipsis:{tooltip:!0},fixed:"left",sortOrder:!1,sorter:"default",render(l){return u("div",{},{default:()=>l.fullname})}},{title:t("type"),key:"type",resizable:!0,width:125,render(l){return u("div",{},{default:()=>De(l.profileType)})},defaultFilterOptionValues:[],filterOptions:le,filter:(l,a)=>a.profileType==l},{title:t("roles"),key:"roles",resizable:!0,width:150,render(l){return u("div",{},{default:()=>{var i;return(i=l.roles)==null?void 0:i.map(d=>u(Ee,{class:"mx-1 my-1",size:"small",type:"info",round:!1,strong:!0,bordered:!1},{default:()=>d.displayName}))}})},defaultFilterOptionValues:[],filterOptions:ze.value.map(l=>({label:l.displayName,value:l.name})),filter:(l,a)=>{var i,d;return((d=(i=a.roles)==null?void 0:i.map(v=>v.name))==null?void 0:d.includes(String(l)))||!1}},{title:t("email"),key:"email",resizable:!0,width:200,ellipsis:{tooltip:!0}},{title:t("phoneNumber"),key:"phone",width:200,ellipsis:{tooltip:!0}},{title:t("status"),key:"accountStatus",width:125,render(l){return u(Ee,{type:l.accountStatus==S.ENABLED?"success":l.accountStatus==S.DISABLED?"error":"warning",bordered:!1},{default:()=>l.accountStatus==S.ENABLED?t("activated"):l.accountStatus==S.DISABLED?t("deactivated"):t("undefined")})},sortOrder:!1,sorter:"default"},{title:t("lastLogin"),key:"lastLoggedInAt",width:125,render(l){return u("div",{},{default:()=>ae(l.lastLoggedInAt||"",{locale:W.value})})}},{title:t("lastEdition"),key:"updatedAt",width:125,render(l){return u("div",{},{default:()=>ae(l.updatedAt,{locale:W.value})})}},{title:t("creation"),key:"createdAt",width:125,render(l){return u("div",{},{default:()=>ae(l.createdAt,{locale:W.value})})}},{title:()=>u(va,{},{default:()=>[u(Q,{ref:Te,placeholder:t("search"),value:f.value,onInput:l=>{f.value=l,f.value||A(`/users?pageSize=${c.value}&page=${_.value}&query=${f.value}`)},clearable:!0}),u(V,{onClick:()=>{A(`/users?pageSize=${c.value}&page=${_.value}&query=${f.value}`)}},{default:()=>u(P,{},{default:()=>u(U,{icon:"carbon:search"})})})]}),key:"actions",width:200,render(l){const a=()=>{var d,v,k;return l.id!=((d=Ie.userData)==null?void 0:d.id)&&!((k=(v=l.roles)==null?void 0:v.map(x=>x.name))!=null&&k.includes(_e.SUPER_ADMIN))},i=[];return J("edit-user")&&a()&&(i.push(u(V,{size:"small",type:"warning",onClick:()=>{oe(l)},renderIcon:()=>u(P,null,{default:()=>u(U,{icon:"carbon:edit"})})},{default:()=>t("edit")})),i.push(u("div",{class:"w-2"})),i.push(u(V,{size:"small",type:"success",onClick:()=>{B.value=l.preferences||Z.value,se.value=l.id||0,R.value=!0},renderIcon:()=>u(P,null,{default:()=>u(U,{icon:"carbon:settings"})})}))),J("delete-user")&&a()&&(i.push(u("div",{class:"w-2"})),i.push(u(V,{size:"small",type:"error",onClick:()=>{Y.warning({title:t("confirm"),content:t("confirmDeleteUser"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{g.start(),(await z({url:`/users/${l.id}`,method:"delete"})).success?y.success(t("success")):y.error(t("anErrorOccurred")),g.finish(),A(`/users?pageSize=${c.value}&page=${_.value}&query=${f.value}`)}})},renderIcon:()=>u(P,null,{default:()=>u(U,{icon:"carbon:trash-can"})})}))),u("div",{class:"flex justify-end items-center w-full"},i)},fixed:"right"}]),ne=p(0),c=p(6),_=p(1),Ue=l=>{A(`/users?pageSize=${c.value}&page=${l}&query=${f.value}`)},Pe=l=>{c.value=l,A(`/users?pageSize=${c.value}&query=${f.value}`)},A=async(l=null,a=!1)=>{var d,v,k,x,T;ee.value=!0,g.start();const i=await z({url:l||`/users?pageSize=${c.value}&query=${f.value}`});i.success&&i.result&&(ne.value=((v=(d=i.result.data)==null?void 0:d.meta)==null?void 0:v.total)||0,_.value=((x=(k=i.result.data)==null?void 0:k.meta)==null?void 0:x.currentPage)||1,F.value=(((T=i.result.data)==null?void 0:T.users)||[]).map((C,$)=>{const m=ye.cloneDeep(C);return m.no=$+1+(_.value-1)*c.value,m})),a&&X.loadRoles(),g.finish(),ee.value=!1};A(null,!0);const D=p(!1),I=p(!1),N=p(!1),b=p(null),re=p(null),s=p({avatar:"",lastname:"",firstname:"",email:"",profileType:H.ADMIN,accountStatus:S.DISABLED,roles:[]}),qe=ke(()=>({lastname:[{required:!0,message:t("fillRequired")}],firstname:[{required:!0,message:t("fillRequired")}],status:[{required:!0,message:t("fillRequired")}],profileType:[{required:!0,message:t("fillRequired")}],email:[{required:b.value?b.value.authType!=sa.PHONE:!0,message:t("fillRequired")},{trigger:["input"],validator(l,a){return a&&!oa.isEmail(a)?new Error(t("invalidEmail")):!0}}]})),oe=l=>{var a;b.value=ye.cloneDeep(l),s.value={avatar:l?l.avatar:"",lastname:l?l.lastname:"",firstname:l?l.firstname:"",email:l?l.email:"",profileType:l?l.profileType:H.ADMIN,accountStatus:l?l.accountStatus:S.DISABLED,roles:l?((a=l.roles)==null?void 0:a.map(i=>i.name))??[]:[]},I.value=!0},Le=async()=>{var l;return(l=re.value)==null||l.validate(async a=>{var i,d,v,k,x,T,C;if(!a){const $=Je(12);if(b.value)if(b.value.email!==s.value.email&&F.value.findIndex(m=>m.email==s.value.email)>-1)y.error(t("sameEmailMessage"));else{if(g.start(),D.value=!0,(await z({url:`/users/${b.value.id}`,method:"put",data:{password:$,avatar:s.value.avatar,lastname:s.value.lastname,firstname:s.value.firstname,email:s.value.email,roles:s.value.roles,accountStatus:s.value.accountStatus,sendCredentialsEmail:N.value}})).success){let h;switch(s.value.profileType){case H.ADMIN:h={};break}await z({url:`/auth/profile/${(i=b.value.profile)==null?void 0:i.id}`,method:"put",data:{type:s.value.profileType,profileData:h}}),N.value?Y.success({title:t("success"),content:t("userAccountPasswordReset",[s.value.email,$]),positiveText:t("ok")}):y.success(t("success"))}else y.error(t("anErrorOccurred"));D.value=!1,g.finish(),A(`/users?pageSize=${c.value}&page=${_.value}&query=${f.value}`),I.value=!1}else if(F.value.findIndex(m=>m.email==s.value.email)>-1)y.error(t("sameEmailMessage"));else{g.start(),D.value=!0;const m=await z({url:"/users",method:"post",data:{password:$,email:s.value.email,lastname:s.value.lastname,firstname:s.value.firstname,avatar:s.value.avatar,roles:s.value.roles,accountStatus:s.value.accountStatus,sendCredentialsEmail:N.value,preferences:Z.value}});if(m.failure&&m.error)switch((k=(v=(d=m.error)==null?void 0:d.response)==null?void 0:v.data)==null?void 0:k.errorCode){case ge.AUTH_MISSING_DATA:y.error(t("missingData"));break;case ge.FORM_INVALID_DATA:$e((C=(T=(x=m.error)==null?void 0:x.response)==null?void 0:T.data)==null?void 0:C.data);break;default:y.error(t("registrationNotSuccessful"))}else{let h;switch(s.value.profileType){case H.ADMIN:h={};break}await z({url:"/auth/profile",method:"post",data:{type:s.value.profileType,id:m.result.data.id,profileData:h}}),Y.success({title:t("success"),content:t("userAccountEmailContent",[s.value.email,$]),positiveText:t("ok")})}D.value=!1,g.finish(),A(`/users?pageSize=${c.value}&page=${_.value}&query=${f.value}`),I.value=!1}}}),!1},Re=async()=>{g.start(),D.value=!0;const l=await z({url:`/users/${se.value}`,method:"put",data:{preferences:B.value}});l.success&&l.result?(A(`/users?pageSize=${c.value}&page=${_.value}&query=${f.value}`),y.success(t("success"))):y.error(t("anErrorOccurred")),D.value=!1,g.finish(),R.value=!1},Be="avatars",M=p(!1),Me=async l=>{s.value.avatar=l,M.value=!1},Oe=()=>{s.value.avatar=""},ie=p(be());return ua(()=>[I.value],()=>{setTimeout(()=>{ie.value=be()},500)}),(l,a)=>{var fe;const i=_a,d=ga,v=la,k=ya,x=ta,T=aa,C=ba,$=ka,m=ha,h=wa,ue=Ea,pe=Sa,Ve=Aa,je=xa,Fe=ea,He=$a,de=fa,me=Da,ce=Ia;return w(),G(pa,null,[n(x,null,{"header-extra":r(()=>[e(J)("add-user")?(w(),O(i,{key:0},{default:r(()=>[n(e(V),{type:"primary",onClick:a[0]||(a[0]=o=>oe(null))},{icon:r(()=>[n(e(P),{size:"18"},{default:r(()=>[n(e(U),{icon:"carbon:add-alt"})]),_:1})]),default:r(()=>[he(" "+q(e(t)("add")),1)]),_:1})]),_:1})):we("",!0)]),default:r(()=>[n(v,null,{default:r(()=>[n(d,{"pagination-behavior-on-filter":"first",columns:e(Ce),data:e(F),loading:e(ee),"single-line":!1,"scroll-x":2e3,striped:""},null,8,["columns","data","loading"])]),_:1}),n(k,{page:e(_),"onUpdate:page":[a[1]||(a[1]=o=>j(_)?_.value=o:null),Ue],class:"mt-5 justify-end","show-size-picker":"","page-size":e(c),"page-sizes":[6,12,24,36,48],"page-count":Math.ceil(e(ne)/e(c)),"onUpdate:pageSize":Pe},null,8,["page","page-size","page-count"])]),_:1}),n(T,{show:e(M),"onUpdate:show":a[2]||(a[2]=o=>j(M)?M.value=o:null),title:e(t)("selectImage"),"upload-config":{folder:Be,limit:0,maxSize:0,baseUrl:((fe=e(Ne))==null?void 0:fe.apiUrl)+"/media-files/upload",excludedExtensions:[]},onSubmit:Me},null,8,["show","title","upload-config"]),n(de,{show:e(I),"onUpdate:show":a[14]||(a[14]=o=>j(I)?I.value=o:null),loading:e(D),preset:"dialog",style:{width:"700px"},bordered:!1,"show-icon":!1,"mask-closable":!1,title:e(b)?e(t)("edit"):e(t)("add"),"positive-text":e(t)("validate"),"negative-text":e(t)("cancel"),onPositiveClick:Le,onNegativeClick:a[15]||(a[15]=o=>I.value=!1)},{default:r(()=>[n(m,{"x-gap":"12","y-gap":"12",span:24,"item-responsive":"",responsive:"screen"},{default:r(()=>[n(C,{span:"24 s:8 m:8 l:8 xl:8 2xl:8",class:"text-center"},{default:r(()=>[n(i,{align:"center",justify:"center",style:{height:"100%"}},{default:r(()=>[e(s).avatar?(w(),O(e(K),{key:0,class:"cursor-pointer","object-fit":"contain",style:Se("border: 1px dashed "+e(te)("green","white")),size:150,src:e(xe)(e(s).avatar),onClick:a[3]||(a[3]=o=>M.value=!0)},null,8,["style","src"])):(w(),O(e(K),{key:1,class:"cursor-pointer",style:Se("border: 1px dashed "+e(te)("green","white")),size:150,onClick:a[4]||(a[4]=o=>M.value=!0)},{default:r(()=>[e(s).firstname&&e(s).lastname?(w(),G("span",Na,q(e(ve)(`${e(s).firstname} ${e(s).lastname}`)),1)):(w(),O(e(P),{key:1,size:64},{default:r(()=>[n(e(U),{icon:"carbon:image",class:"text-gray-400"})]),_:1}))]),_:1},8,["style"])),e(s).avatar?(w(),O(e(V),{key:2,quaternary:"",onClick:a[5]||(a[5]=o=>Oe())},{icon:r(()=>[n(e(P),null,{default:r(()=>[n(e(U),{icon:"carbon:trash-can"})]),_:1})]),default:r(()=>[he(" "+q(e(t)("clear")),1)]),_:1})):we("",!0)]),_:1})]),_:1}),n(C,{span:"24 s:16 m:16 l:16 xl:16 2xl:16"},{default:r(()=>[n(He,{ref_key:"formRef",ref:re,model:e(s),rules:e(qe),"show-require-mark":!1,size:"medium"},{default:r(()=>[n(m,{"x-gap":"12",span:24},{default:r(()=>[n($,{span:12,label:e(t)("lastname"),path:"lastname"},{default:r(()=>[n(e(Q),{value:e(s).lastname,"onUpdate:value":a[6]||(a[6]=o=>e(s).lastname=o),placeholder:e(t)("lastname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),n($,{span:12,label:e(t)("firstname_s"),path:"firstname"},{default:r(()=>[n(e(Q),{value:e(s).firstname,"onUpdate:value":a[7]||(a[7]=o=>e(s).firstname=o),placeholder:e(t)("firstname_s"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),n(h,{label:e(t)("addressEmail"),path:"email"},{default:r(()=>[n(e(Q),{value:e(s).email,"onUpdate:value":a[8]||(a[8]=o=>e(s).email=o),disabled:e(b)!=null,placeholder:e(t)("addressEmail"),class:"w-full"},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),n(h,{label:e(t)("type"),path:"type"},{default:r(()=>[n(ue,{value:e(s).profileType,"onUpdate:value":a[9]||(a[9]=o=>e(s).profileType=o),options:e(le),placeholder:e(t)("type"),placement:"bottom",filterable:"",class:"w-full"},null,8,["value","options","placeholder"])]),_:1},8,["label"]),n(h,{label:e(t)("roles"),path:"roles"},{default:r(()=>[n(ue,{value:e(s).roles,"onUpdate:value":a[10]||(a[10]=o=>e(s).roles=o),options:e(X).roles.filter(o=>o.name!=e(_e).SUPER_ADMIN),placeholder:e(t)("roles"),placement:"bottom",filterable:"",multiple:"","value-field":"name","label-field":"displayName",class:"w-full"},null,8,["value","options","placeholder"])]),_:1},8,["label"]),n(h,{label:e(t)("status"),path:"accountStatus"},{default:r(()=>[(w(),O(Ve,{key:e(ie),value:e(s).accountStatus,"onUpdate:value":[a[11]||(a[11]=o=>e(s).accountStatus=o),a[12]||(a[12]=o=>{o==e(S).DISABLED&&(N.value=!1)})],type:"segment"},{default:r(()=>[n(pe,{name:e(S).ENABLED,tab:e(t)("activated")},null,8,["name","tab"]),n(pe,{name:e(S).DISABLED,tab:e(t)("deactivated")},null,8,["name","tab"])]),_:1},8,["value"]))]),_:1},8,["label"]),n(Fe,null,{default:r(()=>[E("div",Ta,[n(je,{checked:e(N),"onUpdate:checked":a[13]||(a[13]=o=>j(N)?N.value=o:null)},{default:r(()=>[e(b)?(w(),G("span",Ca,q(e(t)("resetAndSendCredentialsEmail")),1)):(w(),G("span",Ua,q(e(t)("sendCredentialsEmailToUser")),1))]),_:1},8,["checked"])])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["show","loading","title","positive-text","negative-text"]),n(de,{show:e(R),"onUpdate:show":a[18]||(a[18]=o=>j(R)?R.value=o:null),loading:e(D),preset:"dialog",style:{width:"500px"},bordered:!1,"show-icon":!1,"mask-closable":!1,title:e(t)("userSettings"),"positive-text":e(t)("validate"),"negative-text":e(t)("cancel"),onPositiveClick:Re,onNegativeClick:a[19]||(a[19]=o=>R.value=!1)},{default:r(()=>[a[24]||(a[24]=E("div",{class:"h-4"},null,-1)),n(ce,{class:"w-full",size:"small"},{default:r(()=>[n(i,{align:"center",justify:"space-between"},{default:r(()=>[E("span",null,q(e(t)("notificationsInApp")),1),n(me,{value:e(B).inAppNotifEnabled,"onUpdate:value":a[16]||(a[16]=o=>e(B).inAppNotifEnabled=o),"checked-value":1,"unchecked-value":0,size:"small"},{checked:r(()=>a[20]||(a[20]=[E("div",{class:"w-6"},null,-1)])),unchecked:r(()=>a[21]||(a[21]=[E("div",{class:"w-6"},null,-1)])),_:1},8,["value"])]),_:1})]),_:1}),a[25]||(a[25]=E("div",{class:"h-2"},null,-1)),n(ce,{class:"w-full",size:"small"},{default:r(()=>[n(i,{align:"center",justify:"space-between"},{default:r(()=>[E("span",null,q(e(t)("notificationsInEmail")),1),n(me,{value:e(B).emailNotifEnabled,"onUpdate:value":a[17]||(a[17]=o=>e(B).emailNotifEnabled=o),"checked-value":1,"unchecked-value":0,size:"small"},{checked:r(()=>a[22]||(a[22]=[E("div",{class:"w-6"},null,-1)])),unchecked:r(()=>a[23]||(a[23]=[E("div",{class:"w-6"},null,-1)])),_:1},8,["value"])]),_:1})]),_:1}),a[26]||(a[26]=E("div",{class:"h-4"},null,-1))]),_:1},8,["show","loading","title","positive-text","negative-text"])],64)}}});export{rl as default};
