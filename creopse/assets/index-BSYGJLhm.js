import{i as h}from"./css-render_vue3-ssr-Vbotx5Ir.js";import{_ as L}from"./AuthLayout-Cd04zGrL.js";import{u as O,a as M,b as F,d as j,c as z,R as p,_ as $,e as W,g as J}from"./index-B2LlKIv2.js";import{p as K}from"./password-strength-options-ByZgG3BK.js";import{p as Q}from"./check-password-strength-CYKRgybp.js";import{R as A}from"./response-error-code-DXeaxdrh.js";import{u as X}from"./vue-router-B7M2c80d.js";import{_ as Y}from"./validator-QVVspsrX.js";import{b as Z,A as ee,D as se,G as ae,H as te,F as oe,E as re,B as le}from"./naive-ui-CrTIpLJ9.js";import{u as ne}from"./vue-i18n-CWrb4u3f.js";const{defineComponent:ie}=await h("vue"),{unref:e,createElementVNode:u,resolveComponent:Ve,createVNode:o,withCtx:l,toDisplayString:v,createTextVNode:R,vShow:ue,withDirectives:de,openBlock:pe,createBlock:me}=await h("vue"),ce={class:"container h-full"},_e={class:"flex justify-center items-center flex-wrap h-full g-6 text-gray-800"},fe={class:"md:w-8/12 lg:w-5/12 xl:w-4/12 2xl:w-3.5/12 sm:w-full"},we={class:"flex justify-center mb-8"},ge=["src","alt"],ve={class:"mt-2"},{defineComponent:he,ref:_,watch:be}=await h("vue"),Ce=he({name:p.REGISTER.NAME}),He=ie({...Ce,setup(Se){const{t:s}=ne(),m=X(),f=Z(),{request:k}=W(),{displayFormErrors:E,logo:T}=O(),{userHasSuperAdminRole:x}=M(),{defaultPrefs:D}=F(),w=j(),d=z(),g=_(!1),b=_(null),t=_({lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""}),N={lastname:[{required:!0,message:s("fillRequired")}],firstname:[{required:!0,message:s("fillRequired")}],email:[{required:!0,message:s("fillRequired")},{trigger:["input"],validator(i,a){return a&&!Y.isEmail(a)?new Error(s("invalidEmail")):!0}}],password:[{required:!0,message:s("fillRequired")},{trigger:["input"],validator(i,a){return a&&["too-weak"].includes(Q(a,K).value)?new Error(s("passwordTooWeak")):!0}}],passwordConfirmation:[{required:!0,message:s("fillRequired")},{trigger:["input"],validator(i,a){return a&&a!==t.value.password?new Error(s("nonCompliantPassword")):!0}}]},q=async i=>{i.preventDefault(),b.value?.validate(async a=>{if(a)f.error(s("invalidForm"));else{g.value=!0,d.userData=null;const r=await k({url:"/auth/register",method:"post",data:{...t.value,preferences:D.value}});if(r.failure&&r.error)switch(r.error?.response?.data?.errorCode){case A.AUTH_MISSING_DATA:f.error(s("missingData"));break;case A.FORM_INVALID_DATA:E(r.error?.response?.data?.data);break;default:f.error(s("registrationNotSuccessful"))}else r.success&&r.result?(d.userData=r.result.data.user,d.accessToken=r.result.data.accessToken,d.accessTokenDate=J()):m.replace(p.LOGIN.PATH),t.value={lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""};g.value=!1}})},I="Creopse";be(()=>d.isUserConnected,i=>{i&&(x()&&w.initDefaultSettings(),m.replace(p.HOME.PATH))},{immediate:!0});const V=w.getSettingValue("disableInstaller","boolean");w.getSettingValue("allowRegistration","boolean")||m.replace(p.LOGIN.PATH);const H=_(!0);return(i,a)=>{const r=oe,c=te,C=ae,P=re,S=le,U=se,B=ee,y=$,G=L;return pe(),me(G,{"display-server-alerts":!e(V)},{default:l(()=>[o(y,{name:"slide-fade",appear:""},{default:l(()=>[u("div",ce,[u("div",_e,[u("div",fe,[o(y,{appear:""},{default:l(()=>[de(o(B,{size:"small",class:"w-full"},{default:l(()=>[u("div",we,[u("img",{src:e(T),class:"w-54",alt:e(I)},null,8,ge)]),o(U,{ref_key:"formRef",ref:b,model:e(t),rules:N,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:l(()=>[o(C,{"x-gap":"12",span:24},{default:l(()=>[o(c,{span:12,label:e(s)("lastname"),path:"lastname"},{default:l(()=>[o(r,{value:e(t).lastname,"onUpdate:value":a[0]||(a[0]=n=>e(t).lastname=n),placeholder:e(s)("lastname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),o(c,{span:12,label:e(s)("firstname_s"),path:"firstname"},{default:l(()=>[o(r,{value:e(t).firstname,"onUpdate:value":a[1]||(a[1]=n=>e(t).firstname=n),placeholder:e(s)("firstname_s"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(P,{label:e(s)("addressEmail"),path:"email"},{default:l(()=>[o(r,{value:e(t).email,"onUpdate:value":a[2]||(a[2]=n=>e(t).email=n),placeholder:e(s)("addressEmail"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),o(C,{"x-gap":"12",span:24},{default:l(()=>[o(c,{span:12,label:e(s)("password"),path:"password"},{default:l(()=>[o(r,{value:e(t).password,"onUpdate:value":a[3]||(a[3]=n=>e(t).password=n),placeholder:e(s)("password"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),o(c,{span:12,label:e(s)("confirmPassword"),path:"passwordConfirmation"},{default:l(()=>[o(r,{value:e(t).passwordConfirmation,"onUpdate:value":a[4]||(a[4]=n=>e(t).passwordConfirmation=n),placeholder:e(s)("confirmPassword"),disabled:!e(t).password,"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1}),o(S,{type:"primary",loading:e(g),disabled:!e(t).lastname||!e(t).firstname||!e(t).email||!e(t).password||!e(t).passwordConfirmation,block:"",onClick:q},{default:l(()=>[R(v(e(s)("validate")),1)]),_:1},8,["loading","disabled"]),u("div",ve,[o(S,{block:"",tertiary:"",type:"default",onClick:a[5]||(a[5]=n=>e(m).push(e(p).LOGIN.PATH))},{default:l(()=>[R(v(e(s)("alreadyHaveAccount"))+" "+v(e(s)("toLogin")),1)]),_:1})])]),_:1},8,["model"])]),_:1},512),[[ue,e(H)]])]),_:1})])])])]),_:1})]),_:1},8,["display-server-alerts"])}}});export{He as default};
