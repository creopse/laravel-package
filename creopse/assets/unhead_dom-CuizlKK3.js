import{d as M,h as k,H,c as _,a as x}from"./unhead_shared-C2Qklalk.js";async function T(n,p={}){const s=p.document||n.resolvedOptions.document;if(!s||!n.dirty)return;const l={shouldRender:!0,tags:[]};if(await n.hooks.callHook("dom:beforeRender",l),!!l.shouldRender)return n._domUpdatePromise||(n._domUpdatePromise=new Promise(async C=>{const h=(await n.resolveTags()).map(e=>({tag:e,id:H.has(e.tag)?k(e):e.tag,shouldRender:!0}));let i=n._dom;if(!i){i={elMap:{htmlAttrs:s.documentElement,bodyAttrs:s.body}};const e=new Set;for(const t of["body","head"]){const o=s[t]?.children;for(const d of o){const r=d.tagName.toLowerCase();if(!H.has(r))continue;const c={tag:r,props:await _(d.getAttributeNames().reduce((y,g)=>({...y,[g]:d.getAttribute(g)}),{})),innerHTML:d.innerHTML},u=x(c);let a=u,b=1;for(;a&&e.has(a);)a=`${u}:${b++}`;a&&(c._d=a,e.add(a)),i.elMap[d.getAttribute("data-hid")||k(c)]=d}}}i.pendingSideEffects={...i.sideEffects},i.sideEffects={};function m(e,t,o){const d=`${e}:${t}`;i.sideEffects[d]=o,delete i.pendingSideEffects[d]}function P({id:e,$el:t,tag:o}){const d=o.tag.endsWith("Attrs");if(i.elMap[e]=t,d||(o.textContent&&o.textContent!==t.textContent&&(t.textContent=o.textContent),o.innerHTML&&o.innerHTML!==t.innerHTML&&(t.innerHTML=o.innerHTML),m(e,"el",()=>{i.elMap[e]?.remove(),delete i.elMap[e]})),o._eventHandlers)for(const r in o._eventHandlers)Object.prototype.hasOwnProperty.call(o._eventHandlers,r)&&t.getAttribute(`data-${r}`)!==""&&((o.tag==="bodyAttrs"?s.defaultView:t).addEventListener(r.substring(2),o._eventHandlers[r].bind(t)),t.setAttribute(`data-${r}`,""));for(const r in o.props){if(!Object.prototype.hasOwnProperty.call(o.props,r))continue;const c=o.props[r],u=`attr:${r}`;if(r==="class"){if(!c)continue;for(const a of c.split(" "))d&&m(e,`${u}:${a}`,()=>t.classList.remove(a)),!t.classList.contains(a)&&t.classList.add(a)}else if(r==="style"){if(!c)continue;for(const a of c.split(";")){const b=a.indexOf(":"),y=a.substring(0,b).trim(),g=a.substring(b+1).trim();m(e,`${u}:${y}`,()=>{t.style.removeProperty(y)}),t.style.setProperty(y,g)}}else t.getAttribute(r)!==c&&t.setAttribute(r,c===!0?"":String(c)),d&&m(e,u,()=>t.removeAttribute(r))}}const v=[],f={bodyClose:void 0,bodyOpen:void 0,head:void 0};for(const e of h){const{tag:t,shouldRender:o,id:d}=e;if(o){if(t.tag==="title"){s.title=t.textContent;continue}e.$el=e.$el||i.elMap[d],e.$el?P(e):H.has(t.tag)&&v.push(e)}}for(const e of v){const t=e.tag.tagPosition||"head";e.$el=s.createElement(e.tag.tag),P(e),f[t]=f[t]||s.createDocumentFragment(),f[t].appendChild(e.$el)}for(const e of h)await n.hooks.callHook("dom:renderTag",e,s,m);f.head&&s.head.appendChild(f.head),f.bodyOpen&&s.body.insertBefore(f.bodyOpen,s.body.firstChild),f.bodyClose&&s.body.appendChild(f.bodyClose);for(const e in i.pendingSideEffects)i.pendingSideEffects[e]();n._dom=i,await n.hooks.callHook("dom:rendered",{renders:h}),C()}).finally(()=>{n._domUpdatePromise=void 0,n.dirty=!1})),n._domUpdatePromise}function w(n,p={}){const s=p.delayFn||(l=>setTimeout(l,10));return n._domDebouncedUpdatePromise=n._domDebouncedUpdatePromise||new Promise(l=>s(()=>T(n,p).then(()=>{delete n._domDebouncedUpdatePromise,l()})))}function L(n){return M(p=>{const s=p.resolvedOptions.document?.head.querySelector('script[id="unhead:payload"]')?.innerHTML||!1;return s&&p.push(JSON.parse(s)),{mode:"client",hooks:{"entries:updated":l=>{w(l,n)}}}})}export{L as D};
