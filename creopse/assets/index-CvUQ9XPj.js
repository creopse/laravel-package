import{i as I}from"./ckeditor_ckeditor5-vue-CmLqe3wy.js";import{I as xe}from"./iconify_vue-DXPEksg3.js";import{u as Ze,q as xn,r as En,s as Dn,t as Jn,_ as Vn,v as qn,c as Gn,w as Nn,d as Kn,x as Yn,y as Qn,z as Xn,R as Qt,A as Zn,B as ea,C as Xt}from"./main-DH7x7JSJ.js";import{t as Ft,q as Tn,l as Bn,v as ta,w as na,h as Pe,B as wt,f as On,_ as Wt,x as Pn,y as Ln,z as Jt,A as An,C as aa,D as qt,E as oa,F as zn,k as Rn,r as Mn,G as Un,H as sa,S as ia}from"./naive-ui-dfg6Ko-R.js";import{F as Ht,u as jn,_ as la,a as ra,b as ca}from"./page-h4g_pRdn.js";import{p as at,d as Zt,f as ua}from"./jsondiffpatch-6ukoYq90.js";import{_ as Y}from"./lodash-C_MgVQnG.js";import{v as Te}from"./uuid-8I8R7izr.js";import{u as Ue}from"./vue-i18n-B92nPylK.js";import{_ as $t}from"./fawmi_vue-google-maps-yyESU4s0.js";import{a as Hn,o as da,u as pa}from"./vue-router-DS5MTONl.js";import{b as va,c as ot}from"./vueuse_core-DKs1Kb2a.js";import{u as ga}from"./unhead_vue-ObhOJ4d0.js";function _a(){const h=Ft();return{confirm:i=>new Promise(t=>{h.warning({...i,onPositiveClick:()=>{t("positive")},onNegativeClick:()=>{t("negative")},onClose:()=>{t("close")}})}),info:i=>new Promise(t=>{h.info({...i,onPositiveClick:()=>{t("positive")},onNegativeClick:()=>{t("negative")},onClose:()=>{t("close")}})}),success:i=>new Promise(t=>{h.success({...i,onPositiveClick:()=>{t("positive")},onNegativeClick:()=>{t("negative")},onClose:()=>{t("close")}})}),warning:i=>new Promise(t=>{h.warning({...i,onPositiveClick:()=>{t("positive")},onNegativeClick:()=>{t("negative")},onClose:()=>{t("close")}})}),error:i=>new Promise(t=>{h.error({...i,onPositiveClick:()=>{t("positive")},onNegativeClick:()=>{t("negative")},onClose:()=>{t("close")}})})}}var be=(h=>(h.RELOAD="reload",h.RELOAD_COMPLETE="reload-complete",h.ENABLE_EDITION_MODE="enable-edition-mode",h.DESELECT_ALL_SECTIONS="deselect-all-sections",h.SELECT_PREVIEW_SECTION="select-preview-section",h.SELECT_SIDEBAR_SECTION="select-sidebar-section",h.SEND_BASE_SECTION_SETTINGS="send-base-section-settings",h.SEND_BASE_SECTION_DATA="send-base-section-data",h.SEND_SECTION_SETTINGS="send-section-settings",h.SEND_SECTION_DATA="send-section-data",h.SEND_PAGE_SECTIONS="send-page-sections",h))(be||{});const{defineStore:fa}=await I("pinia"),{ref:pe,computed:st}=await I("vue"),et=fa("visual-editor",()=>{const h=pe(!1),f=pe(!0),c=pe(!1),M=pe("desktop"),w=pe(null),m=pe(!1),i=pe({}),t=pe({}),n=pe({}),d=pe([]),S=pe(null),ne=pe(null),$=pe(!1),L=pe(!1),l=pe(!1),y=pe(!1),O=(e,a,u)=>`${e}+${a}+${u}`,Z=()=>{let e=!1,a=[];for(const u of d.value)(e||!S.value)&&a.push(u),u===S.value&&(e=!0);return a},ee=(e,a,u,_,x)=>{const p=O(e,a,u);x==="data"?i.value[p]={data:Y.cloneDeep(_??{}),date:new Date}:x==="settings"&&(t.value[p]={data:Y.cloneDeep(_??{}),date:new Date})},ie=(e,a,u,_,x,p,o,W)=>{const k=O(e,a,u),ae=`${k}|${Te()}`;let ge;const J=Z();try{if(o==="data"&&i.value[k]?.data){const de=Array.isArray(n.value[k])?n.value[k].filter(_e=>_e.type==="data"&&!J.includes(_e.id)).reduce((_e,je)=>at(_e,je.data),Y.cloneDeep(i.value[k].data)):Y.cloneDeep(i.value[k].data);ge=Zt(de,p)}else if(o==="settings"&&t.value[k]?.data){const de=Array.isArray(n.value[k])?n.value[k].filter(_e=>_e.type==="settings"&&!J.includes(_e.id)).reduce((_e,je)=>at(_e,je.data),Y.cloneDeep(t.value[k].data)):Y.cloneDeep(t.value[k].data);ge=Zt(de,p)}const Ee={id:ae,title:_,type:o,pivot:x,data:ge,validator:W,date:new Date};ge&&(Array.isArray(n.value[k])?(Object.keys(n.value).forEach(de=>{n.value[de]=n.value[de].filter(_e=>!J.includes(_e.id))}),n.value[k].push(Ee)):n.value[k]=[Ee],d.value=d.value.filter(de=>!J.includes(de)),d.value.push(ae),l.value=!0,S.value=ae)}catch{}},le=()=>{i.value={},t.value={},n.value={},d.value=[],S.value=null,ne.value=null,$.value=!1,L.value=!1,l.value=!1,y.value=!1},re=(e,a)=>{let u=!1,_=[];for(const o of d.value)o===e&&(u=!0),u&&_.push(o);let x,p;return Object.keys(n.value).forEach(o=>{n.value[o].find(W=>W.id===e)&&(x=o)}),x&&(p=n.value[x]?.filter(o=>o.type===a&&!_.includes(o.id))?.reduce((o,W)=>at(o,W.data),Y.cloneDeep((a==="data"?i.value[x]?.data:t.value[x]?.data)??{}))),p},ve=()=>{const e={};try{Object.keys(n.value).forEach(a=>{const u=_=>_.type==="data"&&!Z().includes(_.id);e[a]={data:n.value[a]?.filter(u)?.reduce((_,x)=>at(_,x.data),Y.cloneDeep(i.value[a]?.data??{})),pivot:n.value[a].length?n.value[a][0].pivot:null,hasChanges:Array.isArray(n.value[a])&&n.value[a].filter(u).length>0}})}catch{}return e},oe=(e,a,u)=>{const _=O(e,a,u);return ve()[_]},U=(e,a,u)=>{const _=O(e,a,u);return Array.isArray(n.value[_])&&n.value[_].filter(x=>x.type==="data").length>0},F=()=>{const e={};return Object.keys(n.value).forEach(a=>{const u=n.value[a].filter(_=>_.type==="data");e[a]=u.length>0?u[u.length-1].validator||(()=>Promise.resolve(!0)):()=>Promise.resolve(!0)}),e},T=()=>{const e={};try{Object.keys(n.value).forEach(a=>{const u=_=>_.type==="settings"&&!Z().includes(_.id);e[a]={data:n.value[a]?.filter(u)?.reduce((_,x)=>at(_,x.data),Y.cloneDeep(t.value[a]?.data??{})),pivot:n.value[a].length?n.value[a][0].pivot:null,hasChanges:Array.isArray(n.value[a])&&n.value[a].filter(u).length>0}})}catch{}return e},D=(e,a,u)=>{const _=O(e,a,u);return T()[_]},B=(e,a,u)=>{const _=O(e,a,u);return Array.isArray(n.value[_])&&n.value[_].filter(x=>x.type==="settings").length>0},b=()=>{const e={};return Object.keys(n.value).forEach(a=>{const u=n.value[a].filter(_=>_.type==="settings");e[a]=u.length>0?u[u.length-1].validator||(()=>Promise.resolve(!0)):()=>Promise.resolve(!0)}),e},j=st(()=>S.value?d.value.indexOf(S.value):-1),H=()=>{l.value=!1,S.value=d.value[j.value-1]||null},$e=()=>{l.value=!1,S.value=d.value[j.value+1]},ce=st(()=>j.value>=0),Be=st(()=>j.value<d.value.length-1),ke=st(()=>{const e=Object.values(n.value).flat();return d.value.map(a=>e.find(u=>u.id===a)).filter(a=>a!==void 0)}),me=e=>{l.value=!1,S.value=e};return{isOverlayMode:h,showLeftSidebar:f,showRightSidebar:c,currentDeviceType:M,selectedSection:w,showSectionData:m,versionItems:n,versionItemIds:d,versionItemsList:ke,currentVersionId:S,lastSavedVersionId:ne,addVersionBaseSnapshot:ee,addVersionItem:ie,getLastSnapshotFrom:re,getDataSnapshotBySections:ve,getSettingsSnapshotBySections:T,sectionHasDataDeltas:U,sectionHasSettingsDeltas:B,getSectionDataSnapshot:oe,getSectionSettingsSnapshot:D,getDataValidatorBySections:F,getSettingsValidatorBySections:b,resetVersions:le,getSectionId:O,currentVersionIndex:j,ignoreDataChangeEffects:$,ignoreSettingsChangeEffects:L,ignoreVersionChangeEffects:l,showVersionsHistory:y,undo:H,redo:$e,canUndo:ce,canRedo:Be,changeVersion:me,isVersionSelected:e=>st({get:()=>e===S.value,set:a=>{a&&me(e)}})}}),{unref:Et}=await I("vue"),{defineComponent:ma}=await I("vue"),{unref:v,resolveComponent:ha,createVNode:Q,withCtx:E,openBlock:X,createBlock:Se,createCommentVNode:it,toDisplayString:Ke,createTextVNode:Ye,renderList:Dt,Fragment:He,createElementBlock:Fe,normalizeClass:Sa,isRef:ya,createSlots:ba,vShow:en,createElementVNode:lt,withDirectives:tn,Transition:nn}=await I("vue"),ka={class:"mb-2 px-3 py-6"},wa={class:"mb-2"},$a={class:"flex items-center justify-start gap-1"},{storeToRefs:Ca}=await I("pinia"),{ref:We,inject:Ia,watch:an,reactive:gt,onMounted:xa}=await I("vue"),Ea=ma({__name:"Data",props:{page:{}},setup(h,{expose:f}){const c=h,{t:M}=Ue(),{editKeysToCamelCase:w,tr:m}=Ze(),i=et(),{selectedSection:t,showSectionData:n,currentVersionId:d,ignoreDataChangeEffects:S,ignoreVersionChangeEffects:ne}=Ca(i),{addVersionBaseSnapshot:$,getSectionDataSnapshot:L}=i,l=We({}),y=We({}),O=We(),Z=We(),ee=We("index"),ie=We(Te()),le=Ia("appConfig"),{data:re,isPending:ve}=xn({slug:t.value?.slug||"",linkId:t.value?.pivot?.dataSourceLinkId,pageId:t.value?.pivot?.dataSourcePageId});an(()=>re?.value,T=>{const D=L(t.value?.slug||"",t.value?.pivot?.linkId||"",c.page?.id||0)?.data;if(D&&!En(D)){l.value=D;return}const B=Y.cloneDeep(T),b=B?.pages?.length?B?.pages[0].pivot:null;B&&l&&b&&(Y.isObject(b?.data)&&Dn(b?.data)?l.value=gt(b?.data):l.value=gt({}),Y.forIn(w(B.dataStructure),(j,H)=>{(!l.value[H]||Array.isArray(l.value[H])&&l.value[H].length==0)&&(H==="index"?l.value[H]=gt({}):l.value[H]=gt([]))})),y&&l&&setTimeout(()=>{y.value=Y.cloneDeep(l.value),t.value?.slug&&t.value?.pivot?.linkId&&c.page?.id&&($(t.value?.slug,t.value?.pivot?.linkId,c.page?.id,y.value,"data"),oe?.contentWindow?.postMessage({type:be.SEND_BASE_SECTION_DATA,slug:t.value?.slug,linkId:t.value?.pivot?.linkId,pageId:c.page?.id,data:JSON.parse(JSON.stringify(y.value||{}))},le?.apiBaseUrl??"*"))},500),ie.value=Te()},{immediate:!0,deep:!0});let oe=null;xa(()=>{oe=document.getElementById("preview")}),an(()=>d.value,()=>{ne.value||t.value?.slug&&t.value?.pivot?.linkId&&c.page?.id&&(S.value=!0,l.value=L(t.value?.slug,t.value?.pivot?.linkId,c.page?.id)?.data,oe?.contentWindow?.postMessage({type:be.SEND_SECTION_DATA,slug:t.value?.slug,linkId:t.value?.pivot?.linkId,pageId:c.page?.id,data:JSON.parse(JSON.stringify(l.value||{}))},le?.apiBaseUrl??"*"),ie.value=Te())});const U=We(!1),F=()=>{U.value=!0,setTimeout(()=>{U.value=!1},3e3)};return f({data:l,initialData:y,formValueValidate1:O,formValueValidate2:Z}),(T,D)=>{const B=Bn,b=Tn,j=xe,H=Pe,$e=wt,ce=na,Be=ta,ke=On,me=Jt,C=An,e=Ln,a=Pn,u=Wt,_=ha("Draggable"),x=Vn;return v(ve)?(X(),Se(b,{key:0,align:"center",justify:"center",class:"min-h-[50vh]"},{default:E(()=>[Q(B)]),_:1})):(X(),Fe(He,{key:1},[Q(Be,{value:v(ee),"onUpdate:value":D[2]||(D[2]=p=>ya(ee)?ee.value=p:null),type:"card",size:"small",class:"data-tabs"},ba({prefix:E(()=>[Q($e,{secondary:"",size:"tiny",onClick:D[0]||(D[0]=()=>{n.value=!1}),class:"!h-full"},{icon:E(()=>[Q(H,null,{default:E(()=>[Q(j,{icon:"carbon:close"})]),_:1})]),_:1})]),default:E(()=>[v(w)(v(re)?.dataStructure)?(X(),Fe(He,{key:0},[v(w)(v(re)?.dataStructure).index?(X(),Se(ce,{key:0,name:"index"},{default:E(()=>[Q(H,{class:"mr-1"},{default:E(()=>[Q(j,{icon:"carbon:types"})]),_:1}),Ye(" "+Ke(v(M)("general")),1)]),_:1})):it("",!0),(X(!0),Fe(He,null,Dt(v(Jn)(v(w)(v(re)?.dataStructure),["index"]),(p,o)=>(X(),Se(ce,{key:o,name:String(o)},{default:E(()=>[Ye(Ke(v(m)(p.title)),1)]),_:2},1032,["name"]))),128))],64)):it("",!0)]),_:2},[v(ee)!=="index"?{name:"suffix",fn:E(()=>[Q($e,{secondary:"",size:"tiny",class:Sa(["!h-full",{"btn-blink":v(U)}]),onClick:D[1]||(D[1]=()=>{v(l)[v(ee)].push({}),ie.value=("uuidv4"in T?T.uuidv4:Et(Te))()})},{icon:E(()=>[Q(H,null,{default:E(()=>[Q(j,{icon:"carbon:add-alt"})]),_:1})]),_:1},8,["class"])]),key:"0"}:void 0]),1032,["value"]),Q(x,{appear:"",name:"slide-fade"},{default:E(()=>[lt("section",null,[(X(!0),Fe(He,null,Dt(v(w)(v(re)?.dataStructure)||{},(p,o)=>(X(),Fe(He,{key:o},[String(o)==="index"?(X(),Se(nn,{key:0,name:"slide-fade",mode:"out-in"},{default:E(()=>[tn(lt("div",ka,[v(w)(v(re)?.dataStructure).index?.length?(X(),Fe(He,{key:0},[v(l)&&v(l)[o]?(X(),Se(Ht,{key:`${v(ie)}-${o}-form-1`,modelValue:v(l)[o],"onUpdate:modelValue":W=>v(l)[o]=W,items:p,"form-size":"small","label-placement":"top",onUpdate:(W,k)=>{O.value=k}},null,8,["modelValue","onUpdate:modelValue","items","onUpdate"])):it("",!0)],64)):(X(),Se(ke,{key:1,type:"warning","show-icon":""},{default:E(()=>[Ye(Ke(v(M)("noFieldDefinedHere")),1)]),_:1}))],512),[[en,v(ee)==="index"]])]),_:2},1024)):(X(),Se(nn,{key:1,name:"slide-fade",mode:"out-in"},{default:E(()=>[tn(lt("div",wa,[v(l)&&v(l)[o]&&Array.isArray(v(l)[o])&&v(l)[o].length?(X(),Se(_,{key:0,list:v(l)[o],onChange:D[3]||(D[3]=W=>{ie.value=("uuidv4"in T?T.uuidv4:Et(Te))()}),class:"w-full"},{default:E(()=>[(X(!0),Fe(He,null,Dt(v(l)[o],(W,k)=>(X(),Se(u,{key:k,size:"small",class:"mb-2","content-class":"!px-3"},{default:E(()=>[Q(a,{"default-expanded-names":["1"],"display-directive":"show"},{"header-extra":E(({collapsed:ae})=>[Q(b,{align:"center",justify:"space-between"},{default:E(()=>[Q($e,{secondary:"",type:"error",size:"tiny",onClick:()=>{v(l)[o].splice(k,1),ie.value=("uuidv4"in T?T.uuidv4:Et(Te))()}},{icon:E(()=>[Q(H,null,{default:E(()=>[Q(j,{icon:"carbon:trash-can"})]),_:1})]),_:1},8,["onClick"]),Q(H,null,{default:E(()=>[ae?(X(),Se(j,{key:0,icon:"fa-solid:chevron-left"})):(X(),Se(j,{key:1,icon:"fa-solid:chevron-down"}))]),_:2},1024)]),_:2},1024)]),arrow:E(()=>[...D[5]||(D[5]=[lt("span",null,null,-1)])]),default:E(()=>[Q(e,{name:"1"},{header:E(({collapsed:ae})=>[lt("div",$a,[Q(H,{size:"14",class:"cursor-move"},{default:E(()=>[Q(j,{icon:"fa-solid:grip-lines"})]),_:1}),Q(me,{size:"small",type:"info"},{default:E(()=>[Ye(Ke(String(k+1)),1)]),_:2},1024),ae?(X(),Se(C,{key:0,"line-clamp":1,"expand-trigger":"click",class:"text-sm max-w-[90%]"},{default:E(()=>[Ye(Ke(v(qn)(v(l)[o][k],v(m),"")),1)]),_:2},1024)):it("",!0)])]),default:E(()=>[v(l)&&v(l)[o][k]?(X(),Se(Ht,{key:`${v(ie)}-${o}-${k}-form-2`,modelValue:v(l)[o][k],"onUpdate:modelValue":ae=>v(l)[o][k]=ae,items:p.items,"form-size":"small","label-placement":"top",onUpdate:(ae,ge)=>{Z.value=ge}},null,8,["modelValue","onUpdate:modelValue","items","onUpdate"])):it("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["list"])):(X(),Se(ke,{key:1,type:"info",class:"cursor-pointer","show-icon":"",onClick:D[4]||(D[4]=W=>F())},{default:E(()=>[Ye(Ke(v(M)("emptyCollectionInfoMessage")),1)]),_:1}))],512),[[en,v(ee)===String(o)]])]),_:2},1024))],64))),128))])]),_:1})],64))}}}),Da=$t(Ea,[["__scopeId","data-v-6ba9fc33"]]),{defineComponent:Va}=await I("vue"),{unref:r,openBlock:Ce,createBlock:on,createCommentVNode:sn,renderList:ln,Fragment:Vt,createElementBlock:Oe,resolveComponent:Na,createVNode:z,withModifiers:rn,withCtx:te,toDisplayString:rt,createTextVNode:_t,normalizeClass:ft,createElementVNode:Re,normalizeStyle:Ta}=await I("vue"),Ba={class:"p-2"},Oa={key:0},Pa={key:1},La={key:0},Aa=["onClick"],za={class:"flex items-center"},Ra={class:"absolute top-[-10px] right-[-10px] z-[10]"},Ma={class:"flex items-center justify-center cursor-pointer gap-2 text-sm"},Ua={key:1},ja={class:"text-center"},Ha={class:"mt-2"},{storeToRefs:Fa}=await I("pinia"),{inject:cn,useTemplateRef:un,computed:ct,h:Je,onMounted:dn}=await I("vue"),Wa=Va({__name:"LeftSidebar",setup(h,{expose:f}){const{t:c}=Ue(),{isSmScreen:M,isMdScreen:w,pickByTheme:m,appPrimaryColor:i}=Ze(),{showLeftSidebar:t,isOverlayMode:n,selectedSection:d,showSectionData:S}=Fa(et()),ne=cn("appConfig"),$=cn("currentPageSlug"),{page:L,isLoadingPage:l,pageSections:y,initialPageSections:O,pageSectionsEnabled:Z,initialPageSectionsEnabled:ee,getPageSectionTitle:ie,dataSourcePagesOptions:le,confirmUpdateDataSourcePage:re,submitRemoveSection:ve,submitDuplicateSection:oe,submitFillInFakeData:U}=jn($?.value||""),F=un("sectionData"),T=un("sectionActions"),D=ct(()=>Y.isEqual(F.value?.data,F.value?.initialData)&&Y.isEqual(y.value,O.value)&&Y.isEqual(Z.value,ee.value)),B=C=>()=>Je(Pe,null,{default:()=>Je(xe,{icon:C})}),b=C=>[{label:c("copyData"),key:"copy-data",icon:B("carbon:copy")},{label:c("fillInFakeData"),key:"fill-in-fake-data",icon:B("carbon:magic-wand")},{label:c("duplicateSection"),key:"duplicate-section",icon:B("carbon:partition-same")},{label:c("removeSection"),key:"remove-section",icon:B("carbon:close")},{key:"first-divider",type:"divider"},{key:"display-section",type:"render",render:()=>Je(Rn,{checked:Z.value[`${C.slug}__${C.pivot?.linkId}`],"onUpdate:checked":e=>{Z.value[`${C.slug}__${C.pivot?.linkId}`]=e},size:"small",class:"px-3 py-1",onClick:e=>e.stopPropagation()},{default:()=>Je("span",{class:"ml-1"},{default:()=>c("displaySection")})})},{key:"second-divider",type:"divider"},{key:"data-source",type:"render",render:()=>Je("div",{class:"px-3 py-1"},[Je("div",{class:"text-sm font-semibold mb-1"},c("dataSource")),Je(Mn,{value:`${C.pivot?.dataSourcePageId}__${C.pivot?.dataSourceLinkId}`,options:le(C.pages||[],C),placeholder:c("select"),labelField:"label",valueField:"value",filterable:!0,size:"small",class:"!w-[225px]","onUpdate:value":e=>re(C,e,D.value)})])}],j=(C,e)=>{switch(C){case"copy-data":T.value?.copyData(e);break;case"fill-in-fake-data":U(e);break;case"duplicate-section":oe(e);break;case"remove-section":ve(e);break}};let H=null;dn(()=>{setTimeout(()=>{d.value=null,S.value=!1},500),H=document.getElementById("preview")});const $e=C=>{C.slug==d.value?.slug&&C.pivot?.linkId==d.value?.pivot?.linkId?S.value=!0:(d.value=C,S.value=!1),H?.contentWindow?.postMessage({type:be.SELECT_SIDEBAR_SECTION,slug:C.slug,linkId:C.pivot?.linkId},ne?.apiBaseUrl??"*")};dn(()=>{window.addEventListener("message",C=>{if(C.data?.type===be.SELECT_PREVIEW_SECTION){const e=y.value.find(a=>a.slug==C.data?.slug&&a.pivot?.linkId==C.data?.linkId);e?.slug==d.value?.slug&&e?.pivot?.linkId==d.value?.pivot?.linkId?S.value=!0:(d.value=e,S.value=!1)}})});const ce=ct(()=>F.value?.data),Be=ct(()=>F.value?.initialData),ke=ct(()=>F.value?.formValueValidate1),me=ct(()=>F.value?.formValueValidate2);return f({sectionData:ce,initialSectionData:Be,formValueValidate1:ke,formValueValidate2:me,pageSections:y,initialPageSections:O,pageSectionsEnabled:Z,initialPageSectionsEnabled:ee,isEverythingUnchanged:D}),(C,e)=>{const a=aa,u=Jt,_=qt,x=An,p=oa,o=Wt,W=wt,k=Na("Draggable"),ae=zn,ge=Vn;return Ce(),Oe("aside",{class:ft(["sidebar-left absolute left-0 top-0 h-full z-30 w-74 bg-white dark:bg-[#18181b] border-r border-gray-200 dark:border-gray-800 overflow-y-auto transition-all duration-300 ease-in-out",{"translate-x-0":r(t),"-translate-x-full":!r(t),"shadow-xl":(r(n)||r(M)||r(w))&&r(t)}])},[r(d)&&r(S)?(Ce(),on(Da,{ref_key:"sectionData",ref:F,key:`${r(d)?.slug}-${r(d)?.pivot?.linkId}-data`,page:r(L)},null,8,["page"])):(Ce(),Oe(Vt,{key:1},[Re("div",Ba,[z(ge,{appear:"",name:"slide-fade"},{default:te(()=>[Re("section",null,[r(l)?(Ce(),Oe("section",Oa,[(Ce(),Oe(Vt,null,ln(7,J=>z(a,{key:J,width:"100%",height:"42px",sharp:!1,class:"mb-2"})),64))])):(Ce(),Oe("section",Pa,[r(L)&&Array.isArray(r(L).sections)&&r(L).sections.length?(Ce(),Oe("section",La,[z(k,{list:r(y)},{default:te(()=>[(Ce(!0),Oe(Vt,null,ln(r(y),(J,Ee)=>(Ce(),Oe("section",{key:J.id},[z(o,{hoverable:"",embedded:r(Z)[`${J.slug}__${J.pivot?.linkId}`],bordered:"",size:"small",class:"my-0.5",style:Ta(`${r(d)?.slug==J?.slug&&r(d)?.pivot?.linkId==J?.pivot?.linkId?"border: 1px solid "+r(i):""}`),"header-class":"!pr-2.5 !pl-2"},{header:te(()=>[Re("div",{class:"flex items-center justify-between cursor-pointer",onClick:de=>$e(J)},[Re("div",za,[z(r(Pe),{size:"14",class:"cursor-move mr-1",onClick:e[0]||(e[0]=rn(()=>{},["stop"]))},{default:te(()=>[z(r(xe),{icon:"fa-solid:grip-lines"})]),_:1}),z(u,{size:"tiny",type:"info"},{default:te(()=>[_t(rt(Ee+1),1)]),_:2},1024),z(_,{vertical:"",class:ft(r(m)("!bg-zinc-400","!bg-slate-500"))},null,8,["class"]),z(x,{"line-clamp":1,class:"text-sm"},{default:te(()=>[_t(rt(r(ie)(J)),1)]),_:2},1024)]),z(p,{size:"small",trigger:"click",options:b(J),onSelect:de=>j(de,J)},{default:te(()=>[z(r(Pe),{class:"cursor-pointer px-1",onClick:e[1]||(e[1]=rn(()=>{},["stop"]))},{default:te(()=>[z(r(xe),{icon:"carbon:overflow-menu-vertical"})]),_:1})]),_:1},8,["options","onSelect"])],8,Aa)]),_:2},1032,["embedded","style"]),Ee<r(y).length-1?(Ce(),Oe("div",{key:0,class:ft(`relative border-dashed border-y-2 h-1.5  ${r(m)("!border-zinc-300","!border-zinc-600")}`)},[Re("div",Ra,[z(W,{size:"tiny",type:"info",title:r(c)("insertSections"),onClick:de=>r(T)?.openInsertSectionsDialog(Ee+1)},{icon:te(()=>[z(r(Pe),null,{default:te(()=>[z(r(xe),{icon:"carbon:insert-page"})]),_:1})]),_:1},8,["title","onClick"])])],2)):sn("",!0)]))),128))]),_:1},8,["list"]),z(o,{size:"small",class:"mb-2 !border-dashed !border-2",onClick:e[2]||(e[2]=J=>r(T)?.openToggleSectionsDialog())},{default:te(()=>[Re("div",Ma,[z(r(Pe),{size:"16"},{default:te(()=>[z(r(xe),{icon:"carbon:row"})]),_:1}),_t(" "+rt(r(c)("insertOrRemoveSections")),1)])]),_:1})])):(Ce(),Oe("section",Ua,[z(o,{size:"small",class:ft(`mb-2 !border-dashed !border-2 ${r(m)("!border-zinc-300","!border-zinc-600")}`)},{default:te(()=>[z(ae,null,{icon:te(()=>[z(r(Pe),null,{default:te(()=>[z(r(xe),{icon:"carbon:page-break"})]),_:1})]),extra:te(()=>[Re("div",Ha,[z(W,{size:"small",secondary:"",onClick:e[3]||(e[3]=J=>r(T)?.openToggleSectionsDialog())},{icon:te(()=>[z(r(Pe),null,{default:te(()=>[z(r(xe),{icon:"carbon:row"})]),_:1})]),default:te(()=>[_t(" "+rt(r(c)("insertSections")),1)]),_:1})])]),default:te(()=>[Re("p",ja,rt(r(c)("noSectionOnThisPage")),1)]),_:1})]),_:1},8,["class"])]))]))])]),_:1})]),r($)?(Ce(),on(la,{key:0,ref_key:"sectionActions",ref:T,page:r(L),slug:r($),"page-sections":r(y)},null,8,["page","slug","page-sections"])):sn("",!0)],64))],2)}}}),Ja=$t(Wa,[["__scopeId","data-v-b9ded999"]]),{defineComponent:qa}=await I("vue"),{unref:Nt,normalizeStyle:Ga,openBlock:pn,createElementBlock:vn,createCommentVNode:Ka,renderSlot:Ya}=await I("vue"),{ref:gn,onUnmounted:Qa}=await I("vue"),Xa={class:"relative"},Za=qa({__name:"ProgressBarWrapper",props:{color:{default:"blue"}},setup(h,{expose:f}){const c=h,M=gn(!1),w=gn(0);let m;const i=()=>{M.value=!0,w.value=0;const d=[{until:30,step:10,interval:100},{until:60,step:5,interval:200},{until:80,step:2,interval:300},{until:95,step:.5,interval:500}];let S=0;const ne=()=>{const $=d[S];w.value<$.until?w.value=Math.min(w.value+$.step,$.until):S<d.length-1&&(S++,window.clearInterval(m),m=window.setInterval(ne,d[S].interval))};m=window.setInterval(ne,d[0].interval)},t=()=>{m&&(clearInterval(m),m=void 0),w.value=100,setTimeout(()=>{M.value=!1,w.value=0},300)},n=()=>{m&&(clearInterval(m),m=void 0),M.value=!1,w.value=0};return Qa(()=>{m&&clearInterval(m)}),f({start:i,complete:t,reset:n}),(d,S)=>(pn(),vn("div",Xa,[Nt(M)?(pn(),vn("div",{key:0,class:"absolute top-0 left-0 h-0.5 z-50 transition-all ease-out",style:Ga({width:Nt(w)+"%",transitionDuration:Nt(w)>=95?"0s":"500ms",backgroundColor:c.color})},null,4)):Ka("",!0),Ya(d.$slots,"default")]))}}),Fn=()=>{const{t:h}=Ue();return{deviceOptions:[{type:"desktop",name:h("desktop"),icon:"carbon:screen",width:1440,height:"auto"},{type:"laptop",name:h("laptop"),icon:"carbon:laptop",width:1024,height:"auto"},{type:"tablet",name:h("tablet"),icon:"carbon:tablet",width:768,height:"auto"},{type:"mobile",name:h("mobile"),icon:"carbon:mobile",width:375,height:667}]}},{defineComponent:eo}=await I("vue"),{unref:s,toDisplayString:ye,createElementVNode:K,resolveComponent:xs,createVNode:N,withCtx:V,normalizeClass:to,withModifiers:_n,openBlock:qe,createElementBlock:mt,createTextVNode:Tt,normalizeStyle:Bt,renderList:no,Fragment:ao,createBlock:Ot,isRef:oo,createSlots:so}=await I("vue"),io={class:"text-sm text-gray-700 dark:text-gray-400"},lo={class:"flex items-center gap-x-2"},ro=["src"],co={key:1,class:"w-full h-full flex items-center justify-center"},uo={class:"mb-8 mt-2"},po={class:"flex items-center justify-between"},vo={class:"text-base flex items-center gap-2"},go={class:"text-xs font-semibold mt-1"},_o={class:"text-sm"},fo={class:"text-xs font-normal"},mo=["innerHTML"],ho={class:"flex items-center justify-between"},So={class:"text-base font-semibold"},{storeToRefs:fn}=await I("pinia"),{inject:Qe,computed:Pt,onMounted:mn,ref:yo,useTemplateRef:bo,onUnmounted:ko}=await I("vue"),wo=eo({__name:"Preview",setup(h,{expose:f}){const{t:c,locale:M}=Ue(),{deviceOptions:w}=Fn(),{tr:m,isSmScreen:i,isMdScreen:t,appPrimaryColor:n}=Ze(),d=Hn(),{accessToken:S}=fn(Gn()),ne=et(),{undo:$,redo:L,changeVersion:l,isVersionSelected:y,getLastSnapshotFrom:O}=ne,{isOverlayMode:Z,showLeftSidebar:ee,showRightSidebar:ie,showVersionsHistory:le,currentDeviceType:re,selectedSection:ve,showSectionData:oe,versionItemsList:U,canUndo:F,canRedo:T}=fn(ne),D=Qe("pages"),B=Qe("appConfig"),b=Qe("headerHeight"),j=Qe("footerHeight"),H=Qe("windowHeight"),$e=Qe("everythingIsSaved"),ce=Pt(()=>w.find(p=>p.type===re.value)),Be=Pt(()=>`${B?.apiBaseUrl}/editor-page/s/${d.query.page}?token=${S.value}`),ke=Pt(()=>!b||!j||!H?0:H.value-(b.value+j.value+100));let me=null;mn(()=>{me=document.getElementById("preview"),me?.addEventListener("load",function(){me?.contentWindow?.postMessage({type:be.ENABLE_EDITION_MODE,primaryColor:n.value},B?.apiBaseUrl??"*")})});const C=()=>{me?.contentWindow?.postMessage({type:be.DESELECT_ALL_SECTIONS},B?.apiBaseUrl??"*"),ve.value=null,oe.value=!1},e=yo(!1),a=bo("progressBar");let u=null;const _=()=>{const p=document.querySelector(".restart-icon");if(p){const o=()=>{e.value=!1,a.value?.complete(),u=null};p.addEventListener("animationiteration",o,{once:!0}),u=()=>{p.removeEventListener("animationiteration",o)}}else e.value=!1,a.value?.complete()},x=()=>{me?.contentWindow?.postMessage({type:be.RELOAD},B?.apiBaseUrl??"*"),e.value=!0,a.value?.start(),setTimeout(()=>{_()},15e3)};return mn(()=>{window.addEventListener("message",p=>{p.data?.type===be.RELOAD_COMPLETE&&_()})}),ko(()=>{u&&u()}),f({deselectAllSections:C,reloadPreview:x}),(p,o)=>{const W=xe,k=Pe,ae=wt,ge=Un,J=On,Ee=Za,de=Jt,_e=qt,je=Ln,Ct=Pn,pt=Rn,vt=Wt,tt=ia,It=zn,xt=sa;return qe(),mt("main",{class:"flex-1 w-full h-full overflow-auto bg-gray-100 dark:bg-[#09090b] flex items-center justify-center px-2 transition-all duration-300 ease-in-out",style:Bt({marginLeft:!s(Z)&&!(s(i)||s(t))&&s(ee)?"278px":"0px",marginRight:!s(Z)&&!(s(i)||s(t))&&s(ie)?"270px":"0px"})},[K("div",{class:"bg-white dark:bg-[#18181b] rounded-xl shadow-md overflow-hidden transition-all duration-300",style:Bt({width:s(ce)?.width+"px",maxWidth:"100%"})},[N(Ee,{color:s(n),ref_key:"progressBar",ref:a},{default:V(()=>[K("div",{class:"border-b border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-[#18181b] py-2 px-4 flex items-center justify-between",onClick:o[1]||(o[1]=_n(()=>{},["stop"]))},[K("span",io,ye(s(ce)?.name)+" ("+ye(s(ce)?.width)+"px) ",1),K("div",lo,[N(ge,{trigger:"hover"},{trigger:V(()=>[N(ae,{secondary:"",onClick:o[0]||(o[0]=q=>le.value=!0)},{icon:V(()=>[N(k,null,{default:V(()=>[N(W,{icon:"carbon:recently-viewed"})]),_:1})]),_:1})]),default:V(()=>[K("span",null,ye(s(c)("history")),1)]),_:1}),N(ge,{trigger:"hover"},{trigger:V(()=>[N(ae,{secondary:"",disabled:!s(F),onClick:s($)},{icon:V(()=>[N(k,null,{default:V(()=>[N(W,{icon:"carbon:undo"})]),_:1})]),_:1},8,["disabled","onClick"])]),default:V(()=>[K("span",null,ye(s(c)("undo")),1)]),_:1}),N(ge,{trigger:"hover"},{trigger:V(()=>[N(ae,{secondary:"",disabled:!s(T),onClick:s(L)},{icon:V(()=>[N(k,null,{default:V(()=>[N(W,{icon:"carbon:redo"})]),_:1})]),_:1},8,["disabled","onClick"])]),default:V(()=>[K("span",null,ye(s(c)("redo")),1)]),_:1}),o[6]||(o[6]=K("div",{class:"w-px h-6 bg-gray-300 dark:bg-gray-700 mx-1"},null,-1)),N(ge,{trigger:"hover"},{trigger:V(()=>[N(ae,{secondary:"",disabled:!s($e),onClick:x},{icon:V(()=>[N(k,null,{default:V(()=>[N(W,{icon:"carbon:restart",class:to(["restart-icon",{spin:s(e)}])},null,8,["class"])]),_:1})]),_:1},8,["disabled"])]),default:V(()=>[K("span",null,ye(s(c)("refresh")),1)]),_:1})])]),K("div",{class:"p-2 min-h-[580px] editor-container",style:Bt(`height: ${s(ce)?.height=="auto"||s(ce)?.height&&s(ce)?.height>s(ke)?s(ke):s(ce)?.height}px`)},[s(d).query.page&&s(D)?.find(q=>q.slug==s(d).query.page)?(qe(),mt("iframe",{key:0,id:"preview",frameborder:"0",src:s(Be),class:"w-full h-full"},null,8,ro)):(qe(),mt("div",co,[N(J,{type:"warning","show-icon":""},{default:V(()=>[Tt(ye(s(c)("noPreviewAvailable")),1)]),_:1})]))],4)]),_:1},8,["color"])],4),N(xt,{show:s(le),"onUpdate:show":o[5]||(o[5]=q=>oo(le)?le.value=q:null),preset:"card",style:{width:"600px"},bordered:!1,"show-icon":!1,"mask-closable":!1,title:s(c)("history")},so({default:V(()=>[K("section",uo,[s(U)?.length?(qe(),Ot(tt,{key:0,style:{"max-height":"400px"}},{default:V(()=>[(qe(!0),mt(ao,null,no(s(U).reverse(),(q,Ge)=>(qe(),Ot(vt,{key:q.id,hoverable:"",embedded:"",size:"small",class:"mb-2 cursor-pointer",onClick:nt=>s(l)(q.id)},{default:V(()=>[K("div",po,[K("div",null,[K("div",vo,[N(de,{size:"tiny",type:"primary"},{default:V(()=>[Tt(ye(s(U)?.length-Ge),1)]),_:2},1024),Tt(" "+ye(`${q.type=="data"?s(c)("changeOfDataFrom"):s(c)("changeOfSettingsFrom")} "${s(m)(q.title)}"`),1)]),K("div",go,ye(s(Nn)(q.date,{locale:s(M),outPattern:"DD MMMM - HH:mm:ss"})),1),N(_e,{class:"!my-2"}),N(Ct,{"arrow-placement":"right"},{default:V(()=>[N(je,{name:"1",onClick:o[2]||(o[2]=_n(()=>{},["stop"]))},{header:V(()=>[K("span",_o,ye(s(c)("details")),1)]),default:V(()=>[K("section",null,[K("div",fo,ye(q.id),1),K("div",{innerHTML:ua(q.data,s(O)(q.id,q.type))},null,8,mo)])]),_:2},1024)]),_:2},1024)]),N(pt,{checked:s(y)(q.id).value,"onUpdate:checked":nt=>s(y)(q.id).value=nt,size:"medium"},null,8,["checked","onUpdate:checked"])])]),_:2},1032,["onClick"]))),128)),N(vt,{hoverable:"",embedded:"",size:"small",class:"cursor-pointer",onClick:o[4]||(o[4]=q=>s(l)(null))},{default:V(()=>[K("div",ho,[K("div",So,ye(s(c)("startOfChanges")),1),N(pt,{checked:s(y)(null).value,"onUpdate:checked":o[3]||(o[3]=q=>s(y)(null).value=q),size:"medium"},null,8,["checked"])])]),_:1})]),_:1})):(qe(),Ot(It,{key:1,description:s(c)("noActionTaken"),class:"my-10"},{icon:V(()=>[N(k,null,{default:V(()=>[N(W,{icon:"carbon:row"})]),_:1})]),_:1},8,["description"]))])]),_:2},[s(U).length?{name:"footer",fn:V(()=>[K("div",null,ye(`${s(U).length} ${s(U).length==1?s(c)("action").toLowerCase():s(c)("actions").toLowerCase()}`),1)]),key:"0"}:void 0]),1032,["show","title"])],4)}}}),$o=$t(wo,[["__scopeId","data-v-93f0b576"]]),{defineComponent:Co}=await I("vue"),{unref:De,resolveComponent:Es,createVNode:Lt,withCtx:hn,openBlock:Xe,createBlock:Sn,createCommentVNode:Io,renderList:xo,Fragment:Eo,createElementBlock:ht,toDisplayString:yn,createElementVNode:bn}=await I("vue"),Do={key:1},Vo={class:"font-bold"},No={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400 flex flex-col items-center"},{storeToRefs:To}=await I("pinia"),{ref:St,inject:kn,watch:wn,reactive:At,onMounted:Bo}=await I("vue"),Oo=Co({__name:"Settings",setup(h,{expose:f}){const{t:c}=Ue(),{tr:M,editKeysToCamelCase:w}=Ze(),m=et(),{selectedSection:i,currentVersionId:t,ignoreSettingsChangeEffects:n,ignoreVersionChangeEffects:d}=To(m),{addVersionBaseSnapshot:S,getSectionSettingsSnapshot:ne}=m,$=St({}),L=St({}),l=St(),y=St(Te()),O=kn("page"),Z=kn("appConfig"),{data:ee,isPending:ie}=xn({slug:i.value?.slug||"",linkId:i.value?.pivot?.dataSourceLinkId,pageId:i.value?.pivot?.dataSourcePageId});wn(()=>ee?.value,re=>{const ve=ne(i.value?.slug||"",i.value?.pivot?.linkId||"",O?.value?.id||0)?.data;if(ve&&!En(ve)){$.value=ve;return}const oe=Y.cloneDeep(re),U=oe?.pages?.length?oe?.pages[0].pivot:null;oe&&$&&(Y.isObject(U?.settings)&&Dn(U?.settings)?$.value=At(U?.settings):$.value=At({}),Y.forIn(w(oe.settingsStructure),(F,T)=>{$.value[T]||($.value[T]=At({}))})),L&&$&&setTimeout(()=>{L.value=Y.cloneDeep($.value),i.value?.slug&&i.value?.pivot?.linkId&&O?.value?.id&&(S(i.value?.slug,i.value?.pivot?.linkId,O?.value?.id,L.value,"settings"),le?.contentWindow?.postMessage({type:be.SEND_BASE_SECTION_SETTINGS,slug:i.value?.slug,linkId:i.value?.pivot?.linkId,pageId:O?.value?.id,settings:JSON.parse(JSON.stringify(L.value||{}))},Z?.apiBaseUrl??"*"))},500),y.value=Te()},{immediate:!0,deep:!0});let le=null;return Bo(()=>{le=document.getElementById("preview")}),wn(()=>t.value,()=>{d.value||i.value?.slug&&i.value?.pivot?.linkId&&O?.value?.id&&(n.value=!0,$.value=ne(i.value?.slug,i.value?.pivot?.linkId,O?.value?.id)?.data,le?.contentWindow?.postMessage({type:be.SEND_SECTION_SETTINGS,slug:i.value?.slug,linkId:i.value?.pivot?.linkId,pageId:O?.value?.id,settings:JSON.parse(JSON.stringify($.value||{}))},Z?.apiBaseUrl??"*"),y.value=Te())}),f({settings:$,initialSettings:L,formValueValidate:l}),(re,ve)=>{const oe=Bn,U=Tn,F=qt,T=xe;return De(ie)?(Xe(),Sn(U,{key:0,align:"center",justify:"center",class:"min-h-[50vh]"},{default:hn(()=>[Lt(oe)]),_:1})):(Xe(),ht("div",Do,[De(ee)?.settingsStructure?(Xe(!0),ht(Eo,{key:0},xo(De(w)(De(ee)?.settingsStructure),(D,B)=>(Xe(),ht("section",{key:B},[Lt(F,{"title-placement":"right",class:"!my-1"},{default:hn(()=>[bn("span",Vo,yn(De(M)(D.title)),1)]),_:2},1024),De($)&&De($)[B]?(Xe(),Sn(Ht,{key:`${De(y)}-${B}-settings-form`,modelValue:De($)[B],"onUpdate:modelValue":b=>De($)[B]=b,items:D.items,"form-size":"small","label-placement":"top",onUpdate:(b,j)=>{l.value=j}},null,8,["modelValue","onUpdate:modelValue","items","onUpdate"])):Io("",!0)]))),128)):(Xe(),ht("div",No,[Lt(T,{icon:"carbon:settings-adjust",class:"text-3xl mb-2"}),bn("p",null,yn(De(c)("noSettingsDefinedForThisSection")),1)]))]))}}}),{defineComponent:Po}=await I("vue"),{unref:Ve,toDisplayString:$n,createElementVNode:zt,openBlock:Rt,createBlock:Lo,resolveComponent:Ds,createVNode:Ao,createElementBlock:Cn,normalizeClass:zo}=await I("vue"),Ro={class:"p-4"},Mo={class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"},Uo={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400 flex flex-col items-center"},{storeToRefs:jo}=await I("pinia"),{useTemplateRef:Ho,computed:Mt}=await I("vue"),Fo=Po({__name:"RightSidebar",setup(h,{expose:f}){const{t:c}=Ue(),{isSmScreen:M,isMdScreen:w}=Ze(),{showRightSidebar:m,isOverlayMode:i,selectedSection:t}=jo(et()),n=Ho("sectionSettings"),d=Mt(()=>n.value?.settings),S=Mt(()=>n.value?.initialSettings),ne=Mt(()=>n.value?.formValueValidate);return f({sectionSettings:d,initialSectionSettings:S,formValueValidate:ne}),($,L)=>{const l=xe;return Rt(),Cn("aside",{class:zo(["sidebar-right absolute right-0 top-0 h-full z-30 w-72 bg-white dark:bg-[#18181b] border-l border-gray-200 dark:border-gray-800 overflow-y-auto transition-all duration-300 ease-in-out",{"translate-x-0":Ve(m),"translate-x-full":!Ve(m),"shadow-xl":(Ve(i)||Ve(M)||Ve(w))&&Ve(m)}])},[zt("div",Ro,[zt("h2",Mo,$n(Ve(c)("settings")),1),Ve(t)?(Rt(),Lo(Oo,{ref_key:"sectionSettings",ref:n,key:`${Ve(t)?.slug}-${Ve(t)?.pivot?.linkId}-settings`})):(Rt(),Cn("div",Uo,[Ao(l,{icon:"carbon:cursor-1",class:"text-3xl mb-2"}),zt("p",null,$n(Ve(c)("selectSectionToEditItsProperties")),1)]))])],2)}}}),Wo=$t(Fo,[["__scopeId","data-v-fc6d5938"]]),{onMounted:Jo,onBeforeUnmount:qo}=await I("vue"),Go=h=>{const{t:f}=Ue(),c=Ft(),M=()=>new Promise(m=>{let i=!1;const t=n=>{i||(i=!0,m(n))};c.warning({title:f("unsavedChanges"),content:f("unsavedChangesWarningMessage"),positiveText:f("leave"),negativeText:f("cancel"),onPositiveClick:()=>t(!0),onNegativeClick:()=>t(!1),onClose:()=>t(!1)})});da(async(m,i,t)=>{if(!h())return t();await M()?t():t(!1)});const w=m=>{h()&&(m.preventDefault(),m.returnValue="")};Jo(()=>{window.addEventListener("beforeunload",w)}),qo(()=>{window.removeEventListener("beforeunload",w)})},{defineComponent:Ko}=await I("vue"),{resolveComponent:Vs,createVNode:R,withCtx:P,unref:g,toDisplayString:we,createElementVNode:se,openBlock:Ne,createElementBlock:Me,createCommentVNode:ut,createBlock:Ut,renderList:Yo,Fragment:yt,createTextVNode:bt,withModifiers:kt}=await I("vue"),Qo={class:"flex items-center"},Xo={class:"layout-topbar-logo ml-2"},Zo=["src","alt"],es={key:0,class:"ml-2 text-base font-bold"},ts={class:"flex items-center gap-x-2"},ns={class:"flex items-center gap-x-2"},as={class:"flex flex-1 overflow-hidden relative main-container"},os={class:"font-medium"},ss={key:0},is={class:"font-medium"},ls={key:1},{inject:rs,computed:In,useTemplateRef:dt,ref:cs,h:us,onMounted:ds,watch:jt,provide:Ie}=await I("vue"),{storeToRefs:ps}=await I("pinia"),Ns=Ko({__name:"index",setup(h){const{t:f,locale:c}=Ue(),{warning:M}=_a(),{deviceOptions:w}=Fn(),{getSettingValue:m}=Kn(),{tr:i,icon:t,isSmScreen:n,isMdScreen:d}=Ze(),S=Hn(),ne=pa(),$=Ft(),L=rs("appConfig"),l=In(()=>S.query.page||""),{page:y}=jn(l?.value||""),{data:O}=Yn(),{data:Z}=Qn(),{data:ee,isPending:ie}=Xn(),{mutate:le,isPending:re}=ra(),{mutate:ve,isPending:oe}=ca(),U=et(),{isOverlayMode:F,showLeftSidebar:T,showRightSidebar:D,currentDeviceType:B,selectedSection:b,currentVersionId:j,lastSavedVersionId:H,ignoreDataChangeEffects:$e,ignoreSettingsChangeEffects:ce}=ps(U),{addVersionItem:Be,resetVersions:ke,getDataSnapshotBySections:me,getDataValidatorBySections:C,getSettingsSnapshotBySections:e,getSettingsValidatorBySections:a}=U,u=dt("header"),_=dt("footer"),x=dt("preview"),p=dt("leftSidebar"),o=dt("rightSidebar"),{height:W}=va(),{height:k}=ot(u),{height:ae}=ot(_),{width:ge}=ot(x),{width:J}=ot(p),{width:Ee}=ot(o),de=cs(Te()),_e=()=>{T.value=!T.value},je=()=>{D.value=!D.value},Ct=()=>{x.value&&x.value.deselectAllSections()},pt=G=>{if(G==l.value)return;const A=`${Zn(ea())}/${(m("basePath")||"creopse")+Qt.VISUAL_EDITOR.PATH}`;Xt(A,{page:G},{target:"_self",method:"GET"})},vt=G=>us("span",{},{default:()=>i(G.title)}),tt=In(()=>j.value==H.value&&Y.isEqual(p.value?.pageSections,p.value?.initialPageSections)&&Y.isEqual(p.value?.pageSectionsEnabled,p.value?.initialPageSectionsEnabled)),It=async()=>{const G=me(),A=C(),he=e(),Ae=a(),ze=[...new Set([...Object.keys(G),...Object.keys(he)])];for(const ue of ze){const Le=G[ue],fe=he[ue];if(Le.hasChanges||fe.hasChanges){const Kt=await A[ue](),Wn=await Ae[ue](),Yt=async()=>{ve({slug:ue.split("+")[0],dataSourceLinkId:Le.pivot?Le.pivot?.dataSourceLinkId:fe.pivot?fe.pivot?.dataSourceLinkId:null,dataSourcePageId:Le.pivot?Le.pivot?.dataSourcePageId:fe.pivot?fe.pivot?.dataSourcePageId:null,...Le&&{data:Le.data},...fe&&{settings:fe.data},hideSuccessMessage:!0})};Kt&&Wn?await Yt():await M({title:f("confirm"),content:f("mandatoryFieldsNotFilledInConfirmation"),positiveText:f("yes"),negativeText:f("cancel")})=="positive"&&await Yt()}}le({slug:l.value,sectionsOrder:p.value?.pageSections?.map(ue=>`${ue.slug}__${ue.pivot?.linkId}`),sectionsDisabled:Object.keys(p.value?.pageSectionsEnabled).filter(ue=>!p.value?.pageSectionsEnabled[ue]),hideSuccessMessage:!1}),ke()},xt=()=>{const G=ee.value?.find(A=>A.pageId==y.value?.id);if(G){const A=`${L?.apiBaseUrl}${G.path}`;Xt(A,{},{target:"_blank",method:"GET"})}else $.warning({title:f("previewUnavailable"),content:f("publishThisPage"),positiveText:f("ok")})},q="Creopse";ga({title:()=>(i(S?.meta?.title)?i(S?.meta?.title)+" - ":"")+q}),Go(()=>!tt.value);let Ge=null;ds(()=>{setTimeout(()=>{ke()},500),Ge=document.getElementById("preview")}),jt(()=>[p.value?.pageSections,p.value?.pageSectionsEnabled],([G,A])=>{Ge?.contentWindow?.postMessage({type:be.SEND_PAGE_SECTIONS,sectionsList:JSON.parse(JSON.stringify(G)),sectionsOrder:JSON.parse(JSON.stringify(G?.map(he=>`${he.slug}__${he.pivot?.linkId}`))),sectionsDisabled:JSON.parse(JSON.stringify(Object.keys(A).filter(he=>!A[he])))},L?.apiBaseUrl??"*")},{deep:!0});let nt;jt(()=>p.value?.sectionData,G=>{G&&(clearTimeout(nt),nt=setTimeout(()=>{if(b.value?.slug&&b.value?.pivot?.linkId&&y.value?.id){if($e.value){$e.value=!1;return}Be(b.value?.slug,b.value?.pivot?.linkId,y.value?.id,b.value?.title,b.value?.pivot,G,"data",async()=>await p.value?.formValueValidate1?.()&&await p.value?.formValueValidate2?.()),Ge?.contentWindow?.postMessage({type:be.SEND_SECTION_DATA,slug:b.value?.slug,linkId:b.value?.pivot?.linkId,pageId:y.value?.id,data:JSON.parse(JSON.stringify(G||{}))},L?.apiBaseUrl??"*")}},432))},{deep:!0});let Gt;return jt(()=>o.value?.sectionSettings,G=>{G&&(clearTimeout(Gt),Gt=setTimeout(()=>{if(b.value?.slug&&b.value?.pivot?.linkId&&y.value?.id){if(ce.value){ce.value=!1;return}Be(b.value?.slug,b.value?.pivot?.linkId,y.value?.id,b.value?.title,b.value?.pivot,G,"settings",async()=>await o.value?.formValueValidate?.()),Ge?.contentWindow?.postMessage({type:be.SEND_SECTION_SETTINGS,slug:b.value?.slug,linkId:b.value?.pivot?.linkId,pageId:y.value?.id,settings:JSON.parse(JSON.stringify(G||{}))},L?.apiBaseUrl??"*")}},432))},{deep:!0}),Ie("page",y),Ie("pages",O),Ie("sections",Z),Ie("currentPageSlug",l),Ie("headerHeight",k),Ie("footerHeight",ae),Ie("windowHeight",W),Ie("previewWidth",ge),Ie("leftSidebarWidth",J),Ie("rightSidebarWidth",Ee),Ie("globalRefreshKey",de),Ie("everythingIsSaved",tt),(G,A)=>{const he=xe,Ae=Pe,ze=wt,ue=Un,Le=Mn;return Ne(),Me("div",{class:"h-screen flex flex-col overflow-hidden bg-[#f1f5f9] dark:bg-[#09090b]",onClick:Ct},[se("header",{ref_key:"header",ref:u,class:"bg-white dark:bg-[#18181b] border-b border-gray-200 dark:border-gray-800 px-4 py-2 flex items-center justify-between z-20 relative",onClick:A[2]||(A[2]=kt(()=>{},["stop"]))},[se("div",Qo,[R(ue,{trigger:"hover"},{trigger:P(()=>[R(ze,{secondary:"",onClick:_e},{icon:P(()=>[R(Ae,{size:"24"},{default:P(()=>[R(he,{icon:"carbon:menu"})]),_:1})]),_:1})]),default:P(()=>[se("span",null,we(g(f)("details")),1)]),_:1}),se("div",Xo,[se("img",{class:"cursor-pointer h-12",src:g(t),alt:g(q),onClick:A[0]||(A[0]=fe=>g(ne).push(g(Qt).DASHBOARD.PATH))},null,8,Zo)]),g(n)?ut("",!0):(Ne(),Me("div",es,we(g(f)("visualEditor")),1))]),se("div",ts,[g(n)||g(d)?ut("",!0):(Ne(),Ut(Le,{key:0,value:g(l),options:g(O),"render-label":vt,"label-field":"title","value-field":"slug",size:"medium",filterable:"","onUpdate:value":pt},null,8,["value","options"])),(Ne(!0),Me(yt,null,Yo(g(w),fe=>(Ne(),Ut(ue,{key:fe.type,trigger:"hover"},{trigger:P(()=>[R(ze,{onClick:Kt=>B.value=fe.type,secondary:"",type:g(B)===fe.type?"primary":"default"},{icon:P(()=>[R(Ae,null,{default:P(()=>[R(he,{icon:fe.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["onClick","type"])]),default:P(()=>[se("span",null,we(fe.name),1)]),_:2},1024))),128))]),se("div",ns,[g(n)||g(d)?ut("",!0):(Ne(),Me(yt,{key:0},[R(ue,{trigger:"hover"},{trigger:P(()=>[R(ze,{secondary:"",onClick:A[1]||(A[1]=fe=>F.value=!g(F)),type:g(F)?"primary":"default"},{icon:P(()=>[R(Ae,null,{default:P(()=>[R(he,{icon:g(F)?"carbon:layers":"carbon:panel-expansion"},null,8,["icon"])]),_:1})]),_:1},8,["type"])]),default:P(()=>[se("span",null,we(g(F)?g(f)("overlayMode"):g(f)("dockedMode")),1)]),_:1}),A[6]||(A[6]=se("div",{class:"w-px h-6 bg-gray-300 dark:bg-gray-700 mx-1"},null,-1))],64)),R(ue,{trigger:"hover",disabled:!g(n)},{trigger:P(()=>[R(ze,{secondary:"",type:"success",disabled:g(tt),loading:g(re)||g(oe),onClick:It},{icon:P(()=>[R(Ae,null,{default:P(()=>[R(he,{icon:"carbon:save-annotation"})]),_:1})]),default:P(()=>[g(n)?ut("",!0):(Ne(),Me(yt,{key:0},[bt(we(g(f)("publish")),1)],64))]),_:1},8,["disabled","loading"])]),default:P(()=>[se("span",null,we(g(f)("publish")),1)]),_:1},8,["disabled"]),R(ue,{trigger:"hover",disabled:!g(n)},{trigger:P(()=>[R(ze,{secondary:"",type:"info",disabled:g(ie),onClick:xt},{icon:P(()=>[R(Ae,null,{default:P(()=>[R(he,{icon:"carbon:launch"})]),_:1})]),default:P(()=>[g(n)?ut("",!0):(Ne(),Me(yt,{key:0},[bt(we(g(f)("preview")),1)],64))]),_:1},8,["disabled"])]),default:P(()=>[se("span",null,we(g(f)("preview")),1)]),_:1},8,["disabled"]),R(ue,{trigger:"hover"},{trigger:P(()=>[R(ze,{secondary:"",type:"primary",onClick:je},{icon:P(()=>[R(Ae,null,{default:P(()=>[R(he,{icon:"carbon:settings"})]),_:1})]),_:1})]),default:P(()=>[se("span",null,we(g(f)("settings")),1)]),_:1})])],512),se("div",as,[R(Ja,{ref_key:"leftSidebar",ref:p,onClick:A[3]||(A[3]=kt(()=>{},["stop"]))},null,512),R($o,{ref_key:"preview",ref:x},null,512),(Ne(),Ut(Wo,{key:`${g(b)?.slug}-${g(b)?.pivot?.linkId}-sidebar-right`,ref_key:"rightSidebar",ref:o,onClick:A[4]||(A[4]=kt(()=>{},["stop"]))}))]),se("footer",{ref_key:"footer",ref:_,class:"bg-white dark:bg-[#18181b] border-t border-gray-200 dark:border-gray-800 px-4 py-2 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 z-20 relative",onClick:A[5]||(A[5]=kt(()=>{},["stop"]))},[se("div",null,[se("span",os,we(g(p)?.pageSections?.length??"0"),1),bt(" "+we(g(f)("sectionsOnPage")),1)]),g(y)?.updatedAt?(Ne(),Me("div",ss,[bt(we(g(f)("lastBackup"))+": ",1),se("span",is,we(g(Nn)(g(y).updatedAt,{locale:g(c),inPattern:"YYYY-MM-DD HH:mm:ss",outPattern:"DD MMMM YYYY - HH:mm"})),1)])):(Ne(),Me("div",ls))],512)])}}});export{Ns as default};
