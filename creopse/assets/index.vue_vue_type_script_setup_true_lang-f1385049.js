import{c as zt,b as Tt}from"./vueuse_core-d5cd9503.js";import{u as nt,k as at,r as Je,l as Et,m as At,n as st,o as Dt,_ as Ot,e as Lt,c as Ft}from"./index-916f1e45.js";import{d as fe,p as Le,w as Re,aH as Bt,o as s,P as $,aO as l,r as Oe,Q as w,a as d,u as Vt,b as ot,y as it,z as Nt,i as Fe,c as _,Y as n,l as R,F as pe,ar as Pe,h as Pt,ag as Ze,s as Rt,aF as et}from"./vue_runtime-core-273b5003.js";import{a4 as ut,a as ct,b as je,c as jt,N as He,_ as Ge,M as Ht,j as Gt,E as dt,a5 as rt,a8 as Yt,a9 as qt,L as _t,ab as Wt,W as Kt,g as pt,R as Qt,I as Xt,ac as Jt,a1 as Zt,P as ft,a2 as el,ad as tl,ai as ll,V as nl,ar as al,O as sl,X as ol,ae as il,af as ul,ao as cl,al as dl}from"./naive-ui-ab0dda7d.js";import{r as m,u as e,c as q}from"./vue_reactivity-852d8377.js";import{n as tt,t as c}from"./vue_shared-7dcc3b7f.js";import{u as rl,M as r,_ as _l,a as pl}from"./media-library-9c1c0b4a.js";import{I as Ye}from"./iconify_vue-46af0b81.js";import{v as De}from"./uuid-cf522c50.js";import{u as Be}from"./vue-i18n-0da1582b.js";import{_ as lt}from"./validator-c0254ba9.js";import{b as fl}from"./axios-96fb5abd.js";const ml=fe({__name:"NFullscreenModal",props:{modelValue:{type:Boolean},maskClosable:{type:Boolean,default:!1},closeOnEsc:{type:Boolean,default:!0},segmented:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},bordered:{type:Boolean,default:!1},title:{default:""},onClose:{type:Function,default:void 0}},emits:["update:modelValue","onSizeChange"],setup(Q,{emit:p}){const t=Q,h=p,{width:a,height:D}=zt(),v=Le({get(){return t.modelValue},set(U){h("update:modelValue",U)}}),M=m(0),I=()=>{const U=document.querySelector(".fullscreen-modal-header");if(!U)return;const E=window.getComputedStyle(U);M.value=parseFloat(E.height),h("onSizeChange",{windowWidth:a.value,windowHeight:D.value,headerHeight:M.value,contentHeight:D.value-M.value})};Re(()=>t.modelValue,U=>{U&&Vt(()=>I())}),Re(()=>[a.value,D.value],()=>I());const y=Bt(),T=Le(()=>!!y.header||!!y["header-extra"]),{pickByTheme:j}=nt();return(U,E)=>{const F=ut;return s(),$(F,{show:e(v),"onUpdate:show":E[0]||(E[0]=X=>q(v)?v.value=X:null),preset:"card",closable:t.closable,segmented:t.segmented,bordered:t.bordered,"mask-closable":t.maskClosable,"close-on-esc":t.closeOnEsc,title:t.title,style:tt(`width: ${e(a)}px; min-height: ${e(D)}px`),"header-style":`background-color: ${e(j)("white","rgba(24, 24, 28, 1)")}`,"header-class":`fullscreen-modal-header ${e(T)?"fixed top-0 w-full z-50":""} `,"content-class":"!p-0 fullscreen-modal-content",onClose:U.onClose},{header:l(()=>[e(y).header?Oe(U.$slots,"header",{key:0}):w("",!0)]),"header-extra":l(()=>[e(y)["header-extra"]?Oe(U.$slots,"header-extra",{key:0}):w("",!0)]),default:l(()=>[d("section",{style:tt(`margin-top: ${e(T)?e(M):"0"}px`)},[Oe(U.$slots,"default")],4)]),_:3},8,["show","closable","segmented","bordered","mask-closable","close-on-esc","title","style","header-style","header-class","onClose"])}}}),mt=fe({__name:"MountedTeleport",props:{to:{}},setup(Q){const p=Q,t=m(!1);return ot(()=>{t.value=!0}),it(()=>{t.value=!1}),(h,a)=>e(t)?(s(),$(Nt,{key:0,to:p.to},[Oe(h.$slots,"default")],8,["to"])):w("",!0)}}),Ve=Symbol(),vl={class:"px-10"},yl={key:0,class:"flex items-center gap-3"},gl={key:1,class:"flex items-center gap-3"},hl={class:"flex justify-between items-center"},bl={class:"flex items-center gap-3"},kl={key:0},wl={key:0},xl={key:0},$l={class:"flex items-center justify-center h-[200px] relative"},Ml={class:"text-center text-dimgray text-sm"},Cl={class:"flex items-center gap-2"},Il={class:"flex items-center gap-2"},Ul={key:1,class:"flex items-center justify-center"},Sl={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},zl=["src"],Tl={id:"video",autoplay:"",controls:"",style:{width:"100%"}},El=["src"],Al={class:"w-[30%]"},Dl={key:0},Ol={key:1},Ll={key:2},Fl={key:3},Bl={key:4},Vl={key:0},Nl={key:1},Pl={key:2},Rl={key:3},jl={key:4},Hl={key:5},Gl={key:6},Yl=fe({__name:"MediaLibrary",emits:["validate"],setup(Q,{emit:p}){const t=Fe(Ve),h=p,{t:a,locale:D}=Be(),{request:v}=Lt(),{getVideoThumbnail:M}=nt(),I=ct(),y=je(),T=jt(),{mediaFileTypes:j}=rl(),U=m(De()),E=m(!1),F=m(!1),X=m(0),Z=m(""),ve=m(null),W=m([]),g=m({[r.DOCUMENT]:0,[r.IMAGE]:0,[r.VIDEO]:0,[r.AUDIO]:0,[r.OTHER]:0}),f=m(!1),O=m([]),H=Le(()=>j.filter(i=>i.value==r.DOCUMENT&&(t==null?void 0:t.displayDocuments)||i.value==r.IMAGE&&(t==null?void 0:t.displayImages)||i.value==r.VIDEO&&(t==null?void 0:t.displayVideos)||i.value==r.AUDIO&&(t==null?void 0:t.displayAudios)||i.value==r.OTHER&&(t==null?void 0:t.displayOtherTypes))),B=m([]),K=m(j.length===H.value.length?0:H.value[0].value),A=i=>{let u=`${i}&query=${Z.value}&type=${K.value}`;for(const k of B.value)u+=`&months[]=${k}`;return u},ee=i=>Pt("span",{},{default:()=>Je(i.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:D.value})}),G=m(0),L=m(12),N=m(1),ye=i=>{b(A(`/media-files?pageSize=${L.value}&page=${i}`))},se=i=>{L.value=i,b(A(`/media-files?pageSize=${L.value}`))},b=async(i=null,u=!1)=>{var z,Y,de,ze,Te;F.value=!0,I.start();const k=await v({url:i||A(`/media-files?pageSize=${L.value}`)});if(k.success&&k.result&&(W.value=((z=k.result.data)==null?void 0:z.mediaFiles)||[],G.value=((de=(Y=k.result.data)==null?void 0:Y.meta)==null?void 0:de.total)||0,N.value=((Te=(ze=k.result.data)==null?void 0:ze.meta)==null?void 0:Te.currentPage)||1),u){const ne=await v({url:"/media-files/list/months"});ne.success&&ne.result&&(O.value=(ne.result.data||[]).map(ae=>({label:ae,value:ae})));const me=await v({url:"/count/media-files"});me.success&&me.result&&(X.value=me.result.data);const ge=await v({url:`/count/media-files/type/${r.IMAGE}`});ge.success&&ge.result&&(g.value[r.IMAGE]=ge.result.data);const re=await v({url:`/count/media-files/type/${r.VIDEO}`});re.success&&re.result&&(g.value[r.VIDEO]=re.result.data);const he=await v({url:`/count/media-files/type/${r.AUDIO}`});he.success&&he.result&&(g.value[r.AUDIO]=he.result.data);const be=await v({url:`/count/media-files/type/${r.OTHER}`});be.success&&be.result&&(g.value[r.OTHER]=be.result.data);const ke=await v({url:`/count/media-files/type/${r.DOCUMENT}`});if(ke.success&&ke.result&&(g.value[r.DOCUMENT]=ke.result.data),t!=null&&t.preselectedMediaList&&Array.isArray(t==null?void 0:t.preselectedMediaList)){const ae=await v({url:"/media-files/list",method:"post",data:{ids:t==null?void 0:t.preselectedMediaList}});if(ae.success&&ae.result){V.value=ae.result.data,P.value={};for(const Ee of V.value)Ee.id&&(P.value[Ee.id]=!0)}}}let C=!0;W.value.length===0&&(C=!1);for(const ne of W.value)if(ne.id&&!P.value[ne.id]){C=!1;break}f.value=C,U.value=De(),I.finish(),F.value=!1};b(null,!0);const te=async i=>{T.warning({title:a("confirm"),content:a("confirmDeleteMediaFile"),positiveText:a("yes"),negativeText:a("no"),onPositiveClick:async()=>{(await v({method:"delete",url:`/media-files/${i.id}`})).success?(y.success(a("success")),b(A(`/media-files?pageSize=${L.value}&page=${N.value}`),!0)):y.error(a("anErrorOccurred"))}})},{copy:xe,copied:$e,isSupported:Me}=Tt(),Ce=async i=>{i.url&&xe(i.url)};Re(()=>$e.value,i=>{i&&y.success(a("mediaLinkCopied"))});const le=m(null),oe=m(!1),ie=m(!1),Ie=async i=>{switch(le.value=i,i.type){case r.IMAGE:break;case r.VIDEO:ie.value=!0;break;case r.AUDIO:oe.value=!0;break;case r.DOCUMENT:window.open(i.url);break;default:y.info(a("cannotOpenThisFile"));break}},x=m(null),Ue=m(!1),vt=async i=>{x.value=i,Ue.value=!0},Ne=m(null),ue=m(null),ce=m(!1),yt=async i=>{ue.value=i,I.start();const u=await v({url:"/file/download",method:"post",data:{path:i.path},responseType:"blob"});u.success&&u.result&&(Ne.value=await Et(u.result)),I.finish(),ce.value=!0},gt=async(i,u)=>{var k=At(u);k=await st(k,{maxSizeMB:1});const C=new FormData;C.append("file",k),T.warning({title:a("registration"),content:a("confirmReplaceCurrentFile"),positiveText:a("yes"),negativeText:a("no"),onPositiveClick:async()=>{var Y,de;E.value=!0,I.start(),ue.value&&C.append("filename",(Y=ue.value)==null?void 0:Y.name);const z=await v({url:`/media-files/replace/${(de=ue.value)==null?void 0:de.id}`,method:"post",data:C});z.success&&z.result?(ce.value=!1,b(A(`/media-files?pageSize=${L.value}&page=${N.value}`),!0)):y.error(a("anErrorOccurred")),I.finish(),E.value=!1},onNegativeClick:async()=>{var Y;E.value=!0,I.start(),ue.value&&C.append("filename",Dt(6)+"-"+((Y=ue.value)==null?void 0:Y.name));const z=await v({url:"/media-files/upload",method:"post",data:C});z.success&&z.result?(ce.value=!1,b(A(`/media-files?pageSize=${L.value}&page=${N.value}`),!0)):y.error(a("anErrorOccurred")),I.finish(),E.value=!1}})},P=m({}),V=m([]),Se=Le(()=>{let i=0;for(const u in P.value)P.value[u]&&i++;return i}),ht=i=>{const u=!(t!=null&&t.selectionMultiple),k=(t==null?void 0:t.selectionMultiple)&&!(t!=null&&t.selectionLimit),C=(t==null?void 0:t.selectionMultiple)&&(t==null?void 0:t.selectionLimit)&&V.value.length<(t==null?void 0:t.selectionLimit),z=(t==null?void 0:t.selectionMultiple)&&(t==null?void 0:t.selectionLimit)&&i.id&&P.value[i.id];return u||k||z||C},bt=()=>{let i=V.value;(t==null?void 0:t.selectionType)=="url"?i=V.value.map(u=>u.url):(t==null?void 0:t.selectionType)=="path"&&(i=V.value.map(u=>u.path)),h("validate",t!=null&&t.selectionMultiple?i:i[0])},kt=()=>{P.value={},V.value=[],b(A(`/media-files?pageSize=${L.value}&page=${N.value}`))},wt=async()=>(Se.value?T.warning({title:a("confirm"),content:a("deleteSelectionWarningMessage",[Se.value]),positiveText:a("yes"),negativeText:a("no"),onPositiveClick:async()=>{E.value=!0,I.start();for(const i in P.value)P.value[i]&&await v({url:`/media-files/${i}`,method:"delete"});I.finish(),E.value=!1,y.success(a("success")),P.value={},V.value=[],b(null,!0)}}):y.warning(a("noItemSelected")),!1);return(i,u)=>{var We,Ke,Qe,Xe;const k=Ye,C=He,z=Ge,Y=Ht,de=Gt,ze=dt,Te=rt,ne=mt,me=Yt,ge=qt,re=_t,he=Wt,be=_l,ke=Kt,ae=pt,Ee=Ot,xt=Qt,$t=Xt,Mt=Jt,Ct=Zt,It=ft,Ut=el,Ae=ut,qe=tl,St=pl;return s(),_(pe,null,[d("section",vl,[n(ne,{to:"#actions"},{default:l(()=>[e(Se)>0?(s(),_("section",yl,[d("span",null,c(e(a)("nbItemsSelected",[e(Se)])),1),n(z,{type:"success",size:"small",onClick:bt},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:checkmark"})]),_:1})]),default:l(()=>[R(" "+c(e(a)("validateSelection")),1)]),_:1}),n(z,{type:"error",size:"small",onClick:wt},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:trash-can"})]),_:1})]),default:l(()=>[R(" "+c(e(a)("deleteSelection")),1)]),_:1}),n(z,{type:"warning",size:"small",onClick:kt},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:close"})]),_:1})]),default:l(()=>[R(" "+c(e(a)("cancelSelection")),1)]),_:1})])):(s(),_("section",gl,[n(de,{value:e(B),"onUpdate:value":[u[1]||(u[1]=o=>q(B)?B.value=o:null),u[2]||(u[2]=o=>b())],"render-label":ee,options:e(O),placeholder:e(a)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:l(()=>[n(Y,{size:"large",class:"w-full","default-checked":e(O).length&&e(B).length===e(O).length,"onUpdate:checked":u[0]||(u[0]=o=>{o?B.value=e(O).map(J=>J.value):B.value=[],b()})},{default:l(()=>[R(c(e(a)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),n(Te,{class:"!w-[250px]"},{default:l(()=>[n(ze,{ref_key:"searchInputRef",ref:ve,value:e(Z),"onUpdate:value":[u[3]||(u[3]=o=>q(Z)?Z.value=o:null),u[4]||(u[4]=o=>{o||b(A(`/media-files?pageSize=${e(L)}&page=${e(N)}`))})],clearable:!0,placeholder:e(a)("search")},null,8,["value","placeholder"]),n(z,{type:"primary",onClick:u[5]||(u[5]=o=>b(A(`/media-files?pageSize=${e(L)}&page=${e(N)}`)))},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})]))]),_:1}),n(re,{size:"small",class:"mb-5"},{default:l(()=>{var o,J;return[d("div",hl,[d("div",bl,[(o=e(t))!=null&&o.selectionMultiple&&!((J=e(t))!=null&&J.selectionLimit)?(s(),$(Y,{key:0,checked:e(f),"onUpdate:checked":[u[6]||(u[6]=S=>q(f)?f.value=S:null),u[7]||(u[7]=S=>{for(const _e of e(W))_e.id&&(e(P)[_e.id]=S,e(V).findIndex(we=>we.id==_e.id)===-1&&e(V).push(_e));U.value=("uuidv4"in i?i.uuidv4:e(De))()})]},{default:l(()=>[R(c(e(a)("selectAll")),1)]),_:1},8,["checked"])):w("",!0)]),n(ge,{value:e(K),"onUpdate:value":[u[8]||(u[8]=S=>q(K)?K.value=S:null),u[9]||(u[9]=S=>b())],name:"filtertyperadiobuttongroup",size:"medium"},{default:l(()=>[e(j).length===e(H).length?(s(),$(me,{key:0,value:0},{default:l(()=>[R(c(e(a)("all"))+"  ",1),e(X)?(s(),_("span",kl," ("+c(e(X))+") ",1)):w("",!0)]),_:1})):w("",!0),(s(!0),_(pe,null,Pe(e(H),S=>(s(),$(me,{key:S.value,value:S.value},{default:l(()=>[R(c(S.label)+"  ",1),e(g)[S.value]?(s(),_("span",wl," ("+c(e(g)[S.value])+") ",1)):w("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]}),_:1}),n(re,{embedded:"",class:"py-2"},{default:l(()=>[e(W).length&&!e(F)?(s(),_("section",xl,[n(Mt,{"show-toolbar-tooltip":""},{default:l(()=>[n($t,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:4 900:4 1400:6"},{default:l(()=>[(s(!0),_(pe,null,Pe(e(W),(o,J)=>(s(),$(xt,{key:J},{default:l(()=>[n(Ee,{name:"slide-fade",appear:""},{default:l(()=>[n(re,{bordered:"",hoverable:""},{cover:l(()=>[d("div",$l,[o.type==e(r).IMAGE?(s(),_(pe,{key:0},[o.url?(s(),$(he,{key:0,src:o.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):w("",!0)],64)):o.type==e(r).VIDEO?(s(),_(pe,{key:1},[o.url?(s(),$(be,{key:0,load:()=>e(M)(o.url??""),class:"w-full h-[200px] object-cover",size:"large"},{fallback:l(()=>[n(C,{size:"96"},{default:l(()=>[n(k,{icon:"carbon:document-video"})]),_:1})]),_:2},1032,["load"])):w("",!0)],64)):o.type==e(r).AUDIO?(s(),$(C,{key:2,size:"96"},{default:l(()=>[n(k,{icon:"carbon:document-audio"})]),_:1})):o.type==e(r).DOCUMENT?(s(),$(C,{key:3,size:"96"},{default:l(()=>[n(k,{icon:"carbon:document"})]),_:1})):(s(),$(C,{key:4,size:"96"},{default:l(()=>[n(k,{icon:"carbon:document-unknown"})]),_:1}))])]),header:l(()=>[d("div",Ml,[n(ke,{"line-clamp":1},{default:l(()=>[o.id?(s(),_(pe,{key:0},[ht(o)?(s(),$(Y,{key:e(U),checked:e(P)[o.id],"onUpdate:checked":[S=>e(P)[o.id]=S,S=>{var _e;(_e=e(t))!=null&&_e.selectionMultiple?S?e(V).findIndex(we=>we.id==o.id)===-1&&e(V).push(o):V.value=e(V).filter(we=>we.id!=o.id):o&&o.id&&(V.value=[o],P.value={[o.id]:S}),U.value=("uuidv4"in i?i.uuidv4:e(De))()}],class:"mr-1"},null,8,["checked","onUpdate:checked"])):w("",!0)],64)):w("",!0),R(" "+c(o.name),1)]),_:2},1024)])]),action:l(()=>[n(ae,{justify:"space-between",align:"center"},{default:l(()=>[d("div",Cl,[o.type!=e(r).IMAGE?(s(),$(z,{key:0,ternary:"",circle:"",title:e(a)("preview"),onClick:S=>Ie(o)},{icon:l(()=>[n(C,null,{default:l(()=>[[e(r).AUDIO,e(r).VIDEO].includes(o.type)?(s(),$(k,{key:0,icon:"carbon:play-filled-alt"})):(s(),$(k,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):w("",!0),n(z,{ternary:"",circle:"",title:e(a)("details"),onClick:S=>vt(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:information-filled"})]),_:1})]),_:2},1032,["title","onClick"])]),d("div",Il,[e(Me)?(s(),$(z,{key:0,ternary:"",circle:"",title:e(a)("copy"),onClick:S=>Ce(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:copy"})]),_:1})]),_:2},1032,["title","onClick"])):w("",!0),o.type==e(r).IMAGE?(s(),$(z,{key:1,ternary:"",circle:"",title:e(a)("edit"),onClick:S=>yt(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:edit"})]),_:1})]),_:2},1032,["title","onClick"])):w("",!0),n(z,{ternary:"",circle:"",title:e(a)("delete"),onClick:S=>te(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(k,{icon:"carbon:trash-can"})]),_:1})]),_:2},1032,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n(Ct,{page:e(N),"onUpdate:page":[u[10]||(u[10]=o=>q(N)?N.value=o:null),ye],class:"mt-10 justify-center","show-size-picker":"","page-size":e(L),"page-sizes":[8,12,24,36,48,60],"page-count":Math.ceil(e(G)/e(L)),"onUpdate:pageSize":se},null,8,["page","page-size","page-count"])])):e(F)?(s(),_("section",Ul,[n(It,{size:"medium"})])):(s(),$(Ut,{key:2,description:e(a)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),n(Ae,{show:e(oe),"onUpdate:show":u[11]||(u[11]=o=>q(oe)?oe.value=o:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(We=e(le))==null?void 0:We.name},{default:l(()=>{var o;return[d("audio",Sl,[d("source",{src:(o=e(le))==null?void 0:o.url},null,8,zl)])]}),_:1},8,["show","title"]),n(Ae,{show:e(ie),"onUpdate:show":u[12]||(u[12]=o=>q(ie)?ie.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(Ke=e(le))==null?void 0:Ke.name},{default:l(()=>{var o;return[d("video",Tl,[d("source",{src:(o=e(le))==null?void 0:o.url},null,8,El)])]}),_:1},8,["show","title"]),n(Ae,{show:e(Ue),"onUpdate:show":u[13]||(u[13]=o=>q(Ue)?Ue.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(Qe=e(x))==null?void 0:Qe.name},{default:l(()=>[e(x)?(s(),$(qe,{key:0,striped:"","single-line":!1,size:"small"},{default:l(()=>[d("tbody",null,[d("tr",null,[d("td",Al,c(e(a)("name")),1),d("td",null,c(e(x).name),1)]),d("tr",null,[d("td",null,c(e(a)("link")),1),d("td",null,[d("small",null,c(e(x).url),1)])]),d("tr",null,[d("td",null,c(e(a)("type")),1),d("td",null,[e(x).type==e(r).IMAGE?(s(),_("span",Dl,c(e(a)("image")),1)):e(x).type==e(r).VIDEO?(s(),_("span",Ol,c(e(a)("video")),1)):e(x).type==e(r).AUDIO?(s(),_("span",Ll,c(e(a)("audio")),1)):e(x).type==e(r).DOCUMENT?(s(),_("span",Fl,c(e(a)("document")),1)):(s(),_("span",Bl,c(e(a)("other")),1))])]),e(x).size?(s(),_("tr",Vl,[d("td",null,c(e(a)("size")),1),d("td",null,c(e(at)(e(x).size,!0)),1)])):w("",!0),e(x).mimeType?(s(),_("tr",Nl,[d("td",null,c(e(a)("mimeType")),1),d("td",null,c(e(x).mimeType),1)])):w("",!0),e(x).sender?(s(),_("tr",Pl,[d("td",null,c(e(a)("sendBy")),1),d("td",null,c(e(x).sender.fullname),1)])):w("",!0),e(x).title?(s(),_("tr",Rl,[d("td",null,c(e(a)("title")),1),d("td",null,c(e(x).title),1)])):w("",!0),e(x).description?(s(),_("tr",jl,[d("td",null,c(e(a)("description")),1),d("td",null,[d("small",null,c(e(x).description),1)])])):w("",!0),e(x).createdAt?(s(),_("tr",Hl,[d("td",null,c(e(a)("date")),1),d("td",null,c(e(Je)(e(x).createdAt)),1)])):w("",!0),e(x).additionalMetadata?(s(),_("tr",Gl,[d("td",null,c(e(a)("metadata")),1),d("td",null,[n(qe,{striped:"","single-line":"",size:"small"},{default:l(()=>[d("tbody",null,[(s(!0),_(pe,null,Pe(e(x).additionalMetadata||[],(o,J)=>(s(),_("tr",{key:J},[d("td",null,c(J),1),d("td",null,c(o),1)]))),128))])]),_:1})])])):w("",!0)])]),_:1})):w("",!0)]),_:1},8,["show","title"]),n(Ae,{show:e(ce),"onUpdate:show":u[15]||(u[15]=o=>q(ce)?ce.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(Xe=e(ue))==null?void 0:Xe.name},{default:l(()=>[n(St,{"cropper-ratio":void 0,"round-preview":!1,src:e(Ne)?e(Ne):void 0,onCancel:u[14]||(u[14]=o=>ce.value=!1),onSave:gt},null,8,["src"])]),_:1},8,["show","title"])],64)}}}),ql={class:"px-10"},Wl={key:0},Kl={key:0,class:"text-end"},Ql=fe({__name:"AddFromAnUrl",emits:["validate"],setup(Q,{emit:p}){const{t}=Be(),h=je(),a=Fe(Ve),D=p,v=m(""),M=m([]);return(I,y)=>{const T=ll,j=nl,U=Ye,E=He,F=Ge,X=al,Z=dt,ve=rt,W=_t;return s(),_("section",ql,[n(W,null,{default:l(()=>{var g;return[(g=e(a))!=null&&g.selectionMultiple?(s(),_("section",Wl,[n(T,{value:e(M),"onUpdate:value":y[0]||(y[0]=f=>q(M)?M.value=f:null),placeholder:e(t)("fileUrl"),min:1,max:e(a).selectionLimit||void 0},null,8,["value","placeholder","max"]),e(M).length>0?(s(),_("div",Kl,[n(j),n(F,{type:"primary",disabled:e(M).length!=e(M).filter(f=>f.trim()).length,onClick:y[1]||(y[1]=()=>{const f=e(M).map(O=>encodeURI(O));f.findIndex(O=>!("_v"in I?I._v:e(lt)).isURL(O))>-1?e(h).error(e(t)("invalidUrl")):D("validate",f),D("validate",e(M))})},{icon:l(()=>[n(E,null,{default:l(()=>[n(U,{icon:"carbon:checkmark"})]),_:1})]),default:l(()=>[R(" "+c(e(t)("validate")),1)]),_:1},8,["disabled"])])):w("",!0)])):(s(),$(ve,{key:1},{default:l(()=>[n(X,null,{default:l(()=>[R(c(e(t)("fileUrl")),1)]),_:1}),n(Z,{value:e(v),"onUpdate:value":y[2]||(y[2]=f=>q(v)?v.value=f:null)},null,8,["value"]),e(v)?(s(),$(F,{key:0,type:"primary",onClick:y[3]||(y[3]=()=>{const f=encodeURI(e(v));("_v"in I?I._v:e(lt)).isURL(f)?D("validate",f):e(h).error(e(t)("invalidUrl"))})},{icon:l(()=>[n(E,null,{default:l(()=>[n(U,{icon:"carbon:checkmark"})]),_:1})]),default:l(()=>[R(" "+c(e(t)("validate")),1)]),_:1})):w("",!0)]),_:1}))]}),_:1})])}}}),Xl={class:"px-10"},Jl={class:"flex justify-between items-center"},Zl={style:{"margin-bottom":"12px"}},en={key:0,class:"text-xs"},tn={key:1,class:"text-xs"},ln={key:2,class:"text-xs"},nn={key:3,class:"text-xs"},an={key:4,class:"text-xs"},sn={key:5,class:"text-xs"},on=fe({__name:"UploadFiles",setup(Q){const p=Fe(Ve),t=Fe("appConfig"),{t:h}=Be(),a=je(),D=ct(),v=m(),M=m([]),I=m(!1),y=Ft(),T=t==null?void 0:t.apiRequestHeaders;T&&(T.Authorization=`Bearer ${y.accessToken}`);const j=async()=>{v.value.submit()},U=()=>{var g;(g=v.value)==null||g.clear(),M.value=[]},E=g=>{var H,B,K;const f=g.file.file;if((H=p==null?void 0:p.uploadConfig)!=null&&H.maxSize&&f&&f.size){const A=f.size/1024/1024<=((B=p==null?void 0:p.uploadConfig)==null?void 0:B.maxSize);return A||a.error(h("fileSizeNotAllowed")),A}const O=f==null?void 0:f.name.split(".").pop();return O&&((K=p==null?void 0:p.uploadConfig)!=null&&K.excludedExtensions.map(A=>A.toLowerCase()).includes(O.toLowerCase()))?(a.error(h("fileTypeNotAllowed")),!1):!0},F=g=>{M.value=g.fileList},X=({file:g})=>g,Z=()=>{var g;if((g=p==null?void 0:p.uploadConfig)!=null&&g.limit)return p==null?void 0:p.uploadConfig.limit},ve=async({file:g,data:f,headers:O,action:H,onFinish:B,onError:K,onProgress:A})=>{var se;const ee=new FormData;f&&Object.keys(f).forEach(b=>{ee.append(b,f[b])});const G=g.file,L=G==null?void 0:G.name.split(".").pop(),N=G==null?void 0:G.name.replace("."+L,""),ye=await st(G,{maxSizeMB:1});ee.append("file",ye,N),ee.append("folder",(se=p==null?void 0:p.uploadConfig)==null?void 0:se.folder),I.value=!0,D.start(),fl.post(H,ee,{headers:O,onUploadProgress:b=>{if(b.total!==null){const te=Math.round(b.loaded*100/b.total);A({percent:te})}}}).then(async()=>{B();const b=M.value.findIndex(te=>te.id===g.id);b!==-1&&M.value.splice(b,1),a.success(h("success")),D.finish(),I.value=!1}).catch(b=>{console.log(b),a.error(h("anErrorOccurred")),K(),D.finish(),I.value=!1})},W=console.warn;return ot(()=>{console.warn=g=>{typeof g=="string"&&g.includes('Non-function value encountered for slot "default"')||W(g)}}),it(()=>{console.warn=W}),(g,f)=>{const O=Ye,H=He,B=Ge,K=pt,A=mt,ee=sl,G=ol,L=il,N=ul,ye=ft;return s(),_("section",Xl,[n(A,{to:"#actions"},{default:l(()=>[d("div",Jl,[e(M).length?(s(),$(K,{key:0,align:"center"},{default:l(()=>[n(B,{disabled:e(M).length==0,onClick:U},{icon:l(()=>[n(H,null,{default:l(()=>[n(O,{icon:"carbon:close"})]),_:1})]),default:l(()=>[R(" "+c(e(h)("clearList")),1)]),_:1},8,["disabled"]),n(B,{type:"primary",disabled:e(M).length==0,onClick:j},{default:l(()=>[R(c(e(h)("launchImport")),1)]),_:1},8,["disabled"])]),_:1})):w("",!0)])]),_:1}),n(ye,{show:!1},{default:l(()=>{var se,b,te;return[n(N,{ref_key:"upload",ref:v,multiple:"","directory-dnd":"","list-type":"image",max:Z(),"default-upload":!1,headers:e(T),"custom-request":ve,action:((b=(se=e(p))==null?void 0:se.uploadConfig)==null?void 0:b.baseUrl)||((te=e(t))==null?void 0:te.apiUrl)+"/media-files/upload",onBeforeUpload:E,onChange:F,onFinish:X},{default:l(()=>[n(L,{class:"h-[250px] flex flex-col items-center justify-center"},{default:l(()=>[d("div",Zl,[n(H,{size:"48",depth:3},{default:l(()=>[n(O,{icon:"mdi:file-upload"})]),_:1})]),n(ee,{style:{"font-size":"16px"}},{default:l(()=>[R(c(e(h)("uploadAreaTitle")),1)]),_:1}),n(G,{depth:"3",class:"mt-4"},{default:l(()=>{var xe,$e,Me,Ce,le,oe,ie,Ie,x;return[($e=(xe=e(p))==null?void 0:xe.uploadConfig)!=null&&$e.limit?(s(),_("span",en,c(e(h)("limitToTheNumberOfFilesToSend",[(Me=e(p))==null?void 0:Me.uploadConfig.limit])),1)):(s(),_("span",tn,c(e(h)("noLimitToTheNumberOfFilesToSend")),1)),f[0]||(f[0]=d("br",null,null,-1)),(le=(Ce=e(p))==null?void 0:Ce.uploadConfig)!=null&&le.maxSize?(s(),_("span",ln,c(e(h)("limitToTheSizeOfFilesToSend",[e(at)((oe=e(p))==null?void 0:oe.uploadConfig.maxSize)])),1)):(s(),_("span",nn,c(e(h)("noLimitToTheSizeOfFilesToSend")),1)),f[1]||(f[1]=d("br",null,null,-1)),(Ie=(ie=e(p))==null?void 0:ie.uploadConfig)!=null&&Ie.excludedExtensions.length?(s(),_("span",an,c(e(h)("extensionsAreNotAllowed",[(x=e(p))==null?void 0:x.uploadConfig.excludedExtensions.join(", ")])),1)):(s(),_("span",sn,c(e(h)("allFileExtensionsAreAllowed")),1))]}),_:1})]),_:1})]),_:1},8,["max","headers","action"])]}),_:1})])}}}),un=fe({name:"MediaPicker"}),kn=fe({...un,props:Ze({enableUploadFiles:{type:Boolean,default:!0},enableMediaLibrary:{type:Boolean,default:!0},enableAddFromAnUrl:{type:Boolean,default:!0},displayImages:{type:Boolean,default:!0},displayVideos:{type:Boolean,default:!0},displayAudios:{type:Boolean,default:!0},displayDocuments:{type:Boolean,default:!0},displayOtherTypes:{type:Boolean,default:!0},preselectedMediaList:{default:null},selectionType:{default:"path"},selectionMultiple:{type:Boolean,default:!1},selectionLimit:{default:0},title:{default:""},uploadConfig:{default:()=>({folder:"uploads",limit:0,maxSize:0,baseUrl:null,excludedExtensions:[]})}},{show:{type:Boolean,required:!0,default:!1},showModifiers:{},tab:{default:"media-library"},tabModifiers:{}}),emits:Ze(["submit"],["update:show","update:tab"]),setup(Q,{emit:p}){const{t}=Be(),h=Q;Rt(Ve,h);const a=et(Q,"show"),D=et(Q,"tab"),v=p,M=y=>{v("submit",y),a.value=!1},I=y=>{v("submit",y),a.value=!1};return(y,T)=>{const j=cl,U=dl,E=ml;return s(),$(E,{modelValue:a.value,"onUpdate:modelValue":T[1]||(T[1]=F=>a.value=F),title:y.title,class:"w-full"},{default:l(()=>[n(U,{value:D.value,"onUpdate:value":T[0]||(T[0]=F=>D.value=F),type:"card",size:"large",animated:""},{suffix:l(()=>T[2]||(T[2]=[d("div",{id:"actions",class:"pr-10"},null,-1)])),default:l(()=>[h.enableUploadFiles?(s(),$(j,{key:0,name:"upload-files",tab:e(t)("uploadFiles")},{default:l(()=>[n(on)]),_:1},8,["tab"])):w("",!0),h.enableMediaLibrary?(s(),$(j,{key:1,name:"media-library",tab:e(t)("mediaLibrary")},{default:l(()=>[n(Yl,{onValidate:M})]),_:1},8,["tab"])):w("",!0),h.enableAddFromAnUrl?(s(),$(j,{key:2,name:"add-from-an-url",tab:e(t)("addFromAnUrl")},{default:l(()=>[n(Ql,{onValidate:I})]),_:1},8,["tab"])):w("",!0)]),_:1},8,["value"])]),_:1},8,["modelValue","title"])}}});export{mt as _,kn as a,ml as b};
