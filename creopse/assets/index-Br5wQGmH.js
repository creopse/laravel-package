import{i as E}from"./css-render_vue3-ssr-Vbotx5Ir.js";import{_ as Y}from"./AuthLayout-Cd04zGrL.js";import{I as Z}from"./iconify_vue-BwapRRpV.js";import{u as ee,a as ae,b as se,c as le,d as te,R as A,e as oe}from"./index-B2LlKIv2.js";import{p as ne}from"./check-password-strength-CYKRgybp.js";import{p as re}from"./password-strength-options-ByZgG3BK.js";import{R as H}from"./response-error-code-DXeaxdrh.js";import{u as ue}from"./vue-router-B7M2c80d.js";import{_ as ie}from"./validator-QVVspsrX.js";import{b as de,A as pe,C as me,D as ce,E as _e,F as fe,G as we,H as ve,I as ge,J as be,B as he,N as ke,K as Ce,L as ye}from"./naive-ui-CrTIpLJ9.js";import{u as Re}from"./vue-i18n-CWrb4u3f.js";const{defineComponent:xe}=await E("vue"),{unref:e,resolveComponent:Xe,createVNode:s,withCtx:t,createElementVNode:f,toDisplayString:b,createTextVNode:h,openBlock:w,createElementBlock:q,createCommentVNode:qe,createBlock:S}=await E("vue"),Se={class:"container h-full"},Ae={class:"flex justify-center items-center flex-wrap h-full g-6 text-gray-800"},Ee={class:"md:w-10/12 lg:w-7/12 xl:w-6/12 2xl:w-5/12 sm:w-full"},Ie={class:"w-full flex justify-center"},Ne={class:"px-20"},Te={key:0},De={key:1},Ue={key:2},Ve={class:"w-full flex justify-end px-20"},{defineComponent:Fe,ref:m,onMounted:Pe}=await E("vue"),Be=Fe({name:A.SETUP.NAME}),Ye=xe({...Be,setup(He){const{t:a}=Re(),{request:k}=oe(),{displayFormErrors:L}=ee(),{userHasSuperAdminRole:M}=ae(),{defaultPrefs:O}=se(),I=ue(),c=de(),N=le(),T=te(),G=T.getSettingValue("disableInstaller","boolean"),r=m(1),i=m("process"),_=m(!1),D=m(null),o=m({lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""}),j={lastname:[{required:!0,message:a("fillRequired")}],firstname:[{required:!0,message:a("fillRequired")}],email:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(p,l){return l&&!ie.isEmail(l)?new Error(a("invalidEmail")):!0}}],password:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(p,l){return l&&["too-weak"].includes(ne(l,re).value)?new Error(a("passwordTooWeak")):!0}}],passwordConfirmation:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(p,l){return l&&l!==o.value.password?new Error(a("nonCompliantPassword")):!0}}]},U=m(null),u=m({dbname:"",host:"",username:"",password:""}),z={dbname:[{required:!0,message:a("fillRequired")}],host:[{required:!0,message:a("fillRequired")}],username:[{required:!0,message:a("fillRequired")}],password:[{required:!1}]},$=()=>{r.value>2&&r.value--},J=()=>{r.value==1?U.value?.validate(async p=>{if(p)c.warning(a("invalidForm"));else{if(_.value=!0,i.value="wait",(await k({url:"/database/create",method:"post",data:u.value})).success){await new Promise(C=>setTimeout(C,3e3));const v=await k({url:"/database/migrate"}),R=await k({url:"/database/seed"});v.success&&R.success?(r.value=2,i.value="process"):(c.error(a("unableToInstallTablesInDb")),i.value="error")}else c.error(a("unableToCreateDbOrEditConfig")),i.value="error";_.value=!1}}):r.value==2?o.value.lastname||o.value.firstname||o.value.email||o.value.password?D.value?.validate(async p=>{if(p)c.warning(a("invalidForm"));else{_.value=!0,i.value="wait";const l=await k({url:"/auth/register",method:"post",data:{lastname:o.value.lastname,firstname:o.value.firstname,email:o.value.email,password:o.value.password,passwordConfirmation:o.value.passwordConfirmation,preferences:O.value}});if(l.failure&&l.error){switch(l.error?.response?.data?.errorCode){case H.AUTH_MISSING_DATA:c.error(a("missingData"));break;case H.FORM_INVALID_DATA:L(l.error?.response?.data?.data);break;default:c.error(a("registrationNotSuccessful"))}i.value="error"}else N.userData=l.result.data.user,M()&&T.initDefaultSettings(),N.userData=null,o.value={lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""},r.value=3,i.value="finish";_.value=!1}}):(r.value=3,i.value="finish"):r.value==3&&I.replace(A.LOGIN.PATH)};return Pe(()=>{G&&I.replace(A.LOGIN.PATH)}),(p,l)=>{const v=ye,R=Ce,C=me,d=fe,g=_e,V=ce,y=ve,F=we,K=ge,x=Z,P=ke,B=he,W=be,Q=pe,X=Y;return w(),S(X,{"display-server-alerts":!1},{default:t(()=>[f("div",Se,[f("div",Ae,[f("div",Ee,[s(Q,{size:"medium",class:"w-full"},{header:t(()=>[f("div",Ie,[s(R,{current:e(r),status:e(i)},{default:t(()=>[s(v,{title:e(a)("database")},null,8,["title"]),s(v,{title:e(a)("admin")},null,8,["title"]),s(v,{title:e(a)("completion")},null,8,["title"])]),_:1},8,["current","status"])])]),action:t(()=>[f("section",Ve,[s(W,null,{default:t(()=>[s(B,{loading:e(_),disabled:e(r)<3,onClick:$},{icon:t(()=>[s(P,null,{default:t(()=>[s(x,{icon:"carbon:arrow-left"})]),_:1})]),default:t(()=>[h(" "+b(e(a)("previous")),1)]),_:1},8,["loading","disabled"]),s(B,{"icon-placement":"right",loading:e(_),onClick:J},{icon:t(()=>[s(P,null,{default:t(()=>[e(r)==3?(w(),S(x,{key:0,icon:"carbon:checkmark-outline"})):(w(),S(x,{key:1,icon:"carbon:arrow-right"}))]),_:1})]),default:t(()=>[h(" "+b(e(r)==3?e(a)("validate"):e(a)("next")),1)]),_:1},8,["loading"])]),_:1})])]),default:t(()=>[f("div",Ne,[e(r)==1?(w(),q("section",Te,[s(C,{class:"text-center"},{default:t(()=>[h(b(e(a)("databaseConnectionInfo")),1)]),_:1}),s(V,{ref_key:"dbFormRef",ref:U,model:e(u),rules:z,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:t(()=>[s(g,{label:e(a)("dbname"),path:"dbname"},{default:t(()=>[s(d,{value:e(u).dbname,"onUpdate:value":l[0]||(l[0]=n=>e(u).dbname=n),placeholder:e(a)("dbname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(g,{label:e(a)("username"),path:"username"},{default:t(()=>[s(d,{value:e(u).username,"onUpdate:value":l[1]||(l[1]=n=>e(u).username=n),placeholder:e(a)("username"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(g,{label:e(a)("password"),path:"password"},{default:t(()=>[s(d,{value:e(u).password,"onUpdate:value":l[2]||(l[2]=n=>e(u).password=n),placeholder:e(a)("password"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(g,{label:e(a)("host"),path:"host"},{default:t(()=>[s(d,{value:e(u).host,"onUpdate:value":l[3]||(l[3]=n=>e(u).host=n),placeholder:e(a)("host"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])):e(r)==2?(w(),q("section",De,[s(C,{class:"text-center"},{default:t(()=>[h(b(e(a)("createAdmin")),1)]),_:1}),s(V,{ref_key:"adminFormRef",ref:D,model:e(o),rules:j,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:t(()=>[s(F,{"x-gap":"12",span:24},{default:t(()=>[s(y,{span:12,label:e(a)("lastname"),path:"lastname"},{default:t(()=>[s(d,{value:e(o).lastname,"onUpdate:value":l[4]||(l[4]=n=>e(o).lastname=n),placeholder:e(a)("lastname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(y,{span:12,label:e(a)("firstname_s"),path:"firstname"},{default:t(()=>[s(d,{value:e(o).firstname,"onUpdate:value":l[5]||(l[5]=n=>e(o).firstname=n),placeholder:e(a)("firstname_s"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),s(g,{label:e(a)("addressEmail"),path:"email"},{default:t(()=>[s(d,{value:e(o).email,"onUpdate:value":l[6]||(l[6]=n=>e(o).email=n),placeholder:e(a)("addressEmail"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(F,{"x-gap":"12",span:24},{default:t(()=>[s(y,{span:12,label:e(a)("password"),path:"password"},{default:t(()=>[s(d,{value:e(o).password,"onUpdate:value":l[7]||(l[7]=n=>e(o).password=n),placeholder:e(a)("password"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(y,{span:12,label:e(a)("confirmPassword"),path:"passwordConfirmation"},{default:t(()=>[s(d,{value:e(o).passwordConfirmation,"onUpdate:value":l[8]||(l[8]=n=>e(o).passwordConfirmation=n),placeholder:e(a)("confirmPassword"),disabled:!e(o).password,"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1},8,["model"])])):e(r)==3?(w(),q("section",Ue,[s(K,{title:e(a)("installationCompleted"),type:"success"},{default:t(()=>[h(b(e(a)("confirmToReturnToLoginPage")),1)]),_:1},8,["title"])])):qe("",!0)])]),_:1})])])])]),_:1})}}});export{Ye as default};
