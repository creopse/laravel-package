import{P as m}from"./ckeditor_ckeditor5-core-c8d003a2.js";import{E,d as T,e as p,u as k}from"./ckeditor_ckeditor5-utils-df07b536.js";import{D as M,a as C,M as P,L as v}from"./ckeditor_ckeditor5-engine-af85ebf5.js";import{W as O,i as g}from"./ckeditor_ckeditor5-widget-4ebd81a8.js";import"./ckeditor_ckeditor5-ui-a35c6a55.js";import"./color-convert-6fc98488.js";import"./vanilla-colorful-3f59310b.js";import{t as x}from"./lodash-es-a215867d.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class D extends M{constructor(e){super(e),this.domEventType=["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"];const t=this.document;this.listenTo(t,"paste",r("clipboardInput"),{priority:"low"}),this.listenTo(t,"drop",r("clipboardInput"),{priority:"low"}),this.listenTo(t,"dragover",r("dragging"),{priority:"low"});function r(a){return(n,s)=>{s.preventDefault();const i=s.dropRange?[s.dropRange]:null,l=new E(t,a);t.fire(l,{dataTransfer:s.dataTransfer,method:n.name,targetRanges:i,target:s.target,domEvent:s.domEvent}),l.stop.called&&s.stopPropagation()}}}onDomEvent(e){const t="clipboardData"in e?e.clipboardData:e.dataTransfer,r=e.type=="drop"||e.type=="paste",a={dataTransfer:new C(t,{cacheFiles:r})};(e.type=="drop"||e.type=="dragover")&&(a.dropRange=I(this.view,e)),this.fire(e.type,e,a)}}function I(o,e){const t=e.target.ownerDocument,r=e.clientX,a=e.clientY;let n;return t.caretRangeFromPoint&&t.caretRangeFromPoint(r,a)?n=t.caretRangeFromPoint(r,a):e.rangeParent&&(n=t.createRange(),n.setStart(e.rangeParent,e.rangeOffset),n.collapse(!0)),n?o.domConverter.domRangeToView(n):null}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function S(o){return o=o.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(o.includes("</p><p>")||o.includes("<br>"))&&(o=`<p>${o}</p>`),o}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function F(o){return o.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const _=["figcaption","li"];function A(o){let e="";if(o.is("$text")||o.is("$textProxy"))e=o.data;else if(o.is("element","img")&&o.hasAttribute("alt"))e=o.getAttribute("alt");else if(o.is("element","br"))e=`
`;else{let t=null;for(const r of o.getChildren()){const a=A(r);t&&(t.is("containerElement")||r.is("containerElement"))&&(_.includes(t.name)||_.includes(r.name)?e+=`
`:e+=`

`),e+=a,t=r}}return e}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class f extends m{static get pluginName(){return"ClipboardPipeline"}init(){this.editor.editing.view.addObserver(D),this._setupPasteDrop(),this._setupCopyCut()}_setupPasteDrop(){const e=this.editor,t=e.model,r=e.editing.view,a=r.document;this.listenTo(a,"clipboardInput",(n,s)=>{s.method=="paste"&&!e.model.canEditAt(e.model.document.selection)&&n.stop()},{priority:"highest"}),this.listenTo(a,"clipboardInput",(n,s)=>{const i=s.dataTransfer;let l;if(s.content)l=s.content;else{let c="";i.getData("text/html")?c=F(i.getData("text/html")):i.getData("text/plain")&&(c=S(i.getData("text/plain"))),l=this.editor.data.htmlProcessor.toView(c)}const d=new E(this,"inputTransformation");this.fire(d,{content:l,dataTransfer:i,targetRanges:s.targetRanges,method:s.method}),d.stop.called&&n.stop(),r.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(n,s)=>{if(s.content.isEmpty)return;const l=this.editor.data.toModel(s.content,"$clipboardHolder");l.childCount!=0&&(n.stop(),t.change(()=>{this.fire("contentInsertion",{content:l,method:s.method,dataTransfer:s.dataTransfer,targetRanges:s.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(n,s)=>{s.resultRange=t.insertContent(s.content)},{priority:"low"})}_setupCopyCut(){const e=this.editor,t=e.model.document,a=e.editing.view.document,n=(s,i)=>{const l=i.dataTransfer;i.preventDefault();const d=e.data.toView(e.model.getSelectedContent(t.selection));a.fire("clipboardOutput",{dataTransfer:l,content:d,method:s.name})};this.listenTo(a,"copy",n,{priority:"low"}),this.listenTo(a,"cut",(s,i)=>{e.model.canEditAt(e.model.document.selection)?n(s,i):i.preventDefault()},{priority:"low"}),this.listenTo(a,"clipboardOutput",(s,i)=>{i.content.isEmpty||(i.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(i.content)),i.dataTransfer.setData("text/plain",A(i.content))),i.method=="cut"&&e.model.deleteContent(t.selection)},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class W extends m{static get pluginName(){return"DragDrop"}static get requires(){return[f,O]}init(){const e=this.editor,t=e.editing.view;if(this._draggedRange=null,this._draggingUid="",this._draggableElement=null,this._updateDropMarkerThrottled=x(r=>this._updateDropMarker(r),40),this._removeDropMarkerDelayed=T(()=>this._removeDropMarker(),40),this._clearDraggableAttributesDelayed=T(()=>this._clearDraggableAttributes(),40),e.plugins.has("DragDropExperimental")){this.forceDisabled("DragDropExperimental");return}t.addObserver(D),t.addObserver(P),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDropMarker(),this._setupDraggableAttributeHandling(),this.listenTo(e,"change:isReadOnly",(r,a,n)=>{n?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(r,a,n)=>{n||this._finalizeDragging(!1)}),p.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._updateDropMarkerThrottled.cancel(),this._removeDropMarkerDelayed.cancel(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const e=this.editor,t=e.model,r=t.document,a=e.editing.view,n=a.document;this.listenTo(n,"dragstart",(s,i)=>{const l=r.selection;if(i.target&&i.target.is("editableElement")){i.preventDefault();return}const d=i.target?w(i.target):null;if(d){const h=e.editing.mapper.toModelElement(d);this._draggedRange=v.fromRange(t.createRangeOn(h)),e.plugins.has("WidgetToolbarRepository")&&e.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop")}else if(!n.selection.isCollapsed){const h=n.selection.getSelectedElement();(!h||!g(h))&&(this._draggedRange=v.fromRange(l.getFirstRange()))}if(!this._draggedRange){i.preventDefault();return}this._draggingUid=k();const c=this.isEnabled&&e.model.canEditAt(this._draggedRange);i.dataTransfer.effectAllowed=c?"copyMove":"copy",i.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const b=t.createSelection(this._draggedRange.toRange()),u=e.data.toView(t.getSelectedContent(b));n.fire("clipboardOutput",{dataTransfer:i.dataTransfer,content:u,method:"dragstart"}),c||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(n,"dragend",(s,i)=>{this._finalizeDragging(!i.dataTransfer.isCanceled&&i.dataTransfer.dropEffect=="move")},{priority:"low"}),this.listenTo(n,"dragenter",()=>{this.isEnabled&&a.focus()}),this.listenTo(n,"dragleave",()=>{this._removeDropMarkerDelayed()}),this.listenTo(n,"dragging",(s,i)=>{if(!this.isEnabled){i.dataTransfer.dropEffect="none";return}this._removeDropMarkerDelayed.cancel();const l=R(e,i.targetRanges,i.target);if(!e.model.canEditAt(l)){i.dataTransfer.dropEffect="none";return}this._draggedRange||(i.dataTransfer.dropEffect="copy"),p.isGecko||(i.dataTransfer.effectAllowed=="copy"?i.dataTransfer.dropEffect="copy":["all","copyMove"].includes(i.dataTransfer.effectAllowed)&&(i.dataTransfer.dropEffect="move"));/* istanbul ignore else -- @preserve */l&&this._updateDropMarkerThrottled(l)},{priority:"low"})}_setupClipboardInputIntegration(){const e=this.editor,r=e.editing.view.document;this.listenTo(r,"clipboardInput",(a,n)=>{if(n.method!="drop")return;const s=R(e,n.targetRanges,n.target);this._removeDropMarker();/* istanbul ignore if -- @preserve */if(!s||!e.model.canEditAt(s)){this._finalizeDragging(!1),a.stop();return}if(this._draggedRange&&this._draggingUid!=n.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),y(n.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(s,!0)){this._finalizeDragging(!1),a.stop();return}n.targetRanges=[e.editing.mapper.toViewRange(s)]},{priority:"high"})}_setupContentInsertionIntegration(){const e=this.editor.plugins.get(f);e.on("contentInsertion",(t,r)=>{if(!this.isEnabled||r.method!=="drop")return;const a=r.targetRanges.map(n=>this.editor.editing.mapper.toModelRange(n));this.editor.model.change(n=>n.setSelection(a))},{priority:"high"}),e.on("contentInsertion",(t,r)=>{if(!this.isEnabled||r.method!=="drop")return;const a=y(r.dataTransfer)=="move",n=!r.resultRange||!r.resultRange.isCollapsed;this._finalizeDragging(n&&a)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const e=this.editor,t=e.editing.view,r=t.document;this.listenTo(r,"mousedown",(a,n)=>{if(p.isAndroid||!n)return;this._clearDraggableAttributesDelayed.cancel();let s=w(n.target);if(p.isBlink&&!s&&!r.selection.isCollapsed){const i=r.selection.getSelectedElement();if(!i||!g(i)){const l=r.selection.editableElement;l&&!l.isReadOnly&&(s=l)}}s&&(t.change(i=>{i.setAttribute("draggable","true",s)}),this._draggableElement=e.editing.mapper.toModelElement(s))}),this.listenTo(r,"mouseup",()=>{p.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const e=this.editor.editing;e.view.change(t=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&t.removeAttribute("draggable",e.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_setupDropMarker(){const e=this.editor;e.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),e.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(t,{writer:r})=>{if(e.model.schema.checkChild(t.markerRange.start,"$text"))return r.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(n){const s=this.toDomElement(n);return s.append("⁠",n.createElement("span"),"⁠"),s})}})}_updateDropMarker(e){const t=this.editor,r=t.model.markers;t.model.change(a=>{r.has("drop-target")?r.get("drop-target").getRange().isEqual(e)||a.updateMarker("drop-target",{range:e}):a.addMarker("drop-target",{range:e,usingOperation:!1,affectsData:!1})})}_removeDropMarker(){const e=this.editor.model;this._removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),e.markers.has("drop-target")&&e.change(t=>{t.removeMarker("drop-target")})}_finalizeDragging(e){const t=this.editor,r=t.model;this._removeDropMarker(),this._clearDraggableAttributes(),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",this._draggedRange&&(e&&this.isEnabled&&r.deleteContent(r.createSelection(this._draggedRange),{doNotAutoparagraph:!0}),this._draggedRange.detach(),this._draggedRange=null)}}function R(o,e,t){const r=o.model,a=o.editing.mapper;let n=null;const s=e?e[0].start:null;if(t.is("uiElement")&&(t=t.parent),n=N(o,t),n)return n;const i=B(o,t),l=s?a.toModelPosition(s):null;return l?(n=U(o,l,i),n||(n=r.schema.getNearestSelectionRange(l,p.isGecko?"forward":"backward"),n)?n:z(o,l.parent)):$(o,i)}function N(o,e){const t=o.model,r=o.editing.mapper;if(g(e))return t.createRangeOn(r.toModelElement(e));if(!e.is("editableElement")){const a=e.findAncestor(n=>g(n)||n.is("editableElement"));if(g(a))return t.createRangeOn(r.toModelElement(a))}return null}function $(o,e){const t=o.model,r=t.schema,a=t.createPositionAt(e,0);return r.getNearestSelectionRange(a,"forward")}function U(o,e,t){const r=o.model;if(!r.schema.checkChild(t,"$block"))return null;const a=r.createPositionAt(t,0),n=e.path.slice(0,a.path.length),i=r.createPositionFromPath(e.root,n).nodeAfter;return i&&r.schema.isObject(i)?r.createRangeOn(i):null}function z(o,e){const t=o.model;let r=e;for(;r;){if(t.schema.isObject(r))return t.createRangeOn(r);r=r.parent}/* istanbul ignore next -- @preserve */return null}function B(o,e){const t=o.editing.mapper,r=o.editing.view,a=t.toModelElement(e);if(a)return a;const n=r.createPositionBefore(e),s=t.findMappedViewAncestor(n);return t.toModelElement(s)}function y(o){return p.isGecko?o.dropEffect:["all","copyMove"].includes(o.effectAllowed)?"move":"copy"}function w(o){if(o.is("editableElement"))return null;if(o.hasClass("ck-widget__selection-handle"))return o.findAncestor(g);if(g(o))return o;const e=o.findAncestor(t=>g(t)||t.is("editableElement"));return g(e)?e:null}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class H extends m{static get pluginName(){return"PastePlainText"}static get requires(){return[f]}init(){const e=this.editor,t=e.model,r=e.editing.view,a=r.document,n=t.document.selection;let s=!1;r.addObserver(D),this.listenTo(a,"keydown",(i,l)=>{s=l.shiftKey}),e.plugins.get(f).on("contentInsertion",(i,l)=>{!s&&!j(l.content,t.schema)||t.change(d=>{const c=Array.from(n.getAttributes()).filter(([u])=>t.schema.getAttributeProperties(u).isFormatting);n.isCollapsed||t.deleteContent(n,{doNotAutoparagraph:!0}),c.push(...n.getAttributes());const b=d.createRangeIn(l.content);for(const u of b.getItems())u.is("$textProxy")&&d.setAttributes(c,u)})})}}function j(o,e){if(o.childCount>1)return!1;const t=o.getChild(0);return e.isObject(t)?!1:Array.from(t.getAttributeKeys()).length==0}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Z extends m{static get pluginName(){return"Clipboard"}static get requires(){return[f,W,H]}}export{Z as C,f as a};
