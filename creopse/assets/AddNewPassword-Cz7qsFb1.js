import{i as f}from"./css-render_vue3-ssr-Vbotx5Ir.js";import{_ as I}from"./AuthLayout-Cd04zGrL.js";import{d as T,u as B,R as _,_ as O,e as F}from"./index-B2LlKIv2.js";import{p as L}from"./password-strength-options-ByZgG3BK.js";import{p as M}from"./check-password-strength-CYKRgybp.js";import{R as H}from"./response-error-code-DXeaxdrh.js";import{a as U,u as W}from"./vue-router-B7M2c80d.js";import{_ as j}from"./validator-QVVspsrX.js";import{b as z,A as G,D as J,E as K,F as Q,B as X}from"./naive-ui-CrTIpLJ9.js";import{u as Y}from"./vue-i18n-CWrb4u3f.js";const{defineComponent:Z}=await f("vue"),{unref:e,createElementVNode:u,resolveComponent:be,createVNode:r,withCtx:n,openBlock:h,createBlock:C,createCommentVNode:$,toDisplayString:ee,createTextVNode:oe}=await f("vue"),se={class:"container h-full"},ae={class:"flex justify-center items-center flex-wrap h-full g-6 text-gray-800"},re={class:"md:w-8/12 lg:w-5/12 xl:w-4/12 2xl:w-3/12 sm:w-full"},te={class:"flex justify-center mb-6"},ne=["src","alt"],{defineComponent:le,ref:c,onMounted:ie}=await f("vue"),ue=le({name:_.ADD_NEW_PASSWORD.NAME}),ye=Z({...ue,setup(de){const{t:s}=Y(),d=U(),w=W(),v=z(),b=T(),{request:y}=F(),{displayFormErrors:k,logo:R}=B(),p=c(!1),g=c(null),a=c({email:"",password:"",passwordConfirmation:""}),E={email:[{required:!0,message:s("fillRequired")},{trigger:["input"],validator(l,o){return o&&!j.isEmail(o)?new Error(s("invalidEmail")):!0}}],password:[{required:!0,message:s("fillRequired")},{trigger:["input"],validator(l,o){return o&&["too-weak"].includes(M(o,L).value)?new Error(s("passwordTooWeak")):!0}}],passwordConfirmation:[{required:!0,message:s("fillRequired")},{trigger:["input"],validator(l,o){return o&&o!==a.value.password?new Error(s("nonCompliantPassword")):!0}}]},N=l=>{l.preventDefault(),g.value?.validate(async o=>{if(!o){p.value=!0;const t=await y({url:"/auth/reset-password",method:"post",data:{email:a.value.email,token:d.params.token,password:a.value.password,passwordConfirmation:a.value.passwordConfirmation}});if(t.failure&&t.error)switch(t.error?.response?.data?.errorCode){case H.FORM_INVALID_DATA:k(t.error?.response?.data?.data);break;default:v.error(s("passwordResetFailure"),{closable:!0,duration:5e3})}else v.success(s("passwordResetSuccess"),{closable:!0,duration:1e4}),w.replace(_.LOGIN.PATH);p.value=!1}})},S="Creopse",x=b.getSettingValue("disableInstaller","boolean");return ie(()=>{d.params.token||w.replace(_.LOGIN.PATH),a.value.email=d.query.email}),(l,o)=>{const t=Q,m=K,A=X,V=J,q=G,D=O,P=I;return h(),C(P,{"display-server-alerts":!e(x)},{default:n(()=>[r(D,{name:"slide-fade",appear:""},{default:n(()=>[u("div",se,[u("div",ae,[u("div",re,[r(q,{size:"small",class:"w-full"},{default:n(()=>[u("div",te,[u("img",{src:e(R),class:"w-54",alt:e(S)},null,8,ne)]),r(V,{ref_key:"formRef",ref:g,model:e(a),rules:E,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:n(()=>[e(d).query.email?$("",!0):(h(),C(m,{key:0,label:e(s)("addressEmail"),path:"email"},{default:n(()=>[r(t,{value:e(a).email,"onUpdate:value":o[0]||(o[0]=i=>e(a).email=i),placeholder:e(s)("addressEmail"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])),r(m,{label:e(s)("newPassword"),path:"password"},{default:n(()=>[r(t,{value:e(a).password,"onUpdate:value":o[1]||(o[1]=i=>e(a).password=i),placeholder:e(s)("newPassword"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),r(m,{label:e(s)("confirmPassword"),path:"passwordConfirmation"},{default:n(()=>[r(t,{value:e(a).passwordConfirmation,"onUpdate:value":o[2]||(o[2]=i=>e(a).passwordConfirmation=i),placeholder:e(s)("confirmPassword"),disabled:!e(a).password,"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),r(A,{block:"",type:"primary",loading:e(p),onClick:N},{default:n(()=>[oe(ee(e(s)("save")),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})])])])]),_:1})]),_:1},8,["display-server-alerts"])}}});export{ye as default};
