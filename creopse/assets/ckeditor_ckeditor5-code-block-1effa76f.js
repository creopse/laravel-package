import{C as v,P as C}from"./ckeditor_ckeditor5-core-c8d003a2.js";import{f as k,a as _}from"./ckeditor_ckeditor5-utils-df07b536.js";import{U as I}from"./ckeditor_ckeditor5-engine-af85ebf5.js";import{S as V}from"./ckeditor_ckeditor5-enter-27538ad0.js";import{c as y,S as R,b as z,M as N}from"./ckeditor_ckeditor5-ui-a35c6a55.js";import"./color-convert-6fc98488.js";import"./vanilla-colorful-3f59310b.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function S(i){const e=i.t,n=i.config.get("codeBlock.languages");for(const o of n)o.label==="Plain text"&&(o.label=e("Plain text")),o.class===void 0&&(o.class=`language-${o.language}`);return n}function B(i,e,n){const o={};for(const s of i)if(e==="class"){const a=s[e].split(" ").shift();o[a]=s[n]}else o[s[e]]=s[n];return o}function x(i){return i.data.match(/^(\s*)/)[0]}function O(i,e){const n=i.createDocumentFragment(),o=e.split(`
`),s=o.reduce((a,t,c)=>(a.push(t),c<o.length-1&&a.push(i.createElement("br")),a),[]);return i.appendChild(s,n),n}function b(i){const e=i.document.selection,n=[];if(e.isCollapsed)return[e.anchor];const o=e.getFirstRange().getWalker({ignoreElementEnd:!0,direction:"backward"});for(const{item:s}of o){if(!s.is("$textProxy"))continue;const{parent:a,startOffset:t}=s.textNode;if(!a.is("element","codeBlock"))continue;const c=x(s.textNode),l=i.createPositionAt(a,t+c.length);n.push(l)}return n}function w(i){const e=k(i.getSelectedBlocks());return!!e&&e.is("element","codeBlock")}function E(i,e){return e.is("rootElement")||i.isLimit(e)?!1:i.checkChild(e.parent,"codeBlock")}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class M extends v{constructor(e){super(e),this._lastLanguage=null}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const n=this.editor,o=n.model,s=o.document.selection,t=S(n)[0],c=Array.from(s.getSelectedBlocks()),l=e.forceValue==null?!this.value:e.forceValue,r=q(e,this._lastLanguage,t.language);o.change(d=>{l?this._applyCodeBlock(d,c,r):this._removeCodeBlock(d,c)})}_getValue(){const e=this.editor.model.document.selection,n=k(e.getSelectedBlocks());return!!(n&&n.is("element","codeBlock"))?n.getAttribute("language"):!1}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,n=this.editor.model.schema,o=k(e.getSelectedBlocks());return o?E(n,o):!1}_applyCodeBlock(e,n,o){this._lastLanguage=o;const s=this.editor.model.schema,a=n.filter(t=>E(s,t));for(const t of a)e.rename(t,"codeBlock"),e.setAttribute("language",o,t),s.removeDisallowedAttributes([t],e),Array.from(t.getChildren()).filter(c=>!s.checkChild(t,c)).forEach(c=>e.remove(c));a.reverse().forEach((t,c)=>{const l=a[c+1];t.previousSibling===l&&(e.appendElement("softBreak",l),e.merge(e.createPositionBefore(t)))})}_removeCodeBlock(e,n){const o=n.filter(s=>s.is("element","codeBlock"));for(const s of o){const a=e.createRangeOn(s);for(const t of Array.from(a.getItems()).reverse())if(t.is("element","softBreak")&&t.parent.is("element","codeBlock")){const{position:c}=e.split(e.createPositionBefore(t)),l=c.nodeAfter;e.rename(l,"paragraph"),e.removeAttribute("language",l),e.remove(t)}e.rename(s,"paragraph"),e.removeAttribute("language",s)}}}function q(i,e,n){return i.language?i.language:i.usePreviousLanguageChoice&&e?e:n}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class H extends v{constructor(e){super(e),this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const n=this.editor.model;n.change(o=>{const s=b(n);for(const a of s){const t=o.createText(this._indentSequence);n.insertContent(t,a)}})}_checkEnabled(){return this._indentSequence?w(this.editor.model.document.selection):!1}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class W extends v{constructor(e){super(e),this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const n=this.editor.model;n.change(()=>{const o=b(n);for(const s of o){const a=P(n,s,this._indentSequence);a&&n.deleteContent(n.createSelection(a))}})}_checkEnabled(){if(!this._indentSequence)return!1;const e=this.editor.model;return w(e.document.selection)?b(e).some(n=>P(e,n,this._indentSequence)):!1}}function P(i,e,n){const o=F(e);if(!o)return null;const s=x(o),a=s.lastIndexOf(n);if(a+n.length!==s.length||a===-1)return null;const{parent:t,startOffset:c}=o;return i.createRange(i.createPositionAt(t,c+a),i.createPositionAt(t,c+a+n.length))}function F(i){let e=i.parent.getChild(i.index);return(!e||e.is("element","softBreak"))&&(e=i.nodeBefore),!e||e.is("element","softBreak")?null:e}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function A(i,e,n=!1){const o=B(e,"language","class"),s=B(e,"language","label");return(a,t,c)=>{const{writer:l,mapper:r,consumable:d}=c;if(!d.consume(t.item,"insert"))return;const u=t.item.getAttribute("language"),g=r.toViewPosition(i.createPositionBefore(t.item)),m={};n&&(m["data-language"]=s[u],m.spellcheck="false");const f=o[u]?{class:o[u]}:void 0,L=l.createContainerElement("code",f),T=l.createContainerElement("pre",m,L);l.insert(g,T),r.bindElements(t.item,L)}}function $(i){return(e,n,o)=>{if(n.item.parent.name!=="codeBlock")return;const{writer:s,mapper:a,consumable:t}=o;if(!t.consume(n.item,"insert"))return;const c=a.toViewPosition(i.createPositionBefore(n.item));s.insert(c,s.createText(`
`))}}function U(i,e){const n=B(e,"class","language"),o=e[0].language;return(s,a,t)=>{const c=a.viewItem,l=c.parent;if(!l||!l.is("element","pre")||a.modelCursor.findAncestor("codeBlock"))return;const{consumable:r,writer:d}=t;if(!r.test(c,{name:!0}))return;const u=d.createElement("codeBlock"),g=[...c.getClassNames()];g.length||g.push("");for(const m of g){const f=n[m];if(f){d.setAttribute("language",f,u);break}}u.hasAttribute("language")||d.setAttribute("language",o,u),t.convertChildren(c,u),t.safeInsert(u,a.modelCursor)&&(r.consume(c,{name:!0}),t.updateConversionResult(u,a))}}function j(){return(i,e,{consumable:n,writer:o})=>{let s=e.modelCursor;if(!n.test(e.viewItem)||!s.findAncestor("codeBlock"))return;n.consume(e.viewItem);const t=e.viewItem.data.split(`
`).map(l=>o.createText(l)),c=t[t.length-1];for(const l of t)if(o.insert(l,s),s=s.getShiftedBy(l.offsetSize),l!==c){const r=o.createElement("softBreak");o.insert(r,s),s=o.createPositionAfter(r)}e.modelRange=o.createRange(e.modelCursor,s),e.modelCursor=s}}function J(){return(i,e,{consumable:n})=>{const o=e.viewItem;if(o.findAncestor("pre"))return;const s=Array.from(o.getChildren()),a=s.find(t=>t.is("element","code"));if(a)for(const t of s)t===a||!t.is("$text")||n.consume(t,{name:!0})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const D="paragraph";class K extends C{static get pluginName(){return"CodeBlockEditing"}static get requires(){return[V]}constructor(e){super(e),e.config.define("codeBlock",{languages:[{language:"plaintext",label:"Plain text"},{language:"c",label:"C"},{language:"cs",label:"C#"},{language:"cpp",label:"C++"},{language:"css",label:"CSS"},{language:"diff",label:"Diff"},{language:"html",label:"HTML"},{language:"java",label:"Java"},{language:"javascript",label:"JavaScript"},{language:"php",label:"PHP"},{language:"python",label:"Python"},{language:"ruby",label:"Ruby"},{language:"typescript",label:"TypeScript"},{language:"xml",label:"XML"}],indentSequence:"	"})}init(){const e=this.editor,n=e.model.schema,o=e.model,s=e.editing.view,a=e.plugins.has("DocumentListEditing"),t=S(e);e.commands.add("codeBlock",new M(e)),e.commands.add("indentCodeBlock",new H(e)),e.commands.add("outdentCodeBlock",new W(e)),this.listenTo(s.document,"tab",(c,l)=>{const r=l.shiftKey?"outdentCodeBlock":"indentCodeBlock";e.commands.get(r).isEnabled&&(e.execute(r),l.stopPropagation(),l.preventDefault(),c.stop())},{context:"pre"}),n.register("codeBlock",{allowWhere:"$block",allowChildren:"$text",isBlock:!0,allowAttributes:["language"]}),n.addAttributeCheck((c,l)=>{const r=c.endsWith("codeBlock")&&l.startsWith("list")&&l!=="list";if(a&&r)return!0;if(c.endsWith("codeBlock $text"))return!1}),e.model.schema.addChildCheck((c,l)=>{if(c.endsWith("codeBlock")&&l.isObject)return!1}),e.editing.downcastDispatcher.on("insert:codeBlock",A(o,t,!0)),e.data.downcastDispatcher.on("insert:codeBlock",A(o,t)),e.data.downcastDispatcher.on("insert:softBreak",$(o),{priority:"high"}),e.data.upcastDispatcher.on("element:code",U(s,t)),e.data.upcastDispatcher.on("text",j()),e.data.upcastDispatcher.on("element:pre",J(),{priority:"high"}),this.listenTo(e.editing.view.document,"clipboardInput",(c,l)=>{let r=o.createRange(o.document.selection.anchor);if(l.targetRanges&&(r=e.editing.mapper.toModelRange(l.targetRanges[0])),!r.start.parent.is("element","codeBlock"))return;const d=l.dataTransfer.getData("text/plain"),u=new I(e.editing.view.document);l.content=O(u,d)}),this.listenTo(o,"getSelectedContent",(c,[l])=>{const r=l.anchor;l.isCollapsed||!r.parent.is("element","codeBlock")||!r.hasSameParentAs(l.focus)||o.change(d=>{const u=c.return;if(r.parent.is("element")&&(u.childCount>1||l.containsEntireContent(r.parent))){const m=d.createElement("codeBlock",r.parent.getAttributes());d.append(u,m);const f=d.createDocumentFragment();d.append(m,f),c.return=f;return}const g=u.getChild(0);n.checkAttribute(g,"code")&&d.setAttribute("code",!0,g)})})}afterInit(){const e=this.editor,n=e.commands,o=n.get("indent"),s=n.get("outdent");o&&o.registerChildCommand(n.get("indentCodeBlock"),{priority:"highest"}),s&&s.registerChildCommand(n.get("outdentCodeBlock")),this.listenTo(e.editing.view.document,"enter",(a,t)=>{e.model.document.selection.getLastPosition().parent.is("element","codeBlock")&&(!G(e,t.isSoft)&&!Q(e,t.isSoft)&&X(e),t.preventDefault(),a.stop())},{context:"pre"})}}function X(i){const n=i.model.document,o=n.selection.getLastPosition(),s=o.nodeBefore||o.textNode;let a;s&&s.is("$text")&&(a=x(s)),i.model.change(t=>{i.execute("shiftEnter"),a&&t.insertText(a,n.selection.anchor)})}function G(i,e){const o=i.model.document,s=i.editing.view,a=o.selection.getLastPosition(),t=a.nodeAfter;return e||!o.selection.isCollapsed||!a.isAtStart||!h(t)?!1:(i.model.change(c=>{i.execute("enter");const l=o.selection.anchor.parent.previousSibling;c.rename(l,D),c.setSelection(l,"in"),i.model.schema.removeDisallowedAttributes([l],c),c.remove(t)}),s.scrollToTheSelection(),!0)}function Q(i,e){const n=i.model,o=n.document,s=i.editing.view,a=o.selection.getLastPosition(),t=a.nodeBefore;let c;if(e||!o.selection.isCollapsed||!a.isAtEnd||!t||!t.previousSibling)return!1;if(h(t)&&h(t.previousSibling))c=n.createRange(n.createPositionBefore(t.previousSibling),n.createPositionAfter(t));else if(p(t)&&h(t.previousSibling)&&h(t.previousSibling.previousSibling))c=n.createRange(n.createPositionBefore(t.previousSibling.previousSibling),n.createPositionAfter(t));else if(p(t)&&h(t.previousSibling)&&p(t.previousSibling.previousSibling)&&t.previousSibling.previousSibling&&h(t.previousSibling.previousSibling.previousSibling))c=n.createRange(n.createPositionBefore(t.previousSibling.previousSibling.previousSibling),n.createPositionAfter(t));else return!1;return i.model.change(l=>{l.remove(c),i.execute("enter");const r=o.selection.anchor.parent;l.rename(r,D),i.model.schema.removeDisallowedAttributes([r],l)}),s.scrollToTheSelection(),!0}function p(i){return i&&i.is("$text")&&!i.data.match(/\S/)}function h(i){return i&&i.is("element","softBreak")}const Y='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.87 12.61a.75.75 0 0 1-.089.976l-.085.07-3.154 2.254 3.412 2.414a.75.75 0 0 1 .237.95l-.057.095a.75.75 0 0 1-.95.237l-.096-.058-4.272-3.022-.003-1.223 4.01-2.867a.75.75 0 0 1 1.047.174zm2.795-.231.095.057 4.011 2.867-.003 1.223-4.272 3.022-.095.058a.75.75 0 0 1-.88-.151l-.07-.086-.058-.095a.75.75 0 0 1 .15-.88l.087-.07 3.412-2.414-3.154-2.253-.085-.071a.75.75 0 0 1 .862-1.207zM16 0a2 2 0 0 1 2 2v9.354l-.663-.492-.837-.001V2a.5.5 0 0 0-.5-.5H2a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h3.118L7.156 19H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h14zM5.009 15l.003 1H3v-1h2.009zm2.188-2-1.471 1H5v-1h2.197zM10 11v.095L8.668 12H7v-1h3zm4-2v1H7V9h7zm0-2v1H7V7h7zm-4-2v1H5V5h5zM6 3v1H3V3h3z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Z extends C{static get pluginName(){return"CodeBlockUI"}init(){const e=this.editor,n=e.t,o=e.ui.componentFactory,s=S(e);o.add("codeBlock",a=>{const t=e.commands.get("codeBlock"),c=y(a,R),l=c.buttonView,r=n("Insert code block");return l.set({label:r,tooltip:!0,icon:Y,isToggleable:!0}),l.bind("isOn").to(t,"value",d=>!!d),l.on("execute",()=>{e.execute("codeBlock",{usePreviousLanguageChoice:!0}),e.editing.view.focus()}),c.on("execute",d=>{e.execute("codeBlock",{language:d.source._codeBlockLanguage,forceValue:!0}),e.editing.view.focus()}),c.class="ck-code-block-dropdown",c.bind("isEnabled").to(t),z(c,()=>this._getLanguageListItemDefinitions(s),{role:"menu",ariaLabel:r}),c})}_getLanguageListItemDefinitions(e){const o=this.editor.commands.get("codeBlock"),s=new _;for(const a of e){const t={type:"button",model:new N({_codeBlockLanguage:a.language,label:a.label,role:"menuitemradio",withText:!0})};t.model.bind("isOn").to(o,"value",c=>c===t.model._codeBlockLanguage),s.add(t)}return s}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ae extends C{static get requires(){return[K,Z]}static get pluginName(){return"CodeBlock"}}export{ae as C};
