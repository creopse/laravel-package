import{I as F}from"./iconify_vue-6750bec6.js";import{u as U,a as L,c as M,P as V,R as y,_ as B,e as G}from"./index-21fa1843.js";import{R as _}from"./response-error-code-87d1097e.js";import{u as Y}from"./vue-router-e670704e.js";import{d as q,o as z,P as J,aO as s,Y as t,a as T,l as N}from"./vue_runtime-core-4f5fb440.js";import{u as W}from"./vue-i18n-84a05dd5.js";import{c as X,b as $,J as j,G as K,N as Q,_ as Z,L as ee}from"./naive-ui-0caedd43.js";import{r as b,u as o}from"./vue_reactivity-852d8377.js";import{t as D}from"./vue_shared-7dcc3b7f.js";const oe={class:"w-full flex"},me=q({__name:"Admin",props:{mode:{default:"creation"}},emits:["back"],setup(S,{emit:v}){const n=S,w=v,{t:e}=W(),{request:I}=G(),{displayFormErrors:C}=U(),{userHasSuperAdminRole:E}=L(),g=M(),R=Y(),O=X(),i=$(),d=b(!1),h=b(null),P=b({}),x={},H=()=>{var k;(k=h.value)==null||k.validate(async a=>{var p,f,l,c,u,m,A;if(!a){d.value=!0;const r=await I({url:"/auth/profile",method:"post",data:{type:V.ADMIN,id:(p=g.userData)==null?void 0:p.id,profileData:{}}});if(r.failure&&r.error)switch((c=(l=(f=r.error)==null?void 0:f.response)==null?void 0:l.data)==null?void 0:c.errorCode){case _.AUTH_PROFILE_ALREADY_EXISTS:i.error(e("profileAlreadyExists"));break;case _.AUTH_MISSING_DATA:i.error(e("missingData"));break;case _.FORM_INVALID_DATA:C((A=(m=(u=r.error)==null?void 0:u.response)==null?void 0:m.data)==null?void 0:A.data);break;case _.AUTH_USER_NOT_FOUND:i.error(e("userNotFound"));break;case _.AUTH_PROFILE_TYPE_NOT_FOUND:i.error(e("profileTypeNotFound"));break;default:i.error(e("registerProfileNotSuccessful"))}else E()?(g.userData=r.result.data,R.replace(y.HOME.PATH)):(await I({url:"/auth/logout"}),O.success({title:e("success"),content:e("accountCreatedWithSuccess1"),positiveText:e("ok")}),g.resetAuthData(),R.replace(y.LOGIN.PATH));d.value=!1}})};return n.mode=="edition",(k,a)=>{const p=j,f=K,l=B,c=F,u=Q,m=Z,A=ee;return z(),J(A,{size:"medium",class:"w-full"},{default:s(()=>[t(l,{name:"slide-fade",appear:""},{default:s(()=>[T("section",null,[t(p,{title:n.mode=="edition"?o(e)("update"):o(e)("validation"),type:"success",class:"mb-10"},{default:s(()=>[N(D(n.mode=="edition"?o(e)("updateCompleted"):o(e)("registrationCompleted")),1)]),_:1},8,["title"]),t(f,{ref_key:"formRef",ref:h,model:o(P),rules:x,"show-label":!1,"show-require-mark":!1,size:"medium"},null,8,["model"])])]),_:1}),t(l,{name:"slide-fade",appear:""},{default:s(()=>[T("section",oe,[t(m,{class:"flex-1",loading:o(d),onClick:a[0]||(a[0]=r=>w("back"))},{icon:s(()=>[t(u,null,{default:s(()=>[t(c,{icon:"carbon:arrow-left"})]),_:1})]),default:s(()=>[N(" "+D(n.mode=="edition"?o(e)("close"):o(e)("back")),1)]),_:1},8,["loading"]),a[1]||(a[1]=T("div",{class:"w-2"},null,-1)),t(m,{class:"flex-1",type:"primary","icon-placement":"right",loading:o(d),onClick:H},{icon:s(()=>[t(u,null,{default:s(()=>[t(c,{icon:"carbon:checkmark-outline"})]),_:1})]),default:s(()=>[N(" "+D(n.mode=="edition"?o(e)("save"):o(e)("validate")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})}}});export{me as _};
