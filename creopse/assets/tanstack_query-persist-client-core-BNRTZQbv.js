import{h as U,p as q,n as p,m as S}from"./tanstack_query-core-CCfXiMWC.js";var E="tanstack-query";function P({storage:a,buster:l="",maxAge:w=1e3*60*60*24,serialize:v=JSON.stringify,deserialize:f=JSON.parse,prefix:c=E,filters:h}){function y(e){if(e.state.dataUpdatedAt){const t=Date.now()-e.state.dataUpdatedAt>w,s=e.buster!==l;return!!(t||s)}return!0}async function m(e,n){if(a!=null){const t=`${c}-${e}`;try{const s=await a.getItem(t);if(s){const i=await f(s);if(y(i))await a.removeItem(t);else return n&&p.schedule(()=>n(i)),i.state.data}}catch{await a.removeItem(t)}}}async function K(e,n){if(a!=null){const t=n.getQueryCache().find({queryKey:e});t&&await d(t)}}async function d(e){if(a!=null){const n=`${c}-${e.queryHash}`;a.setItem(n,await v({state:e.state,queryKey:e.queryKey,queryHash:e.queryHash,buster:l}))}}async function A(e,n,t){const s=h?S(h,t):!0;if(s&&t.state.data===void 0&&a!=null){const u=await m(t.queryHash,o=>{t.setState({dataUpdatedAt:o.state.dataUpdatedAt,errorUpdatedAt:o.state.errorUpdatedAt}),t.isStale()&&t.fetch()});if(u!=null)return Promise.resolve(u)}const i=await e(n);return s&&a!=null&&p.schedule(()=>{d(t)}),Promise.resolve(i)}async function I(){if(a?.entries){const e=await a.entries();for(const[n,t]of e)if(n.startsWith(c)){const s=await f(t);y(s)&&await a.removeItem(n)}}}async function Q(e,n={}){const{exact:t,queryKey:s}=n;if(a?.entries){const i=await a.entries();for(const[u,o]of i)if(u.startsWith(c)){const r=await f(o);if(y(r)){await a.removeItem(u);continue}if(s){if(t){if(r.queryHash!==U(s))continue}else if(!q(r.queryKey,s))continue}e.setQueryData(r.queryKey,r.state.data,{updatedAt:r.state.dataUpdatedAt})}}}return{persisterFn:A,persistQuery:d,persistQueryByKey:K,retrieveQuery:m,persisterGc:I,restoreQueries:Q}}export{P as e};
