import{i as E}from"./ckeditor_ckeditor5-vue-D9YIFk5Z.js";import{_ as Z}from"./AuthLayout.vue_vue_type_script_setup_true_lang-B7vkOKp2.js";import{I as ee}from"./iconify_vue-DK9FHL8l.js";import{u as ae,a as se,b as te,c as le,d as oe,R as S,e as ne,f as B,g as re,h as ue}from"./index-BkcZCWEr.js";import{p as ie}from"./check-password-strength-DpJr94ZL.js";import{p as de}from"./password-strength-options-ByZgG3BK.js";import{u as pe}from"./app-setting-BRDrXCWg.js";import{a as me}from"./vue-router-JM7pifDK.js";import{_ as ce}from"./validator-DwVK3abb.js";import{a as fe,x as _e,y as we,z as ve,A as ge,C as be,D as he,E as ke,F as Ce,G as ye,B as xe,q as qe,H as Re,I as Ae}from"./naive-ui-U3LV0D3Q.js";import{u as Se}from"./vue-i18n-DGGON2e6.js";const{defineComponent:Ee}=await E("vue"),{unref:e,resolveComponent:aa,createVNode:s,withCtx:l,createElementVNode:_,toDisplayString:b,createTextVNode:h,openBlock:w,createElementBlock:R,createCommentVNode:Ie,createBlock:A}=await E("vue"),Ne={class:"container h-full"},Te={class:"flex justify-center items-center flex-wrap h-full g-6 text-gray-800"},Ue={class:"md:w-10/12 lg:w-7/12 xl:w-6/12 2xl:w-5/12 sm:w-full"},De={class:"w-full flex justify-center"},Ve={class:"px-20"},Fe={key:0},Pe={key:1},Be={key:2},He={class:"w-full flex justify-end px-20"},{defineComponent:Oe,ref:m,onMounted:Le}=await E("vue"),Me=Oe({name:S.SETUP.NAME}),sa=Ee({...Me,setup(je){const{t:a}=Se(),{request:k}=ne(),{displayFormErrors:H}=ae(),{userHasSuperAdminRole:O}=se(),{defaultPrefs:L}=te(),{mutate:M}=pe(),I=me(),c=fe(),N=le(),{getSettingValue:j}=oe(),z=j("disableInstaller","boolean"),r=m(1),i=m("process"),f=m(!1),T=m(null),o=m({lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""}),G={lastname:[{required:!0,message:a("fillRequired")}],firstname:[{required:!0,message:a("fillRequired")}],email:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(p,t){return t&&!ce.isEmail(t)?new Error(a("invalidEmail")):!0}}],password:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(p,t){return t&&["too-weak"].includes(ie(t,de).value)?new Error(a("passwordTooWeak")):!0}}],passwordConfirmation:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(p,t){return t&&t!==o.value.password?new Error(a("nonCompliantPassword")):!0}}]},U=m(null),u=m({dbname:"",host:"",username:"",password:""}),$={dbname:[{required:!0,message:a("fillRequired")}],host:[{required:!0,message:a("fillRequired")}],username:[{required:!0,message:a("fillRequired")}],password:[{required:!1}]},W=()=>{r.value>2&&r.value--},J=()=>{r.value==1?U.value?.validate(async p=>{if(p)c.warning(a("invalidForm"));else{if(f.value=!0,i.value="wait",(await k({url:"/database/create",method:"post",data:u.value})).success){await new Promise(C=>setTimeout(C,3e3));const v=await k({url:"/database/migrate"}),x=await k({url:"/database/seed"});v.success&&x.success?(r.value=2,i.value="process"):(c.error(a("unableToInstallTablesInDb")),i.value="error")}else c.error(a("unableToCreateDbOrEditConfig")),i.value="error";f.value=!1}}):r.value==2?o.value.lastname||o.value.firstname||o.value.email||o.value.password?T.value?.validate(async p=>{if(p)c.warning(a("invalidForm"));else{f.value=!0,i.value="wait";const t=await k({url:"/auth/register",method:"post",data:{lastname:o.value.lastname,firstname:o.value.firstname,email:o.value.email,password:o.value.password,passwordConfirmation:o.value.passwordConfirmation,preferences:L.value}});if(t.failure&&t.error){switch(t.error?.response?.data?.errorCode){case B.AUTH_MISSING_DATA:c.error(a("missingData"));break;case B.FORM_INVALID_DATA:H(t.error?.response?.data?.data);break;default:c.error(a("registrationNotSuccessful"))}i.value="error"}else N.userData=t.result.data.user,O()&&M(re(ue)),N.userData=null,o.value={lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""},r.value=3,i.value="finish";f.value=!1}}):(r.value=3,i.value="finish"):r.value==3&&I.replace(S.LOGIN.PATH)};return Le(()=>{z&&I.replace(S.LOGIN.PATH)}),(p,t)=>{const v=Ae,x=Re,C=we,d=be,g=ge,D=ve,y=ke,V=he,K=Ce,q=ee,F=qe,P=xe,Q=ye,X=_e,Y=Z;return w(),A(Y,{"display-server-alerts":!1},{default:l(()=>[_("div",Ne,[_("div",Te,[_("div",Ue,[s(X,{size:"medium",class:"w-full"},{header:l(()=>[_("div",De,[s(x,{current:e(r),status:e(i)},{default:l(()=>[s(v,{title:e(a)("database")},null,8,["title"]),s(v,{title:e(a)("admin")},null,8,["title"]),s(v,{title:e(a)("completion")},null,8,["title"])]),_:1},8,["current","status"])])]),action:l(()=>[_("section",He,[s(Q,null,{default:l(()=>[s(P,{loading:e(f),disabled:e(r)<3,secondary:"",onClick:W},{icon:l(()=>[s(F,null,{default:l(()=>[s(q,{icon:"carbon:arrow-left"})]),_:1})]),default:l(()=>[h(" "+b(e(a)("previous")),1)]),_:1},8,["loading","disabled"]),s(P,{"icon-placement":"right",loading:e(f),secondary:"",onClick:J},{icon:l(()=>[s(F,null,{default:l(()=>[e(r)==3?(w(),A(q,{key:0,icon:"carbon:checkmark-outline"})):(w(),A(q,{key:1,icon:"carbon:arrow-right"}))]),_:1})]),default:l(()=>[h(" "+b(e(r)==3?e(a)("validate"):e(a)("next")),1)]),_:1},8,["loading"])]),_:1})])]),default:l(()=>[_("div",Ve,[e(r)==1?(w(),R("section",Fe,[s(C,{class:"text-center"},{default:l(()=>[h(b(e(a)("databaseConnectionInfo")),1)]),_:1}),s(D,{ref_key:"dbFormRef",ref:U,model:e(u),rules:$,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:l(()=>[s(g,{label:e(a)("dbname"),path:"dbname"},{default:l(()=>[s(d,{value:e(u).dbname,"onUpdate:value":t[0]||(t[0]=n=>e(u).dbname=n),placeholder:e(a)("dbname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(g,{label:e(a)("username"),path:"username"},{default:l(()=>[s(d,{value:e(u).username,"onUpdate:value":t[1]||(t[1]=n=>e(u).username=n),placeholder:e(a)("username"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(g,{label:e(a)("password"),path:"password"},{default:l(()=>[s(d,{value:e(u).password,"onUpdate:value":t[2]||(t[2]=n=>e(u).password=n),placeholder:e(a)("password"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(g,{label:e(a)("host"),path:"host"},{default:l(()=>[s(d,{value:e(u).host,"onUpdate:value":t[3]||(t[3]=n=>e(u).host=n),placeholder:e(a)("host"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])):e(r)==2?(w(),R("section",Pe,[s(C,{class:"text-center"},{default:l(()=>[h(b(e(a)("createAdmin")),1)]),_:1}),s(D,{ref_key:"adminFormRef",ref:T,model:e(o),rules:G,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:l(()=>[s(V,{"x-gap":"12",span:24},{default:l(()=>[s(y,{span:12,label:e(a)("lastname"),path:"lastname"},{default:l(()=>[s(d,{value:e(o).lastname,"onUpdate:value":t[4]||(t[4]=n=>e(o).lastname=n),placeholder:e(a)("lastname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(y,{span:12,label:e(a)("firstname_s"),path:"firstname"},{default:l(()=>[s(d,{value:e(o).firstname,"onUpdate:value":t[5]||(t[5]=n=>e(o).firstname=n),placeholder:e(a)("firstname_s"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),s(g,{label:e(a)("addressEmail"),path:"email"},{default:l(()=>[s(d,{value:e(o).email,"onUpdate:value":t[6]||(t[6]=n=>e(o).email=n),placeholder:e(a)("addressEmail"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(V,{"x-gap":"12",span:24},{default:l(()=>[s(y,{span:12,label:e(a)("password"),path:"password"},{default:l(()=>[s(d,{value:e(o).password,"onUpdate:value":t[7]||(t[7]=n=>e(o).password=n),placeholder:e(a)("password"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(y,{span:12,label:e(a)("confirmPassword"),path:"passwordConfirmation"},{default:l(()=>[s(d,{value:e(o).passwordConfirmation,"onUpdate:value":t[8]||(t[8]=n=>e(o).passwordConfirmation=n),placeholder:e(a)("confirmPassword"),disabled:!e(o).password,"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1},8,["model"])])):e(r)==3?(w(),R("section",Be,[s(K,{title:e(a)("installationCompleted"),type:"success"},{default:l(()=>[h(b(e(a)("confirmToReturnToLoginPage")),1)]),_:1},8,["title"])])):Ie("",!0)])]),_:1})])])])]),_:1})}}});export{sa as default};
