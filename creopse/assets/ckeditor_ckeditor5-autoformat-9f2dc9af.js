import{P as C}from"./ckeditor_ckeditor5-core-c8d003a2.js";import{f as E}from"./ckeditor_ckeditor5-utils-df07b536.js";import{L as B}from"./ckeditor_ckeditor5-engine-af85ebf5.js";import{D as P}from"./ckeditor_ckeditor5-typing-70b03be4.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function h(n,t,e,o){let c,i=null;typeof o=="function"?c=o:(i=n.commands.get(o),c=()=>{n.execute(o)}),n.model.document.on("change:data",(L,d)=>{if(i&&!i.isEnabled||!t.isEnabled)return;const r=E(n.model.document.selection.getRanges());if(!r.isCollapsed||d.isUndo||!d.isLocal)return;const g=Array.from(n.model.document.differ.getChanges()),a=g[0];if(g.length!=1||a.type!=="insert"||a.name!="$text"||a.length!=1)return;const s=a.position.parent;if(s.is("element","codeBlock")||s.is("element","listItem")&&typeof o!="function"&&!["numberedList","bulletedList","todoList"].includes(o)||i&&i.value===!0)return;const l=s.getChild(0),f=n.model.createRangeOn(l);if(!f.containsRange(r)&&!r.end.isEqual(f.end))return;const m=e.exec(l.data.substr(0,r.end.offset));m&&n.model.enqueueChange(u=>{const p=u.createPositionAt(s,0),_=u.createPositionAt(s,m[0].length),k=new B(p,_);if(c({match:m})!==!1){u.remove(k);const b=n.model.document.selection.getFirstRange(),x=u.createRangeIn(s);s.isEmpty&&!x.isEqual(b)&&!x.containsRange(b,!0)&&u.remove(s)}k.detach(),n.model.enqueueChange(()=>{n.plugins.get("Delete").requestUndoOnBackspace()})})})}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function A(n,t,e,o){let c,i;e instanceof RegExp?c=e:i=e,i=i||(L=>{let d;const r=[],g=[];for(;(d=c.exec(L))!==null&&!(d&&d.length<4);){let{index:a,"1":s,"2":l,"3":f}=d;const m=s+l+f;a+=d[0].length-m.length;const u=[a,a+s.length],p=[a+s.length+l.length,a+s.length+l.length+f.length];r.push(u),r.push(p),g.push([a+s.length,a+s.length+l.length])}return{remove:r,format:g}}),n.model.document.on("change:data",(L,d)=>{if(d.isUndo||!d.isLocal||!t.isEnabled)return;const r=n.model,g=r.document.selection;if(!g.isCollapsed)return;const a=Array.from(r.document.differ.getChanges()),s=a[0];if(a.length!=1||s.type!=="insert"||s.name!="$text"||s.length!=1)return;const l=g.focus,f=l.parent,{text:m,range:u}=y(r.createRange(r.createPositionAt(f,0),l),r),p=i(m),_=R(u.start,p.format,r),k=R(u.start,p.remove,r);_.length&&k.length&&r.enqueueChange(v=>{if(o(v,_)!==!1){for(const x of k.reverse())v.remove(x);r.enqueueChange(()=>{n.plugins.get("Delete").requestUndoOnBackspace()})}})})}function R(n,t,e){return t.filter(o=>o[0]!==void 0&&o[1]!==void 0).map(o=>e.createRange(n.getShiftedBy(o[0]),n.getShiftedBy(o[1])))}function y(n,t){let e=n.start;return{text:Array.from(n.getItems()).reduce((c,i)=>!(i.is("$text")||i.is("$textProxy"))||i.getAttribute("code")?(e=t.createPositionAfter(i),""):c+i.data,""),range:t.createRange(e,n.end)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class I extends C{static get requires(){return[P]}static get pluginName(){return"Autoformat"}afterInit(){this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats()}_addListAutoformats(){const t=this.editor.commands;t.get("bulletedList")&&h(this.editor,this,/^[*-]\s$/,"bulletedList"),t.get("numberedList")&&h(this.editor,this,/^1[.|)]\s$/,"numberedList"),t.get("todoList")&&h(this.editor,this,/^\[\s?\]\s$/,"todoList"),t.get("checkTodoList")&&h(this.editor,this,/^\[\s?x\s?\]\s$/,()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")})}_addBasicStylesAutoformats(){const t=this.editor.commands;if(t.get("bold")){const e=$(this.editor,"bold");A(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,e),A(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,e)}if(t.get("italic")){const e=$(this.editor,"italic");A(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,e),A(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,e)}if(t.get("code")){const e=$(this.editor,"code");A(this.editor,this,/(`)([^`]+)(`)$/g,e)}if(t.get("strikethrough")){const e=$(this.editor,"strikethrough");A(this.editor,this,/(~~)([^~]+)(~~)$/g,e)}}_addHeadingAutoformats(){const t=this.editor.commands.get("heading");t&&t.modelElements.filter(e=>e.match(/^heading[1-6]$/)).forEach(e=>{const o=e[7],c=new RegExp(`^(#{${o}})\\s$`);h(this.editor,this,c,()=>{if(!t.isEnabled||t.value===e)return!1;this.editor.execute("heading",{value:e})})})}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&h(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const t=this.editor,e=t.model.document.selection;t.commands.get("codeBlock")&&h(t,this,/^```$/,()=>{if(e.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})})}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&h(this.editor,this,/^---$/,"horizontalLine")}}function $(n,t){return(e,o)=>{if(!n.commands.get(t).isEnabled)return!1;const i=n.model.schema.getValidRanges(o,t);for(const L of i)e.setAttribute(t,!0,L);e.removeSelectionAttribute(t)}}export{I as A};
