import{C as _,P as m}from"./ckeditor_ckeditor5-core-c8d003a2.js";import"./ckeditor_ckeditor5-utils-df07b536.js";import{t as B,N as b}from"./ckeditor_ckeditor5-engine-af85ebf5.js";import{B as w}from"./ckeditor_ckeditor5-ui-b7ac7aa2.js";import"./color-convert-eee2eef5.js";import"./vanilla-colorful-3f59310b.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class f extends _{constructor(t){super(t),this._stack=[],this._createdBatches=new WeakSet,this.refresh(),this._isEnabledBasedOnSelection=!1,this.listenTo(t.data,"set",(o,e)=>{e[1]={...e[1]};const n=e[1];n.batchType||(n.batchType={isUndoable:!1})},{priority:"high"}),this.listenTo(t.data,"set",(o,e)=>{e[1].batchType.isUndoable||this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}get createdBatches(){return this._createdBatches}addBatch(t){const o=this.editor.model.document.selection,e={ranges:o.hasOwnRange?Array.from(o.getRanges()):[],isBackward:o.isBackward};this._stack.push({batch:t,selection:e}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(t,o,e){const n=this.editor.model,s=n.document,a=[],d=t.map(h=>h.getTransformedByOperations(e)),c=d.flat();for(const h of d){const l=h.filter(r=>r.root!=s.graveyard).filter(r=>!k(r,c));l.length&&(R(l),a.push(l[0]))}a.length&&n.change(h=>{h.setSelection(a,{backward:o})})}_undo(t,o){const e=this.editor.model,n=e.document;this._createdBatches.add(o);const s=t.operations.slice().filter(a=>a.isDocumentOperation);s.reverse();for(const a of s){const d=a.baseVersion+1,c=Array.from(n.history.getOperations(d)),l=B([a.getReversed()],c,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(let r of l){const u=r.affectedSelectable;u&&!e.canEditAt(u)&&(r=new b(r.baseVersion)),o.addOperation(r),e.applyOperation(r),n.history.setOperationAsUndone(a,r)}}}}function R(i){i.sort((t,o)=>t.start.isBefore(o.start)?-1:1);for(let t=1;t<i.length;t++){const e=i[t-1].getJoined(i[t],!0);e&&(t--,i.splice(t,2,e))}}function k(i,t){return t.some(o=>o!==i&&o.containsRange(i,!0))}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class y extends f{execute(t=null){const o=t?this._stack.findIndex(s=>s.batch==t):this._stack.length-1,e=this._stack.splice(o,1)[0],n=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(n,()=>{this._undo(e.batch,n);const s=this.editor.model.document.history.getOperations(e.batch.baseVersion);this._restoreSelection(e.selection.ranges,e.selection.isBackward,s),this.fire("revert",e.batch,n)}),this.refresh()}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class C extends f{execute(){const t=this._stack.pop(),o=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(o,()=>{const n=t.batch.operations[t.batch.operations.length-1].baseVersion+1,s=this.editor.model.document.history.getOperations(n);this._restoreSelection(t.selection.ranges,t.selection.isBackward,s),this._undo(t.batch,o)}),this.refresh()}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class v extends m{constructor(){super(...arguments),this._batchRegistry=new WeakSet}static get pluginName(){return"UndoEditing"}init(){const t=this.editor;this._undoCommand=new y(t),this._redoCommand=new C(t),t.commands.add("undo",this._undoCommand),t.commands.add("redo",this._redoCommand),this.listenTo(t.model,"applyOperation",(o,e)=>{const n=e[0];if(!n.isDocumentOperation)return;const s=n.batch,a=this._redoCommand.createdBatches.has(s),d=this._undoCommand.createdBatches.has(s);this._batchRegistry.has(s)||(this._batchRegistry.add(s),s.isUndoable&&(a?this._undoCommand.addBatch(s):d||(this._undoCommand.addBatch(s),this._redoCommand.clearStack())))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(o,e,n)=>{this._redoCommand.addBatch(n)}),t.keystrokes.set("CTRL+Z","undo"),t.keystrokes.set("CTRL+Y","redo"),t.keystrokes.set("CTRL+SHIFT+Z","redo")}}const p='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>',g='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14.958 9.367-2.189 1.837a.75.75 0 0 0 .965 1.149l3.788-3.18a.747.747 0 0 0 .21-.284.75.75 0 0 0-.17-.945L13.77 4.762a.75.75 0 1 0-.964 1.15l2.331 1.955H6.22A.75.75 0 0 0 6 7.9a4 4 0 1 0 1.477 7.718l-.344-1.489A2.5 2.5 0 1 1 6.039 9.4l-.008-.032h8.927z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class U extends m{static get pluginName(){return"UndoUI"}init(){const t=this.editor,o=t.locale,e=t.t,n=o.uiLanguageDirection=="ltr"?p:g,s=o.uiLanguageDirection=="ltr"?g:p;this._addButton("undo",e("Undo"),"CTRL+Z",n),this._addButton("redo",e("Redo"),"CTRL+Y",s)}_addButton(t,o,e,n){const s=this.editor;s.ui.componentFactory.add(t,a=>{const d=s.commands.get(t),c=new w(a);return c.set({label:o,icon:n,keystroke:e,tooltip:!0}),c.bind("isEnabled").to(d,"isEnabled"),this.listenTo(c,"execute",()=>{s.execute(t),s.editing.view.focus()}),c})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class I extends m{static get requires(){return[v,U]}static get pluginName(){return"Undo"}}export{I as U};
