import{m as K}from"./tanstack_query-core-D1STKOyV.js";var Q="tanstack-query";function S({storage:a,buster:f="",maxAge:p=1e3*60*60*24,serialize:w=JSON.stringify,deserialize:u=JSON.parse,prefix:r=Q,filters:d}){function c(e){if(e.state.dataUpdatedAt){const t=Date.now()-e.state.dataUpdatedAt>p,n=e.buster!==f;return!!(t||n)}return!0}async function y(e,s){if(a!=null){const t=`${r}-${e}`;try{const n=await a.getItem(t);if(n){const i=await u(n);if(c(i))await a.removeItem(t);else return s&&setTimeout(()=>s(i),0),i.state.data}}catch{await a.removeItem(t)}}}async function h(e,s){if(a!=null){const t=s.getQueryCache().find({queryKey:e});t&&await o(t)}}async function o(e){if(a!=null){const s=`${r}-${e.queryHash}`;a.setItem(s,await w({state:e.state,queryKey:e.queryKey,queryHash:e.queryHash,buster:f}))}}async function v(e,s,t){const n=d?K(d,t):!0;if(n&&t.state.data===void 0&&a!=null){const l=await y(t.queryHash,m=>{t.setState({dataUpdatedAt:m.state.dataUpdatedAt,errorUpdatedAt:m.state.errorUpdatedAt}),t.isStale()&&t.fetch()});if(l!=null)return Promise.resolve(l)}const i=await e(s);return n&&a!=null&&setTimeout(()=>{o(t)},0),Promise.resolve(i)}async function A(){if(a?.entries){const e=await a.entries();for(const[s,t]of e)if(s.startsWith(r)){const n=await u(t);c(n)&&await a.removeItem(s)}}}async function I(e){if(a?.entries){const s=await a.entries();for(const[t,n]of s)if(t.startsWith(r)){const i=await u(n);c(i)?await a.removeItem(t):e.setQueryData(i.queryKey,i.state.data,{updatedAt:i.state.dataUpdatedAt})}}}return{persisterFn:v,persistQuery:o,persistQueryByKey:h,retrieveQuery:y,persisterGc:A,persisterRestoreAll:I}}export{S as e};
