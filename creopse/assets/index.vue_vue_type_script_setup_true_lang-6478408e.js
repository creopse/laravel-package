import{c as It,b as Ut}from"./vueuse_core-e3c6c607.js";import{u as St,k as lt,r as Xe,l as zt,m as Tt,n as nt,o as Et,_ as At,e as Dt,c as Ot}from"./index-818706be.js";import{d as pe,p as Oe,w as Pe,aH as Lt,o as s,P as x,aO as l,r as De,Q as b,a as d,u as Ft,b as at,y as st,z as Bt,i as Le,c as p,Y as n,l as j,F as fe,ar as Ne,h as Vt,ag as Je,s as Nt,aF as Ze}from"./vue_runtime-core-4f5fb440.js";import{a4 as ot,a as it,b as Re,c as Pt,N as He,_ as je,M as Rt,j as Ht,E as ut,a5 as ct,a8 as jt,a9 as Gt,L as dt,ab as Yt,W as qt,g as rt,R as Wt,I as Kt,ac as Qt,a1 as Xt,P as _t,a2 as Jt,ad as Zt,ai as el,V as tl,ar as ll,O as nl,X as al,ae as sl,af as ol,ao as il,al as ul}from"./naive-ui-0ed228f2.js";import{r as v,u as e,c as W}from"./vue_reactivity-852d8377.js";import{n as et,t as c}from"./vue_shared-7dcc3b7f.js";import{u as cl,M as r,_ as dl}from"./media-library-a580bf59.js";import{I as Ge}from"./iconify_vue-6750bec6.js";import{v as Ae}from"./uuid-cf522c50.js";import{u as Fe}from"./vue-i18n-84a05dd5.js";import{_ as tt}from"./validator-c0254ba9.js";import{b as rl}from"./axios-96fb5abd.js";const _l=pe({__name:"NFullscreenModal",props:{modelValue:{type:Boolean},maskClosable:{type:Boolean,default:!1},closeOnEsc:{type:Boolean,default:!0},segmented:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},bordered:{type:Boolean,default:!1},title:{default:""},onClose:{type:Function,default:void 0}},emits:["update:modelValue","onSizeChange"],setup(K,{emit:_}){const t=K,h=_,{width:a,height:A}=It(),y=Oe({get(){return t.modelValue},set(M){h("update:modelValue",M)}}),m=v(0),I=()=>{const M=document.querySelector(".fullscreen-modal-header");if(!M)return;const D=window.getComputedStyle(M);m.value=parseFloat(D.height),h("onSizeChange",{windowWidth:a.value,windowHeight:A.value,headerHeight:m.value,contentHeight:A.value-m.value})};Pe(()=>t.modelValue,M=>{M&&Ft(()=>I())}),Pe(()=>[a.value,A.value],()=>I());const $=Lt(),T=Oe(()=>!!$.header||!!$["header-extra"]),{pickByTheme:N}=St();return(M,D)=>{const P=ot;return s(),x(P,{show:e(y),"onUpdate:show":D[0]||(D[0]=Q=>W(y)?y.value=Q:null),preset:"card",closable:t.closable,segmented:t.segmented,bordered:t.bordered,"mask-closable":t.maskClosable,"close-on-esc":t.closeOnEsc,title:t.title,style:et(`width: ${e(a)}px; min-height: ${e(A)}px`),"header-style":`background-color: ${e(N)("white","rgba(24, 24, 28, 1)")}`,"header-class":`fullscreen-modal-header ${e(T)?"fixed top-0 w-full z-50":""} `,"content-class":"!p-0 fullscreen-modal-content",onClose:M.onClose},{header:l(()=>[e($).header?De(M.$slots,"header",{key:0}):b("",!0)]),"header-extra":l(()=>[e($)["header-extra"]?De(M.$slots,"header-extra",{key:0}):b("",!0)]),default:l(()=>[d("section",{style:et(`margin-top: ${e(T)?e(m):"0"}px`)},[De(M.$slots,"default")],4)]),_:3},8,["show","closable","segmented","bordered","mask-closable","close-on-esc","title","style","header-style","header-class","onClose"])}}}),pt=pe({__name:"MountedTeleport",props:{to:{}},setup(K){const _=K,t=v(!1);return at(()=>{t.value=!0}),st(()=>{t.value=!1}),(h,a)=>e(t)?(s(),x(Bt,{key:0,to:_.to},[De(h.$slots,"default")],8,["to"])):b("",!0)}}),Be=Symbol(),pl={class:"px-10"},ml={key:0,class:"flex items-center gap-3"},fl={key:1,class:"flex items-center gap-3"},vl={class:"flex justify-between items-center"},yl={class:"flex items-center gap-3"},hl={key:0},gl={key:0},kl={key:0},bl={class:"flex items-center justify-center h-[200px] relative"},wl={class:"text-center text-dimgray text-sm"},xl={class:"flex items-center gap-2"},$l={class:"flex items-center gap-2"},Ml={key:1,class:"flex items-center justify-center"},Cl={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},Il=["src"],Ul={id:"video",autoplay:"",controls:"",style:{width:"100%"}},Sl=["src"],zl={class:"w-[30%]"},Tl={key:0},El={key:1},Al={key:2},Dl={key:3},Ol={key:4},Ll={key:0},Fl={key:1},Bl={key:2},Vl={key:3},Nl={key:4},Pl={key:5},Rl={key:6},Hl=pe({__name:"MediaLibrary",emits:["validate"],setup(K,{emit:_}){const t=Le(Be),h=_,{t:a,locale:A}=Fe(),{request:y}=Dt(),m=it(),I=Re(),$=Pt(),{mediaFileTypes:T}=cl(),N=v(Ae()),M=v(!1),D=v(!1),P=v(0),Q=v(""),ve=v(null),X=v([]),G=v({[r.DOCUMENT]:0,[r.IMAGE]:0,[r.VIDEO]:0,[r.AUDIO]:0,[r.OTHER]:0}),k=v(!1),f=v([]),O=Oe(()=>T.filter(i=>i.value==r.DOCUMENT&&(t==null?void 0:t.displayDocuments)||i.value==r.IMAGE&&(t==null?void 0:t.displayImages)||i.value==r.VIDEO&&(t==null?void 0:t.displayVideos)||i.value==r.AUDIO&&(t==null?void 0:t.displayAudios)||i.value==r.OTHER&&(t==null?void 0:t.displayOtherTypes))),B=v([]),Y=v(T.length===O.value.length?0:O.value[0].value),L=i=>{let u=`${i}&query=${Q.value}&type=${Y.value}`;for(const g of B.value)u+=`&months[]=${g}`;return u},J=i=>Vt("span",{},{default:()=>Xe(i.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:A.value})}),Z=v(0),U=v(12),R=v(1),ye=i=>{E(L(`/media-files?pageSize=${U.value}&page=${i}`))},he=i=>{U.value=i,E(L(`/media-files?pageSize=${U.value}`))},E=async(i=null,u=!1)=>{var z,q,de,Se,ze;D.value=!0,m.start();const g=await y({url:i||L(`/media-files?pageSize=${U.value}`)});if(g.success&&g.result&&(X.value=((z=g.result.data)==null?void 0:z.mediaFiles)||[],Z.value=((de=(q=g.result.data)==null?void 0:q.meta)==null?void 0:de.total)||0,R.value=((ze=(Se=g.result.data)==null?void 0:Se.meta)==null?void 0:ze.currentPage)||1),u){const ne=await y({url:"/media-files/list/months"});ne.success&&ne.result&&(f.value=(ne.result.data||[]).map(ae=>({label:ae,value:ae})));const me=await y({url:"/count/media-files"});me.success&&me.result&&(P.value=me.result.data);const ge=await y({url:`/count/media-files/type/${r.IMAGE}`});ge.success&&ge.result&&(G.value[r.IMAGE]=ge.result.data);const re=await y({url:`/count/media-files/type/${r.VIDEO}`});re.success&&re.result&&(G.value[r.VIDEO]=re.result.data);const ke=await y({url:`/count/media-files/type/${r.AUDIO}`});ke.success&&ke.result&&(G.value[r.AUDIO]=ke.result.data);const be=await y({url:`/count/media-files/type/${r.OTHER}`});be.success&&be.result&&(G.value[r.OTHER]=be.result.data);const we=await y({url:`/count/media-files/type/${r.DOCUMENT}`});if(we.success&&we.result&&(G.value[r.DOCUMENT]=we.result.data),t!=null&&t.preselectedMediaList&&Array.isArray(t==null?void 0:t.preselectedMediaList)){const ae=await y({url:"/media-files/list",method:"post",data:{ids:t==null?void 0:t.preselectedMediaList}});if(ae.success&&ae.result){V.value=ae.result.data,H.value={};for(const Te of V.value)Te.id&&(H.value[Te.id]=!0)}}}let C=!0;X.value.length===0&&(C=!1);for(const ne of X.value)if(ne.id&&!H.value[ne.id]){C=!1;break}k.value=C,N.value=Ae(),m.finish(),D.value=!1};E(null,!0);const F=async i=>{$.warning({title:a("confirm"),content:a("confirmDeleteMediaFile"),positiveText:a("yes"),negativeText:a("no"),onPositiveClick:async()=>{(await y({method:"delete",url:`/media-files/${i.id}`})).success?(I.success(a("success")),E(L(`/media-files?pageSize=${U.value}&page=${R.value}`),!0)):I.error(a("anErrorOccurred"))}})},{copy:te,copied:$e,isSupported:Me}=Ut(),Ce=async i=>{i.url&&te(i.url)};Pe(()=>$e.value,i=>{i&&I.success(a("mediaLinkCopied"))});const le=v(null),se=v(!1),oe=v(!1),Ie=async i=>{switch(le.value=i,i.type){case r.IMAGE:break;case r.VIDEO:oe.value=!0;break;case r.AUDIO:se.value=!0;break;case r.DOCUMENT:window.open(i.url);break;default:I.info(a("cannotOpenThisFile"));break}},w=v(null),ie=v(!1),mt=async i=>{w.value=i,ie.value=!0},Ve=v(null),ue=v(null),ce=v(!1),ft=async i=>{ue.value=i,m.start();const u=await y({url:"/file/download",method:"post",data:{path:i.path},responseType:"blob"});u.success&&u.result&&(Ve.value=await zt(u.result)),m.finish(),ce.value=!0},vt=async(i,u)=>{var g=Tt(u);g=await nt(g,{maxSizeMB:1});const C=new FormData;C.append("file",g),$.warning({title:a("registration"),content:a("confirmReplaceCurrentFile"),positiveText:a("yes"),negativeText:a("no"),onPositiveClick:async()=>{var q,de;M.value=!0,m.start(),ue.value&&C.append("filename",(q=ue.value)==null?void 0:q.name);const z=await y({url:`/media-files/replace/${(de=ue.value)==null?void 0:de.id}`,method:"post",data:C});z.success&&z.result?(ce.value=!1,E(L(`/media-files?pageSize=${U.value}&page=${R.value}`),!0)):I.error(a("anErrorOccurred")),m.finish(),M.value=!1},onNegativeClick:async()=>{var q;M.value=!0,m.start(),ue.value&&C.append("filename",Et(6)+"-"+((q=ue.value)==null?void 0:q.name));const z=await y({url:"/media-files/upload",method:"post",data:C});z.success&&z.result?(ce.value=!1,E(L(`/media-files?pageSize=${U.value}&page=${R.value}`),!0)):I.error(a("anErrorOccurred")),m.finish(),M.value=!1}})},H=v({}),V=v([]),Ue=Oe(()=>{let i=0;for(const u in H.value)H.value[u]&&i++;return i}),yt=i=>{const u=!(t!=null&&t.selectionMultiple),g=(t==null?void 0:t.selectionMultiple)&&!(t!=null&&t.selectionLimit),C=(t==null?void 0:t.selectionMultiple)&&(t==null?void 0:t.selectionLimit)&&V.value.length<(t==null?void 0:t.selectionLimit),z=(t==null?void 0:t.selectionMultiple)&&(t==null?void 0:t.selectionLimit)&&i.id&&H.value[i.id];return u||g||z||C},ht=()=>{let i=V.value;(t==null?void 0:t.selectionType)=="url"?i=V.value.map(u=>u.url):(t==null?void 0:t.selectionType)=="path"&&(i=V.value.map(u=>u.path)),h("validate",t!=null&&t.selectionMultiple?i:i[0])},gt=()=>{H.value={},V.value=[],E(L(`/media-files?pageSize=${U.value}&page=${R.value}`))},kt=async()=>(Ue.value?$.warning({title:a("confirm"),content:a("deleteSelectionWarningMessage",[Ue.value]),positiveText:a("yes"),negativeText:a("no"),onPositiveClick:async()=>{M.value=!0,m.start();for(const i in H.value)H.value[i]&&await y({url:`/media-files/${i}`,method:"delete"});m.finish(),M.value=!1,I.success(a("success")),H.value={},V.value=[],E(null,!0)}}):I.warning(a("noItemSelected")),!1);return(i,u)=>{var qe,We,Ke,Qe;const g=Ge,C=He,z=je,q=Rt,de=Ht,Se=ut,ze=ct,ne=pt,me=jt,ge=Gt,re=dt,ke=Yt,be=qt,we=rt,ae=At,Te=Wt,bt=Kt,wt=Qt,xt=Xt,$t=_t,Mt=Jt,Ee=ot,Ye=Zt,Ct=dl;return s(),p(fe,null,[d("section",pl,[n(ne,{to:"#actions"},{default:l(()=>[e(Ue)>0?(s(),p("section",ml,[d("span",null,c(e(a)("nbItemsSelected",[e(Ue)])),1),n(z,{type:"success",size:"small",onClick:ht},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"mdi:check"})]),_:1})]),default:l(()=>[j(" "+c(e(a)("validateSelection")),1)]),_:1}),n(z,{type:"error",size:"small",onClick:kt},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"carbon:trash-can"})]),_:1})]),default:l(()=>[j(" "+c(e(a)("deleteSelection")),1)]),_:1}),n(z,{type:"warning",size:"small",onClick:gt},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"mdi:close"})]),_:1})]),default:l(()=>[j(" "+c(e(a)("cancelSelection")),1)]),_:1})])):(s(),p("section",fl,[n(de,{value:e(B),"onUpdate:value":[u[1]||(u[1]=o=>W(B)?B.value=o:null),u[2]||(u[2]=o=>E())],"render-label":J,options:e(f),placeholder:e(a)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:l(()=>[n(q,{size:"large",class:"w-full","default-checked":e(f).length&&e(B).length===e(f).length,"onUpdate:checked":u[0]||(u[0]=o=>{o?B.value=e(f).map(ee=>ee.value):B.value=[],E()})},{default:l(()=>[j(c(e(a)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),n(ze,{class:"!w-[250px]"},{default:l(()=>[n(Se,{ref_key:"searchInputRef",ref:ve,value:e(Q),"onUpdate:value":[u[3]||(u[3]=o=>W(Q)?Q.value=o:null),u[4]||(u[4]=o=>{o||E(L(`/media-files?pageSize=${e(U)}&page=${e(R)}`))})],clearable:!0,placeholder:e(a)("search")},null,8,["value","placeholder"]),n(z,{type:"primary",onClick:u[5]||(u[5]=o=>E(L(`/media-files?pageSize=${e(U)}&page=${e(R)}`)))},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})]))]),_:1}),n(re,{size:"small",class:"mb-5"},{default:l(()=>{var o,ee;return[d("div",vl,[d("div",yl,[(o=e(t))!=null&&o.selectionMultiple&&!((ee=e(t))!=null&&ee.selectionLimit)?(s(),x(q,{key:0,checked:e(k),"onUpdate:checked":[u[6]||(u[6]=S=>W(k)?k.value=S:null),u[7]||(u[7]=S=>{for(const _e of e(X))_e.id&&(e(H)[_e.id]=S,e(V).findIndex(xe=>xe.id==_e.id)===-1&&e(V).push(_e));N.value=("uuidv4"in i?i.uuidv4:e(Ae))()})]},{default:l(()=>[j(c(e(a)("selectAll")),1)]),_:1},8,["checked"])):b("",!0)]),n(ge,{value:e(Y),"onUpdate:value":[u[8]||(u[8]=S=>W(Y)?Y.value=S:null),u[9]||(u[9]=S=>E())],name:"filtertyperadiobuttongroup",size:"medium"},{default:l(()=>[e(T).length===e(O).length?(s(),x(me,{key:0,value:0},{default:l(()=>[j(c(e(a)("all"))+"  ",1),e(P)?(s(),p("span",hl," ("+c(e(P))+") ",1)):b("",!0)]),_:1})):b("",!0),(s(!0),p(fe,null,Ne(e(O),S=>(s(),x(me,{key:S.value,value:S.value},{default:l(()=>[j(c(S.label)+"  ",1),e(G)[S.value]?(s(),p("span",gl," ("+c(e(G)[S.value])+") ",1)):b("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]}),_:1}),n(re,{embedded:"",class:"py-2"},{default:l(()=>[e(X).length&&!e(D)?(s(),p("section",kl,[n(wt,{"show-toolbar-tooltip":""},{default:l(()=>[n(bt,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:4 900:4 1400:6"},{default:l(()=>[(s(!0),p(fe,null,Ne(e(X),(o,ee)=>(s(),x(Te,{key:ee},{default:l(()=>[n(ae,{name:"slide-fade",appear:""},{default:l(()=>[n(re,{bordered:"",hoverable:""},{cover:l(()=>[d("div",bl,[o.type==e(r).IMAGE?(s(),p(fe,{key:0},[o.url?(s(),x(ke,{key:0,src:o.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):b("",!0)],64)):o.type==e(r).VIDEO?(s(),x(C,{key:1,size:"96"},{default:l(()=>[n(g,{icon:"carbon:document-video"})]),_:1})):o.type==e(r).AUDIO?(s(),x(C,{key:2,size:"96"},{default:l(()=>[n(g,{icon:"carbon:document-audio"})]),_:1})):o.type==e(r).DOCUMENT?(s(),x(C,{key:3,size:"96"},{default:l(()=>[n(g,{icon:"carbon:document"})]),_:1})):(s(),x(C,{key:4,size:"96"},{default:l(()=>[n(g,{icon:"carbon:document-unknown"})]),_:1}))])]),header:l(()=>[d("div",wl,[n(be,{"line-clamp":1},{default:l(()=>[o.id?(s(),p(fe,{key:0},[yt(o)?(s(),x(q,{key:e(N),checked:e(H)[o.id],"onUpdate:checked":[S=>e(H)[o.id]=S,S=>{var _e;(_e=e(t))!=null&&_e.selectionMultiple?S?e(V).findIndex(xe=>xe.id==o.id)===-1&&e(V).push(o):V.value=e(V).filter(xe=>xe.id!=o.id):o&&o.id&&(V.value=[o],H.value={[o.id]:S}),N.value=("uuidv4"in i?i.uuidv4:e(Ae))()}],class:"mr-1"},null,8,["checked","onUpdate:checked"])):b("",!0)],64)):b("",!0),j(" "+c(o.name),1)]),_:2},1024)])]),action:l(()=>[n(we,{justify:"space-between",align:"center"},{default:l(()=>[d("div",xl,[o.type!=e(r).IMAGE?(s(),x(z,{key:0,ternary:"",circle:"",title:e(a)("preview"),onClick:S=>Ie(o)},{icon:l(()=>[n(C,null,{default:l(()=>[[e(r).AUDIO,e(r).VIDEO].includes(o.type)?(s(),x(g,{key:0,icon:"mdi:play"})):(s(),x(g,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):b("",!0),n(z,{ternary:"",circle:"",title:e(a)("details"),onClick:S=>mt(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"mdi:information-variant-circle"})]),_:1})]),_:2},1032,["title","onClick"])]),d("div",$l,[e(Me)?(s(),x(z,{key:0,ternary:"",circle:"",title:e(a)("copy"),onClick:S=>Ce(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"carbon:copy"})]),_:1})]),_:2},1032,["title","onClick"])):b("",!0),o.type==e(r).IMAGE?(s(),x(z,{key:1,ternary:"",circle:"",title:e(a)("edit"),onClick:S=>ft(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"carbon:edit"})]),_:1})]),_:2},1032,["title","onClick"])):b("",!0),n(z,{ternary:"",circle:"",title:e(a)("delete"),onClick:S=>F(o)},{icon:l(()=>[n(C,null,{default:l(()=>[n(g,{icon:"carbon:trash-can"})]),_:1})]),_:2},1032,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n(xt,{page:e(R),"onUpdate:page":[u[10]||(u[10]=o=>W(R)?R.value=o:null),ye],class:"mt-10 justify-center","show-size-picker":"","page-size":e(U),"page-sizes":[8,12,24,36,48,60],"page-count":Math.ceil(e(Z)/e(U)),"onUpdate:pageSize":he},null,8,["page","page-size","page-count"])])):e(D)?(s(),p("section",Ml,[n($t,{size:"medium"})])):(s(),x(Mt,{key:2,description:e(a)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),n(Ee,{show:e(se),"onUpdate:show":u[11]||(u[11]=o=>W(se)?se.value=o:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(qe=e(le))==null?void 0:qe.name},{default:l(()=>{var o;return[d("audio",Cl,[d("source",{src:(o=e(le))==null?void 0:o.url},null,8,Il)])]}),_:1},8,["show","title"]),n(Ee,{show:e(oe),"onUpdate:show":u[12]||(u[12]=o=>W(oe)?oe.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(We=e(le))==null?void 0:We.name},{default:l(()=>{var o;return[d("video",Ul,[d("source",{src:(o=e(le))==null?void 0:o.url},null,8,Sl)])]}),_:1},8,["show","title"]),n(Ee,{show:e(ie),"onUpdate:show":u[13]||(u[13]=o=>W(ie)?ie.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(Ke=e(w))==null?void 0:Ke.name},{default:l(()=>[e(w)?(s(),x(Ye,{key:0,striped:"","single-line":!1,size:"small"},{default:l(()=>[d("tbody",null,[d("tr",null,[d("td",zl,c(e(a)("name")),1),d("td",null,c(e(w).name),1)]),d("tr",null,[d("td",null,c(e(a)("link")),1),d("td",null,[d("small",null,c(e(w).url),1)])]),d("tr",null,[d("td",null,c(e(a)("type")),1),d("td",null,[e(w).type==e(r).IMAGE?(s(),p("span",Tl,c(e(a)("image")),1)):e(w).type==e(r).VIDEO?(s(),p("span",El,c(e(a)("video")),1)):e(w).type==e(r).AUDIO?(s(),p("span",Al,c(e(a)("audio")),1)):e(w).type==e(r).DOCUMENT?(s(),p("span",Dl,c(e(a)("document")),1)):(s(),p("span",Ol,c(e(a)("other")),1))])]),e(w).size?(s(),p("tr",Ll,[d("td",null,c(e(a)("size")),1),d("td",null,c(e(lt)(e(w).size,!0)),1)])):b("",!0),e(w).mimeType?(s(),p("tr",Fl,[d("td",null,c(e(a)("mimeType")),1),d("td",null,c(e(w).mimeType),1)])):b("",!0),e(w).sender?(s(),p("tr",Bl,[d("td",null,c(e(a)("sendBy")),1),d("td",null,c(e(w).sender.fullname),1)])):b("",!0),e(w).title?(s(),p("tr",Vl,[d("td",null,c(e(a)("title")),1),d("td",null,c(e(w).title),1)])):b("",!0),e(w).description?(s(),p("tr",Nl,[d("td",null,c(e(a)("description")),1),d("td",null,[d("small",null,c(e(w).description),1)])])):b("",!0),e(w).createdAt?(s(),p("tr",Pl,[d("td",null,c(e(a)("date")),1),d("td",null,c(e(Xe)(e(w).createdAt)),1)])):b("",!0),e(w).additionalMetadata?(s(),p("tr",Rl,[d("td",null,c(e(a)("metadata")),1),d("td",null,[n(Ye,{striped:"","single-line":"",size:"small"},{default:l(()=>[d("tbody",null,[(s(!0),p(fe,null,Ne(e(w).additionalMetadata||[],(o,ee)=>(s(),p("tr",{key:ee},[d("td",null,c(ee),1),d("td",null,c(o),1)]))),128))])]),_:1})])])):b("",!0)])]),_:1})):b("",!0)]),_:1},8,["show","title"]),n(Ee,{show:e(ce),"onUpdate:show":u[15]||(u[15]=o=>W(ce)?ce.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:(Qe=e(ue))==null?void 0:Qe.name},{default:l(()=>[n(Ct,{"cropper-ratio":void 0,"round-preview":!1,src:e(Ve)?e(Ve):void 0,onCancel:u[14]||(u[14]=o=>ce.value=!1),onSave:vt},null,8,["src"])]),_:1},8,["show","title"])],64)}}}),jl={class:"px-10"},Gl={key:0},Yl={key:0,class:"text-end"},ql=pe({__name:"AddFromAnUrl",emits:["validate"],setup(K,{emit:_}){const{t}=Fe(),h=Re(),a=Le(Be),A=_,y=v(""),m=v([]);return(I,$)=>{const T=el,N=tl,M=Ge,D=He,P=je,Q=ll,ve=ut,X=ct,G=dt;return s(),p("section",jl,[n(G,null,{default:l(()=>{var k;return[(k=e(a))!=null&&k.selectionMultiple?(s(),p("section",Gl,[n(T,{value:e(m),"onUpdate:value":$[0]||($[0]=f=>W(m)?m.value=f:null),placeholder:e(t)("fileUrl"),min:1,max:e(a).selectionLimit||void 0},null,8,["value","placeholder","max"]),e(m).length>0?(s(),p("div",Yl,[n(N),n(P,{type:"primary",disabled:e(m).length!=e(m).filter(f=>f.trim()).length,onClick:$[1]||($[1]=()=>{const f=e(m).map(O=>encodeURI(O));f.findIndex(O=>!("_v"in I?I._v:e(tt)).isURL(O))>-1?e(h).error(e(t)("invalidUrl")):A("validate",f),A("validate",e(m))})},{icon:l(()=>[n(D,null,{default:l(()=>[n(M,{icon:"mdi:check"})]),_:1})]),default:l(()=>[j(" "+c(e(t)("validate")),1)]),_:1},8,["disabled"])])):b("",!0)])):(s(),x(X,{key:1},{default:l(()=>[n(Q,null,{default:l(()=>[j(c(e(t)("fileUrl")),1)]),_:1}),n(ve,{value:e(y),"onUpdate:value":$[2]||($[2]=f=>W(y)?y.value=f:null)},null,8,["value"]),e(y)?(s(),x(P,{key:0,type:"primary",onClick:$[3]||($[3]=()=>{const f=encodeURI(e(y));("_v"in I?I._v:e(tt)).isURL(f)?A("validate",f):e(h).error(e(t)("invalidUrl"))})},{icon:l(()=>[n(D,null,{default:l(()=>[n(M,{icon:"mdi:check"})]),_:1})]),default:l(()=>[j(" "+c(e(t)("validate")),1)]),_:1})):b("",!0)]),_:1}))]}),_:1})])}}}),Wl={class:"px-10"},Kl={class:"flex justify-between items-center"},Ql={style:{"margin-bottom":"12px"}},Xl={key:0,class:"text-xs"},Jl={key:1,class:"text-xs"},Zl={key:2,class:"text-xs"},en={key:3,class:"text-xs"},tn={key:4,class:"text-xs"},ln={key:5,class:"text-xs"},nn=pe({__name:"UploadFiles",setup(K){const _=Le(Be),t=Le("appConfig"),{t:h}=Fe(),a=Re(),A=it(),y=v(),m=v([]),I=v(!1),$=Ot(),T=t==null?void 0:t.apiRequestHeaders;T&&(T.Authorization=`Bearer ${$.accessToken}`);const N=async()=>{y.value.submit()},M=()=>{var k;(k=y.value)==null||k.clear(),m.value=[]},D=k=>{var B,Y,L;const f=k.file.file;if((B=_==null?void 0:_.uploadConfig)!=null&&B.maxSize&&f&&f.size){const J=f.size/1024/1024<=((Y=_==null?void 0:_.uploadConfig)==null?void 0:Y.maxSize);return J||a.error(h("fileSizeNotAllowed")),J}const O=f==null?void 0:f.name.split(".").pop();return O&&((L=_==null?void 0:_.uploadConfig)!=null&&L.excludedExtensions.map(J=>J.toLowerCase()).includes(O.toLowerCase()))?(a.error(h("fileTypeNotAllowed")),!1):!0},P=k=>{m.value=k.fileList},Q=({file:k})=>k,ve=()=>{var k;if((k=_==null?void 0:_.uploadConfig)!=null&&k.limit)return _==null?void 0:_.uploadConfig.limit},X=async({file:k,data:f,headers:O,action:B,onFinish:Y,onError:L,onProgress:J})=>{var E;const Z=new FormData;f&&Object.keys(f).forEach(F=>{Z.append(F,f[F])});const U=k.file,R=U==null?void 0:U.name.split(".").pop(),ye=U==null?void 0:U.name.replace("."+R,""),he=await nt(U,{maxSizeMB:1});Z.append("file",he,ye),Z.append("folder",(E=_==null?void 0:_.uploadConfig)==null?void 0:E.folder),I.value=!0,A.start(),rl.post(B,Z,{headers:O,onUploadProgress:F=>{if(F.total!==null){const te=Math.round(F.loaded*100/F.total);J({percent:te})}}}).then(async()=>{Y();const F=m.value.findIndex(te=>te.id===k.id);F!==-1&&m.value.splice(F,1),a.success(h("success")),A.finish(),I.value=!1}).catch(F=>{console.log(F),a.error(h("anErrorOccurred")),L(),A.finish(),I.value=!1})},G=console.warn;return at(()=>{console.warn=k=>{typeof k=="string"&&k.includes('Non-function value encountered for slot "default"')||G(k)}}),st(()=>{console.warn=G}),(k,f)=>{const O=Ge,B=He,Y=je,L=rt,J=pt,Z=nl,U=al,R=sl,ye=ol,he=_t;return s(),p("section",Wl,[n(J,{to:"#actions"},{default:l(()=>[d("div",Kl,[e(m).length?(s(),x(L,{key:0,align:"center"},{default:l(()=>[n(Y,{disabled:e(m).length==0,onClick:M},{icon:l(()=>[n(B,null,{default:l(()=>[n(O,{icon:"mdi:close"})]),_:1})]),default:l(()=>[j(" "+c(e(h)("clearList")),1)]),_:1},8,["disabled"]),n(Y,{type:"primary",disabled:e(m).length==0,onClick:N},{default:l(()=>[j(c(e(h)("launchImport")),1)]),_:1},8,["disabled"])]),_:1})):b("",!0)])]),_:1}),n(he,{show:!1},{default:l(()=>{var E,F,te;return[n(ye,{ref_key:"upload",ref:y,multiple:"","directory-dnd":"","list-type":"image",max:ve(),"default-upload":!1,headers:e(T),"custom-request":X,action:((F=(E=e(_))==null?void 0:E.uploadConfig)==null?void 0:F.baseUrl)||((te=e(t))==null?void 0:te.apiUrl)+"/media-files/upload",onBeforeUpload:D,onChange:P,onFinish:Q},{default:l(()=>[n(R,{class:"h-[250px] flex flex-col items-center justify-center"},{default:l(()=>[d("div",Ql,[n(B,{size:"48",depth:3},{default:l(()=>[n(O,{icon:"mdi:file-upload"})]),_:1})]),n(Z,{style:{"font-size":"16px"}},{default:l(()=>[j(c(e(h)("uploadAreaTitle")),1)]),_:1}),n(U,{depth:"3",class:"mt-4"},{default:l(()=>{var $e,Me,Ce,le,se,oe,Ie,w,ie;return[(Me=($e=e(_))==null?void 0:$e.uploadConfig)!=null&&Me.limit?(s(),p("span",Xl,c(e(h)("limitToTheNumberOfFilesToSend",[(Ce=e(_))==null?void 0:Ce.uploadConfig.limit])),1)):(s(),p("span",Jl,c(e(h)("noLimitToTheNumberOfFilesToSend")),1)),f[0]||(f[0]=d("br",null,null,-1)),(se=(le=e(_))==null?void 0:le.uploadConfig)!=null&&se.maxSize?(s(),p("span",Zl,c(e(h)("limitToTheSizeOfFilesToSend",[e(lt)((oe=e(_))==null?void 0:oe.uploadConfig.maxSize)])),1)):(s(),p("span",en,c(e(h)("noLimitToTheSizeOfFilesToSend")),1)),f[1]||(f[1]=d("br",null,null,-1)),(w=(Ie=e(_))==null?void 0:Ie.uploadConfig)!=null&&w.excludedExtensions.length?(s(),p("span",tn,c(e(h)("extensionsAreNotAllowed",[(ie=e(_))==null?void 0:ie.uploadConfig.excludedExtensions.join(", ")])),1)):(s(),p("span",ln,c(e(h)("allFileExtensionsAreAllowed")),1))]}),_:1})]),_:1})]),_:1},8,["max","headers","action"])]}),_:1})])}}}),an=pe({name:"MediaPicker"}),hn=pe({...an,props:Je({enableUploadFiles:{type:Boolean,default:!0},enableMediaLibrary:{type:Boolean,default:!0},enableAddFromAnUrl:{type:Boolean,default:!0},displayImages:{type:Boolean,default:!0},displayVideos:{type:Boolean,default:!0},displayAudios:{type:Boolean,default:!0},displayDocuments:{type:Boolean,default:!0},displayOtherTypes:{type:Boolean,default:!0},preselectedMediaList:{default:null},selectionType:{default:"path"},selectionMultiple:{type:Boolean,default:!1},selectionLimit:{default:0},title:{default:""},uploadConfig:{default:()=>({folder:"uploads",limit:0,maxSize:0,baseUrl:null,excludedExtensions:[]})}},{show:{type:Boolean,required:!0,default:!1},showModifiers:{},tab:{default:"media-library"},tabModifiers:{}}),emits:Je(["submit"],["update:show","update:tab"]),setup(K,{emit:_}){const{t}=Fe(),h=K;Nt(Be,h);const a=Ze(K,"show"),A=Ze(K,"tab"),y=_,m=$=>{y("submit",$),a.value=!1},I=$=>{y("submit",$),a.value=!1};return($,T)=>{const N=il,M=ul,D=_l;return s(),x(D,{modelValue:a.value,"onUpdate:modelValue":T[1]||(T[1]=P=>a.value=P),title:$.title,class:"w-full"},{default:l(()=>[n(M,{value:A.value,"onUpdate:value":T[0]||(T[0]=P=>A.value=P),type:"card",size:"large",animated:""},{suffix:l(()=>T[2]||(T[2]=[d("div",{id:"actions",class:"pr-10"},null,-1)])),default:l(()=>[h.enableUploadFiles?(s(),x(N,{key:0,name:"upload-files",tab:e(t)("uploadFiles")},{default:l(()=>[n(nn)]),_:1},8,["tab"])):b("",!0),h.enableMediaLibrary?(s(),x(N,{key:1,name:"media-library",tab:e(t)("mediaLibrary")},{default:l(()=>[n(Hl,{onValidate:m})]),_:1},8,["tab"])):b("",!0),h.enableAddFromAnUrl?(s(),x(N,{key:2,name:"add-from-an-url",tab:e(t)("addFromAnUrl")},{default:l(()=>[n(ql,{onValidate:I})]),_:1},8,["tab"])):b("",!0)]),_:1},8,["value"])]),_:1},8,["modelValue","title"])}}});export{pt as _,hn as a,_l as b};
