import{P as p,C as T}from"./ckeditor_ckeditor5-core-Cqajz_gD.js";import{D as ut}from"./ckeditor_ckeditor5-typing-DcL_fNuA.js";import{E as dt}from"./ckeditor_ckeditor5-enter-B0CSFwo1.js";import{C as mt,Z as ft,k as C,f as gt,a0 as ht,a1 as pt,e as W,u as bt}from"./ckeditor_ckeditor5-utils-Bp8opE8z.js";import{n as U}from"./ckeditor_ckeditor5-font-BvBYz8K6.js";import{C as It}from"./ckeditor_ckeditor5-clipboard-3CV4NNCs.js";import{B as kt,e as At}from"./ckeditor_ckeditor5-ui-wSLROq0V.js";import{T as yt,U as Lt,V as wt}from"./ckeditor_ckeditor5-icons-BkOmZeoU.js";import{D as _t,n as nt}from"./ckeditor_ckeditor5-engine-CS7i4Bo_.js";/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class b{_startElement;_referenceIndent;_isForward;_includeSelf;_sameAttributes;_sameIndent;_lowerIndent;_higherIndent;constructor(t,e){this._startElement=t,this._referenceIndent=t.getAttribute("listIndent"),this._isForward=e.direction=="forward",this._includeSelf=!!e.includeSelf,this._sameAttributes=C(e.sameAttributes||[]),this._sameIndent=!!e.sameIndent,this._lowerIndent=!!e.lowerIndent,this._higherIndent=!!e.higherIndent}static first(t,e){const s=new this(t,e)[Symbol.iterator]();return gt(s)}*[Symbol.iterator](){const t=[];for(const{node:e}of new B(this._getStartNode(),this._isForward?"forward":"backward")){const i=e.getAttribute("listIndent");if(i<this._referenceIndent){if(!this._lowerIndent)break;this._referenceIndent=i}else if(i>this._referenceIndent){if(!this._higherIndent)continue;if(!this._isForward){t.push(e);continue}}else{if(!this._sameIndent){if(this._higherIndent){t.length&&(yield*t,t.length=0);break}continue}if(this._sameAttributes.some(s=>e.getAttribute(s)!==this._startElement.getAttribute(s)))break}t.length&&(yield*t,t.length=0),yield e}}_getStartNode(){return this._includeSelf?this._startElement:this._isForward?this._startElement.nextSibling:this._startElement.previousSibling}}class B{_node;_isForward;_previousNodesByIndent=[];_previous=null;_previousNodeIndent=null;constructor(t,e="forward"){this._node=t,this._isForward=e==="forward"}[Symbol.iterator](){return this}next(){if(!g(this._node))return{done:!0,value:void 0};const t=this._node.getAttribute("listIndent");let e=null;if(this._previous){const s=this._previousNodeIndent;t>s?this._previousNodesByIndent[s]=this._previous:t<s?(e=this._previousNodesByIndent[t]||null,this._previousNodesByIndent.length=t):e=this._previous}const i={node:this._node,previous:this._previous,previousNodeInList:e};return this._previous=this._node,this._previousNodeIndent=t,this._node=this._isForward?this._node.nextSibling:this._node.previousSibling,{value:i,done:!1}}}class St{_listHead;constructor(t){this._listHead=t}[Symbol.iterator](){return new B(this._listHead)}}class S{static next(){return bt()}}function g(n){return!!n&&n.is("element")&&n.hasAttribute("listItemId")}function y(n,t={}){return[...w(n,{...t,direction:"backward"}),...w(n,{...t,direction:"forward"})]}function w(n,t={}){const e=t.direction=="forward",i=Array.from(new b(n,{...t,includeSelf:e,sameIndent:!0,sameAttributes:"listItemId"}));return e?i:i.reverse()}function Ct(n){return Array.from(new b(n,{direction:"forward",higherIndent:!0}))}function rt(n,t){const e=new b(n,{sameIndent:!0,sameAttributes:"listType",...t}),i=new b(n,{sameIndent:!0,sameAttributes:"listType",includeSelf:!0,direction:"forward",...t});return[...Array.from(e).reverse(),...i]}function A(n){return!b.first(n,{sameIndent:!0,sameAttributes:"listItemId"})}function q(n){return!b.first(n,{direction:"forward",sameIndent:!0,sameAttributes:"listItemId"})}function x(n,t={}){n=C(n);const e=t.withNested!==!1,i=new Set;for(const s of n)for(const o of y(s,{higherIndent:e}))i.add(o);return _(i)}function vt(n){n=C(n);const t=new Set;for(const e of n)for(const i of rt(e))t.add(i);return _(t)}function K(n,t){const e=w(n,{direction:"forward"}),i=S.next();for(const s of e)t.setAttribute("listItemId",i,s);return e}function D(n,t,e){const i={};for(const[o,l]of t.getAttributes())o.startsWith("list")&&(i[o]=l);const s=w(n,{direction:"forward"});for(const o of s)e.setAttributes(i,o);return s}function $(n,t,{expand:e,indentBy:i=1}={}){n=C(n);const s=e?x(n):n;for(const o of s){const l=o.getAttribute("listIndent")+i;l<0?R(o,t):t.setAttribute("listIndent",l,o)}return s}function Et(n,t){n=C(n);const e=x(n),i=new Set,s=Math.min(...e.map(l=>l.getAttribute("listIndent"))),o=new Map;for(const l of e)o.set(l,b.first(l,{lowerIndent:!0}));for(const l of e){if(i.has(l))continue;i.add(l);const r=l.getAttribute("listIndent")-1;if(r<0){R(l,t);continue}if(l.getAttribute("listIndent")==s){const c=Bt(l,o.get(l),t);for(const a of c)i.add(a);if(c.length)continue}t.setAttribute("listIndent",r,l)}return _(i)}function R(n,t){n=C(n);for(const e of n)e.is("element","listItem")&&t.rename(e,"paragraph");for(const e of n)for(const i of e.getAttributeKeys())i.startsWith("list")&&t.removeAttribute(i,e);return n}function E(n){if(!n.length)return!1;const t=n[0].getAttribute("listItemId");return t?!n.some(e=>e.getAttribute("listItemId")!=t):!1}function Ft(n,t){const e=[];let i=Number.POSITIVE_INFINITY;for(const{node:s}of new B(n.nextSibling)){const o=s.getAttribute("listIndent");if(o==0)break;o<i&&(i=o);const l=o-i;t.setAttribute("listIndent",l,s),e.push(s)}return e}function _(n){return Array.from(n).filter(t=>t.root.rootName!=="$graveyard").sort((t,e)=>t.index-e.index)}function F(n){const t=n.document.selection.getSelectedElement();return t&&n.schema.isObject(t)&&n.schema.isBlock(t)?t:null}function M(n,t){return t.checkChild(n.parent,"listItem")&&t.checkChild(n,"$text")&&!t.isObject(n)}function Tt(n){return n=="numbered"||n=="customNumbered"}function Bt(n,t,e){return w(t,{direction:"forward"}).pop().index>n.index?D(n,t,e):[]}class H extends T{_direction;constructor(t,e){super(t),this._direction=e}refresh(){this.isEnabled=this._checkEnabled()}execute(){const t=this.editor.model,e=Y(t.document.selection);t.change(i=>{const s=[];E(e)&&!A(e[0])?(this._direction=="forward"&&s.push(...$(e,i)),s.push(...K(e[0],i))):this._direction=="forward"?s.push(...$(e,i,{expand:!0})):s.push(...Et(e,i));for(const o of s){if(!o.hasAttribute("listType"))continue;const l=b.first(o,{sameIndent:!0});l&&i.setAttribute("listType",l.getAttribute("listType"),o)}this._fireAfterExecute(s)})}_fireAfterExecute(t){this.fire("afterExecute",_(new Set(t)))}_checkEnabled(){let t=Y(this.editor.model.document.selection),e=t[0];if(!e)return!1;if(this._direction=="backward"||E(t)&&!A(t[0]))return!0;t=x(t),e=t[0];const i=b.first(e,{sameIndent:!0});return i?i.getAttribute("listType")==e.getAttribute("listType"):!1}}function Y(n){const t=Array.from(n.getSelectedBlocks()),e=t.findIndex(i=>!g(i));return e!=-1&&(t.length=e),t}class v extends T{type;_listWalkerOptions;constructor(t,e,i={}){super(t),this.type=e,this._listWalkerOptions=i.multiLevel?{higherIndent:!0,lowerIndent:!0,sameAttributes:[]}:void 0}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(t={}){const e=this.editor.model,i=e.document,s=F(e),o=Array.from(i.selection.getSelectedBlocks()).filter(r=>e.schema.checkAttribute(r,"listType")||M(r,e.schema)),l=t.forceValue!==void 0?!t.forceValue:this.value;e.change(r=>{if(l){const c=o[o.length-1],a=w(c,{direction:"forward"}),u=[];a.length>1&&u.push(...K(a[1],r)),u.push(...R(o,r)),u.push(...Ft(c,r)),this._fireAfterExecute(u)}else if((s||i.selection.isCollapsed)&&g(o[0])){const c=rt(s||o[0],this._listWalkerOptions);for(const a of c)r.setAttributes({...t.additionalAttributes,listType:this.type},a);this._fireAfterExecute(c)}else{const c=[];for(const a of o)if(!a.hasAttribute("listType"))!a.is("element","listItem")&&M(a,e.schema)&&r.rename(a,"listItem"),r.setAttributes({...t.additionalAttributes,listIndent:0,listItemId:S.next(),listType:this.type},a),c.push(a);else for(const u of x(a,{withNested:!1}))u.getAttribute("listType")!=this.type&&(r.setAttributes({...t.additionalAttributes,listType:this.type},u),c.push(u));this._fireAfterExecute(c)}})}_fireAfterExecute(t){this.fire("afterExecute",_(new Set(t)))}_getValue(){const t=this.editor.model.document.selection,e=Array.from(t.getSelectedBlocks());if(!e.length)return!1;for(const i of e)if(i.getAttribute("listType")!=this.type)return!1;return!0}_checkEnabled(){const t=this.editor.model,e=t.schema,i=t.document.selection,s=Array.from(i.getSelectedBlocks());if(!s.length)return!1;if(this.value)return!0;for(const o of s)if(e.checkAttribute(o,"listType")||M(o,e))return!0;return!1}}class G extends T{_direction;constructor(t,e){super(t),this._direction=e}refresh(){this.isEnabled=this._checkEnabled()}execute({shouldMergeOnBlocksContentLevel:t=!1}={}){const e=this.editor.model,i=e.document.selection,s=[];e.change(o=>{const{firstElement:l,lastElement:r}=this._getMergeSubjectElements(i,t),c=l.getAttribute("listIndent")||0,a=r.getAttribute("listIndent"),u=r.getAttribute("listItemId");if(c!=a){const d=Ct(r);s.push(...$([r,...d],o,{indentBy:c-a,expand:c<a}))}if(t){let d=i;i.isCollapsed&&(d=o.createSelection(o.createRange(o.createPositionAt(l,"end"),o.createPositionAt(r,0)))),e.deleteContent(d,{doNotResetEntireContent:i.isCollapsed});const m=d.getLastPosition().parent,f=m.nextSibling;s.push(m),f&&f!==r&&f.getAttribute("listItemId")==u&&s.push(...D(f,m,o))}else s.push(...D(r,l,o));this._fireAfterExecute(s)})}_fireAfterExecute(t){this.fire("afterExecute",_(new Set(t)))}_checkEnabled(){const t=this.editor.model,e=t.document.selection,i=F(t);if(e.isCollapsed||i){const s=i||e.getFirstPosition().parent;if(!g(s))return!1;const o=this._direction=="backward"?s.previousSibling:s.nextSibling;if(!o||E([s,o]))return!1}else{const s=e.getLastPosition(),o=e.getFirstPosition();if(s.parent===o.parent||!g(s.parent))return!1}return!0}_getMergeSubjectElements(t,e){const i=this.editor.model,s=F(i);let o,l;if(t.isCollapsed||s){const r=s||t.getFirstPosition().parent,c=A(r);this._direction=="backward"?(l=r,c&&!e?o=b.first(r,{sameIndent:!0,lowerIndent:!0}):o=r.previousSibling):(o=r,l=r.nextSibling)}else o=t.getFirstPosition().parent,l=t.getLastPosition().parent;return{firstElement:o,lastElement:l}}}class Z extends T{_direction;constructor(t,e){super(t),this._direction=e}refresh(){this.isEnabled=this._checkEnabled()}execute(){this.editor.model.change(e=>{const i=K(this._getStartBlock(),e);this._fireAfterExecute(i)})}_fireAfterExecute(t){this.fire("afterExecute",_(new Set(t)))}_checkEnabled(){const t=this.editor.model.document.selection,e=this._getStartBlock();return t.isCollapsed&&g(e)&&!A(e)}_getStartBlock(){const e=this.editor.model.document.selection.getFirstPosition().parent;return this._direction=="before"?e:e.nextSibling}}class xt extends p{static get pluginName(){return"ListItemBoldIntegration"}static get isOfficialPlugin(){return!0}static get requires(){return[h]}init(){const t=this.editor,e=t.plugins.get("ListFormatting"),i=t.plugins.get(h);!t.plugins.has("BoldEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.registerFormatAttribute("bold","listItemBold"),i.registerDowncastStrategy({scope:"item",attributeName:"listItemBold",setAttributeOnDowncast(s,o,l,r){o&&(s.addClass("ck-list-marker-bold",l),W.isSafari&&!(r&&r.dataPipeline)&&s.setStyle("--ck-content-list-marker-dummy-bold","0",l))}}))}afterInit(){const t=this.editor,e=t.model;!t.plugins.has("BoldEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.schema.extend("$listItem",{allowAttributes:"listItemBold"}),e.schema.setAttributeProperties("listItemBold",{isFormatting:!0}),e.schema.addAttributeCheck(i=>{if(!i.last.getAttribute("listItemId"))return!1},"listItemBold"),t.conversion.for("upcast").attributeToAttribute({model:"listItemBold",view:{name:"li",classes:"ck-list-marker-bold"}}))}}class Pt extends p{static get pluginName(){return"ListItemItalicIntegration"}static get isOfficialPlugin(){return!0}static get requires(){return[h]}init(){const t=this.editor,e=t.plugins.get("ListFormatting"),i=t.plugins.get(h);!t.plugins.has("ItalicEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.registerFormatAttribute("italic","listItemItalic"),i.registerDowncastStrategy({scope:"item",attributeName:"listItemItalic",setAttributeOnDowncast(s,o,l,r){o&&(s.addClass("ck-list-marker-italic",l),W.isSafari&&!(r&&r.dataPipeline)&&s.setStyle("--ck-content-list-marker-dummy-italic","0",l))}}))}afterInit(){const t=this.editor,e=t.model;!t.plugins.has("ItalicEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.schema.extend("$listItem",{allowAttributes:"listItemItalic"}),e.schema.setAttributeProperties("listItemItalic",{isFormatting:!0}),e.schema.addAttributeCheck(i=>{if(!i.last.getAttribute("listItemId"))return!1},"listItemItalic"),t.conversion.for("upcast").attributeToAttribute({model:"listItemItalic",view:{name:"li",classes:"ck-list-marker-italic"}}))}}class Ot extends p{static get pluginName(){return"ListItemFontSizeIntegration"}static get isOfficialPlugin(){return!0}static get requires(){return[h]}init(){const t=this.editor,e=t.plugins.get("ListFormatting"),i=t.plugins.get(h);if(!t.plugins.has("FontSizeEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting"))return;const s=U(t.config.get("fontSize.options"));e.registerFormatAttribute("fontSize","listItemFontSize"),i.registerDowncastStrategy({scope:"item",attributeName:"listItemFontSize",setAttributeOnDowncast(o,l,r,c){if(l){const a=s.find(u=>u.model==l);a&&a.view&&typeof a.view!="string"?a.view.styles?(o.addClass("ck-list-marker-font-size",r),o.setStyle("--ck-content-list-marker-font-size",a.view.styles["font-size"],r)):a.view.classes&&(o.addClass(`ck-list-marker-font-size-${l}`,r),W.isSafari&&!(c&&c.dataPipeline)&&o.setStyle("--ck-content-list-marker-dummy-font-size","0",r)):(o.addClass("ck-list-marker-font-size",r),o.setStyle("--ck-content-list-marker-font-size",l,r))}}})}afterInit(){const t=this.editor,e=t.model;if(!t.plugins.has("FontSizeEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting"))return;e.schema.extend("$listItem",{allowAttributes:"listItemFontSize"}),e.schema.setAttributeProperties("listItemFontSize",{isFormatting:!0}),e.schema.addAttributeCheck(s=>{if(!s.last.getAttribute("listItemId"))return!1},"listItemFontSize"),t.conversion.for("upcast").elementToAttribute({model:{key:"listItemFontSize",value:s=>s.getStyle("--ck-content-list-marker-font-size")},view:{name:"li",classes:"ck-list-marker-font-size",styles:{"--ck-content-list-marker-font-size":/.*/}}});const i=U(t.config.get("fontSize.options"));for(const s of i)s.model&&s.view&&t.conversion.for("upcast").elementToAttribute({model:{key:"listItemFontSize",value:s.model},view:{name:"li",classes:`ck-list-marker-font-size-${s.model}`}})}}class Nt extends p{static get pluginName(){return"ListItemFontColorIntegration"}static get isOfficialPlugin(){return!0}static get requires(){return[h]}init(){const t=this.editor,e=t.plugins.get("ListFormatting"),i=t.plugins.get(h);!t.plugins.has("FontColorEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.registerFormatAttribute("fontColor","listItemFontColor"),i.registerDowncastStrategy({scope:"item",attributeName:"listItemFontColor",setAttributeOnDowncast(s,o,l){o&&(s.addClass("ck-list-marker-color",l),s.setStyle("--ck-content-list-marker-color",o,l))}}))}afterInit(){const t=this.editor,e=t.model;!t.plugins.has("FontColorEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.schema.extend("$listItem",{allowAttributes:"listItemFontColor"}),e.schema.setAttributeProperties("listItemFontColor",{isFormatting:!0}),e.schema.addAttributeCheck(i=>{if(!i.last.getAttribute("listItemId"))return!1},"listItemFontColor"),t.conversion.for("upcast").attributeToAttribute({model:{key:"listItemFontColor",value:i=>i.getStyle("--ck-content-list-marker-color")},view:{name:"li",classes:"ck-list-marker-color",styles:{"--ck-content-list-marker-color":/.*/}}}))}}class Rt extends p{static get pluginName(){return"ListItemFontFamilyIntegration"}static get isOfficialPlugin(){return!0}static get requires(){return[h]}init(){const t=this.editor,e=t.plugins.get("ListFormatting"),i=t.plugins.get(h);!t.plugins.has("FontFamilyEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.registerFormatAttribute("fontFamily","listItemFontFamily"),i.registerDowncastStrategy({scope:"item",attributeName:"listItemFontFamily",setAttributeOnDowncast(s,o,l){o&&(s.addClass("ck-list-marker-font-family",l),s.setStyle("--ck-content-list-marker-font-family",o,l))}}))}afterInit(){const t=this.editor,e=t.model;!t.plugins.has("FontFamilyEditing")||!this.editor.config.get("list.enableListItemMarkerFormatting")||(e.schema.extend("$listItem",{allowAttributes:"listItemFontFamily"}),e.schema.setAttributeProperties("listItemFontFamily",{isFormatting:!0}),e.schema.addAttributeCheck(i=>{if(!i.last.getAttribute("listItemId"))return!1},"listItemFontFamily"),t.conversion.for("upcast").attributeToAttribute({model:{key:"listItemFontFamily",value:i=>i.getStyle("--ck-content-list-marker-font-family")},view:{name:"li",classes:"ck-list-marker-font-family",styles:{"--ck-content-list-marker-font-family":/.*/}}}))}}class Mt extends p{_loadedFormatting={};static get pluginName(){return"ListFormatting"}static get isOfficialPlugin(){return!0}static get requires(){return[xt,Pt,Ot,Nt,Rt]}constructor(t){super(t),t.config.define("list.enableListItemMarkerFormatting",!0)}afterInit(){this.editor.config.get("list.enableListItemMarkerFormatting")&&this._registerPostfixerForListItemFormatting()}_registerPostfixerForListItemFormatting(){const t=this.editor.model;t.document.registerPostFixer(e=>{const i=t.document.differ.getChanges(),s=new Set;let o=!1;for(const l of i)if(l.type==="attribute")(l.attributeKey=="listItemId"||l.attributeKey=="listType"||this._isInlineOrSelectionFormatting(l.attributeKey)||Object.values(this._loadedFormatting).includes(l.attributeKey))&&(g(l.range.start.nodeAfter)?s.add(l.range.start.nodeAfter):g(l.range.start.parent)&&s.add(l.range.start.parent));else if(g(l.position.nodeAfter)&&s.add(l.position.nodeAfter),g(l.position.nodeBefore)&&s.add(l.position.nodeBefore),g(l.position.parent)&&s.add(l.position.parent),l.type=="insert"&&l.name!="$text"){const r=e.createRangeIn(l.position.nodeAfter);for(const c of r.getItems())g(c)&&s.add(c)}for(const l of s){const r=Vt(t,l,Object.keys(this._loadedFormatting));for(const[c,a]of Object.entries(r)){const u=this._loadedFormatting[c];(a&&Dt(e,l,u,a)||!a&&$t(e,l,u))&&(o=!0)}}return o})}registerFormatAttribute(t,e){this._loadedFormatting[t]=e}_isInlineOrSelectionFormatting(t){return t.replace(/^selection:/,"")in this._loadedFormatting}}function Vt(n,t,e){if(A(t))return J(n,t,e);const i=y(t);return J(n,i[0],e)}function J(n,t,e){if(!zt(t)||n.schema.isLimit(t))return Object.fromEntries(e.map(r=>[r]));if(t.isEmpty)return Object.fromEntries(e.map(r=>[r,t.getAttribute(`selection:${r}`)]));const i=new Set(e),s={},l=n.createRangeIn(t).getWalker({ignoreElementEnd:!0});for(const{item:r}of l){for(const c of i)if(n.schema.checkAttribute(r,c)){const a=r.getAttribute(c);a===void 0?(i.delete(c),s[c]=void 0):s[c]===void 0?s[c]=a:s[c]!==a&&(i.delete(c),s[c]=void 0)}else c in s||(s[c]=void 0);if(!i.size)break;n.schema.isLimit(r)&&l.jumpTo(n.createPositionAfter(r))}return s}function Dt(n,t,e,i){const s=y(t);let o=!1;for(const l of s)(!l.hasAttribute(e)||l.getAttribute(e)!==i)&&(n.setAttribute(e,i,l),o=!0);return o}function $t(n,t,e){const i=y(t);let s=!1;for(const o of i)o.hasAttribute(e)&&(n.removeAttribute(e,o),s=!0);return s}function zt(n){return["numbered","bulleted","customNumbered","customBulleted"].includes(n.getAttribute("listType"))}class jt extends p{static get pluginName(){return"ListUtils"}static get isOfficialPlugin(){return!0}expandListBlocksToCompleteList(t){return vt(t)}isFirstBlockOfListItem(t){return A(t)}isListItemBlock(t){return g(t)}expandListBlocksToCompleteItems(t,e={}){return x(t,e)}isNumberedListType(t){return Tt(t)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Wt(n){return n.is("element","ol")||n.is("element","ul")}function z(n){return n.is("element","li")}function Kt(n){let t=0,e=n.parent;for(;e;){if(z(e))t++;else{const i=e.previousSibling;i&&z(i)&&t++}e=e.parent}return t}function Ut(n,t,e,i=lt(e,t)){return n.createAttributeElement(ot(e),null,{priority:2*t/100-100,id:i})}function qt(n,t,e){return n.createAttributeElement("li",null,{priority:(2*t+1)/100-100,id:e})}function ot(n){return n=="numbered"||n=="customNumbered"?"ol":"ul"}function lt(n,t){return`list-${n}-${t}`}function k(n,t,e){const i=n.nodeBefore;if(g(i)){let s=i;for(const{node:o}of new B(s,"backward"))if(s=o,e.has(s)||(e.add(s),t.has(i)))return;t.add(s)}else{const s=n.nodeAfter;g(s)&&t.add(s)}}function Ht(n,t){let e=0,i=-1,s=null,o=!1;for(const{node:l}of n){const r=l.getAttribute("listIndent");if(r>e){let c;s===null?(s=r-e,c=e):(s>r&&(s=r),c=r-s),c>i+1&&(c=i+1),t.setAttribute("listIndent",c,l),o=!0,i=c}else s=null,e=r+1,i=r}return o}function Yt(n,t,e){const i=new Set;let s=!1;for(const{node:o}of n){if(i.has(o))continue;let l=o.getAttribute("listType"),r=o.getAttribute("listItemId");if(t.has(r)&&(r=S.next()),t.add(r),o.is("element","listItem")){o.getAttribute("listItemId")!=r&&(e.setAttribute("listItemId",r,o),s=!0);continue}for(const c of w(o,{direction:"forward"}))i.add(c),c.getAttribute("listType")!=l&&(r=S.next(),l=c.getAttribute("listType")),c.getAttribute("listItemId")!=r&&(e.setAttribute("listItemId",r,c),s=!0)}return s}function Gt(){return(n,t,e)=>{const{writer:i,schema:s}=e;if(!t.modelRange)return;const o=Array.from(t.modelRange.getItems({shallow:!0})).filter(d=>s.checkAttribute(d,"listItemId"));if(!o.length)return;const l=t.viewItem.getAttribute("data-list-item-id")||S.next();e.consumable.consume(t.viewItem,{attributes:"data-list-item-id"});const r=Kt(t.viewItem);let c=t.viewItem.parent&&t.viewItem.parent.is("element","ol")?"numbered":"bulleted";const a=o[0].getAttribute("listType");a&&(c=a);const u={listItemId:l,listIndent:r,listType:c};for(const d of o)d.hasAttribute("listItemId")||i.setAttributes(u,d);o.length>1&&o[1].getAttribute("listItemId")!=u.listItemId&&e.keepEmptyElement(o[0])}}function Zt(n,t,e,i){return()=>{const r=n.document.differ.getChanges(),c=[],a=new Set,u=new Set,d=new Set;for(const m of r)if(m.type=="insert"&&m.name!="$text")k(m.position,a,d),m.attributes.has("listItemId")?u.add(m.position.nodeAfter):k(m.position.getShiftedBy(m.length),a,d);else if(m.type=="remove"&&m.attributes.has("listItemId"))k(m.position,a,d);else if(m.type=="attribute"){const f=m.range.start.nodeAfter;e.includes(m.attributeKey)?(k(m.range.start,a,d),m.attributeNewValue===null?(k(m.range.start.getShiftedBy(1),a,d),o(f)&&c.push(f)):u.add(f)):g(f)&&o(f)&&c.push(f)}for(const m of a.values())c.push(...s(m,u));for(const m of new Set(c))t.reconvertItem(m)};function s(r,c){const a=[],u=new Set,d=[];for(const{node:m,previous:f}of new B(r)){if(u.has(m))continue;const I=m.getAttribute("listIndent");f&&I<f.getAttribute("listIndent")&&(d.length=I+1),d[I]={modelAttributes:Object.fromEntries(Array.from(m.getAttributes()).filter(([L])=>e.includes(L))),modelElement:m};const P=w(m,{direction:"forward"});for(const L of P)u.add(L),(o(L,P)||l(L,d,c))&&a.push(L)}return a}function o(r,c){const a=t.mapper.toViewElement(r);if(!a)return!1;if(i.fire("checkElement",{modelElement:r,viewElement:a}))return!0;if(!r.is("element","paragraph")&&!r.is("element","listItem"))return!1;const d=at(r,e,c);return d&&a.is("element","p")?!0:!!(!d&&a.is("element","span"))}function l(r,c,a){if(a.has(r))return!1;const u=t.mapper.toViewElement(r);let d=c.length-1;for(let m=u.parent;!m.is("editableElement");m=m.parent){const f=z(m),I=Wt(m);if(!I&&!f)continue;const P=`checkAttributes:${f?"item":"list"}`;if(i.fire(P,{viewElement:m,modelAttributes:c[d].modelAttributes,modelReferenceElement:c[d].modelElement}))break;if(I&&(d--,d<0))return!1}return!0}}function Q(n,t,e,{dataPipeline:i}={}){const s=se(n);return(o,l,r)=>{const{writer:c,mapper:a,consumable:u}=r,d=l.item;if(!n.includes(l.attributeKey)||!s(d,u))return;const m={...r.options,dataPipeline:i},f=Qt(d,a,e);ct(f,c,a),ee(f,c);const I=te(d,f,t,c,m);ie(d,I,t,c,m)}}function Jt(n){return(t,e,i)=>{const{writer:s,mapper:o}=i,l=t.name.split(":")[1];if(!n.checkAttribute(l,"listItemId"))return;const r=o.toViewPosition(e.position),c=e.position.getShiftedBy(e.length),a=o.toViewPosition(c,{isPhantom:!0}),d=s.createRange(r,a).getTrimmed().end.nodeBefore;/* istanbul ignore next -- @preserve */d&&ct(d,s,o)}}function X(n,{dataPipeline:t}={}){return(e,{writer:i})=>{if(!at(e,n))return null;if(!t)return i.createContainerElement("span",{class:"ck-list-bogus-paragraph"});const s=i.createContainerElement("p");return i.setCustomProperty("dataPipeline:transparentRendering",!0,s),s}}function Qt(n,t,e){const i=e.createRangeOn(n);return t.toViewRange(i).getTrimmed().end.nodeBefore}function Xt(n,t){return(e,i)=>{if(i.modelPosition.offset>0)return;const s=i.modelPosition.parent;if(!g(s)||!n.some(a=>a.scope=="itemMarker"&&a.canInjectMarkerIntoElement&&a.canInjectMarkerIntoElement(s)))return;const o=i.mapper.toViewElement(s),l=t.createRangeIn(o),r=l.getWalker();let c=l.start;for(const{item:a}of r){if(a.is("element")&&i.mapper.toModelElement(a)||a.is("$textProxy"))break;a.is("element")&&a.getCustomProperty("listItemMarker")&&(c=t.createPositionAfter(a),r.skip(({previousPosition:u})=>!u.isEqual(c)))}i.viewPosition=c}}function ct(n,t,e){for(;n.parent.is("attributeElement")&&n.parent.getCustomProperty("listItemWrapper");)t.unwrap(t.createRangeOn(n),n.parent);const i=[];s(t.createPositionBefore(n).getWalker({direction:"backward"})),s(t.createRangeIn(n).getWalker());for(const o of i)t.remove(o);function s(o){for(const{item:l}of o){if(l.is("element")&&e.toModelElement(l))break;l.is("element")&&l.getCustomProperty("listItemMarker")&&i.push(l)}}}function te(n,t,e,i,{dataPipeline:s}){let o=i.createRangeOn(t);if(!A(n))return o;for(const l of e){if(l.scope!="itemMarker")continue;const r=l.createElement(i,n,{dataPipeline:s});if(!r||(i.setCustomProperty("listItemMarker",!0,r),l.canInjectMarkerIntoElement&&l.canInjectMarkerIntoElement(n)?i.insert(i.createPositionAt(t,0),r):(i.insert(o.start,r),o=i.createRange(i.createPositionBefore(r),i.createPositionAfter(t))),!l.createWrapperElement||!l.canWrapElement))continue;const c=l.createWrapperElement(i,n,{dataPipeline:s});i.setCustomProperty("listItemWrapper",!0,c),l.canWrapElement(n)?o=i.wrap(o,c):(o=i.wrap(i.createRangeOn(r),c),o=i.createRange(o.start,i.createPositionAfter(t)))}return o}function ee(n,t){let e=n.parent;for(;e.is("attributeElement")&&["ul","ol","li"].includes(e.name);){const i=e.parent;t.unwrap(t.createRangeOn(n),e),e=i}}function ie(n,t,e,i,s){if(!n.hasAttribute("listIndent"))return;const o=n.getAttribute("listIndent");let l=n;for(let r=o;r>=0;r--){const c=qt(i,r,l.getAttribute("listItemId")),a=Ut(i,r,l.getAttribute("listType"));for(const u of e)(u.scope=="list"||u.scope=="item")&&l.hasAttribute(u.attributeName)&&u.setAttributeOnDowncast(i,l.getAttribute(u.attributeName),u.scope=="list"?a:c,s);if(t=i.wrap(t,c),t=i.wrap(t,a),r==0||(l=b.first(l,{lowerIndent:!0}),!l))break}}function se(n){return(t,e)=>{const i=[];for(const s of n)t.hasAttribute(s)&&i.push(`attribute:${s}`);return i.every(s=>e.test(t,s)!==!1)?(i.forEach(s=>e.consume(t,s)),!0):!1}}function at(n,t,e=y(n)){if(!g(n))return!1;for(const i of n.getAttributeKeys())if(!(i.startsWith("selection:")||i=="htmlEmptyBlock")&&!t.includes(i))return!1;return e.length<2}const N=["listType","listIndent","listItemId"];class h extends p{_downcastStrategies=[];static get pluginName(){return"ListEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[dt,ut,jt,It,Mt]}constructor(t){super(t),t.config.define("list.multiBlock",!0)}init(){const t=this.editor,e=t.model,i=t.config.get("list.multiBlock");if(t.plugins.has("LegacyListEditing"))throw new mt("list-feature-conflict",this,{conflictPlugin:"LegacyListEditing"});e.schema.register("$listItem",{allowAttributes:N}),i?(e.schema.extend("$container",{allowAttributesOf:"$listItem"}),e.schema.extend("$block",{allowAttributesOf:"$listItem"}),e.schema.extend("$blockObject",{allowAttributesOf:"$listItem"})):e.schema.register("listItem",{inheritAllFrom:"$block",allowAttributesOf:"$listItem"});for(const s of N)e.schema.setAttributeProperties(s,{copyOnReplace:!0});t.commands.add("numberedList",new v(t,"numbered")),t.commands.add("bulletedList",new v(t,"bulleted")),t.commands.add("customNumberedList",new v(t,"customNumbered",{multiLevel:!0})),t.commands.add("customBulletedList",new v(t,"customBulleted",{multiLevel:!0})),t.commands.add("indentList",new H(t,"forward")),t.commands.add("outdentList",new H(t,"backward")),t.commands.add("splitListItemBefore",new Z(t,"before")),t.commands.add("splitListItemAfter",new Z(t,"after")),i&&(t.commands.add("mergeListItemBackward",new G(t,"backward")),t.commands.add("mergeListItemForward",new G(t,"forward"))),this._setupDeleteIntegration(),this._setupEnterIntegration(),this._setupTabIntegration(),this._setupClipboardIntegration(),this._setupAccessibilityIntegration(),this._setupListItemIdConversionStrategy()}afterInit(){const e=this.editor.commands,i=e.get("indent"),s=e.get("outdent");i&&i.registerChildCommand(e.get("indentList"),{priority:"high"}),s&&s.registerChildCommand(e.get("outdentList"),{priority:"lowest"}),this._setupModelPostFixing(),this._setupConversion()}registerDowncastStrategy(t){this._downcastStrategies.push(t)}getListAttributeNames(){return[...N,...this._downcastStrategies.map(t=>t.attributeName)]}_setupDeleteIntegration(){const t=this.editor,e=t.commands.get("mergeListItemBackward"),i=t.commands.get("mergeListItemForward");this.listenTo(t.editing.view.document,"delete",(s,o)=>{const l=t.model.document.selection;F(t.model)||t.model.change(()=>{const r=l.getFirstPosition();if(l.isCollapsed&&o.direction=="backward"){if(!r.isAtStart)return;const c=r.parent;if(!g(c))return;if(!b.first(c,{sameAttributes:"listType",sameIndent:!0})&&c.getAttribute("listIndent")===0)q(c)||t.execute("splitListItemAfter"),t.execute("outdentList");else{if(!e||!e.isEnabled)return;e.execute({shouldMergeOnBlocksContentLevel:tt(t.model,"backward")})}o.preventDefault(),s.stop()}else{if(l.isCollapsed&&!l.getLastPosition().isAtEnd||!i||!i.isEnabled)return;i.execute({shouldMergeOnBlocksContentLevel:tt(t.model,"forward")}),o.preventDefault(),s.stop()}})},{context:"li"})}_setupEnterIntegration(){const t=this.editor,e=t.model,i=t.commands,s=i.get("enter");this.listenTo(t.editing.view.document,"enter",(o,l)=>{const r=e.document,c=r.selection.getFirstPosition().parent;if(r.selection.isCollapsed&&g(c)&&c.isEmpty&&!l.isSoft){const a=A(c),u=q(c);a&&u?(t.execute("outdentList"),l.preventDefault(),o.stop()):a&&!u?(t.execute("splitListItemAfter"),l.preventDefault(),o.stop()):u&&(t.execute("splitListItemBefore"),l.preventDefault(),o.stop())}},{context:"li"}),this.listenTo(s,"afterExecute",()=>{const o=i.get("splitListItemBefore");if(o.refresh(),!o.isEnabled)return;const r=t.model.document.selection.getLastPosition().parent;y(r).length===2&&o.execute()})}_setupTabIntegration(){const t=this.editor;this.listenTo(t.editing.view.document,"tab",(e,i)=>{const s=i.shiftKey?"outdentList":"indentList";this.editor.commands.get(s).isEnabled&&(t.execute(s),i.stopPropagation(),i.preventDefault(),e.stop())},{context:"li"})}_setupConversion(){const t=this.editor,e=t.model,i=this.getListAttributeNames(),s=t.config.get("list.multiBlock"),o=s?"paragraph":"listItem";t.conversion.for("upcast").elementToElement({view:"li",model:(r,{writer:c})=>c.createElement(o,{listType:""})}).elementToElement({view:"p",model:(r,{writer:c})=>r.parent&&r.parent.is("element","li")?c.createElement(o,{listType:""}):null,converterPriority:"high"}).add(r=>{r.on("element:li",Gt())}),s||t.conversion.for("downcast").elementToElement({model:"listItem",view:"p"}),t.conversion.for("editingDowncast").elementToElement({model:o,view:X(i),converterPriority:"high"}).add(r=>{r.on("attribute",Q(i,this._downcastStrategies,e)),r.on("remove",Jt(e.schema))}),t.conversion.for("dataDowncast").elementToElement({model:o,view:X(i,{dataPipeline:!0}),converterPriority:"high"}).add(r=>{r.on("attribute",Q(i,this._downcastStrategies,e,{dataPipeline:!0}))});const l=Xt(this._downcastStrategies,t.editing.view);t.editing.mapper.on("modelToViewPosition",l),t.data.mapper.on("modelToViewPosition",l),this.listenTo(e.document,"change:data",Zt(e,t.editing,i,this),{priority:"high"}),this.on("checkAttributes:item",(r,{viewElement:c,modelAttributes:a})=>{c.id!=a.listItemId&&(r.return=!0,r.stop())}),this.on("checkAttributes:list",(r,{viewElement:c,modelAttributes:a})=>{(c.name!=ot(a.listType)||c.id!=lt(a.listType,a.listIndent))&&(r.return=!0,r.stop())})}_setupModelPostFixing(){const t=this.editor.model,e=this.getListAttributeNames();t.document.registerPostFixer(i=>ne(t,i,e,this)),this.on("postFixer",(i,{listNodes:s,writer:o})=>{i.return=Ht(s,o)||i.return},{priority:"high"}),this.on("postFixer",(i,{listNodes:s,writer:o,seenIds:l})=>{i.return=Yt(s,l,o)||i.return},{priority:"high"})}_setupClipboardIntegration(){const t=this.editor.model,e=this.editor.plugins.get("ClipboardPipeline");this.listenTo(t,"insertContent",re(t),{priority:"high"}),this.listenTo(e,"outputTransformation",(i,s)=>{t.change(o=>{const l=Array.from(s.content.getChildren()),r=l[l.length-1];if(l.length>1&&r.is("element")&&r.isEmpty&&l.slice(0,-1).every(g)&&o.remove(r),s.method=="copy"||s.method=="cut"){const c=Array.from(s.content.getChildren());E(c)&&R(c,o)}})})}_setupAccessibilityIntegration(){const t=this.editor,e=t.t;t.accessibility.addKeystrokeInfoGroup({id:"list",label:e("Keystrokes that can be used in a list"),keystrokes:[{label:e("Increase list item indent"),keystroke:"Tab"},{label:e("Decrease list item indent"),keystroke:"Shift+Tab"}]})}_setupListItemIdConversionStrategy(){this.registerDowncastStrategy({scope:"item",attributeName:"listItemId",setAttributeOnDowncast(t,e,i,s){s&&(s.skipListItemIds||s.isClipboardPipeline)||t.setAttribute("data-list-item-id",e,i)}})}}function ne(n,t,e,i){const s=n.document.differ.getChanges(),o=new Set,l=new Set,r=i.editor.config.get("list.multiBlock");let c=!1;for(const u of s){if(u.type=="insert"&&u.name!="$text"){const d=u.position.nodeAfter;if(!n.schema.checkAttribute(d,"listItemId"))for(const m of Array.from(d.getAttributeKeys()))e.includes(m)&&(t.removeAttribute(m,d),c=!0);k(u.position,l,o),u.attributes.has("listItemId")||k(u.position.getShiftedBy(u.length),l,o);for(const{item:m,previousPosition:f}of n.createRangeIn(d))g(m)&&k(f,l,o)}else u.type=="remove"?k(u.position,l,o):u.type=="attribute"&&e.includes(u.attributeKey)&&(k(u.range.start,l,o),u.attributeNewValue===null&&k(u.range.start.getShiftedBy(1),l,o));if(!r&&u.type=="attribute"&&N.includes(u.attributeKey)){const d=u.range.start.nodeAfter;u.attributeNewValue===null&&d&&d.is("element","listItem")?(t.rename(d,"paragraph"),c=!0):u.attributeOldValue===null&&d&&d.is("element")&&d.name!="listItem"&&(t.rename(d,"listItem"),c=!0)}}const a=new Set;for(const u of l.values())c=i.fire("postFixer",{listNodes:new St(u),listHead:u,writer:t,seenIds:a})||c;return c}function re(n){return(t,[e,i])=>{const s=e.is("documentFragment")?Array.from(e.getChildren()):[e];if(!s.length)return;const l=(i?n.createSelection(i):n.document.selection).getFirstPosition();let r;if(g(l.parent))r=l.parent;else if(g(l.nodeBefore)&&g(l.nodeAfter))r=l.nodeBefore;else return;n.change(c=>{const a=r.getAttribute("listType"),u=r.getAttribute("listIndent"),d=s[0].getAttribute("listIndent")||0,m=Math.max(u-d,0);for(const f of s){const I=g(f);r.is("element","listItem")&&f.is("element","paragraph")&&c.rename(f,"listItem"),c.setAttributes({listIndent:(I?f.getAttribute("listIndent"):0)+m,listItemId:I?f.getAttribute("listItemId"):S.next(),listType:a},f)}})}}function tt(n,t){const e=n.document.selection;if(!e.isCollapsed)return!F(n);if(t==="forward")return!0;const s=e.getFirstPosition().parent,o=s.previousSibling;return n.schema.isObject(o)?!1:o.isEmpty?!0:E([s,o])}function j(n,t,e,i){n.ui.componentFactory.add(t,()=>{const s=et(kt,n,t,e,i);return s.set({tooltip:!0,isToggleable:!0}),s}),n.ui.componentFactory.add(`menuBar:${t}`,()=>{const s=et(At,n,t,e,i);return s.set({role:"menuitemcheckbox",isToggleable:!0}),s})}function et(n,t,e,i,s){const o=t.commands.get(e),l=new n(t.locale);return l.set({label:i,icon:s}),l.bind("isOn","isEnabled").to(o,"value","isEnabled"),l.on("execute",()=>{t.execute(e),t.editing.view.focus()}),l}class oe extends p{static get pluginName(){return"ListUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor.t;this.editor.ui.componentFactory.has("numberedList")||j(this.editor,"numberedList",t("Numbered List"),yt),this.editor.ui.componentFactory.has("bulletedList")||j(this.editor,"bulletedList",t("Bulleted List"),Lt)}}class ve extends p{static get requires(){return[h,oe]}static get pluginName(){return"List"}static get isOfficialPlugin(){return!0}}const le=[{listStyle:"disc",typeAttribute:"disc",listType:"bulleted"},{listStyle:"circle",typeAttribute:"circle",listType:"bulleted"},{listStyle:"square",typeAttribute:"square",listType:"bulleted"},{listStyle:"decimal",typeAttribute:"1",listType:"numbered"},{listStyle:"decimal-leading-zero",typeAttribute:null,listType:"numbered"},{listStyle:"lower-roman",typeAttribute:"i",listType:"numbered"},{listStyle:"upper-roman",typeAttribute:"I",listType:"numbered"},{listStyle:"lower-alpha",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-alpha",typeAttribute:"A",listType:"numbered"},{listStyle:"lower-latin",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-latin",typeAttribute:"A",listType:"numbered"}];for(const{listStyle:n,typeAttribute:t,listType:e}of le);class ce extends T{constructor(t){super(t),this.on("execute",()=>{this.refresh()},{priority:"highest"})}refresh(){const t=this._getSelectedItems();this.value=this._getValue(t),this.isEnabled=!!t.length}execute(t={}){this.editor.model.change(e=>{const i=this._getSelectedItems(),s=t.forceValue===void 0?!this._getValue(i):t.forceValue;for(const o of i)s?e.setAttribute("todoListChecked",!0,o):e.removeAttribute("todoListChecked",o)})}_getValue(t){return t.every(e=>e.getAttribute("todoListChecked"))}_getSelectedItems(){const t=this.editor.model,e=t.schema,i=t.document.selection.getFirstRange(),s=i.start.parent,o=[];e.checkAttribute(s,"todoListChecked")&&o.push(...y(s));for(const l of i.getItems({shallow:!0}))e.checkAttribute(l,"todoListChecked")&&!o.includes(l)&&o.push(...y(l));return o}}class ae extends _t{domEventType=["change"];onDomEvent(t){if(t.target){const e=this.view.domConverter.mapDomToView(t.target);e&&e.is("element","input")&&e.getAttribute("type")=="checkbox"&&e.findAncestor({classes:"todo-list__label"})&&this.fire("todoCheckboxChange",t)}}}const ue=ht("Ctrl+Enter");class de extends p{static get pluginName(){return"TodoListEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[h]}init(){const t=this.editor,e=t.model,i=t.editing,s=t.plugins.get(h),l=t.config.get("list.multiBlock")?"paragraph":"listItem";t.commands.add("todoList",new v(t,"todo")),t.commands.add("checkTodoList",new ce(t)),i.view.addObserver(ae),e.schema.extend("$listItem",{allowAttributes:"todoListChecked"}),e.schema.addAttributeCheck(r=>{const c=r.last;if(!c.getAttribute("listItemId")||c.getAttribute("listType")!="todo")return!1},"todoListChecked"),t.conversion.for("upcast").add(r=>{r.on("element:input",fe()),r.on("element:li",me(),{priority:"low"}),r.on("element:label",V({name:"label",classes:"todo-list__label"})),r.on("element:label",V({name:"label",classes:["todo-list__label","todo-list__label_without-description"]})),r.on("element:span",V({name:"span",classes:"todo-list__label__description"})),r.on("element:ul",ge({name:"ul",classes:"todo-list"}))}),t.conversion.for("downcast").elementToElement({model:l,view:(r,{writer:c})=>{if(O(r,s.getListAttributeNames()))return c.createContainerElement("span",{class:"todo-list__label__description"})},converterPriority:"highest"}),s.registerDowncastStrategy({scope:"list",attributeName:"listType",setAttributeOnDowncast(r,c,a){c=="todo"?r.addClass("todo-list",a):r.removeClass("todo-list",a)}}),s.registerDowncastStrategy({scope:"itemMarker",attributeName:"todoListChecked",createElement(r,c,{dataPipeline:a}){if(c.getAttribute("listType")!="todo")return null;const u=r.createUIElement("input",{type:"checkbox",...c.getAttribute("todoListChecked")?{checked:"checked"}:null,...a?{disabled:"disabled"}:{tabindex:"-1"}});if(a)return u;const d=r.createContainerElement("span",{contenteditable:"false"},u);return d.getFillerOffset=()=>null,d},canWrapElement(r){return O(r,s.getListAttributeNames())},createWrapperElement(r,c,{dataPipeline:a}){const u=["todo-list__label"];return O(c,s.getListAttributeNames())||u.push("todo-list__label_without-description"),r.createAttributeElement(a?"label":"span",{class:u.join(" ")})}}),s.on("checkElement",(r,{modelElement:c,viewElement:a})=>{const u=O(c,s.getListAttributeNames());a.hasClass("todo-list__label__description")!=u&&(r.return=!0,r.stop())}),s.on("checkElement",(r,{modelElement:c,viewElement:a})=>{const u=c.getAttribute("listType")=="todo"&&A(c);let d=!1;const m=t.editing.view.createPositionBefore(a).getWalker({direction:"backward"});for(const{item:f}of m){if(f.is("element")&&t.editing.mapper.toModelElement(f))break;f.is("element","input")&&f.getAttribute("type")=="checkbox"&&(d=!0)}d!=u&&(r.return=!0,r.stop())}),s.on("postFixer",(r,{listNodes:c,writer:a})=>{for(const{node:u,previousNodeInList:d}of c){if(!d||d.getAttribute("listItemId")!=u.getAttribute("listItemId"))continue;const m=d.hasAttribute("todoListChecked"),f=u.hasAttribute("todoListChecked");f&&!m?(a.removeAttribute("todoListChecked",u),r.return=!0):!f&&m&&(a.setAttribute("todoListChecked",!0,u),r.return=!0)}}),e.document.registerPostFixer(r=>{const c=e.document.differ.getChanges();let a=!1;for(const u of c)if(u.type=="attribute"&&u.attributeKey=="listType"){const d=u.range.start.nodeAfter;u.attributeOldValue=="todo"&&d.hasAttribute("todoListChecked")&&(r.removeAttribute("todoListChecked",d),a=!0)}else if(u.type=="insert"&&u.name!="$text")for(const{item:d}of r.createRangeOn(u.position.nodeAfter))d.is("element")&&d.getAttribute("listType")!="todo"&&d.hasAttribute("todoListChecked")&&(r.removeAttribute("todoListChecked",d),a=!0);return a}),this.listenTo(i.view.document,"keydown",(r,c)=>{ft(c)===ue&&(t.execute("checkTodoList"),r.stop())},{priority:"high"}),this.listenTo(i.view.document,"todoCheckboxChange",(r,c)=>{const a=c.target;if(!a||!a.is("element","input"))return;const u=i.view.createPositionAfter(a),m=i.mapper.toModelPosition(u).parent;m&&g(m)&&m.getAttribute("listType")=="todo"&&this._handleCheckmarkChange(m)}),this.listenTo(i.view.document,"arrowKey",pe(e,t.locale),{context:"$text"}),this.listenTo(i.mapper,"viewToModelPosition",(r,c)=>{const a=c.viewPosition.parent,u=a.is("attributeElement","li")&&c.viewPosition.offset==0,d=it(a)&&c.viewPosition.offset<=1,m=a.is("element","span")&&a.getAttribute("contenteditable")=="false"&&it(a.parent);if(!u&&!d&&!m)return;const f=c.modelPosition.nodeAfter;f&&f.getAttribute("listType")=="todo"&&(c.modelPosition=e.createPositionAt(f,0))},{priority:"low"}),this._initAriaAnnouncements()}_handleCheckmarkChange(t){const e=this.editor,i=e.model,s=Array.from(i.document.selection.getRanges());i.change(o=>{o.setSelection(t,"end"),e.execute("checkTodoList"),o.setSelection(s)})}_initAriaAnnouncements(){const{model:t,ui:e,t:i}=this.editor;let s=null;e&&t.document.selection.on("change:range",()=>{const o=t.document.selection.focus.parent,l=st(s),r=st(o);l&&!r?e.ariaLiveAnnouncer.announce(i("Leaving a to-do list")):!l&&r&&e.ariaLiveAnnouncer.announce(i("Entering a to-do list")),s=o})}}function me(){return(n,t,e)=>{const{writer:i,schema:s}=e;if(!t.modelRange)return;const o=Array.from(t.modelRange.getItems({shallow:!0})).filter(l=>l.getAttribute("listType")==="todo"&&s.checkAttribute(l,"listItemId")).reduce((l,r)=>{const c=r.getAttribute("listItemId");return l.has(c)||l.set(c,y(r)),l},new Map);for(const[,l]of o.entries())if(l.some(r=>r.getAttribute("todoListChecked")))for(const r of l)i.setAttribute("todoListChecked",!0,r)}}function fe(){return(n,t,e)=>{const i=t.modelCursor,s=i.parent,o=t.viewItem;if(!e.consumable.test(o,{name:!0})||o.getAttribute("type")!="checkbox"||!i.isAtStart||!s.hasAttribute("listType"))return;e.consumable.consume(o,{name:!0});const l=e.writer;l.setAttribute("listType","todo",s),t.viewItem.hasAttribute("checked")&&l.setAttribute("todoListChecked",!0,s),t.modelRange=l.createRange(i)}}function V(n){const t=new nt(n);return(e,i,s)=>{const o=t.match(i.viewItem);o&&s.consumable.consume(i.viewItem,o.match)&&Object.assign(i,s.convertChildren(i.viewItem,i.modelCursor))}}function ge(n){const t=new nt(n);return(e,i,s)=>{const o=t.match(i.viewItem);if(!o)return;const l=o.match;l.name=!1,s.consumable.consume(i.viewItem,l)}}function O(n,t){return(n.is("element","paragraph")||n.is("element","listItem"))&&n.getAttribute("listType")=="todo"&&A(n)&&he(n,t)}function he(n,t){for(const e of n.getAttributeKeys())if(!e.startsWith("selection:")&&!t.includes(e))return!1;return!0}function pe(n,t){return(e,i)=>{const s=pt(i.keyCode,t.contentLanguageDirection),o=n.schema,l=n.document.selection;if(!l.isCollapsed)return;const r=l.getFirstPosition(),c=r.parent;if(s=="right"&&r.isAtEnd){const a=o.getNearestSelectionRange(n.createPositionAfter(c),"forward");if(!a)return;const u=a.start.parent;u&&g(u)&&u.getAttribute("listType")=="todo"&&(n.change(d=>d.setSelection(a)),i.preventDefault(),i.stopPropagation(),e.stop())}else if(s=="left"&&r.isAtStart&&g(c)&&c.getAttribute("listType")=="todo"){const a=o.getNearestSelectionRange(n.createPositionBefore(c),"backward");if(!a)return;n.change(u=>u.setSelection(a)),i.preventDefault(),i.stopPropagation(),e.stop()}}}function it(n){return!!n&&n.is("attributeElement")&&n.hasClass("todo-list__label")}function st(n){return!n||!n.is("element","paragraph")&&!n.is("element","listItem")?!1:n.getAttribute("listType")=="todo"}class be extends p{static get pluginName(){return"TodoListUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor.t;j(this.editor,"todoList",t("To-do List"),wt)}}class Ee extends p{static get requires(){return[de,be]}static get pluginName(){return"TodoList"}static get isOfficialPlugin(){return!0}}export{ve as L,Ee as T};
