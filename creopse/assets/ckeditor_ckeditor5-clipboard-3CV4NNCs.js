import{P as b}from"./ckeditor_ckeditor5-core-Cqajz_gD.js";import{u as z,E as q,d as j,D as A,e as f,g as u,c as I,R as k,a as ee,b as te,t as re}from"./ckeditor_ckeditor5-utils-Bp8opE8z.js";import{P as ne,M as T,D as ie,V as oe,b as se}from"./ckeditor_ckeditor5-engine-CS7i4Bo_.js";import{W as ae,i as _}from"./ckeditor_ckeditor5-widget-l7jZmFCq.js";import{V as le}from"./ckeditor_ckeditor5-ui-wSLROq0V.js";import{m as ce,t as V}from"./es-toolkit-RjqxEpf9.js";/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class v extends ie{domEventType=["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"];constructor(e){super(e);const t=this.document;this.listenTo(t,"paste",r("clipboardInput"),{priority:"low"}),this.listenTo(t,"drop",r("clipboardInput"),{priority:"low"}),this.listenTo(t,"dragover",r("dragging"),{priority:"low"});function r(i){return(s,o)=>{o.preventDefault();const n=o.dropRange?[o.dropRange]:null,a=new q(t,i);t.fire(a,{dataTransfer:o.dataTransfer,method:s.name,targetRanges:n,target:o.target,domEvent:o.domEvent}),a.stop.called&&o.stopPropagation()}}}onDomEvent(e){const t="clipboardData"in e?e.clipboardData:e.dataTransfer,r=e.type=="drop"||e.type=="paste",i={dataTransfer:new oe(t,{cacheFiles:r})};if(e.type=="drop"||e.type=="dragover"){const s=ee(e);i.dropRange=s&&this.view.domConverter.domRangeToView(s)}this.fire(e.type,e,i)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function de(l){return l=l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(l.includes("</p><p>")||l.includes("<br>"))&&(l=`<p>${l}</p>`),l}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ge(l){return l.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const B=["figcaption","li"],L=["ol","ul"];function H(l,e){if(e.is("$text")||e.is("$textProxy"))return e.data;if(e.is("element","img")&&e.hasAttribute("alt"))return e.getAttribute("alt");if(e.is("element","br"))return`
`;let t="",r=null;for(const i of e.getChildren())t+=pe(i,r)+H(l,i),r=i;if(e.is("rawElement")){const s=document.implementation.createHTMLDocument("").createElement("div");e.render(s,l),t+=K(s)}return t}function K(l){let e="";if(l.nodeType===Node.TEXT_NODE)return l.textContent;if(l.tagName==="BR")return`
`;for(const t of l.childNodes)e+=K(t);return e}function pe(l,e){return e?l.is("element","li")&&!l.isEmpty&&l.getChild(0).is("containerElement")||L.includes(l.name)&&L.includes(e.name)?`

`:!l.is("containerElement")&&!e.is("containerElement")?"":B.includes(l.name)||B.includes(e.name)?`
`:l.is("element")&&l.getCustomProperty("dataPipeline:transparentRendering")||e.is("element")&&e.getCustomProperty("dataPipeline:transparentRendering")?"":`

`:""}class G extends b{_markersToCopy=new Map;static get pluginName(){return"ClipboardMarkersUtils"}static get isOfficialPlugin(){return!0}_registerMarkerToCopy(e,t){this._markersToCopy.set(e,t)}_copySelectedFragmentWithMarkers(e,t,r=i=>i.model.getSelectedContent(i.model.document.selection)){return this.editor.model.change(i=>{const s=i.model.document.selection;i.setSelection(t);const o=this._insertFakeMarkersIntoSelection(i,i.model.document.selection,e),n=r(i),a=this._removeFakeMarkersInsideElement(i,n);for(const[c,d]of Object.entries(o)){a[c]||=i.createRangeIn(n);for(const g of d)i.remove(g)}n.markers.clear();for(const[c,d]of Object.entries(a))n.markers.set(c,d);return i.setSelection(s),n})}_pasteMarkersIntoTransformedElement(e,t){const r=this._getPasteMarkersFromRangeMap(e);return this.editor.model.change(i=>{const s=this._insertFakeMarkersElements(i,r),o=t(i),n=this._removeFakeMarkersInsideElement(i,o);for(const a of Object.values(s).flat())i.remove(a);for(const[a,c]of Object.entries(n))i.model.markers.has(a)||i.addMarker(a,{usingOperation:!0,affectsData:!0,range:c});return o})}_pasteFragmentWithMarkers(e){const t=this._getPasteMarkersFromRangeMap(e.markers);e.markers.clear();for(const r of t)e.markers.set(r.name,r.range);return this.editor.model.insertContent(e)}_forceMarkersCopy(e,t,r={allowedActions:"all",copyPartiallySelected:!0,duplicateOnPaste:!0}){const i=this._markersToCopy.get(e);this._markersToCopy.set(e,r),t(),i?this._markersToCopy.set(e,i):this._markersToCopy.delete(e)}_isMarkerCopyable(e,t){const r=this._getMarkerClipboardConfig(e);if(!r)return!1;if(!t)return!0;const{allowedActions:i}=r;return i==="all"||i.includes(t)}_hasMarkerConfiguration(e){return!!this._getMarkerClipboardConfig(e)}_getMarkerClipboardConfig(e){const[t]=e.split(":");return this._markersToCopy.get(t)||null}_insertFakeMarkersIntoSelection(e,t,r){const i=this._getCopyableMarkersFromSelection(e,t,r);return this._insertFakeMarkersElements(e,i)}_getCopyableMarkersFromSelection(e,t,r){const i=Array.from(t.getRanges()),s=new Set(i.flatMap(n=>Array.from(e.model.markers.getMarkersIntersectingRange(n)))),o=n=>{if(!this._isMarkerCopyable(n.name,r))return!1;const{copyPartiallySelected:c}=this._getMarkerClipboardConfig(n.name);if(!c){const d=n.getRange();return i.some(g=>g.containsRange(d,!0))}return!0};return Array.from(s).filter(o).map(n=>({name:r==="dragstart"?this._getUniqueMarkerName(n.name):n.name,range:n.getRange()}))}_getPasteMarkersFromRangeMap(e,t=null){const{model:r}=this.editor;return(e instanceof Map?Array.from(e.entries()):Object.entries(e)).flatMap(([s,o])=>{if(!this._hasMarkerConfiguration(s))return[{name:s,range:o}];if(this._isMarkerCopyable(s,t)){const n=this._getMarkerClipboardConfig(s),a=r.markers.has(s)&&r.markers.get(s).getRange().root.rootName==="$graveyard";return(n.duplicateOnPaste||a)&&(s=this._getUniqueMarkerName(s)),[{name:s,range:o}]}return[]})}_insertFakeMarkersElements(e,t){const r={},i=t.flatMap(s=>{const{start:o,end:n}=s.range;return[{position:o,marker:s,type:"start"},{position:n,marker:s,type:"end"}]}).sort(({position:s},{position:o})=>s.isBefore(o)?1:-1);for(const{position:s,marker:o,type:n}of i){const a=e.createElement("$marker",{"data-name":o.name,"data-type":n});r[o.name]||(r[o.name]=[]),r[o.name].push(a),e.insert(a,s)}return r}_removeFakeMarkersInsideElement(e,t){const i=this._getAllFakeMarkersFromElement(e,t).reduce((s,o)=>{const n=o.markerElement&&e.createPositionBefore(o.markerElement);let a=s[o.name],c=!1;return a?.start&&a?.end&&(this._getMarkerClipboardConfig(o.name).duplicateOnPaste?s[this._getUniqueMarkerName(o.name)]=s[o.name]:c=!0,a=null),c||(s[o.name]={...a,[o.type]:n}),o.markerElement&&e.remove(o.markerElement),s},{});return ce(i,s=>new se(s.start||e.createPositionFromPath(t,[0]),s.end||e.createPositionAt(t,"end")))}_getAllFakeMarkersFromElement(e,t){const r=Array.from(e.createRangeIn(t)).flatMap(({item:o})=>{if(!o.is("element","$marker"))return[];const n=o.getAttribute("data-name"),a=o.getAttribute("data-type");return[{markerElement:o,name:n,type:a}]}),i=[],s=[];for(const o of r)o.type==="end"&&(r.some(a=>a.name===o.name&&a.type==="start")||i.push({markerElement:null,name:o.name,type:"start"})),o.type==="start"&&(r.some(a=>a.name===o.name&&a.type==="end")||s.unshift({markerElement:null,name:o.name,type:"end"}));return[...i,...r,...s]}_getUniqueMarkerName(e){const t=e.split(":"),r=z().substring(1,6);return t.length===3?`${t.slice(0,2).join(":")}:${r}`:`${t.join(":")}:${r}`}}class y extends b{static get pluginName(){return"ClipboardPipeline"}static get isOfficialPlugin(){return!0}static get requires(){return[G]}init(){this.editor.editing.view.addObserver(v),this._setupPasteDrop(),this._setupCopyCut()}_fireOutputTransformationEvent(e,t,r){const i=this.editor.plugins.get("ClipboardMarkersUtils");this.editor.model.enqueueChange({isUndoable:r==="cut"},()=>{const s=i._copySelectedFragmentWithMarkers(r,t);this.fire("outputTransformation",{dataTransfer:e,content:s,method:r})})}_setupPasteDrop(){const e=this.editor,t=e.model,r=e.editing.view,i=r.document,s=this.editor.plugins.get("ClipboardMarkersUtils");this.listenTo(i,"clipboardInput",(o,n)=>{n.method=="paste"&&!e.model.canEditAt(e.model.document.selection)&&o.stop()},{priority:"highest"}),this.listenTo(i,"clipboardInput",(o,n)=>{const a=n.dataTransfer;let c;if(n.content)c=n.content;else{let p="";a.getData("text/html")?p=ge(a.getData("text/html")):a.getData("text/plain")&&(p=de(a.getData("text/plain"))),c=this.editor.data.htmlProcessor.toView(p)}const d=new q(this,"inputTransformation"),g=a.getData("application/ckeditor5-editor-id")||null;this.fire(d,{content:c,dataTransfer:a,sourceEditorId:g,targetRanges:n.targetRanges,method:n.method}),d.stop.called&&o.stop(),r.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(o,n)=>{if(n.content.isEmpty)return;const c=this.editor.data.toModel(n.content,"$clipboardHolder");c.childCount!=0&&(o.stop(),t.change(()=>{this.fire("contentInsertion",{content:c,method:n.method,sourceEditorId:n.sourceEditorId,dataTransfer:n.dataTransfer,targetRanges:n.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(o,n)=>{n.resultRange=s._pasteFragmentWithMarkers(n.content)},{priority:"low"})}_setupCopyCut(){const e=this.editor,t=e.model.document,i=e.editing.view.document,s=(o,n)=>{const a=n.dataTransfer;n.preventDefault(),this._fireOutputTransformationEvent(a,t.selection,o.name)};this.listenTo(i,"copy",s,{priority:"low"}),this.listenTo(i,"cut",(o,n)=>{e.model.canEditAt(e.model.document.selection)?s(o,n):n.preventDefault()},{priority:"low"}),this.listenTo(this,"outputTransformation",(o,n)=>{const a=e.data.toView(n.content,{isClipboardPipeline:!0});i.fire("clipboardOutput",{dataTransfer:n.dataTransfer,content:a,method:n.method})},{priority:"low"}),this.listenTo(i,"clipboardOutput",(o,n)=>{n.content.isEmpty||(n.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(n.content)),n.dataTransfer.setData("text/plain",H(e.data.htmlProcessor.domConverter,n.content)),n.dataTransfer.setData("application/ckeditor5-editor-id",this.editor.id)),n.method=="cut"&&e.model.deleteContent(t.selection)},{priority:"low"})}}const P=re("px");class me extends le{constructor(){super();const e=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-clipboard-drop-target-line",e.if("isVisible","ck-hidden",t=>!t)],style:{left:e.to("left",t=>P(t)),top:e.to("top",t=>P(t)),width:e.to("width",t=>P(t))}}})}}class E extends b{removeDropMarkerDelayed=j(()=>this.removeDropMarker(),40);_updateDropMarkerThrottled=V(e=>this._updateDropMarker(e),40);_reconvertMarkerThrottled=V(()=>{this.editor.model.markers.has("drop-target")&&this.editor.editing.reconvertMarker("drop-target")},0);_dropTargetLineView=new me;_domEmitter=new(A());_scrollables=new Map;static get pluginName(){return"DragDropTarget"}static get isOfficialPlugin(){return!0}init(){this._setupDropMarker()}destroy(){this._domEmitter.stopListening();for(const{resizeObserver:e}of this._scrollables.values())e.destroy();return this._updateDropMarkerThrottled.cancel(),this.removeDropMarkerDelayed.cancel(),this._reconvertMarkerThrottled.cancel(),super.destroy()}updateDropMarker(e,t,r,i,s,o){this.removeDropMarkerDelayed.cancel();const n=U(this.editor,e,t,r,i,s,o);/* istanbul ignore next -- @preserve */if(n){if(o&&o.containsRange(n))return this.removeDropMarker();this._updateDropMarkerThrottled(n)}}getFinalDropRange(e,t,r,i,s,o){const n=U(this.editor,e,t,r,i,s,o);return this.removeDropMarker(),n}removeDropMarker(){const e=this.editor.model;this.removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),this._dropTargetLineView.isVisible=!1,e.markers.has("drop-target")&&e.change(t=>{t.removeMarker("drop-target")})}_setupDropMarker(){const e=this.editor;e.ui.view.body.add(this._dropTargetLineView),e.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),e.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(t,{writer:r})=>{if(e.model.schema.checkChild(t.markerRange.start,"$text"))return this._dropTargetLineView.isVisible=!1,this._createDropTargetPosition(r);t.markerRange.isCollapsed?this._updateDropTargetLine(t.markerRange):this._dropTargetLineView.isVisible=!1}})}_updateDropMarker(e){const t=this.editor,r=t.model.markers;t.model.change(i=>{r.has("drop-target")?r.get("drop-target").getRange().isEqual(e)||i.updateMarker("drop-target",{range:e}):i.addMarker("drop-target",{range:e,usingOperation:!1,affectsData:!1})})}_createDropTargetPosition(e){return e.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(t){const r=this.toDomElement(t);return r.append("⁠",t.createElement("span"),"⁠"),r})}_updateDropTargetLine(e){const t=this.editor.editing,r=e.start.nodeBefore,i=e.start.nodeAfter,s=e.start.parent,o=r?t.mapper.toViewElement(r):null,n=o?t.view.domConverter.mapViewToDom(o):null,a=i?t.mapper.toViewElement(i):null,c=a?t.view.domConverter.mapViewToDom(a):null,d=t.mapper.toViewElement(s);if(!d)return;const g=t.view.domConverter.mapViewToDom(d),p=this._getScrollableRect(d),{scrollX:m,scrollY:h}=u.window,w=n?new k(n):null,S=c?new k(c):null,D=new k(g).excludeScrollbarsAndBorders(),O=w?w.bottom:D.top,C=S?S.top:D.bottom,x=u.window.getComputedStyle(g),R=O<=C?(O+C)/2:C;if(p.top<R&&R<p.bottom){const J=D.left+parseFloat(x.paddingLeft),Q=D.right-parseFloat(x.paddingRight),F=Math.max(J+m,p.left),Z=Math.min(Q+m,p.right);this._dropTargetLineView.set({isVisible:!0,left:F,top:R+h,width:Z-F})}else this._dropTargetLineView.isVisible=!1}_getScrollableRect(e){const t=e.root.rootName;let r;if(this._scrollables.has(t))r=this._scrollables.get(t).domElement;else{const i=this.editor.editing.view.domConverter.mapViewToDom(e);r=he(i),this._domEmitter.listenTo(r,"scroll",this._reconvertMarkerThrottled,{usePassive:!0});const s=new te(r,this._reconvertMarkerThrottled);this._scrollables.set(t,{domElement:r,resizeObserver:s})}return new k(r).excludeScrollbarsAndBorders()}}function U(l,e,t,r,i,s,o){const n=l.model,a=l.editing.mapper;let d=$(l,e);for(;d;){if(!s){if(n.schema.checkChild(d,"$text")){if(t){const g=t[0].start,p=a.toModelPosition(g);if(!o||Array.from(o.getItems({shallow:!0})).every(h=>n.schema.checkChild(p,h))){if(n.schema.checkChild(p,"$text"))return n.createRange(p);if(g)return M(l,$(l,g.parent),r,i)}}}else if(n.schema.isInline(d))return M(l,d,r,i)}if(n.schema.isBlock(d))return M(l,d,r,i);if(n.schema.checkChild(d,"$block")){const g=Array.from(d.getChildren()).filter(h=>h.is("element")&&!ue(l,h));let p=0,m=g.length;if(m==0)return n.createRange(n.createPositionAt(d,"end"));for(;p<m-1;){const h=Math.floor((p+m)/2);X(l,g[h],r,i)=="before"?m=h:p=h}return M(l,g[p],r,i)}d=d.parent}return null}function ue(l,e){const t=l.editing.mapper,r=l.editing.view.domConverter,i=t.toViewElement(e);if(!i)return!0;const s=r.mapViewToDom(i);return u.window.getComputedStyle(s).float!="none"}function M(l,e,t,r){const i=l.model;return i.createRange(i.createPositionAt(e,X(l,e,t,r)))}function X(l,e,t,r){const i=l.editing.mapper,s=l.editing.view.domConverter,o=i.toViewElement(e),n=s.mapViewToDom(o),a=new k(n);return l.model.schema.isInline(e)?t<(a.left+a.right)/2?"before":"after":r<(a.top+a.bottom)/2?"before":"after"}function $(l,e){const t=l.editing.mapper,r=l.editing.view,i=t.toModelElement(e);if(i)return i;const s=r.createPositionBefore(e),o=t.findMappedViewAncestor(s);return t.toModelElement(o)}function he(l){let e=l;do{e=e.parentElement;const t=u.window.getComputedStyle(e).overflowY;if(t=="auto"||t=="scroll")break}while(e.tagName!="BODY");return e}class fe extends b{_isBlockDragging=!1;_domEmitter=new(A());static get pluginName(){return"DragDropBlockToolbar"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;if(this.listenTo(e,"change:isReadOnly",(t,r,i)=>{i?(this.forceDisabled("readOnlyMode"),this._isBlockDragging=!1):this.clearForceDisabled("readOnlyMode")}),f.isAndroid&&this.forceDisabled("noAndroidSupport"),e.plugins.has("BlockToolbar")){const r=e.plugins.get("BlockToolbar").buttonView.element;this._domEmitter.listenTo(r,"dragstart",(i,s)=>this._handleBlockDragStart(s)),this._domEmitter.listenTo(u.document,"dragover",(i,s)=>this._handleBlockDragging(s)),this._domEmitter.listenTo(u.document,"drop",(i,s)=>this._handleBlockDragging(s)),this._domEmitter.listenTo(u.document,"dragend",()=>this._handleBlockDragEnd(),{useCapture:!0}),this.isEnabled&&r.setAttribute("draggable","true"),this.on("change:isEnabled",(i,s,o)=>{r.setAttribute("draggable",o?"true":"false")})}}destroy(){return this._domEmitter.stopListening(),super.destroy()}_handleBlockDragStart(e){if(!this.isEnabled)return;const t=this.editor.model,r=t.document.selection,i=this.editor.editing.view,s=Array.from(r.getSelectedBlocks()),o=t.createRange(t.createPositionBefore(s[0]),t.createPositionAfter(s[s.length-1]));t.change(n=>n.setSelection(o)),this._isBlockDragging=!0,i.focus(),i.getObserver(v).onDomEvent(e)}_handleBlockDragging(e){if(!this.isEnabled||!this._isBlockDragging)return;const t=e.clientX+(this.editor.locale.contentLanguageDirection=="ltr"?100:-100),r=e.clientY,i=document.elementFromPoint(t,r),s=this.editor.editing.view;!i||!i.closest(".ck-editor__editable")||s.getObserver(v).onDomEvent({...e,type:e.type,dataTransfer:e.dataTransfer,target:i,clientX:t,clientY:r,preventDefault:()=>e.preventDefault(),stopPropagation:()=>e.stopPropagation()})}_handleBlockDragEnd(){this._isBlockDragging=!1}}class be extends b{_draggedRange;_draggingUid;_draggableElement;_clearDraggableAttributesDelayed=j(()=>this._clearDraggableAttributes(),40);_blockMode=!1;_domEmitter=new(A());_previewContainer;static get pluginName(){return"DragDrop"}static get isOfficialPlugin(){return!0}static get requires(){return[y,ae,E,fe]}init(){const e=this.editor,t=e.editing.view;this._draggedRange=null,this._draggingUid="",this._draggableElement=null,t.addObserver(v),t.addObserver(ne),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDraggableAttributeHandling(),this.listenTo(e,"change:isReadOnly",(r,i,s)=>{s?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(r,i,s)=>{s||this._finalizeDragging(!1)}),f.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._previewContainer&&this._previewContainer.remove(),this._domEmitter.stopListening(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const e=this.editor,t=e.model,r=e.editing.view,i=r.document,s=e.plugins.get(E);this.listenTo(i,"dragstart",(o,n)=>{if(n.target?.is("editableElement")){n.preventDefault();return}if(this._prepareDraggedRange(n.target),!this._draggedRange){n.preventDefault();return}this._draggingUid=z(),n.dataTransfer.effectAllowed=this.isEnabled?"copyMove":"copy",n.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const a=t.createSelection(this._draggedRange.toRange());this.editor.plugins.get("ClipboardPipeline")._fireOutputTransformationEvent(n.dataTransfer,a,"dragstart");const{dataTransfer:d,domTarget:g,domEvent:p}=n,{clientX:m}=p;this._updatePreview({dataTransfer:d,domTarget:g,clientX:m}),n.stopPropagation(),this.isEnabled||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(i,"dragend",(o,n)=>{this._finalizeDragging(!n.dataTransfer.isCanceled&&n.dataTransfer.dropEffect=="move")},{priority:"low"}),this._domEmitter.listenTo(u.document,"dragend",()=>{this._blockMode=!1},{useCapture:!0}),this.listenTo(i,"dragenter",()=>{this.isEnabled&&r.focus()}),this.listenTo(i,"dragleave",()=>{s.removeDropMarkerDelayed()}),this.listenTo(i,"dragging",(o,n)=>{if(!this.isEnabled){n.dataTransfer.dropEffect="none";return}const{clientX:a,clientY:c}=n.domEvent;s.updateDropMarker(n.target,n.targetRanges,a,c,this._blockMode,this._draggedRange),this._draggedRange||(n.dataTransfer.dropEffect="copy"),f.isGecko||(n.dataTransfer.effectAllowed=="copy"?n.dataTransfer.dropEffect="copy":["all","copyMove"].includes(n.dataTransfer.effectAllowed)&&(n.dataTransfer.dropEffect="move")),o.stop()},{priority:"low"})}_setupClipboardInputIntegration(){const e=this.editor,r=e.editing.view.document,i=e.plugins.get(E);this.listenTo(r,"clipboardInput",(s,o)=>{if(o.method!="drop")return;const{clientX:n,clientY:a}=o.domEvent,c=i.getFinalDropRange(o.target,o.targetRanges,n,a,this._blockMode,this._draggedRange);if(!c){this._finalizeDragging(!1),s.stop();return}if(this._draggedRange&&this._draggingUid!=o.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),N(o.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(c,!0)){this._finalizeDragging(!1),s.stop();return}o.targetRanges=[e.editing.mapper.toViewRange(c)]},{priority:"high"})}_setupContentInsertionIntegration(){const e=this.editor.plugins.get(y);e.on("contentInsertion",(t,r)=>{if(!this.isEnabled||r.method!=="drop")return;const i=r.targetRanges.map(s=>this.editor.editing.mapper.toModelRange(s));this.editor.model.change(s=>s.setSelection(i))},{priority:"high"}),e.on("contentInsertion",(t,r)=>{if(!this.isEnabled||r.method!=="drop")return;const i=N(r.dataTransfer)=="move",s=!r.resultRange||!r.resultRange.isCollapsed;this._finalizeDragging(s&&i)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const e=this.editor,t=e.editing.view,r=t.document;this.listenTo(r,"pointerdown",(i,s)=>{if(f.isAndroid||!s)return;this._clearDraggableAttributesDelayed.cancel();let o=W(s.target);if(f.isBlink&&!e.isReadOnly&&!o&&!r.selection.isCollapsed){const n=r.selection.getSelectedElement();(!n||!_(n))&&(o=r.selection.editableElement)}o&&(t.change(n=>{n.setAttribute("draggable","true",o)}),this._draggableElement=e.editing.mapper.toModelElement(o))}),this.listenTo(r,"pointerup",()=>{f.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const e=this.editor.editing;e.view.change(t=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&t.removeAttribute("draggable",e.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_finalizeDragging(e){const t=this.editor,r=t.model;t.plugins.get(E).removeDropMarker(),this._clearDraggableAttributes(),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",this._previewContainer&&(this._previewContainer.remove(),this._previewContainer=void 0),this._draggedRange&&(e&&this.isEnabled&&r.change(s=>{const o=r.createSelection(this._draggedRange);r.deleteContent(o,{doNotAutoparagraph:!0});const n=o.getFirstPosition().parent;n.isEmpty&&!r.schema.checkChild(n,"$text")&&r.schema.checkChild(n,"paragraph")&&s.insertElement("paragraph",n,0)}),this._draggedRange.detach(),this._draggedRange=null)}_prepareDraggedRange(e){const t=this.editor,r=t.model,i=r.document.selection,s=e?W(e):null;if(s){const c=t.editing.mapper.toModelElement(s);this._draggedRange=T.fromRange(r.createRangeOn(c)),this._blockMode=r.schema.isBlock(c),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop");return}if(i.isCollapsed&&!i.getFirstPosition().parent.isEmpty)return;const o=Array.from(i.getSelectedBlocks()),n=i.getFirstRange();if(o.length==0){this._draggedRange=T.fromRange(n);return}const a=Y(r,o);if(o.length>1)this._draggedRange=T.fromRange(a),this._blockMode=!0;else if(o.length==1){const c=n.start.isTouching(a.start)&&n.end.isTouching(a.end);this._draggedRange=T.fromRange(c?a:n),this._blockMode=c}r.change(c=>c.setSelection(this._draggedRange.toRange()))}_updatePreview({dataTransfer:e,domTarget:t,clientX:r}){const i=this.editor.editing.view,s=i.document.selection.editableElement,o=i.domConverter.mapViewToDom(s),n=u.window.getComputedStyle(o);this._previewContainer?this._previewContainer.firstElementChild&&this._previewContainer.removeChild(this._previewContainer.firstElementChild):(this._previewContainer=I(u.document,"div",{style:"position: fixed; left: -999999px;"}),u.document.body.appendChild(this._previewContainer));const a=I(u.document,"div");a.className="ck ck-content ck-clipboard-preview";const c=new k(o),d=parseFloat(n.paddingLeft),g=parseFloat(n.paddingRight),p=parseFloat(n.width)-d-g;if(o.contains(t))if(f.isiOS)a.style.maxWidth=`${p}px`,a.style.padding="10px",a.style.minWidth="200px",a.style.minHeight="20px",a.style.boxSizing="border-box",a.style.backgroundColor="var(--ck-color-base-background)";else return;else if(f.isiOS)a.style.width=`${p}px`,a.style.backgroundColor="var(--ck-color-base-background)";else{const m=c.left-r+d;a.style.width=`${p+m}px`,a.style.paddingLeft=`${m}px`}i.domConverter.setContentOf(a,e.getData("text/html")),e.setDragImage(a,0,0),this._previewContainer.appendChild(a)}}function N(l){return f.isGecko?l.dropEffect:["all","copyMove"].includes(l.effectAllowed)?"move":"copy"}function W(l){if(l.is("editableElement"))return null;if(l.hasClass("ck-widget__selection-handle"))return l.findAncestor(_);if(_(l))return l;const e=l.findAncestor(t=>_(t)||t.is("editableElement"));return _(e)?e:null}function Y(l,e){const t=e[0],r=e[e.length-1],i=t.getCommonAncestor(r),s=l.createPositionBefore(t),o=l.createPositionAfter(r);if(i&&i.is("element")&&!l.schema.isLimit(i)){const n=l.createRangeOn(i),a=s.isTouching(n.start),c=o.isTouching(n.end);if(a&&c)return Y(l,[i])}return l.createRange(s,o)}class ke extends b{static get pluginName(){return"PastePlainText"}static get isOfficialPlugin(){return!0}static get requires(){return[y]}init(){const e=this.editor,t=e.model,r=e.editing.view,i=t.document.selection;r.addObserver(v),e.plugins.get(y).on("contentInsertion",(s,o)=>{_e(o.content,t)&&t.change(n=>{const a=Array.from(i.getAttributes()).filter(([d])=>t.schema.getAttributeProperties(d).isFormatting);i.isCollapsed||t.deleteContent(i,{doNotAutoparagraph:!0}),a.push(...i.getAttributes());const c=n.createRangeIn(o.content);for(const d of c.getItems())for(const g of a)t.schema.checkAttribute(d,g[0])&&n.setAttribute(g[0],g[1],d)})})}}function _e(l,e){let t=e.createRangeIn(l);if(l.childCount==1){const r=l.getChild(0);r.is("element")&&e.schema.isBlock(r)&&!e.schema.isObject(r)&&!e.schema.isLimit(r)&&(t=e.createRangeIn(r))}for(const r of t.getItems())if(!e.schema.isInline(r)||Array.from(r.getAttributeKeys()).find(s=>e.schema.getAttributeProperties(s).isFormatting))return!1;return!0}class we extends b{static get pluginName(){return"Clipboard"}static get isOfficialPlugin(){return!0}static get requires(){return[G,y,be,ke]}init(){const e=this.editor,t=this.editor.t;e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Copy selected content"),keystroke:"CTRL+C"},{label:t("Paste content"),keystroke:"CTRL+V"},{label:t("Paste content as plain text"),keystroke:"CTRL+SHIFT+V"}]})}}export{y as C,we as a,G as b};
