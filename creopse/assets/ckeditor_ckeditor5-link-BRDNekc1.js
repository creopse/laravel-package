import{C as x,P as b,i as A}from"./ckeditor_ckeditor5-core-Ck1E_gMX.js";import{k as R,a as z,f as K,O as $,e as q,o as G,S as B,K as F}from"./ckeditor_ckeditor5-utils-CWV6iAXC.js";import{M as W,j as X}from"./ckeditor_ckeditor5-engine-Bp3orBjd.js";import{f as k,T,I as j,i as Y,D as J,b as Q,g as Z}from"./ckeditor_ckeditor5-typing-A9cCj5t0.js";import{a as ee}from"./ckeditor_ckeditor5-clipboard-CGEmRAGP.js";import{i as te}from"./ckeditor_ckeditor5-widget-ODMfBCu6.js";import{V,f as U,F as O,s as ie,L as ne,h as se,B as g,x as oe,v as C,C as re,w as ae}from"./ckeditor_ckeditor5-ui-0Cf30f_5.js";import"./color-name-B0-kzB5j.js";import"./color-convert-CPcGJsTp.js";import"./vanilla-colorful-CgSCOLsm.js";import{p as le}from"./lodash-es-DLvU2Xhi.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ce{constructor(){this._definitions=new Set}get length(){return this._definitions.size}add(e){Array.isArray(e)?e.forEach(t=>this._definitions.add(t)):this._definitions.add(e)}getDispatcher(){return e=>{e.on("attribute:linkHref",(t,n,i)=>{if(!i.consumable.test(n.item,"attribute:linkHref")||!(n.item.is("selection")||i.schema.isInline(n.item)))return;const s=i.writer,a=s.document.selection;for(const o of this._definitions){const l=s.createAttributeElement("a",o.attributes,{priority:5});o.classes&&s.addClass(o.classes,l);for(const c in o.styles)s.setStyle(c,o.styles[c],l);s.setCustomProperty("link",!0,l),o.callback(n.attributeNewValue)?n.item.is("selection")?s.wrap(a.getFirstRange(),l):s.wrap(i.mapper.toViewRange(n.range),l):s.unwrap(i.mapper.toViewRange(n.range),l)}},{priority:"high"})}}getDispatcherForLinkedImage(){return e=>{e.on("attribute:linkHref:imageBlock",(t,n,{writer:i,mapper:s})=>{const a=s.toViewElement(n.item),o=Array.from(a.getChildren()).find(l=>l.is("element","a"));for(const l of this._definitions){const c=R(l.attributes);if(l.callback(n.attributeNewValue)){for(const[u,d]of c)u==="class"?i.addClass(d,o):i.setAttribute(u,d,o);l.classes&&i.addClass(l.classes,o);for(const u in l.styles)i.setStyle(u,l.styles[u],o)}else{for(const[u,d]of c)u==="class"?i.removeClass(d,o):i.removeAttribute(u,o);l.classes&&i.removeClass(l.classes,o);for(const u in l.styles)i.removeStyle(u,o)}}})}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ue=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,de=/^(?:(?:https?|ftps?|mailto):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))/i,he=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,fe=/^((\w+:(\/{2,})?)|(\W))/i,w="Ctrl+K";function me(r){return r.is("attributeElement")&&!!r.getCustomProperty("link")}function L(r,{writer:e}){const t=e.createAttributeElement("a",{href:r},{priority:5});return e.setCustomProperty("link",!0,t),t}function M(r){const e=String(r);return ke(e)?e:"#"}function ke(r){return!!r.replace(ue,"").match(de)}function ge(r,e){const t={"Open in a new tab":r("Open in a new tab"),Downloadable:r("Downloadable")};return e.forEach(n=>("label"in n&&t[n.label]&&(n.label=t[n.label]),n)),e}function be(r){const e=[];if(r)for(const[t,n]of Object.entries(r)){const i=Object.assign({},n,{id:`link${le(t)}`});e.push(i)}return e}function y(r,e){return r?e.checkAttribute(r.name,"linkHref"):!1}function we(r){return he.test(r)}function E(r,e){const t=we(r)?"mailto:":e,n=!!t&&!N(r);return r&&n?t+r:r}function N(r){return fe.test(r)}function S(r){window.open(r,"_blank","noopener")}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pe extends x{constructor(){super(...arguments),this.manualDecorators=new z,this.automaticDecorators=new ce}restoreManualDecoratorStates(){for(const e of this.manualDecorators)e.value=this._getDecoratorStateFromModel(e.id)}refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement()||K(t.getSelectedBlocks());y(n,e.schema)?(this.value=n.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttribute(n,"linkHref")):(this.value=t.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref"));for(const i of this.manualDecorators)i.value=this._getDecoratorStateFromModel(i.id)}execute(e,t={}){const n=this.editor.model,i=n.document.selection,s=[],a=[];for(const o in t)t[o]?s.push(o):a.push(o);n.change(o=>{if(i.isCollapsed){const l=i.getFirstPosition();if(i.hasAttribute("linkHref")){const c=I(i);let u=k(l,"linkHref",i.getAttribute("linkHref"),n);i.getAttribute("linkHref")===c&&(u=this._updateLinkContent(n,o,u,e)),o.setAttribute("linkHref",e,u),s.forEach(d=>{o.setAttribute(d,!0,u)}),a.forEach(d=>{o.removeAttribute(d,u)}),o.setSelection(o.createPositionAfter(u.end.nodeBefore))}else if(e!==""){const c=R(i.getAttributes());c.set("linkHref",e),s.forEach(d=>{c.set(d,!0)});const{end:u}=n.insertContent(o.createText(e,c),l);o.setSelection(u)}["linkHref",...s,...a].forEach(c=>{o.removeSelectionAttribute(c)})}else{const l=n.schema.getValidRanges(i.getRanges(),"linkHref"),c=[];for(const d of i.getSelectedBlocks())n.schema.checkAttribute(d,"linkHref")&&c.push(o.createRangeOn(d));const u=c.slice();for(const d of l)this._isRangeToUpdate(d,c)&&u.push(d);for(const d of u){let f=d;if(u.length===1){const m=I(i);i.getAttribute("linkHref")===m&&(f=this._updateLinkContent(n,o,d,e),o.setSelection(o.createSelection(f)))}o.setAttribute("linkHref",e,f),s.forEach(m=>{o.setAttribute(m,!0,f)}),a.forEach(m=>{o.removeAttribute(m,f)})}}})}_getDecoratorStateFromModel(e){const t=this.editor.model,n=t.document.selection,i=n.getSelectedElement();return y(i,t.schema)?i.getAttribute(e):n.getAttribute(e)}_isRangeToUpdate(e,t){for(const n of t)if(n.containsRange(e))return!1;return!0}_updateLinkContent(e,t,n,i){const s=t.createText(i,{linkHref:i});return e.insertContent(s,n)}}function I(r){if(r.isCollapsed){const e=r.getFirstPosition();return e.textNode&&e.textNode.data}else{const e=Array.from(r.getFirstRange().getItems());if(e.length>1)return null;const t=e[0];return t.is("$text")||t.is("$textProxy")?t.data:null}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _e extends x{refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement();y(n,e.schema)?this.isEnabled=e.schema.checkAttribute(n,"linkHref"):this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref")}execute(){const e=this.editor,t=this.editor.model,n=t.document.selection,i=e.commands.get("link");t.change(s=>{const a=n.isCollapsed?[k(n.getFirstPosition(),"linkHref",n.getAttribute("linkHref"),t)]:t.schema.getValidRanges(n.getRanges(),"linkHref");for(const o of a)if(s.removeAttribute("linkHref",o),i)for(const l of i.manualDecorators)s.removeAttribute(l.id,o)})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ve extends $(){constructor({id:e,label:t,attributes:n,classes:i,styles:s,defaultValue:a}){super(),this.id=e,this.set("value",void 0),this.defaultValue=a,this.label=t,this.attributes=n,this.classes=i,this.styles=s}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ae="ck-link_selected",P="automatic",Ve="manual",ye=/^(https?:)?\/\//;class Ee extends b{static get pluginName(){return"LinkEditing"}static get requires(){return[T,j,ee]}constructor(e){super(e),e.config.define("link",{addTargetToExternalLinks:!1})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:"linkHref"}),e.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:L}),e.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(i,s)=>L(M(i),s)}),e.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:i=>i.getAttribute("href")}}),e.commands.add("link",new pe(e)),e.commands.add("unlink",new _e(e));const t=ge(e.t,be(e.config.get("link.decorators")));this._enableAutomaticDecorators(t.filter(i=>i.mode===P)),this._enableManualDecorators(t.filter(i=>i.mode===Ve)),e.plugins.get(T).registerAttribute("linkHref"),Y(e,"linkHref","a",Ae),this._enableLinkOpen(),this._enableInsertContentSelectionAttributesFixer(),this._enableClickingAfterLink(),this._enableTypingOverLink(),this._handleDeleteContentAfterLink(),this._enableClipboardIntegration()}_enableAutomaticDecorators(e){const t=this.editor,i=t.commands.get("link").automaticDecorators;t.config.get("link.addTargetToExternalLinks")&&i.add({id:"linkIsExternal",mode:P,callback:s=>!!s&&ye.test(s),attributes:{target:"_blank",rel:"noopener noreferrer"}}),i.add(e),i.length&&t.conversion.for("downcast").add(i.getDispatcher())}_enableManualDecorators(e){if(!e.length)return;const t=this.editor,i=t.commands.get("link").manualDecorators;e.forEach(s=>{t.model.schema.extend("$text",{allowAttributes:s.id});const a=new ve(s);i.add(a),t.conversion.for("downcast").attributeToElement({model:a.id,view:(o,{writer:l,schema:c},{item:u})=>{if((u.is("selection")||c.isInline(u))&&o){const d=l.createAttributeElement("a",a.attributes,{priority:5});a.classes&&l.addClass(a.classes,d);for(const f in a.styles)l.setStyle(f,a.styles[f],d);return l.setCustomProperty("link",!0,d),d}}}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",...a._createPattern()},model:{key:a.id}})})}_enableLinkOpen(){const e=this.editor,n=e.editing.view.document;this.listenTo(n,"click",(i,s)=>{if(!(q.isMac?s.domEvent.metaKey:s.domEvent.ctrlKey))return;let o=s.domTarget;if(o.tagName.toLowerCase()!="a"&&(o=o.closest("a")),!o)return;const l=o.getAttribute("href");l&&(i.stop(),s.preventDefault(),S(l))},{context:"$capture"}),this.listenTo(n,"keydown",(i,s)=>{const o=e.commands.get("link").value;o&&s.keyCode===G.enter&&s.altKey&&(i.stop(),S(o))})}_enableInsertContentSelectionAttributesFixer(){const t=this.editor.model,n=t.document.selection;this.listenTo(t,"insertContent",()=>{const i=n.anchor.nodeBefore,s=n.anchor.nodeAfter;n.hasAttribute("linkHref")&&i&&i.hasAttribute("linkHref")&&(s&&s.hasAttribute("linkHref")||t.change(a=>{p(a,_(t.schema))}))},{priority:"low"})}_enableClickingAfterLink(){const e=this.editor,t=e.model;e.editing.view.addObserver(W);let n=!1;this.listenTo(e.editing.view.document,"mousedown",()=>{n=!0}),this.listenTo(e.editing.view.document,"selectionChange",()=>{if(!n)return;n=!1;const i=t.document.selection;if(!i.isCollapsed||!i.hasAttribute("linkHref"))return;const s=i.getFirstPosition(),a=k(s,"linkHref",i.getAttribute("linkHref"),t);(s.isTouching(a.start)||s.isTouching(a.end))&&t.change(o=>{p(o,_(t.schema))})})}_enableTypingOverLink(){const e=this.editor,t=e.editing.view;let n=null,i=!1;this.listenTo(t.document,"delete",()=>{i=!0},{priority:"high"}),this.listenTo(e.model,"deleteContent",()=>{const s=e.model.document.selection;if(!s.isCollapsed){if(i){i=!1;return}H(e)&&Te(e.model)&&(n=s.getAttributes())}},{priority:"high"}),this.listenTo(e.model,"insertContent",(s,[a])=>{i=!1,H(e)&&n&&(e.model.change(o=>{for(const[l,c]of n)o.setAttribute(l,c,a)}),n=null)},{priority:"high"})}_handleDeleteContentAfterLink(){const e=this.editor,t=e.model,n=t.document.selection,i=e.editing.view;let s=!1,a=!1;this.listenTo(i.document,"delete",(o,l)=>{a=l.direction==="backward"},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{s=!1;const o=n.getFirstPosition(),l=n.getAttribute("linkHref");if(!l)return;const c=k(o,"linkHref",l,t);s=c.containsPosition(o)||c.end.isEqual(o)},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{a&&(a=!1,!s&&e.model.enqueueChange(o=>{p(o,_(t.schema))}))},{priority:"low"})}_enableClipboardIntegration(){const e=this.editor,t=e.model,n=this.editor.config.get("link.defaultProtocol");n&&this.listenTo(e.plugins.get("ClipboardPipeline"),"contentInsertion",(i,s)=>{t.change(a=>{const o=a.createRangeIn(s.content);for(const l of o.getItems())if(l.hasAttribute("linkHref")){const c=E(l.getAttribute("linkHref"),n);a.setAttribute("linkHref",c,l)}})})}}function p(r,e){r.removeSelectionAttribute("linkHref");for(const t of e)r.removeSelectionAttribute(t)}function Te(r){const e=r.document.selection,t=e.getFirstPosition(),n=e.getLastPosition(),i=t.nodeAfter;if(!i||!i.is("$text")||!i.hasAttribute("linkHref"))return!1;const s=n.textNode||n.nodeBefore;return i===s?!0:k(t,"linkHref",i.getAttribute("linkHref"),r).containsRange(r.createRange(t,n),!0)}function H(r){return r.model.change(t=>t.batch).isTyping}function _(r){return r.getDefinition("$text").allowAttributes.filter(t=>t.startsWith("link"))}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ce extends V{constructor(e,t){super(e),this.focusTracker=new B,this.keystrokes=new F,this._focusables=new U;const n=e.t;this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),A.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(n("Cancel"),A.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(t),this.children=this._createFormChildren(t.manualDecorators),this._focusCycler=new O({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const i=["ck","ck-link-form","ck-responsive-form"];t.manualDecorators.length&&i.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:i,tabindex:"-1"},children:this.children})}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((e,t)=>(e[t.name]=t.isOn,e),{})}render(){super.render(),ie({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createUrlInput(){const e=this.locale.t,t=new ne(this.locale,se);return t.label=e("Link URL"),t}_createButton(e,t,n,i){const s=new g(this.locale);return s.set({label:e,icon:t,tooltip:!0}),s.extendTemplate({attributes:{class:n}}),i&&s.delegate("execute").to(this,i),s}_createManualDecoratorSwitches(e){const t=this.createCollection();for(const n of e.manualDecorators){const i=new oe(this.locale);i.set({name:n.id,label:n.label,withText:!0}),i.bind("isOn").toMany([n,e],"value",(s,a)=>a===void 0&&s===void 0?!!n.defaultValue:!!s),i.on("execute",()=>{n.set("value",!i.isOn)}),t.add(i)}return t}_createFormChildren(e){const t=this.createCollection();if(t.add(this.urlInputView),e.length){const n=new V;n.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(i=>({tag:"li",children:[i],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),t.add(n)}return t.add(this.saveButtonView),t.add(this.cancelButtonView),t}}const Le='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Se extends V{constructor(e){super(e),this.focusTracker=new B,this.keystrokes=new F,this._focusables=new U;const t=e.t;this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(t("Unlink"),Le,"unlink"),this.editButtonView=this._createButton(t("Edit link"),A.pencil,"edit"),this.set("href",void 0),this._focusCycler=new O({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(e,t,n){const i=new g(this.locale);return i.set({label:e,icon:t,tooltip:!0}),i.delegate("execute").to(this,n),i}_createPreviewButton(){const e=new g(this.locale),t=this.bindTemplate,n=this.t;return e.set({withText:!0,tooltip:n("Open link in new tab")}),e.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:t.to("href",i=>i&&M(i)),target:"_blank",rel:"noopener noreferrer"}}),e.bind("label").to(this,"href",i=>i||n("This link has no URL")),e.bind("isEnabled").to(this,"href",i=>!!i),e.template.tag="a",e.template.eventListeners={},e}}const Ie='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const h="link-ui";class Pe extends b{constructor(){super(...arguments),this.actionsView=null,this.formView=null}static get requires(){return[C]}static get pluginName(){return"LinkUI"}init(){const e=this.editor;e.editing.view.addObserver(X),this._balloon=e.plugins.get(C),this._createToolbarLinkButton(),this._enableBalloonActivators(),e.conversion.for("editingDowncast").markerToHighlight({model:h,view:{classes:["ck-fake-link-selection"]}}),e.conversion.for("editingDowncast").markerToElement({model:h,view:{name:"span",classes:["ck-fake-link-selection","ck-fake-link-selection_collapsed"]}})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const e=this.editor,t=new Se(e.locale),n=e.commands.get("link"),i=e.commands.get("unlink");return t.bind("href").to(n,"value"),t.editButtonView.bind("isEnabled").to(n),t.unlinkButtonView.bind("isEnabled").to(i),this.listenTo(t,"edit",()=>{this._addFormView()}),this.listenTo(t,"unlink",()=>{e.execute("unlink"),this._hideUI()}),t.keystrokes.set("Esc",(s,a)=>{this._hideUI(),a()}),t.keystrokes.set(w,(s,a)=>{this._addFormView(),a()}),t}_createFormView(){const e=this.editor,t=e.commands.get("link"),n=e.config.get("link.defaultProtocol"),i=new(re(Ce))(e.locale,t);return i.urlInputView.fieldView.bind("value").to(t,"value"),i.urlInputView.bind("isEnabled").to(t,"isEnabled"),i.saveButtonView.bind("isEnabled").to(t),this.listenTo(i,"submit",()=>{const{value:s}=i.urlInputView.fieldView.element,a=E(s,n);e.execute("link",a,i.getDecoratorSwitchesState()),this._closeFormView()}),this.listenTo(i,"cancel",()=>{this._closeFormView()}),i.keystrokes.set("Esc",(s,a)=>{this._closeFormView(),a()}),i}_createToolbarLinkButton(){const e=this.editor,t=e.commands.get("link"),n=e.t;e.ui.componentFactory.add("link",i=>{const s=new g(i);return s.isEnabled=!0,s.label=n("Link"),s.icon=Ie,s.keystroke=w,s.tooltip=!0,s.isToggleable=!0,s.bind("isEnabled").to(t,"isEnabled"),s.bind("isOn").to(t,"value",a=>!!a),this.listenTo(s,"execute",()=>this._showUI(!0)),s})}_enableBalloonActivators(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),e.keystrokes.set(w,(n,i)=>{i(),e.commands.get("link").isEnabled&&this._showUI(!0)})}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",(e,t)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),t())},{priority:"high"}),this.editor.keystrokes.set("Esc",(e,t)=>{this._isUIVisible&&(this._hideUI(),t())}),ae({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),!this._areActionsInPanel&&this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const t=this.editor.commands.get("link");this.formView.disableCssTransitions(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions(),this.formView.urlInputView.fieldView.element.value=t.value||""}_closeFormView(){const e=this.editor.commands.get("link");e.restoreManualDecoratorStates(),e.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(e=!1){this.formView||this._createViews(),this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),e&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),e&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const e=this.editor;this.stopListening(e.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),e.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const e=this.editor,t=e.editing.view.document;let n=this._getSelectedLinkElement(),i=a();const s=()=>{const o=this._getSelectedLinkElement(),l=a();n&&!o||!n&&l!==i?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),n=o,i=l};function a(){return t.selection.focus.getAncestors().reverse().find(o=>o.is("element"))}this.listenTo(e.ui,"update",s),this.listenTo(this._balloon,"change:visibleView",s)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const e=this._balloon.visibleView;return!!this.formView&&e==this.formView||this._areActionsVisible}_getBalloonPositionData(){const e=this.editor.editing.view,t=this.editor.model,n=e.document;let i;if(t.markers.has(h)){const s=Array.from(this.editor.editing.mapper.markerNameToElements(h)),a=e.createRange(e.createPositionBefore(s[0]),e.createPositionAfter(s[s.length-1]));i=e.domConverter.viewRangeToDom(a)}else i=()=>{const s=this._getSelectedLinkElement();return s?e.domConverter.mapViewToDom(s):e.domConverter.viewRangeToDom(n.selection.getFirstRange())};return{target:i}}_getSelectedLinkElement(){const e=this.editor.editing.view,t=e.document.selection,n=t.getSelectedElement();if(t.isCollapsed||n&&te(n))return v(t.getFirstPosition());{const i=t.getFirstRange().getTrimmed(),s=v(i.start),a=v(i.end);return!s||s!=a?null:e.createRangeIn(s).getTrimmed().isEqual(i)?s:null}}_showFakeVisualSelection(){const e=this.editor.model;e.change(t=>{const n=e.document.selection.getFirstRange();if(e.markers.has(h))t.updateMarker(h,{range:n});else if(n.start.isAtEnd){const i=n.start.getLastMatchingPosition(({item:s})=>!e.schema.isContent(s),{boundaries:n});t.addMarker(h,{usingOperation:!1,affectsData:!1,range:t.createRange(i,n.end)})}else t.addMarker(h,{usingOperation:!1,affectsData:!1,range:n})})}_hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(h)&&e.change(t=>{t.removeMarker(h)})}}function v(r){return r.getAncestors().find(e=>me(e))||null}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const He=4,De=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),xe=2;class Re extends b{static get requires(){return[J]}static get pluginName(){return"AutoLink"}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling()}_enableTypingHandling(){const e=this.editor,t=new Q(e.model,n=>{if(!Be(n))return;const i=D(n.substr(0,n.length-1));if(i)return{url:i}});t.on("matched:data",(n,i)=>{const{batch:s,range:a,url:o}=i;if(!s.isTyping)return;const l=a.end.getShiftedBy(-1),c=l.getShiftedBy(-o.length),u=e.model.createRange(c,l);this._applyAutoLink(o,u)}),t.bind("isEnabled").to(this)}_enableEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("enter");n&&n.on("execute",()=>{const i=t.document.selection.getFirstPosition();if(!i.parent.previousSibling)return;const s=t.createRangeIn(i.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(s)})}_enableShiftEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("shiftEnter");n&&n.on("execute",()=>{const i=t.document.selection.getFirstPosition(),s=t.createRange(t.createPositionAt(i.parent,0),i.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(s)})}_checkAndApplyAutoLinkOnRange(e){const t=this.editor.model,{text:n,range:i}=Z(e,t),s=D(n);if(s){const a=t.createRange(i.end.getShiftedBy(-s.length),i.end);this._applyAutoLink(s,a)}}_applyAutoLink(e,t){const n=this.editor.model,i=this.editor.config.get("link.defaultProtocol"),s=E(e,i);!this.isEnabled||!Fe(t,n)||!N(s)||Ue(t)||this._persistAutoLink(s,t)}_persistAutoLink(e,t){const n=this.editor.model,i=this.editor.plugins.get("Delete");n.enqueueChange(s=>{s.setAttribute("linkHref",e,t),n.enqueueChange(()=>{i.requestUndoOnBackspace()})})}}function Be(r){return r.length>He&&r[r.length-1]===" "&&r[r.length-2]!==" "}function D(r){const e=De.exec(r);return e?e[xe]:null}function Fe(r,e){return e.schema.checkAttributeInSelection(e.createSelection(r),"linkHref")}function Ue(r){const e=r.start.nodeAfter;return!!e&&e.hasAttribute("linkHref")}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ye extends b{static get requires(){return[Ee,Pe,Re]}static get pluginName(){return"Link"}}export{Ye as L};
