import{i as I}from"./ckeditor_ckeditor5-vue-CmLqe3wy.js";import{I as V}from"./iconify_vue-DXPEksg3.js";import{f as L,m as Q,u as P,h as x}from"./vue-advanced-cropper-BiMNhMMD.js";import{_ as H}from"./fawmi_vue-google-maps-yyESU4s0.js";import{h as W,f as G,B as K,l as j,p as v,u as w}from"./naive-ui-BrWbllCz.js";import{u as m}from"./vue-i18n-B92nPylK.js";import{Q as B,aG as Z,e as u,v as E,t as U}from"./main-BFQh8EtE.js";import"./browser-image-compression-BvBgsnu7.js";import"./lodash-C_MgVQnG.js";import{c as $}from"./tanstack_vue-query-C9nQ2kf3.js";var y=(s=>(s[s.DOCUMENT=1]="DOCUMENT",s[s.IMAGE=2]="IMAGE",s[s.VIDEO=3]="VIDEO",s[s.AUDIO=4]="AUDIO",s[s.OTHER=5]="OTHER",s))(y||{});const{unref:p,createVNode:c,resolveComponent:ze,withCtx:b,createElementVNode:f,normalizeClass:J,openBlock:O,createElementBlock:T,createCommentVNode:X,toDisplayString:N,createTextVNode:z,createBlock:Y}=await I("vue"),ee={class:"picker-container"},te={class:"picker-content"},se={key:0},re={class:"cropper-container"},oe={class:"vertical-buttons"},ae={class:"preview-container"},ne={key:1,class:"text-center"},ie={class:"picker-action"},le={class:"dialog-footer"},{ref:R,computed:ce}=await I("vue"),ue={name:"ImageEditor",inheritAttrs:!1},de=Object.assign(ue,{props:{cropperAutoZoom:{type:Boolean,default:!0},cropperScalable:{type:Boolean,default:!1},cropperMovable:{type:Boolean,default:!1},cropperRatio:{type:Number,default:null},roundPreview:{type:Boolean,default:!1},previewWidth:{type:Number,default:null},previewHeight:{type:Number,default:120},src:{type:String,default:null}},emits:["croppedFileChange","save","cancel"],setup(s,{emit:r}){const{t:o}=m(),a=r,t=s,e=R(null),n=R({coordinates:null,image:null}),l=ce(()=>t.previewWidth?t.previewWidth:n.value&&n.value.coordinates?n.value.coordinates.width/n.value.coordinates.height*t.previewHeight:t.previewHeight),g=({coordinates:d,image:i})=>{n.value={coordinates:d,image:i};const{canvas:h}=e.value.getResult();a("croppedFileChange",n.value,h.toDataURL())},C=(d,i)=>{e.value.customImageTransforms.rotate%180!==0?e.value.flip(!d,!i):e.value.flip(d,i)},_=d=>{e.value.rotate(d)},D=()=>{const{canvas:d}=e.value.getResult();a("save",n.value,d.toDataURL())};return(d,i)=>{const h=V,k=W,F=G,M=K;return O(),T("div",ee,[f("div",te,[t.src?(O(),T("div",se,[f("div",re,[c(p(L),{ref_key:"cropper",ref:e,class:"cropper",src:t.src,"auto-zoom":t.cropperAutoZoom,"stencil-props":{movable:t.cropperMovable,scalable:t.cropperScalable,aspectRatio:t.cropperRatio,previewClass:t.roundPreview?"circle-stencil-preview":""},"image-restriction":"stencil","background-class":"cropper-background","stencil-component":t.roundPreview?p(Q):p(P),onChange:g},null,8,["src","auto-zoom","stencil-props","stencil-component"]),f("div",oe,[f("div",{class:"square-button",title:"Flip Horizontal",onClick:i[0]||(i[0]=S=>C(!0,!1))},[c(k,{color:"white",size:20},{default:b(()=>[c(h,{icon:"fa-solid:arrows-alt-h"})]),_:1})]),f("div",{class:"square-button",title:"Flip Vertical",onClick:i[1]||(i[1]=S=>C(!1,!0))},[c(k,{color:"white",size:20},{default:b(()=>[c(h,{icon:"fa-solid:arrows-alt-v"})]),_:1})]),f("div",{class:"square-button",title:"Rotate Clockwise",onClick:i[2]||(i[2]=S=>_(90))},[c(k,{color:"white",size:20},{default:b(()=>[c(h,{icon:"fa-solid:redo-alt"})]),_:1})]),f("div",{class:"square-button",title:"Rotate Counter-Clockwise",onClick:i[3]||(i[3]=S=>_(-90))},[c(k,{color:"white",size:20},{default:b(()=>[c(h,{icon:"fa-solid:undo-alt"})]),_:1})])])]),i[6]||(i[6]=f("br",null,null,-1)),f("div",ae,[c(p(x),{ref:"preview",class:J(["preview",{round:t.roundPreview}]),image:p(n).image,width:p(l),height:t.previewHeight,coordinates:p(n).coordinates},null,8,["image","width","height","class","coordinates"])])])):(O(),T("div",ne,[c(F,{title:p(o)("noSrcFileWarning"),type:"warning","show-icon":""},null,8,["title"])])),f("div",ie,[f("span",le,[c(M,{secondary:"",onClick:i[4]||(i[4]=S=>a("cancel"))},{default:b(()=>[z(N(p(o)("close")),1)]),_:1}),i[7]||(i[7]=z("    ",-1)),t.src?(O(),Y(M,{key:0,secondary:"",type:"primary",onClick:i[5]||(i[5]=S=>D())},{default:b(()=>[z(N(p(o)("save")),1)]),_:1})):X("",!0)])])])])}}}),Ae=H(de,[["__scopeId","data-v-1f393804"]]),{defineComponent:fe}=await I("vue"),{unref:q,renderSlot:pe,vShow:me,normalizeClass:he,normalizeStyle:ge,createElementVNode:ye,withDirectives:ve,resolveComponent:Ne,withCtx:we,openBlock:_e,createBlock:ke}=await I("vue"),{ref:A,useSlots:be}=await I("vue"),Ee=["src","alt","title","width","height","loading"],Re=fe({__name:"AsyncImg",props:{load:{},alt:{},width:{},height:{},title:{},loading:{},style:{},fallback:{},class:{},displayLoader:{type:Boolean,default:!0}},setup(s){const r=s,o=A(""),a=A(!1),t=A(!1);(async()=>{a.value=!0,o.value=await r.load(),a.value=!1,o.value||(r.fallback&&(o.value=r.fallback),t.value=!0)})();const n=be(),l=g=>!!n[g];return(g,C)=>{const _=j;return q(t)&&l("fallback")?pe(g.$slots,"fallback",{key:0}):(_e(),ke(_,{key:1,size:"small",class:"w-full h-full",show:s.displayLoader&&q(a)},{default:we(()=>[ve(ye("img",{src:q(o),alt:r.alt,class:he(r.class),title:r.title,style:ge(r.style),width:r.width,height:r.height,loading:r.loading},null,14,Ee),[[me,!s.displayLoader||!q(a)]])]),_:1},8,["show"]))}}}),Ue=()=>{const{t:s}=m(),r=[{label:s("image"),value:y.IMAGE,tagType:"default"},{label:s("video"),value:y.VIDEO,tagType:"info"},{label:s("audio"),value:y.AUDIO,tagType:"success"},{label:s("document"),value:y.DOCUMENT,tagType:"warning"},{label:s("other"),value:y.OTHER,tagType:"error"}];return{getMediaFileTypeTagType:t=>r.find(e=>e.value===t)?.tagType||"default",getMediaFileTypeLabel:t=>r.find(e=>e.value===t)?.label,mediaFileTypes:r}},Ve=(s,r,o)=>Z(["media-files"],s,t=>{const e=new URLSearchParams;return e.set("pageSize",String(t.pageSize)),t.query&&e.set("query",t.query),t.page&&e.set("page",String(t.page)),t.type&&e.set("type",String(t.type)),t.months?.length&&t.months.forEach(n=>e.append("months[]",n)),`/media-files?${e.toString()}`},{keepPreviousData:!0,staleTime:5e3,...r}),Le=(s,r)=>B(["media-files","months"],async()=>{const{request:o}=u(),a=await o({url:"/media-files/list/months"});return a.success&&a.result.data?a.result.data:[]},{refetchOnWindowFocus:!1,...s}),Qe=(s,r)=>B(["media-files","count"],async()=>{const{request:o}=u(),a=await o({url:"/count/media-files"});return a.success?a.result.data:0},{refetchOnWindowFocus:!1,...s}),Pe=(s,r,o)=>B(["media-files","type",s,"count"],async()=>{const{request:a}=u(),t=await a({url:`/count/media-files/type/${s}`});return t.success?t.result.data:0},{refetchOnWindowFocus:!1,...r}),xe=(s,r)=>B(["media-files","trashed","count"],async()=>{const{request:o}=u(),a=await o({url:"/count/media-files/trashed"});return a.success?a.result.data:0},{refetchOnWindowFocus:!1,...s});class Ce{id;foreignId;senderId;foreignUrl;url;name;path;size;type;extension;mimeType;title;description;additionalMetadata;deletedAt;createdAt;updatedAt;sender;constructor(r,o,a,t=y.OTHER,e,n,l,g,C,_,D,d,i,h,k,F,M){this.id=e,this.url=n,this.foreignId=l,this.senderId=g,this.foreignUrl=C,this.name=r,this.path=o,this.size=a,this.type=t,this.extension=_,this.mimeType=D,this.title=d,this.description=i,this.additionalMetadata=h,this.deletedAt=k,this.createdAt=F,this.updatedAt=M}}const He=s=>{const{request:r}=u(),{t:o}=m(),a=v(),t=w();return U({queryKey:["media-files"],operation:"remove",isPaginated:!0,allowEmptyPages:!1,getItemId:e=>e.id??`temp-${crypto.randomUUID()}`,mutationFn:async({id:e,force:n=!1})=>{a.start();const l=await r({method:"delete",url:n?`/media-files/force/${e}`:`/media-files/${e}`});if(a.finish(),!l.success)throw new Error(l.error);return l.result?.data},mutationOptions:{onSuccess:()=>{t.success(o("success"))},onError:e=>{t.error(o("anErrorOccurred"))},...s}})},We=()=>{const{request:s}=u(),{t:r}=m(),o=v(),a=w(),t=$();return E(async({id:e})=>{const n=await s({url:`/media-files/restore/${e}`,method:"put"});if(n.failure&&n.error)throw new Error(n.error);return n.result.data},{onMutate:()=>o.start(),onSettled:()=>o.finish(),onSuccess:()=>{a.success(r("success")),t.invalidateQueries({queryKey:["media-files"]})},onError:e=>{a.error(r("anErrorOccurred"))}})},Ge=()=>{const{request:s}=u(),{t:r}=m(),o=v(),a=w(),t=$();return E(async e=>{for(const n of e)await s({url:`/media-files/restore/${n}`,method:"put"});return e},{onMutate:()=>o.start(),onSettled:()=>o.finish(),onSuccess:()=>{a.success(r("success")),t.invalidateQueries({queryKey:["media-files"]})},onError:e=>{a.error(r("anErrorOccurred"))}})},Ke=s=>{const{request:r}=u(),{t:o}=m(),a=v(),t=w();return U({queryKey:["media-files"],operation:"batch",isPaginated:!0,allowEmptyPages:!1,getItemId:e=>{if(e instanceof Ce){if(typeof e.id!="string"&&typeof e.id!="number")throw new Error("MediaFile ID must be string or number");return e.id}return`temp-${crypto.randomUUID()}`},getBatchData:e=>({type:"remove",ids:Object.keys(e.selectedItems).filter(n=>e.selectedItems[n])}),mutationFn:async e=>{a.start();const n=Object.keys(e.selectedItems).filter(l=>e.selectedItems[l]);try{for(const l of n)await r({method:"delete",url:e.force?`/media-files/force/${l}`:`/media-files/${l}`});return n}finally{a.finish()}},mutationOptions:{onSuccess:()=>{t.success(o("success"))},onError:e=>{t.error(o("anErrorOccurred"))},...s}})},je=()=>{const{request:s}=u();return E(async r=>{const o=await s({url:"/media-files/list",method:"post",data:r});return o.failure&&o.error?[]:o.result.data})},Ze=()=>{const{request:s}=u(),{t:r}=m(),o=v(),a=w(),t=$();return E(async({id:e,data:n})=>{const l=await s({url:`/media-files/replace/${e}`,method:"post",data:n});if(l.failure&&l.error)throw new Error(l.error);return l.result.data},{onMutate:()=>o.start(),onSettled:()=>o.finish(),onSuccess:()=>{t.invalidateQueries({queryKey:["media-files"]})},onError:e=>{a.error(r("anErrorOccurred"))}})},Je=()=>{const{request:s}=u(),{t:r}=m(),o=v(),a=w();return E(async t=>{const e=await s({url:"/media-files/upload",method:"post",data:t});if(e.failure&&e.error)throw new Error(e.error);return e.result.data},{onMutate:()=>o.start(),onSettled:()=>o.finish(),onSuccess:()=>{},onError:t=>{a.error(r("anErrorOccurred"))}})},Xe=()=>{const{request:s}=u(),{t:r}=m(),o=v(),a=w(),t=$();return E(async()=>{const e=await s({method:"delete",url:"/media-files/force/all"});if(e.failure&&e.error)throw new Error(e.error);return e.result.data},{onMutate:()=>o.start(),onSettled:()=>o.finish(),onSuccess:()=>{a.success(r("success")),t.invalidateQueries({queryKey:["media-files"]})},onError:e=>{a.error(r("anErrorOccurred"))}})};export{y as M,Re as _,Ve as a,Le as b,Qe as c,Pe as d,xe as e,He as f,We as g,Ze as h,Je as i,Xe as j,Ke as k,Ge as l,Ae as m,je as n,Ue as u};
