import{i as ae}from"./css-render_vue3-ssr-Vbotx5Ir.js";import{u as Ke,M as r,_ as Xe,a as Je}from"./media-library-DmBw0Umg.js";import{_ as Qe}from"./PageLayout.vue_vue_type_script_setup_true_lang-OixN3STA.js";import{u as Ze,_ as et,R as tt,l as lt,r as fe,e as nt,m as st,n as at,o as ot,p as it}from"./index-B2LlKIv2.js";import{I as ut}from"./iconify_vue-BwapRRpV.js";import{u as ct}from"./vue-router-B7M2c80d.js";import{b as rt}from"./vueuse_core-C-qbfbRJ.js";import{v as re}from"./uuid-8I8R7izr.js";import{a as dt,b as pt,c as _t,A as ft,M as mt,B as vt,N as yt,a8 as gt,a9 as kt,ab as ht,G as wt,R as bt,g as It,X as $t,ac as Ct,a1 as xt,O as Et,a2 as Mt,j as zt,a6 as Dt,F as Tt,a3 as St,ad as Ot}from"./naive-ui-CrTIpLJ9.js";import{u as Ut}from"./vue-i18n-CWrb4u3f.js";const{unref:At}=await ae("vue"),{defineComponent:Rt}=await ae("vue"),{unref:e,toDisplayString:u,createElementVNode:c,resolveComponent:El,createVNode:n,withCtx:l,createTextVNode:E,openBlock:i,createBlock:k,createCommentVNode:y,createElementBlock:_,isRef:z,renderList:de,Fragment:G}=await ae("vue"),Nt={key:0,class:"flex items-center gap-3"},Pt={key:1,class:"flex items-center gap-3"},Vt={class:"flex justify-between items-center"},Ft={class:"flex items-center gap-3"},Bt={key:0},Lt={key:0},Gt={key:0},Yt={key:0},jt={class:"flex items-center justify-center h-[200px] relative"},Ht={class:"text-center text-dimgray text-sm"},qt={class:"flex items-center gap-2"},Wt={class:"flex items-center gap-2"},Kt={key:1,class:"flex items-center justify-center"},Xt={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},Jt=["src"],Qt={id:"video",autoplay:"",controls:"",style:{width:"100%"}},Zt=["src"],el={class:"w-[30%]"},tl={key:0},ll={key:1},nl={key:2},sl={key:3},al={key:4},ol={key:0},il={key:1},ul={key:2},cl={key:3},rl={key:4},dl={key:5},pl={key:6},{ref:m,h:_l,watch:fl,computed:ml}=await ae("vue"),X=10,Ml=Rt({__name:"index",setup(vl){const{t,locale:me}=Ut(),{request:g}=nt(),{getVideoThumbnail:ve}=Ze(),$=dt(),w=pt(),F=_t(),ye=ct(),{mediaFileTypes:ge}=Ke(),oe=m(re()),D=m(!1),J=m(!1),ie=m(0),ue=m(0),Q=m(""),ke=m(null),B=m([]),S=m({[r.DOCUMENT]:0,[r.IMAGE]:0,[r.VIDEO]:0,[r.AUDIO]:0,[r.OTHER]:0}),Z=m(!1),Y=m([]),O=m([]),T=m(0),x=o=>{let a=`${o}&query=${Q.value}&type=${T.value}`;for(const d of O.value)a+=`&months[]=${d}`;return a},he=o=>_l("span",{},{default:()=>fe(o.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:me.value})}),pe=m(0),b=m(12),C=m(1),we=o=>{h(x(`/media-files?pageSize=${b.value}&page=${o}`))},be=o=>{b.value=o,h(x(`/media-files?pageSize=${b.value}`))},h=async(o=null,a=!1)=>{J.value=!0,$.start();const d=await g({url:o||x(`/media-files?pageSize=${b.value}`)});if(d.success&&d.result&&(B.value=d.result.data?.mediaFiles||[],pe.value=d.result.data?.meta?.total||0,C.value=d.result.data?.meta?.currentPage||1),a){const f=await g({url:"/media-files/list/months"});f.success&&f.result&&(Y.value=(f.result.data||[]).map(ne=>({label:ne,value:ne})));const R=await g({url:"/count/media-files"});R.success&&R.result&&(ie.value=R.result.data);const H=await g({url:`/count/media-files/type/${r.IMAGE}`});H.success&&H.result&&(S.value[r.IMAGE]=H.result.data);const q=await g({url:`/count/media-files/type/${r.VIDEO}`});q.success&&q.result&&(S.value[r.VIDEO]=q.result.data);const W=await g({url:`/count/media-files/type/${r.AUDIO}`});W.success&&W.result&&(S.value[r.AUDIO]=W.result.data);const N=await g({url:`/count/media-files/type/${r.OTHER}`});N.success&&N.result&&(S.value[r.OTHER]=N.result.data);const K=await g({url:`/count/media-files/type/${r.DOCUMENT}`});K.success&&K.result&&(S.value[r.DOCUMENT]=K.result.data);const P=await g({url:"/count/media-files/trashed"});P.success&&P.result&&(ue.value=P.result.data)}let p=!0;B.value.length===0&&(p=!1);for(const f of B.value)if(f.id&&!I.value[f.id]){p=!1;break}Z.value=p,oe.value=re(),$.finish(),J.value=!1};h(null,!0);const Ie=async o=>{F.warning({title:t("confirm"),content:t("confirmDeleteMediaFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{let a;T.value==X?a=await g({method:"delete",url:`/media-files/force/${o.id}`}):a=await g({method:"delete",url:`/media-files/${o.id}`}),a.success?(w.success(t("success")),h(x(`/media-files?pageSize=${b.value}&page=${C.value}`),!0)):w.error(t("anErrorOccurred"))}})},$e=async o=>{F.warning({title:t("confirm"),content:t("confirmRestoreMediaFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{(await g({method:"put",url:`/media-files/restore/${o.id}`})).success?(w.success(t("success")),h(x(`/media-files?pageSize=${b.value}&page=${C.value}`),!0)):w.error(t("anErrorOccurred"))}})},{copy:Ce,copied:xe,isSupported:Ee}=rt(),Me=async o=>{o.url&&Ce(o.url)};fl(()=>xe.value,o=>{o&&w.success(t("mediaLinkCopied"))});const j=m(null),ee=m(!1),te=m(!1),ze=async o=>{switch(j.value=o,o.type){case r.IMAGE:break;case r.VIDEO:te.value=!0;break;case r.AUDIO:ee.value=!0;break;case r.DOCUMENT:window.open(o.url);break;default:w.info(t("cannotOpenThisFile"));break}},v=m(null),le=m(!1),De=async o=>{v.value=o,le.value=!0},ce=m(null),U=m(null),A=m(!1),Te=async o=>{U.value=o,$.start();const a=await g({url:"/file/download",method:"post",data:{path:o.path},responseType:"blob"});a.success&&a.result&&(ce.value=await st(a.result)),$.finish(),A.value=!0},Se=async(o,a)=>{var d=at(a);d=await ot(d,{maxSizeMB:1});const p=new FormData;p.append("file",d),F.warning({title:t("registration"),content:t("confirmReplaceCurrentFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{D.value=!0,$.start(),U.value&&p.append("filename",U.value?.name);const f=await g({url:`/media-files/replace/${U.value?.id}`,method:"post",data:p});f.success&&f.result?(A.value=!1,h(x(`/media-files?pageSize=${b.value}&page=${C.value}`),!0)):w.error(t("anErrorOccurred")),$.finish(),D.value=!1},onNegativeClick:async()=>{D.value=!0,$.start(),U.value&&p.append("filename",it(6)+"-"+U.value?.name);const f=await g({url:"/media-files/upload",method:"post",data:p});f.success&&f.result?(A.value=!1,h(x(`/media-files?pageSize=${b.value}&page=${C.value}`),!0)):w.error(t("anErrorOccurred")),$.finish(),D.value=!1}})},Oe=async()=>{F.warning({title:t("confirm"),content:t("confirmEmptyTrash"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{(await g({method:"delete",url:"/media-files/force/all"})).success?(w.success(t("success")),h(x(`/media-files?pageSize=${b.value}&page=${C.value}`),!0)):w.error(t("anErrorOccurred"))}})},I=m({}),L=ml(()=>{let o=0;for(const a in I.value)I.value[a]&&o++;return o});function Ue(){I.value={},h(x(`/media-files?pageSize=${b.value}&page=${C.value}`))}const Ae=async()=>(L.value?F.warning({title:t("confirm"),content:t("deleteSelectionWarningMessage",[L.value]),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{D.value=!0,$.start();for(const o in I.value)I.value[o]&&(T.value==X?await g({url:`/media-files/force/${o}`,method:"delete"}):await g({url:`/media-files/${o}`,method:"delete"}));$.finish(),D.value=!1,w.success(t("success")),I.value={},h(null,!0)}}):w.warning(t("noItemSelected")),!1),Re=async()=>(L.value?F.warning({title:t("confirm"),content:t("restoreSelectionWarningMessage",[L.value]),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{D.value=!0,$.start();for(const o in I.value)I.value[o]&&await g({method:"put",url:`/media-files/restore/${o}`});$.finish(),D.value=!1,w.success(t("success")),I.value={},h(null,!0)}}):w.warning(t("noItemSelected")),!1);return(o,a)=>{const d=ut,p=yt,f=vt,R=mt,H=zt,q=Tt,W=Dt,N=kt,K=gt,P=ft,ne=Ct,Ne=Xe,Pe=$t,Ve=It,Fe=et,Be=bt,Le=wt,Ge=ht,Ye=xt,je=Et,He=Mt,qe=Qe,se=St,_e=Ot,We=Je;return i(),_(G,null,[n(qe,null,{"header-extra":l(()=>[e(L)>0?(i(),_("section",Nt,[c("span",null,u(e(t)("nbItemsSelected",[e(L)])),1),e(T)==X?(i(),k(f,{key:0,type:"success",size:"small",onClick:Re},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"mdi:delete-restore"})]),_:1})]),default:l(()=>[E(" "+u(e(t)("restore")),1)]),_:1})):y("",!0),n(f,{type:"error",size:"small",onClick:Ae},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:trash-can"})]),_:1})]),default:l(()=>[E(" "+u(e(t)("delete")),1)]),_:1}),n(f,{type:"warning",size:"small",onClick:Ue},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:close"})]),_:1})]),default:l(()=>[E(" "+u(e(t)("cancelSelection")),1)]),_:1})])):(i(),_("section",Pt,[n(H,{value:e(O),"onUpdate:value":[a[1]||(a[1]=s=>z(O)?O.value=s:null),a[2]||(a[2]=s=>h())],"render-label":he,options:e(Y),placeholder:e(t)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:l(()=>[n(R,{size:"large",class:"w-full","default-checked":e(Y).length&&e(O).length===e(Y).length,"onUpdate:checked":a[0]||(a[0]=s=>{s?O.value=e(Y).map(M=>M.value):O.value=[],h()})},{default:l(()=>[E(u(e(t)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),n(W,{class:"!w-[250px]"},{default:l(()=>[n(q,{ref_key:"searchInputRef",ref:ke,value:e(Q),"onUpdate:value":[a[3]||(a[3]=s=>z(Q)?Q.value=s:null),a[4]||(a[4]=s=>{s||h(x(`/media-files?pageSize=${e(b)}&page=${e(C)}`))})],clearable:!0,placeholder:e(t)("search")},null,8,["value","placeholder"]),n(f,{type:"primary",onClick:a[5]||(a[5]=s=>h(x(`/media-files?pageSize=${e(b)}&page=${e(C)}`)))},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1}),n(f,{type:"primary",onClick:a[6]||(a[6]=()=>{e(ye).push(e(tt).MEDIA_LIBRARY.PATH+"/add")})},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:add-alt"})]),_:1})]),default:l(()=>[E(" "+u(e(t)("add")),1)]),_:1})]))]),default:l(()=>[n(P,{size:"small",class:"mb-5"},{default:l(()=>[c("div",Vt,[c("div",Ft,[n(R,{checked:e(Z),"onUpdate:checked":[a[7]||(a[7]=s=>z(Z)?Z.value=s:null),a[8]||(a[8]=s=>{for(const M of e(B))M.id&&(e(I)[M.id]=s);oe.value=("uuidv4"in o?o.uuidv4:At(re))()})]},{default:l(()=>[E(u(e(t)("selectAll")),1)]),_:1},8,["checked"]),e(T)==X?(i(),k(f,{key:0,type:"error",size:"small",onClick:Oe},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"mdi:delete-forever"})]),_:1})]),default:l(()=>[E(" "+u(e(t)("emptyTrash")),1)]),_:1})):y("",!0)]),n(K,{value:e(T),"onUpdate:value":[a[9]||(a[9]=s=>z(T)?T.value=s:null),a[10]||(a[10]=s=>h())],name:"filtertyperadiobuttongroup",size:"medium"},{default:l(()=>[n(N,{value:0},{default:l(()=>[E(u(e(t)("all"))+"  ",1),e(ie)?(i(),_("span",Bt," ("+u(e(ie))+") ",1)):y("",!0)]),_:1}),(i(!0),_(G,null,de(e(ge),s=>(i(),k(N,{key:s.value,value:s.value},{default:l(()=>[E(u(s.label)+"  ",1),e(S)[s.value]?(i(),_("span",Lt," ("+u(e(S)[s.value])+") ",1)):y("",!0)]),_:2},1032,["value"]))),128)),n(N,{value:X},{default:l(()=>[E(u(e(t)("trash"))+"  ",1),e(ue)?(i(),_("span",Gt,"("+u(e(ue))+")",1)):y("",!0)]),_:1})]),_:1},8,["value"])])]),_:1}),n(P,{embedded:"",class:"py-2"},{default:l(()=>[e(B).length&&!e(J)?(i(),_("section",Yt,[n(Ge,{"show-toolbar-tooltip":""},{default:l(()=>[n(Le,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:3 900:4"},{default:l(()=>[(i(!0),_(G,null,de(e(B),(s,M)=>(i(),k(Be,{key:M},{default:l(()=>[n(Fe,{name:"slide-fade",appear:""},{default:l(()=>[n(P,{bordered:"",hoverable:""},{cover:l(()=>[c("div",jt,[s.type==e(r).IMAGE?(i(),_(G,{key:0},[s.url?(i(),k(ne,{key:0,src:s.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):y("",!0)],64)):s.type==e(r).VIDEO?(i(),_(G,{key:1},[s.url?(i(),k(Ne,{key:0,load:()=>e(ve)(s.url??""),class:"w-full h-[200px] object-cover",size:"large"},{fallback:l(()=>[n(p,{size:"96"},{default:l(()=>[n(d,{icon:"carbon:document-video"})]),_:1})]),_:2},1032,["load"])):y("",!0)],64)):s.type==e(r).AUDIO?(i(),k(p,{key:2,size:"96"},{default:l(()=>[n(d,{icon:"carbon:document-audio"})]),_:1})):s.type==e(r).DOCUMENT?(i(),k(p,{key:3,size:"96"},{default:l(()=>[n(d,{icon:"carbon:document"})]),_:1})):(i(),k(p,{key:4,size:"96"},{default:l(()=>[n(d,{icon:"carbon:document-unknown"})]),_:1}))])]),header:l(()=>[c("div",Ht,[n(Pe,{"line-clamp":1},{default:l(()=>[s.id?(i(),k(R,{key:e(oe),checked:e(I)[s.id],"onUpdate:checked":V=>e(I)[s.id]=V,class:"mr-1"},null,8,["checked","onUpdate:checked"])):y("",!0),E(" "+u(s.name),1)]),_:2},1024)])]),action:l(()=>[n(Ve,{justify:"space-between",align:"center"},{default:l(()=>[c("div",qt,[s.type!=e(r).IMAGE?(i(),k(f,{key:0,ternary:"",circle:"",title:e(t)("preview"),onClick:V=>ze(s)},{icon:l(()=>[n(p,null,{default:l(()=>[[e(r).AUDIO,e(r).VIDEO].includes(s.type)?(i(),k(d,{key:0,icon:"carbon:play-filled-alt"})):(i(),k(d,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):y("",!0),n(f,{ternary:"",circle:"",title:e(t)("details"),onClick:V=>De(s)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:information-filled"})]),_:1})]),_:2},1032,["title","onClick"])]),c("div",Wt,[s.deletedAt?(i(),k(f,{key:0,ternary:"",circle:"",title:e(t)("restore"),onClick:V=>$e(s)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"mdi:delete-restore"})]),_:1})]),_:2},1032,["title","onClick"])):y("",!0),e(Ee)?(i(),k(f,{key:1,ternary:"",circle:"",title:e(t)("copy"),onClick:V=>Me(s)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:copy"})]),_:1})]),_:2},1032,["title","onClick"])):y("",!0),s.type==e(r).IMAGE?(i(),k(f,{key:2,ternary:"",circle:"",title:e(t)("edit"),onClick:V=>Te(s)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:edit"})]),_:1})]),_:2},1032,["title","onClick"])):y("",!0),n(f,{ternary:"",circle:"",title:e(t)("delete"),onClick:V=>Ie(s)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:trash-can"})]),_:1})]),_:2},1032,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n(Ye,{page:e(C),"onUpdate:page":[a[11]||(a[11]=s=>z(C)?C.value=s:null),we],class:"mt-10 justify-center","show-size-picker":"","page-size":e(b),"page-sizes":[12,24,36,48,60],"page-count":Math.ceil(e(pe)/e(b)),"onUpdate:pageSize":be},null,8,["page","page-size","page-count"])])):e(J)?(i(),_("section",Kt,[n(je,{size:"medium"})])):(i(),k(He,{key:2,description:e(t)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),_:1}),n(se,{show:e(ee),"onUpdate:show":a[12]||(a[12]=s=>z(ee)?ee.value=s:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(j)?.name},{default:l(()=>[c("audio",Xt,[c("source",{src:e(j)?.url},null,8,Jt)])]),_:1},8,["show","title"]),n(se,{show:e(te),"onUpdate:show":a[13]||(a[13]=s=>z(te)?te.value=s:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(j)?.name},{default:l(()=>[c("video",Qt,[c("source",{src:e(j)?.url},null,8,Zt)])]),_:1},8,["show","title"]),n(se,{show:e(le),"onUpdate:show":a[14]||(a[14]=s=>z(le)?le.value=s:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(v)?.name},{default:l(()=>[e(v)?(i(),k(_e,{key:0,striped:"","single-line":!1,size:"small"},{default:l(()=>[c("tbody",null,[c("tr",null,[c("td",el,u(e(t)("name")),1),c("td",null,u(e(v).name),1)]),c("tr",null,[c("td",null,u(e(t)("link")),1),c("td",null,[c("small",null,u(e(v).url),1)])]),c("tr",null,[c("td",null,u(e(t)("type")),1),c("td",null,[e(v).type==e(r).IMAGE?(i(),_("span",tl,u(e(t)("image")),1)):e(v).type==e(r).VIDEO?(i(),_("span",ll,u(e(t)("video")),1)):e(v).type==e(r).AUDIO?(i(),_("span",nl,u(e(t)("audio")),1)):e(v).type==e(r).DOCUMENT?(i(),_("span",sl,u(e(t)("document")),1)):(i(),_("span",al,u(e(t)("other")),1))])]),e(v).size?(i(),_("tr",ol,[c("td",null,u(e(t)("size")),1),c("td",null,u(e(lt)(e(v).size,!0)),1)])):y("",!0),e(v).mimeType?(i(),_("tr",il,[c("td",null,u(e(t)("mimeType")),1),c("td",null,u(e(v).mimeType),1)])):y("",!0),e(v).sender?(i(),_("tr",ul,[c("td",null,u(e(t)("sendBy")),1),c("td",null,u(e(v).sender.fullname),1)])):y("",!0),e(v).title?(i(),_("tr",cl,[c("td",null,u(e(t)("title")),1),c("td",null,u(e(v).title),1)])):y("",!0),e(v).description?(i(),_("tr",rl,[c("td",null,u(e(t)("description")),1),c("td",null,[c("small",null,u(e(v).description),1)])])):y("",!0),e(v).createdAt?(i(),_("tr",dl,[c("td",null,u(e(t)("date")),1),c("td",null,u(e(fe)(e(v).createdAt)),1)])):y("",!0),e(v).additionalMetadata?(i(),_("tr",pl,[c("td",null,u(e(t)("metadata")),1),c("td",null,[n(_e,{striped:"","single-line":"",size:"small"},{default:l(()=>[c("tbody",null,[(i(!0),_(G,null,de(e(v).additionalMetadata||[],(s,M)=>(i(),_("tr",{key:M},[c("td",null,u(M),1),c("td",null,u(s),1)]))),128))])]),_:1})])])):y("",!0)])]),_:1})):y("",!0)]),_:1},8,["show","title"]),n(se,{show:e(A),"onUpdate:show":a[16]||(a[16]=s=>z(A)?A.value=s:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(U)?.name},{default:l(()=>[n(We,{"cropper-ratio":void 0,"round-preview":!1,src:e(ce)?e(ce):void 0,onCancel:a[15]||(a[15]=s=>A.value=!1),onSave:Se},null,8,["src"])]),_:1},8,["show","title"])],64)}}});export{Ml as default};
