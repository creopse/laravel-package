import{P as C,C as S}from"./ckeditor_ckeditor5-core-CWAtyu9P.js";import{S as y}from"./ckeditor_ckeditor5-enter-0icnFgvj.js";import{d as O}from"./ckeditor_ckeditor5-engine-BHV-Rp_a.js";import{C as R}from"./ckeditor_ckeditor5-clipboard-CyjGvBno.js";import{h as M,f as B}from"./ckeditor_ckeditor5-utils-DZhn28Eg.js";import{c as N,f as q,M as F,b as $,d as z,e as U,U as W,S as j}from"./ckeditor_ckeditor5-ui-C7Ma50Jw.js";import{j as w}from"./ckeditor_ckeditor5-icons-BkOmZeoU.js";/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function h(i){const e=i.t,n=i.config.get("codeBlock.languages");for(const o of n)o.label==="Plain text"&&(o.label=e("Plain text")),o.class===void 0&&(o.class=`language-${o.language}`);return n}function b(i,e,n){const o={};for(const c of i)if(e==="class"){const s=c[e].split(" ").shift();o[s]=c[n]}else o[c[e]]=c[n];return o}function x(i){return i.data.match(/^(\s*)/)[0]}function H(i,e){const n=i.createDocumentFragment(),o=e.split(`
`),c=o.reduce((s,t,a)=>(s.push(t),a<o.length-1&&s.push(i.createElement("br")),s),[]);return i.appendChild(c,n),n}function v(i){const e=i.document.selection,n=[];if(e.isCollapsed)return[e.anchor];const o=e.getFirstRange().getWalker({ignoreElementEnd:!0,direction:"backward"});for(const{item:c}of o){let s=c.is("$textProxy")?c.textNode:c;const t=s.parent;if(!t.is("element","codeBlock")||s.is("element","softBreak"))continue;for(;s.previousSibling&&!s.previousSibling.is("element","softBreak");)s=s.previousSibling;const a=s.is("$text")?s.startOffset+x(s).length:s.startOffset,r=i.createPositionAt(t,a);n.every(l=>!l.isEqual(r))&&n.push(r)}return n}function _(i){const e=B(i.getSelectedBlocks());return!!e&&e.is("element","codeBlock")}function A(i,e){return e.is("rootElement")||i.isLimit(e)?!1:i.checkChild(e.parent,"codeBlock")}function P(i,e,n,o){const c=b(e,"language","label"),s=n.getAttribute("language");if(s in c){const t=c[s];return i(o==="enter"?"Entering %0 code snippet":"Leaving %0 code snippet",t)}return i(o==="enter"?"Entering code snippet":"Leaving code snippet")}function D(i,e){for(i.textNode&&(i=e.createPositionBefore(i.textNode));i.nodeBefore&&!i.nodeBefore.is("element","softBreak");)i=e.createPositionBefore(i.nodeBefore);const n=i.nodeAfter;return n&&n.is("$text")?n:null}class J extends S{_lastLanguage;constructor(e){super(e),this._lastLanguage=null}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const n=this.editor,o=n.model,c=o.document.selection,t=h(n)[0],a=Array.from(c.getSelectedBlocks()),r=e.forceValue==null?!this.value:e.forceValue,l=K(e,this._lastLanguage,t.language);o.change(u=>{r?this._applyCodeBlock(u,a,l):this._removeCodeBlock(u,a)})}_getValue(){const e=this.editor.model.document.selection,n=B(e.getSelectedBlocks());return!!n?.is("element","codeBlock")?n.getAttribute("language"):!1}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,n=this.editor.model.schema,o=B(e.getSelectedBlocks());return o?A(n,o):!1}_applyCodeBlock(e,n,o){this._lastLanguage=o;const c=this.editor.model.schema,s=n.filter(t=>A(c,t));for(const t of s)e.rename(t,"codeBlock"),e.setAttribute("language",o,t),c.removeDisallowedAttributes([t],e),Array.from(t.getChildren()).filter(a=>!c.checkChild(t,a)).forEach(a=>e.remove(a));s.reverse().forEach((t,a)=>{const r=s[a+1];t.previousSibling===r&&(e.appendElement("softBreak",r),e.merge(e.createPositionBefore(t)))})}_removeCodeBlock(e,n){const o=n.filter(c=>c.is("element","codeBlock"));for(const c of o){const s=e.createRangeOn(c);for(const t of Array.from(s.getItems()).reverse())if(t.is("element","softBreak")&&t.parent.is("element","codeBlock")){const{position:a}=e.split(e.createPositionBefore(t)),r=a.nodeAfter;e.rename(r,"paragraph"),e.removeAttribute("language",r),e.remove(t)}e.rename(c,"paragraph"),e.removeAttribute("language",c)}}}function K(i,e,n){return i.language?i.language:i.usePreviousLanguageChoice&&e?e:n}class G extends S{_indentSequence;constructor(e){super(e),this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const n=this.editor.model;n.change(o=>{const c=v(n);for(const s of c){const t=o.createText(this._indentSequence);n.insertContent(t,s)}})}_checkEnabled(){return this._indentSequence?_(this.editor.model.document.selection):!1}}class X extends S{_indentSequence;constructor(e){super(e),this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const n=this.editor.model;n.change(()=>{const o=v(n);for(const c of o){const s=E(n,c,this._indentSequence);s&&n.deleteContent(n.createSelection(s))}})}_checkEnabled(){if(!this._indentSequence)return!1;const e=this.editor.model;return _(e.document.selection)?v(e).some(n=>E(e,n,this._indentSequence)):!1}}function E(i,e,n){const o=D(e,i);if(!o)return null;const c=x(o),s=c.lastIndexOf(n);if(s+n.length!==c.length||s===-1)return null;const{parent:t,startOffset:a}=o;return i.createRange(i.createPositionAt(t,a+s),i.createPositionAt(t,a+s+n.length))}function T(i,e,n=!1){const o=b(e,"language","class"),c=b(e,"language","label");return(s,t,a)=>{const{writer:r,mapper:l,consumable:u}=a;if(!u.consume(t.item,"insert"))return;const d=t.item.getAttribute("language"),g=l.toViewPosition(i.createPositionBefore(t.item)),m={};n&&(m["data-language"]=c[d],m.spellcheck="false");const p=o[d]?{class:o[d]}:void 0,L=r.createContainerElement("code",p),V=r.createContainerElement("pre",m,L);r.insert(g,V),l.bindElements(t.item,L)}}function Q(i){return(e,n,o)=>{if(n.item.parent.name!=="codeBlock")return;const{writer:c,mapper:s,consumable:t}=o;if(!t.consume(n.item,"insert"))return;const a=s.toViewPosition(i.createPositionBefore(n.item));c.insert(a,c.createText(`
`))}}function Y(i,e){const n=b(e,"class","language"),o=e[0].language;return(c,s,t)=>{const a=s.viewItem,r=a.parent;if(!r||!r.is("element","pre")||s.modelCursor.findAncestor("codeBlock"))return;const{consumable:l,writer:u}=t;if(!l.test(a,{name:!0}))return;const d=u.createElement("codeBlock"),g=[...a.getClassNames()];g.length||g.push("");for(const m of g){const p=n[m];if(p){l.consume(a,{classes:[m]}),u.setAttribute("language",p,d);break}}d.hasAttribute("language")||u.setAttribute("language",o,d),t.convertChildren(a,d),t.safeInsert(d,s.modelCursor)&&(l.consume(a,{name:!0}),t.updateConversionResult(d,s))}}function Z(){return(i,e,{consumable:n,writer:o})=>{let c=e.modelCursor;if(!n.test(e.viewItem)||!c.findAncestor("codeBlock"))return;n.consume(e.viewItem);const t=e.viewItem.data.split(`
`).map(r=>o.createText(r)),a=t[t.length-1];for(const r of t)if(o.insert(r,c),c=c.getShiftedBy(r.offsetSize),r!==a){const l=o.createElement("softBreak");o.insert(l,c),c=o.createPositionAfter(l)}e.modelRange=o.createRange(e.modelCursor,c),e.modelCursor=c}}function ee(){return(i,e,{consumable:n})=>{const o=e.viewItem;if(o.findAncestor("pre"))return;const c=Array.from(o.getChildren()),s=c.find(t=>t.is("element","code"));if(s)for(const t of c)t===s||!t.is("$text")||n.consume(t,{name:!0})}}const I="paragraph";class te extends C{static get pluginName(){return"CodeBlockEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[y]}constructor(e){super(e),e.config.define("codeBlock",{languages:[{language:"plaintext",label:"Plain text"},{language:"c",label:"C"},{language:"cs",label:"C#"},{language:"cpp",label:"C++"},{language:"css",label:"CSS"},{language:"diff",label:"Diff"},{language:"go",label:"Go"},{language:"html",label:"HTML"},{language:"java",label:"Java"},{language:"javascript",label:"JavaScript"},{language:"php",label:"PHP"},{language:"python",label:"Python"},{language:"ruby",label:"Ruby"},{language:"typescript",label:"TypeScript"},{language:"xml",label:"XML"}],indentSequence:"	"})}init(){const e=this.editor,n=e.model.schema,o=e.model,c=e.editing.view,s=h(e);e.commands.add("codeBlock",new J(e)),e.commands.add("indentCodeBlock",new G(e)),e.commands.add("outdentCodeBlock",new X(e)),this.listenTo(c.document,"tab",(t,a)=>{const r=a.shiftKey?"outdentCodeBlock":"indentCodeBlock";e.commands.get(r).isEnabled&&(e.execute(r),a.stopPropagation(),a.preventDefault(),t.stop())},{context:"pre"}),n.register("codeBlock",{allowWhere:"$block",allowChildren:"$text",disallowChildren:"$inlineObject",allowAttributes:["language"],allowAttributesOf:"$listItem",isBlock:!0}),n.addAttributeCheck((t,a)=>{const r=t.getItem(t.length-2);if(n.getAttributeProperties(a).isFormatting&&r&&r.name=="codeBlock")return!1}),e.editing.downcastDispatcher.on("insert:codeBlock",T(o,s,!0)),e.data.downcastDispatcher.on("insert:codeBlock",T(o,s)),e.data.downcastDispatcher.on("insert:softBreak",Q(o),{priority:"high"}),e.data.upcastDispatcher.on("element:code",Y(c,s)),e.data.upcastDispatcher.on("text",Z()),e.data.upcastDispatcher.on("element:pre",ee(),{priority:"high"}),this.listenTo(e.editing.view.document,"clipboardInput",(t,a)=>{let r=o.createRange(o.document.selection.anchor);if(a.targetRanges&&(r=e.editing.mapper.toModelRange(a.targetRanges[0])),!r.start.parent.is("element","codeBlock"))return;const l=a.dataTransfer.getData("text/plain"),u=new O(e.editing.view.document);a.content=H(u,l)}),e.plugins.has("ClipboardPipeline")&&e.plugins.get(R).on("contentInsertion",(t,a)=>{const r=e.model,l=r.document.selection;l.anchor.parent.is("element","codeBlock")&&r.change(u=>{const d=u.createRangeIn(a.content);for(const g of[...d.getItems()])g.is("node")&&!n.checkChild(l.anchor,g)&&u.remove(g)})}),this.listenTo(o,"getSelectedContent",(t,[a])=>{const r=a.anchor;a.isCollapsed||!r.parent.is("element","codeBlock")||!r.hasSameParentAs(a.focus)||o.change(l=>{const u=t.return;if(r.parent.is("element")&&(u.childCount>1||a.containsEntireContent(r.parent))){const g=l.createElement("codeBlock",r.parent.getAttributes());l.append(u,g);const m=l.createDocumentFragment();l.append(g,m),t.return=m;return}const d=u.getChild(0);n.checkAttribute(d,"code")&&l.setAttribute("code",!0,d)})})}afterInit(){const e=this.editor,n=e.commands,o=n.get("indent"),c=n.get("outdent");o&&o.registerChildCommand(n.get("indentCodeBlock"),{priority:"highest"}),c&&c.registerChildCommand(n.get("outdentCodeBlock")),this.listenTo(e.editing.view.document,"enter",(s,t)=>{e.model.document.selection.getLastPosition().parent.is("element","codeBlock")&&(!oe(e,t.isSoft)&&!ie(e,t.isSoft)&&ne(e),t.preventDefault(),s.stop())},{context:"pre"}),this._initAriaAnnouncements()}_initAriaAnnouncements(){const{model:e,ui:n,t:o}=this.editor,c=h(this.editor);let s=null;e.document.selection.on("change:range",()=>{const t=e.document.selection.focus.parent;!n||s===t||!t.is("element")||(s&&s.is("element","codeBlock")&&n.ariaLiveAnnouncer.announce(P(o,c,s,"leave")),t.is("element","codeBlock")&&n.ariaLiveAnnouncer.announce(P(o,c,t,"enter")),s=t)})}}function ne(i){const e=i.model,n=e.document,o=n.selection.getLastPosition();let c;const s=D(o,e);s&&s.is("$text")&&(c=x(s)),i.model.change(t=>{i.execute("shiftEnter"),c&&t.insertText(c,n.selection.anchor)})}function oe(i,e){const o=i.model.document,c=i.editing.view,s=o.selection.getLastPosition(),t=s.nodeAfter;return e||!o.selection.isCollapsed||!s.isAtStart||!f(t)?!1:(i.model.change(a=>{i.execute("enter");const r=o.selection.anchor.parent.previousSibling;a.rename(r,I),a.setSelection(r,"in"),i.model.schema.removeDisallowedAttributes([r],a),a.remove(t)}),c.scrollToTheSelection(),!0)}function ie(i,e){const n=i.model,o=n.document,c=i.editing.view,s=o.selection.getLastPosition(),t=s.nodeBefore;let a;if(e||!o.selection.isCollapsed||!s.isAtEnd||!t||!t.previousSibling)return!1;if(f(t)&&f(t.previousSibling))a=n.createRange(n.createPositionBefore(t.previousSibling),n.createPositionAfter(t));else if(k(t)&&f(t.previousSibling)&&f(t.previousSibling.previousSibling))a=n.createRange(n.createPositionBefore(t.previousSibling.previousSibling),n.createPositionAfter(t));else if(k(t)&&f(t.previousSibling)&&k(t.previousSibling.previousSibling)&&t.previousSibling.previousSibling&&f(t.previousSibling.previousSibling.previousSibling))a=n.createRange(n.createPositionBefore(t.previousSibling.previousSibling.previousSibling),n.createPositionAfter(t));else return!1;return i.model.change(r=>{r.remove(a),i.execute("enter");const l=o.selection.anchor.parent;r.rename(l,I),i.model.schema.removeDisallowedAttributes([l],r)}),c.scrollToTheSelection(),!0}function k(i){return i&&i.is("$text")&&!i.data.match(/\S/)}function f(i){return i&&i.is("element","softBreak")}class se extends C{static get pluginName(){return"CodeBlockUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,n=e.t,o=e.ui.componentFactory,c=h(e),s=this._getLanguageListItemDefinitions(c),t=e.commands.get("codeBlock");o.add("codeBlock",a=>{const r=N(a,j),l=r.buttonView,u=n("Insert code block");return l.set({label:u,tooltip:!0,icon:w,isToggleable:!0}),l.bind("isOn").to(t,"value",d=>!!d),l.on("execute",()=>{e.execute("codeBlock",{usePreviousLanguageChoice:!0}),e.editing.view.focus()}),r.on("execute",d=>{e.execute("codeBlock",{language:d.source._codeBlockLanguage,forceValue:!0}),e.editing.view.focus()}),r.class="ck-code-block-dropdown",r.bind("isEnabled").to(t),q(r,s,{role:"menu",ariaLabel:u}),r}),o.add("menuBar:codeBlock",a=>{const r=new F(a);r.buttonView.set({role:"menuitem",label:n("Code block"),icon:w}),r.bind("isEnabled").to(t);const l=new $(a);l.set({ariaLabel:n("Insert code block")});for(const u of s){const d=new z(a,r),g=new U(a);g.bind(...Object.keys(u.model)).to(u.model),g.set({isToggleable:!0,role:"menuitemcheckbox"}),g.delegate("execute").to(r),g.on("execute",()=>{e.execute("codeBlock",{language:u.model._codeBlockLanguage,forceValue:t.value!=u.model._codeBlockLanguage}),e.editing.view.focus()}),d.children.add(g),l.items.add(d)}return r.panelView.children.add(l),r})}_getLanguageListItemDefinitions(e){const o=this.editor.commands.get("codeBlock"),c=new M;for(const s of e){const t={type:"button",model:new W({_codeBlockLanguage:s.language,label:s.label,role:"menuitemradio",withText:!0})};t.model.bind("isOn").to(o,"value",a=>a===t.model._codeBlockLanguage),c.add(t)}return c}}class me extends C{static get requires(){return[te,se]}static get pluginName(){return"CodeBlock"}static get isOfficialPlugin(){return!0}}export{me as C};
