import{i as x}from"./ckeditor_ckeditor5-vue-CmLqe3wy.js";import{b as _n,u as mn}from"./vueuse_core-DLnQCT4A.js";import{u as ht,K as fn,_ as vn,L as gt,y as nt,M as yn,N as kt,O as hn,c as gn}from"./main-BRU0R4jH.js";import{K as bt,u as We,F as kn,B as Qe,h as Ke,r as bn,k as wn,O as wt,c as Ct,_ as $t,Q as Cn,R as $n,W as xn,d as Mn,o as Sn,q as xt,w as In,X as Un,I as Fn,l as Mt,J as Bn,Y as Vn,a3 as zn,C as Tn,ag as Nn,p as En,Z as Dn,$ as An,m as Ln,v as On,a4 as Rn,a9 as jn}from"./naive-ui-CqiIy5K7.js";import{u as Pn,M as p,a as Hn,b as Yn,c as qn,d as he,n as Gn,f as Wn,h as Qn,i as Kn,k as Jn,_ as Xn,m as Zn}from"./media-file-Dm8mNHuZ.js";import{I as Je}from"./iconify_vue-DXPEksg3.js";import{v as Me}from"./uuid-8I8R7izr.js";import{r as eo}from"./vueuse_shared-CcT-C3Xm.js";import{u as Ve}from"./vue-i18n-B92nPylK.js";import{_ as ot}from"./validator-DC79P2ge.js";import{a as to}from"./axios-DeS043Oz.js";const{defineComponent:no}=await x("vue"),{unref:Z,renderSlot:Ae,createCommentVNode:lt,normalizeStyle:at,createElementVNode:oo,resolveComponent:ql,isRef:lo,withCtx:Le,openBlock:ao,createBlock:so}=await x("vue"),{computed:st,ref:io,watch:it,nextTick:co,useSlots:uo}=await x("vue"),ro=no({__name:"NFullscreenModal",props:{modelValue:{type:Boolean},maskClosable:{type:Boolean,default:!1},closeOnEsc:{type:Boolean,default:!0},segmented:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},bordered:{type:Boolean,default:!1},title:{default:""},onClose:{type:Function,default:void 0}},emits:["update:modelValue","onSizeChange"],setup(L,{emit:h}){const s=L,m=h,{width:n,height:F}=_n(),I=st({get(){return s.modelValue},set(M){m("update:modelValue",M)}}),f=io(0),B=()=>{const M=document.querySelector(".fullscreen-modal-header");if(!M)return;const D=window.getComputedStyle(M);f.value=parseFloat(D.height),m("onSizeChange",{windowWidth:n.value,windowHeight:F.value,headerHeight:f.value,contentHeight:F.value-f.value})};it(()=>s.modelValue,M=>{M&&co(()=>B())}),it(()=>[n.value,F.value],()=>B());const y=uo(),C=st(()=>!!y.header||!!y["header-extra"]),{pickByTheme:E}=ht();return(M,D)=>{const V=bt;return ao(),so(V,{show:Z(I),"onUpdate:show":D[0]||(D[0]=G=>lo(I)?I.value=G:null),preset:"card",closable:s.closable,segmented:s.segmented,bordered:s.bordered,"mask-closable":s.maskClosable,"close-on-esc":s.closeOnEsc,title:s.title,style:at(`width: ${Z(n)}px; min-height: ${Z(F)}px`),"header-style":`background-color: ${Z(E)("white","rgba(24, 24, 28, 1)")}`,"header-class":`fullscreen-modal-header ${Z(C)?"fixed top-0 w-full z-50":""} `,"content-class":"!p-0 fullscreen-modal-content",onClose:L.onClose},{header:Le(()=>[Z(y).header?Ae(M.$slots,"header",{key:0}):lt("",!0)]),"header-extra":Le(()=>[Z(y)["header-extra"]?Ae(M.$slots,"header-extra",{key:0}):lt("",!0)]),default:Le(()=>[oo("section",{style:at(`margin-top: ${Z(C)?Z(f):"0"}px`)},[Ae(M.$slots,"default")],4)]),_:3},8,["show","closable","segmented","bordered","mask-closable","close-on-esc","title","style","header-style","header-class","onClose"])}}}),{defineComponent:po}=await x("vue"),{unref:_o,renderSlot:mo,Teleport:fo,openBlock:vo,createBlock:yo,createCommentVNode:ho}=await x("vue"),{ref:go,onMounted:ko,onUnmounted:bo}=await x("vue"),St=po({__name:"MountedTeleport",props:{to:{}},setup(L){const h=L,s=go(!1);return ko(()=>{s.value=!0}),bo(()=>{s.value=!1}),(m,n)=>_o(s)?(vo(),yo(fo,{key:0,to:h.to},[mo(m.$slots,"default")],8,["to"])):ho("",!0)}}),ze=Symbol(),{unref:ct}=await x("vue"),{defineComponent:wo}=await x("vue"),{unref:e,toDisplayString:d,createElementVNode:u,resolveComponent:Gl,createVNode:l,withCtx:a,createTextVNode:le,openBlock:c,createElementBlock:_,createCommentVNode:z,isRef:ee,createBlock:N,renderList:Oe,Fragment:pe}=await x("vue"),Co={class:"px-10"},$o={key:0,class:"flex items-center gap-3"},xo={key:1,class:"flex items-center gap-3"},Mo={class:"flex justify-between items-center"},So={class:"flex items-center gap-3"},Io={key:0},Uo={key:0},Fo={key:1},Bo={key:2},Vo={key:3},zo={key:4},To={key:0},No={class:"flex items-center justify-center h-[200px] relative"},Eo=["onClick"],Do={class:"absolute top-0 left-0 w-full h-full bg-black opacity-35 flex items-center justify-center"},Ao={class:"text-center text-dimgray text-sm"},Lo={class:"flex items-center gap-2"},Oo={class:"flex items-center gap-2"},Ro={key:1,class:"flex items-center justify-center"},jo={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},Po=["src"],Ho={id:"video",autoplay:"",controls:"",style:{width:"100%"}},Yo=["src"],qo={class:"w-[30%]"},Go={key:0},Wo={key:1},Qo={key:2},Ko={key:3},Jo={key:4},Xo={key:0},Zo={key:1},el={key:2},tl={key:3},nl={key:4},ol={key:5},ll={key:6},{inject:al,ref:$,computed:Se,h:sl,watch:ut,onMounted:il}=await x("vue"),cl=wo({__name:"MediaLibrary",emits:["validate"],setup(L,{emit:h}){const s=al(ze),m=h,{t:n,locale:F}=Ve(),{getVideoThumbnail:I}=ht(),f=We(),B=kn(),{mediaFileTypes:y}=Pn(),C=$(Me()),E=$(""),M=$(null),D=eo(E,500),V=$([]),G=$(!1),T=$({}),U=$([]),K=Se(()=>y.filter(o=>o.value==p.DOCUMENT&&s?.displayDocuments||o.value==p.IMAGE&&s?.displayImages||o.value==p.VIDEO&&s?.displayVideos||o.value==p.AUDIO&&s?.displayAudios||o.value==p.OTHER&&s?.displayOtherTypes)),r=$([]),b=$(y.length===K.value.length?0:K.value[0].value),J=o=>sl("span",{},{default:()=>nt(o.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:F.value})}),O=$(0),X=$(60),W=$(1),me=Se(()=>({pageSize:X.value,query:D.value,page:W.value,type:b.value,months:r.value})),oe=o=>{W.value=o,R()},se=o=>{X.value=o,R()},{data:fe,refetch:R,isPending:de}=Hn(me);ut(()=>fe.value,o=>{V.value=o?.mediaFiles||[],O.value=o?.meta?.total||0,W.value=o?.meta?.currentPage||1;let i=!0;V.value.length===0&&(i=!1);for(const v of V.value)if(v.id&&!T.value[v.id]){i=!1;break}G.value=i,C.value=Me()},{deep:!0,immediate:!0});const{data:j}=Yn(),{data:re}=qn(),{data:It}=he(p.IMAGE),{data:Ut}=he(p.VIDEO),{data:Ft}=he(p.AUDIO),{data:Bt}=he(p.DOCUMENT),{data:Vt}=he(p.OTHER),{mutateAsync:zt}=Gn(),ke=Se(()=>(j.value||[]).map(o=>({label:o,value:o})));il(async()=>{if(s?.preselectedMediaList&&Array.isArray(s?.preselectedMediaList)){U.value=await zt({ids:s?.preselectedMediaList}),T.value={};for(const o of U.value)o.id&&(T.value[o.id]=!0)}});const{mutate:Tt}=Wn(),Nt=async o=>{B.warning({title:n("confirm"),content:n("confirmDeleteMediaFile"),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:()=>{Tt(o)}})},{copy:Et,copied:Dt,isSupported:At}=mn(),Lt=async o=>{o.url&&Et(o.url)};ut(()=>Dt.value,o=>{o&&f.success(n("mediaLinkCopied"))});const ve=$(null),be=$(!1),we=$(!1),Xe=async o=>{switch(ve.value=o,o.type){case p.IMAGE:break;case p.VIDEO:we.value=!0;break;case p.AUDIO:be.value=!0;break;case p.DOCUMENT:window.open(o.url);break;default:f.info(n("cannotOpenThisFile"));break}},g=$(null),Ce=$(!1),Ot=async o=>{g.value=o,Ce.value=!0},Te=$(null),ie=$(null),ce=$(!1),{mutate:Rt}=fn(),{mutate:jt}=Qn(),{mutate:Pt}=Kn(),Ht=async o=>{ie.value=o,Rt(o.path,{onSuccess(i,v,k){Te.value=i,ce.value=!0}})},Yt=async(o,i)=>{var v=yn(i);v=await kt(v,{maxSizeMB:1});const k=new FormData;k.append("file",v),B.warning({title:n("registration"),content:n("confirmReplaceCurrentFile"),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:async()=>{ie.value&&k.append("filename",ie.value?.name),jt({id:ie.value?.id,data:k},{onSuccess(A,ye,Ne){ce.value=!1}})},onNegativeClick:async()=>{ie.value&&k.append("filename",hn(6)+"-"+ie.value?.name),Pt(k,{onSuccess(A,ye,Ne){ce.value=!1}})}})},$e=Se(()=>{let o=0;for(const i in T.value)T.value[i]&&o++;return o}),qt=o=>{const i=!s?.selectionMultiple,v=s?.selectionMultiple&&!s?.selectionLimit,k=s?.selectionMultiple&&s?.selectionLimit&&U.value.length<s?.selectionLimit,A=s?.selectionMultiple&&s?.selectionLimit&&o.id&&T.value[o.id];return i||v||A||k},Gt=()=>{let o=U.value;s?.selectionType=="url"?o=U.value.map(i=>i.url):s?.selectionType=="path"&&(o=U.value.map(i=>i.path)),m("validate",s?.selectionMultiple?o:o[0])},Ze=()=>{T.value={},U.value=[],R()},{mutate:Wt}=Jn(),Qt=async()=>($e.value?B.warning({title:n("confirm"),content:n("deleteSelectionWarningMessage",[$e.value]),positiveText:n("yes"),negativeText:n("no"),onPositiveClick:async()=>{Wt({selectedItems:T.value},{onSuccess:()=>{Ze()}})}}):f.warning(n("noItemSelected")),!1);return(o,i)=>{const v=Je,k=Ke,A=Qe,ye=wn,Ne=bn,Kt=Ct,Jt=wt,Xt=St,et=$n,Zt=Cn,Ee=$t,en=Un,tn=Xn,nn=In,on=xt,ln=vn,an=Sn,sn=Mn,cn=xn,un=Fn,dn=Mt,rn=Bn,xe=bt,tt=Vn,pn=Zn;return c(),_(pe,null,[u("section",Co,[l(Xt,{to:"#actions"},{default:a(()=>[e($e)>0?(c(),_("section",$o,[u("span",null,d(e(n)("nbItemsSelected",[e($e)])),1),l(A,{type:"success",size:"small",secondary:"",onClick:Gt},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:checkmark"})]),_:1})]),default:a(()=>[le(" "+d(e(n)("validateSelection")),1)]),_:1}),l(A,{type:"error",size:"small",secondary:"",onClick:Qt},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:trash-can"})]),_:1})]),default:a(()=>[le(" "+d(e(n)("deleteSelection")),1)]),_:1}),l(A,{type:"warning",size:"small",secondary:"",onClick:Ze},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:close"})]),_:1})]),default:a(()=>[le(" "+d(e(n)("cancelSelection")),1)]),_:1})])):(c(),_("section",xo,[l(Ne,{value:e(r),"onUpdate:value":[i[1]||(i[1]=t=>ee(r)?r.value=t:null),i[2]||(i[2]=t=>e(R)())],"render-label":J,options:e(ke),placeholder:e(n)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:a(()=>[l(ye,{size:"large",class:"w-full","default-checked":e(ke).length&&e(r).length===e(ke).length,"onUpdate:checked":i[0]||(i[0]=t=>{t?r.value=e(ke).map(q=>q.value):r.value=[],e(R)()})},{default:a(()=>[le(d(e(n)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),l(Jt,{class:"!w-[250px]"},{default:a(()=>[l(Kt,{ref_key:"searchInputRef",ref:M,value:e(E),"onUpdate:value":[i[3]||(i[3]=t=>ee(E)?E.value=t:null),i[4]||(i[4]=t=>{t||e(R)()})],clearable:!0,placeholder:e(n)("search")},null,8,["value","placeholder"]),l(A,{type:"primary",secondary:"",onClick:i[5]||(i[5]=t=>e(R)())},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})]))]),_:1}),l(Ee,{size:"small",class:"mb-5"},{default:a(()=>[u("div",Mo,[u("div",So,[e(s)?.selectionMultiple&&!e(s)?.selectionLimit?(c(),N(ye,{key:0,checked:e(G),"onUpdate:checked":[i[6]||(i[6]=t=>ee(G)?G.value=t:null),i[7]||(i[7]=t=>{for(const q of e(V))q.id&&(e(T)[q.id]=t,e(U).findIndex(P=>P.id==q.id)===-1&&e(U).push(q));C.value=("uuidv4"in o?o.uuidv4:ct(Me))()})]},{default:a(()=>[le(d(e(n)("selectAll")),1)]),_:1},8,["checked"])):z("",!0)]),l(Zt,{value:e(b),"onUpdate:value":[i[8]||(i[8]=t=>ee(b)?b.value=t:null),i[9]||(i[9]=t=>e(R)())],name:"filtertyperadiobuttongroup",size:"medium"},{default:a(()=>[e(y).length===e(K).length?(c(),N(et,{key:0,value:0},{default:a(()=>[le(d(e(n)("all"))+"  ",1),e(re)?(c(),_("span",Io," ("+d(e(re))+") ",1)):z("",!0)]),_:1})):z("",!0),(c(!0),_(pe,null,Oe(e(K),t=>(c(),N(et,{key:t.value,value:t.value},{default:a(()=>[le(d(t.label)+"  ",1),t.value==e(p).IMAGE?(c(),_("span",Uo," ("+d(e(It))+") ",1)):t.value==e(p).VIDEO?(c(),_("span",Fo," ("+d(e(Ut))+") ",1)):t.value==e(p).AUDIO?(c(),_("span",Bo," ("+d(e(Ft))+") ",1)):t.value==e(p).DOCUMENT?(c(),_("span",Vo," ("+d(e(Bt))+") ",1)):(c(),_("span",zo,"("+d(e(Vt))+")",1))]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),_:1}),l(Ee,{embedded:"",class:"py-2"},{default:a(()=>[e(V).length&&!e(de)?(c(),_("section",To,[l(cn,{"show-toolbar-tooltip":""},{default:a(()=>[l(sn,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:4 900:4 1400:6"},{default:a(()=>[(c(!0),_(pe,null,Oe(e(V),(t,q)=>(c(),N(an,{key:q},{default:a(()=>[l(ln,{name:"slide-fade",appear:""},{default:a(()=>[l(Ee,{bordered:"",hoverable:""},{cover:a(()=>[u("div",No,[t.type==e(p).IMAGE?(c(),_(pe,{key:0},[t.url?(c(),N(en,{key:0,src:t.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):z("",!0)],64)):t.type==e(p).VIDEO?(c(),_("div",{key:1,class:"flex items-center justify-center w-full h-full relative cursor-pointer",onClick:P=>Xe(t)},[l(tn,{load:()=>e(I)(t.url??""),class:"w-full h-[200px] object-cover"},{fallback:a(()=>[l(k,{size:"96"},{default:a(()=>[l(v,{icon:"carbon:document-video"})]),_:1})]),_:1},8,["load"]),u("div",Do,[l(k,{size:72},{default:a(()=>[l(v,{icon:"carbon:play-outline-filled",class:"text-white"})]),_:1})])],8,Eo)):t.type==e(p).AUDIO?(c(),N(k,{key:2,size:"96"},{default:a(()=>[l(v,{icon:"carbon:document-audio"})]),_:1})):t.type==e(p).DOCUMENT?(c(),N(k,{key:3,size:"96"},{default:a(()=>[l(v,{icon:"carbon:document"})]),_:1})):(c(),N(k,{key:4,size:"96"},{default:a(()=>[l(v,{icon:"carbon:document-unknown"})]),_:1}))])]),header:a(()=>[u("div",Ao,[l(nn,{"line-clamp":1},{default:a(()=>[t.id?(c(),_(pe,{key:0},[qt(t)?(c(),N(ye,{key:e(C),checked:e(T)[t.id],"onUpdate:checked":[P=>e(T)[t.id]=P,P=>{e(s)?.selectionMultiple?P?e(U).findIndex(De=>De.id==t.id)===-1&&e(U).push(t):U.value=e(U).filter(De=>De.id!=t.id):t&&t.id&&(U.value=[t],T.value={[t.id]:P}),C.value=("uuidv4"in o?o.uuidv4:ct(Me))()}],class:"mr-1"},null,8,["checked","onUpdate:checked"])):z("",!0)],64)):z("",!0),le(" "+d(t.name),1)]),_:2},1024)])]),action:a(()=>[l(on,{justify:"space-between",align:"center"},{default:a(()=>[u("div",Lo,[t.type!=e(p).IMAGE?(c(),N(A,{key:0,size:"small",type:"primary",secondary:"",title:e(n)("preview"),onClick:P=>Xe(t)},{icon:a(()=>[l(k,null,{default:a(()=>[[e(p).AUDIO,e(p).VIDEO].includes(t.type)?(c(),N(v,{key:0,icon:"carbon:play"})):(c(),N(v,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):z("",!0),l(A,{size:"small",type:"primary",secondary:"",title:e(n)("details"),onClick:P=>Ot(t)},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:information-filled"})]),_:1})]),_:1},8,["title","onClick"])]),u("div",Oo,[e(At)?(c(),N(A,{key:0,size:"small",type:"primary",secondary:"",title:e(n)("copy"),onClick:P=>Lt(t)},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:copy"})]),_:1})]),_:1},8,["title","onClick"])):z("",!0),t.type==e(p).IMAGE?(c(),N(A,{key:1,size:"small",type:"primary",secondary:"",title:e(n)("edit"),onClick:P=>Ht(t)},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:edit"})]),_:1})]),_:1},8,["title","onClick"])):z("",!0),l(A,{size:"small",type:"error",secondary:"",title:e(n)("delete"),onClick:P=>Nt(t)},{icon:a(()=>[l(k,null,{default:a(()=>[l(v,{icon:"carbon:trash-can"})]),_:1})]),_:1},8,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(un,{page:e(W),"onUpdate:page":[i[10]||(i[10]=t=>ee(W)?W.value=t:null),oe],class:"mt-10 justify-center","show-size-picker":"","page-size":e(X),"page-sizes":[12,24,36,48,60,72,84,96],"page-count":Math.ceil(e(O)/e(X)),"onUpdate:pageSize":se},null,8,["page","page-size","page-count"])])):e(de)?(c(),_("section",Ro,[l(dn,{size:"medium"})])):(c(),N(rn,{key:2,description:e(n)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),l(xe,{show:e(be),"onUpdate:show":i[11]||(i[11]=t=>ee(be)?be.value=t:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ve)?.name},{default:a(()=>[u("audio",jo,[u("source",{src:e(ve)?.url},null,8,Po)])]),_:1},8,["show","title"]),l(xe,{show:e(we),"onUpdate:show":i[12]||(i[12]=t=>ee(we)?we.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ve)?.name},{default:a(()=>[u("video",Ho,[u("source",{src:e(ve)?.url},null,8,Yo)])]),_:1},8,["show","title"]),l(xe,{show:e(Ce),"onUpdate:show":i[13]||(i[13]=t=>ee(Ce)?Ce.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(g)?.name},{default:a(()=>[e(g)?(c(),N(tt,{key:0,striped:"","single-line":!1,size:"small"},{default:a(()=>[u("tbody",null,[u("tr",null,[u("td",qo,d(e(n)("name")),1),u("td",null,d(e(g).name),1)]),u("tr",null,[u("td",null,d(e(n)("link")),1),u("td",null,[u("small",null,d(e(g).url),1)])]),u("tr",null,[u("td",null,d(e(n)("type")),1),u("td",null,[e(g).type==e(p).IMAGE?(c(),_("span",Go,d(e(n)("image")),1)):e(g).type==e(p).VIDEO?(c(),_("span",Wo,d(e(n)("video")),1)):e(g).type==e(p).AUDIO?(c(),_("span",Qo,d(e(n)("audio")),1)):e(g).type==e(p).DOCUMENT?(c(),_("span",Ko,d(e(n)("document")),1)):(c(),_("span",Jo,d(e(n)("other")),1))])]),e(g).size?(c(),_("tr",Xo,[u("td",null,d(e(n)("size")),1),u("td",null,d(e(gt)(e(g).size,!0)),1)])):z("",!0),e(g).mimeType?(c(),_("tr",Zo,[u("td",null,d(e(n)("mimeType")),1),u("td",null,d(e(g).mimeType),1)])):z("",!0),e(g).sender?(c(),_("tr",el,[u("td",null,d(e(n)("sendBy")),1),u("td",null,d(e(g).sender.fullname),1)])):z("",!0),e(g).title?(c(),_("tr",tl,[u("td",null,d(e(n)("title")),1),u("td",null,d(e(g).title),1)])):z("",!0),e(g).description?(c(),_("tr",nl,[u("td",null,d(e(n)("description")),1),u("td",null,[u("small",null,d(e(g).description),1)])])):z("",!0),e(g).createdAt?(c(),_("tr",ol,[u("td",null,d(e(n)("date")),1),u("td",null,d(e(nt)(e(g).createdAt)),1)])):z("",!0),e(g).additionalMetadata?(c(),_("tr",ll,[u("td",null,d(e(n)("metadata")),1),u("td",null,[l(tt,{striped:"","single-line":"",size:"small"},{default:a(()=>[u("tbody",null,[(c(!0),_(pe,null,Oe(e(g).additionalMetadata||[],(t,q)=>(c(),_("tr",{key:q},[u("td",null,d(q),1),u("td",null,d(t),1)]))),128))])]),_:1})])])):z("",!0)])]),_:1})):z("",!0)]),_:1},8,["show","title"]),l(xe,{show:e(ce),"onUpdate:show":i[15]||(i[15]=t=>ee(ce)?ce.value=t:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(ie)?.name},{default:a(()=>[l(pn,{"cropper-ratio":void 0,"round-preview":!1,src:e(Te)?e(Te):void 0,onCancel:i[14]||(i[14]=t=>ce.value=!1),onSave:Yt},null,8,["src"])]),_:1},8,["show","title"])],64)}}}),{unref:dt}=await x("vue"),{defineComponent:ul}=await x("vue"),{unref:S,resolveComponent:Wl,isRef:rt,createVNode:Q,withCtx:te,toDisplayString:Re,createTextVNode:je,openBlock:ge,createElementBlock:Pe,createCommentVNode:pt,createBlock:_t}=await x("vue"),dl={class:"px-10"},rl={key:0},pl={key:0,class:"text-end"},{inject:_l,ref:mt}=await x("vue"),ml=ul({__name:"AddFromAnUrl",emits:["validate"],setup(L,{emit:h}){const{t:s}=Ve(),m=We(),n=_l(ze),F=h,I=mt(""),f=mt([]);return(B,y)=>{const C=zn,E=Tn,M=Je,D=Ke,V=Qe,G=Nn,T=Ct,U=wt,K=$t;return ge(),Pe("section",dl,[Q(K,null,{default:te(()=>[S(n)?.selectionMultiple?(ge(),Pe("section",rl,[Q(C,{value:S(f),"onUpdate:value":y[0]||(y[0]=r=>rt(f)?f.value=r:null),placeholder:S(s)("fileUrl"),min:1,max:S(n).selectionLimit||void 0},null,8,["value","placeholder","max"]),S(f).length>0?(ge(),Pe("div",pl,[Q(E),Q(V,{type:"primary",secondary:"",disabled:S(f).length!=S(f).filter(r=>r.trim()).length,onClick:y[1]||(y[1]=()=>{const r=S(f).map(b=>encodeURI(b));r.findIndex(b=>!("_v"in B?B._v:dt(ot)).isURL(b))>-1?S(m).error(S(s)("invalidUrl")):F("validate",r),F("validate",S(f))})},{icon:te(()=>[Q(D,null,{default:te(()=>[Q(M,{icon:"carbon:checkmark"})]),_:1})]),default:te(()=>[je(" "+Re(S(s)("validate")),1)]),_:1},8,["disabled"])])):pt("",!0)])):(ge(),_t(U,{key:1},{default:te(()=>[Q(G,null,{default:te(()=>[je(Re(S(s)("fileUrl")),1)]),_:1}),Q(T,{value:S(I),"onUpdate:value":y[2]||(y[2]=r=>rt(I)?I.value=r:null)},null,8,["value"]),S(I)?(ge(),_t(V,{key:0,type:"primary",secondary:"",onClick:y[3]||(y[3]=()=>{const r=encodeURI(S(I));("_v"in B?B._v:dt(ot)).isURL(r)?F("validate",r):S(m).error(S(s)("invalidUrl"))})},{icon:te(()=>[Q(D,null,{default:te(()=>[Q(M,{icon:"carbon:checkmark"})]),_:1})]),default:te(()=>[je(" "+Re(S(s)("validate")),1)]),_:1})):pt("",!0)]),_:1}))]),_:1})])}}}),{defineComponent:fl}=await x("vue"),{unref:w,resolveComponent:Ql,createVNode:H,withCtx:Y,toDisplayString:ne,createTextVNode:He,openBlock:ae,createBlock:vl,createCommentVNode:yl,createElementVNode:Ie,createElementBlock:ue}=await x("vue"),hl={class:"px-10"},gl={class:"flex justify-between items-center"},kl={style:{"margin-bottom":"12px"}},bl={key:0,class:"text-xs"},wl={key:1,class:"text-xs"},Cl={key:2,class:"text-xs"},$l={key:3,class:"text-xs"},xl={key:4,class:"text-xs"},Ml={key:5,class:"text-xs"},{inject:ft,ref:Ye,onMounted:Sl,onUnmounted:Il}=await x("vue"),Ul=fl({__name:"UploadFiles",setup(L){const h=ft(ze),s=ft("appConfig"),{t:m}=Ve(),n=We(),F=En(),I=Ye(),f=Ye([]),B=Ye(!1),y=gn(),C=s?.apiRequestHeaders;C&&(C.Authorization=`Bearer ${y.accessToken}`);const E=async()=>{I.value.submit()},M=()=>{I.value?.clear(),f.value=[]},D=r=>{const b=r.file.file;if(h?.uploadConfig?.maxSize&&b&&b.size){const O=b.size/1024/1024<=h?.uploadConfig?.maxSize;return O||n.error(m("fileSizeNotAllowed")),O}const J=b?.name.split(".").pop();return J&&h?.uploadConfig?.excludedExtensions.map(O=>O.toLowerCase()).includes(J.toLowerCase())?(n.error(m("fileTypeNotAllowed")),!1):!0},V=r=>{f.value=r.fileList},G=({file:r})=>r,T=()=>{if(h?.uploadConfig?.limit)return h?.uploadConfig.limit},U=async({file:r,data:b,headers:J,action:O,onFinish:X,onError:W,onProgress:me})=>{const oe=new FormData;b&&Object.keys(b).forEach(j=>{oe.append(j,b[j])});const se=r.file,fe=se?.name.split(".").pop(),R=se?.name.replace("."+fe,""),de=await kt(se,{maxSizeMB:1});oe.append("file",de,R),oe.append("folder",h?.uploadConfig?.folder),B.value=!0,F.start(),to.post(O,oe,{headers:J,onUploadProgress:j=>{if(j.total!==void 0){const re=Math.round(j.loaded*100/j.total);me({percent:re})}}}).then(async()=>{X();const j=f.value.findIndex(re=>re.id===r.id);j!==-1&&f.value.splice(j,1),n.success(m("success")),F.finish(),B.value=!1}).catch(j=>{n.error(m("anErrorOccurred")),W(),F.finish(),B.value=!1})},K=console.warn;return Sl(()=>{console.warn=r=>{typeof r=="string"&&r.includes('Non-function value encountered for slot "default"')||K(r)}}),Il(()=>{console.warn=K}),(r,b)=>{const J=Je,O=Ke,X=Qe,W=xt,me=St,oe=Ln,se=On,fe=An,R=Dn,de=Mt;return ae(),ue("section",hl,[H(me,{to:"#actions"},{default:Y(()=>[Ie("div",gl,[w(f).length?(ae(),vl(W,{key:0,align:"center"},{default:Y(()=>[H(X,{secondary:"",disabled:w(f).length==0,onClick:M},{icon:Y(()=>[H(O,null,{default:Y(()=>[H(J,{icon:"carbon:close"})]),_:1})]),default:Y(()=>[He(" "+ne(w(m)("clearList")),1)]),_:1},8,["disabled"]),H(X,{type:"primary",secondary:"",disabled:w(f).length==0,onClick:E},{default:Y(()=>[He(ne(w(m)("launchImport")),1)]),_:1},8,["disabled"])]),_:1})):yl("",!0)])]),_:1}),H(de,{show:!1},{default:Y(()=>[H(R,{ref_key:"upload",ref:I,multiple:"","directory-dnd":"","list-type":"image",max:T(),"default-upload":!1,headers:w(C),"custom-request":U,action:w(h)?.uploadConfig?.baseUrl||w(s)?.apiUrl+"/media-files/upload",onBeforeUpload:D,onChange:V,onFinish:G},{default:Y(()=>[H(fe,{class:"h-[250px] flex flex-col items-center justify-center"},{default:Y(()=>[Ie("div",kl,[H(O,{size:"48",depth:3},{default:Y(()=>[H(J,{icon:"mdi:file-upload"})]),_:1})]),H(oe,{style:{"font-size":"16px"}},{default:Y(()=>[He(ne(w(m)("uploadAreaTitle")),1)]),_:1}),H(se,{depth:"3",class:"mt-4"},{default:Y(()=>[w(h)?.uploadConfig?.limit?(ae(),ue("span",bl,ne(w(m)("limitToTheNumberOfFilesToSend",[w(h)?.uploadConfig.limit])),1)):(ae(),ue("span",wl,ne(w(m)("noLimitToTheNumberOfFilesToSend")),1)),b[0]||(b[0]=Ie("br",null,null,-1)),w(h)?.uploadConfig?.maxSize?(ae(),ue("span",Cl,ne(w(m)("limitToTheSizeOfFilesToSend",[w(gt)(w(h)?.uploadConfig.maxSize)])),1)):(ae(),ue("span",$l,ne(w(m)("noLimitToTheSizeOfFilesToSend")),1)),b[1]||(b[1]=Ie("br",null,null,-1)),w(h)?.uploadConfig?.excludedExtensions.length?(ae(),ue("span",xl,ne(w(m)("extensionsAreNotAllowed",[w(h)?.uploadConfig.excludedExtensions.join(", ")])),1)):(ae(),ue("span",Ml,ne(w(m)("allFileExtensionsAreAllowed")),1))]),_:1})]),_:1})]),_:1},8,["max","headers","action"])]),_:1})])}}}),{useModel:vt,mergeModels:yt,defineComponent:Fl}=await x("vue"),{unref:qe,createVNode:Ue,resolveComponent:Kl,withCtx:_e,openBlock:Fe,createBlock:Be,createCommentVNode:Ge,createElementVNode:Bl}=await x("vue"),{defineComponent:Vl,provide:zl}=await x("vue"),Tl=Vl({name:"MediaPicker"}),Jl=Fl({...Tl,props:yt({enableUploadFiles:{type:Boolean,default:!0},enableMediaLibrary:{type:Boolean,default:!0},enableAddFromAnUrl:{type:Boolean,default:!0},displayImages:{type:Boolean,default:!0},displayVideos:{type:Boolean,default:!0},displayAudios:{type:Boolean,default:!0},displayDocuments:{type:Boolean,default:!0},displayOtherTypes:{type:Boolean,default:!0},preselectedMediaList:{default:null},selectionType:{default:"path"},selectionMultiple:{type:Boolean,default:!1},selectionLimit:{default:0},title:{default:""},uploadConfig:{default:()=>({folder:"uploads",limit:0,maxSize:0,baseUrl:null,excludedExtensions:[]})}},{show:{type:Boolean,required:!0,default:!1},showModifiers:{},tab:{default:"media-library"},tabModifiers:{}}),emits:yt(["submit"],["update:show","update:tab"]),setup(L,{emit:h}){const{t:s}=Ve(),m=L;zl(ze,m);const n=vt(L,"show"),F=vt(L,"tab"),I=h,f=y=>{I("submit",y),n.value=!1},B=y=>{I("submit",y),n.value=!1};return(y,C)=>{const E=jn,M=Rn,D=ro;return Fe(),Be(D,{modelValue:n.value,"onUpdate:modelValue":C[1]||(C[1]=V=>n.value=V),title:L.title,class:"w-full"},{default:_e(()=>[Ue(M,{value:F.value,"onUpdate:value":C[0]||(C[0]=V=>F.value=V),type:"card",size:"large",animated:""},{suffix:_e(()=>[...C[2]||(C[2]=[Bl("div",{id:"actions",class:"pr-10"},null,-1)])]),default:_e(()=>[m.enableUploadFiles?(Fe(),Be(E,{key:0,name:"upload-files",tab:qe(s)("uploadFiles")},{default:_e(()=>[Ue(Ul)]),_:1},8,["tab"])):Ge("",!0),m.enableMediaLibrary?(Fe(),Be(E,{key:1,name:"media-library",tab:qe(s)("mediaLibrary")},{default:_e(()=>[Ue(cl,{onValidate:f})]),_:1},8,["tab"])):Ge("",!0),m.enableAddFromAnUrl?(Fe(),Be(E,{key:2,name:"add-from-an-url",tab:qe(s)("addFromAnUrl")},{default:_e(()=>[Ue(ml,{onValidate:B})]),_:1},8,["tab"])):Ge("",!0)]),_:1},8,["value"])]),_:1},8,["modelValue","title"])}}});export{St as _,Jl as a,ro as b};
