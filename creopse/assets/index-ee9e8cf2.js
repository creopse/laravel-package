import{_ as X}from"./AuthLayout-faba6246.js";import{I as Z}from"./iconify_vue-46af0b81.js";import{u as ee,a as ae,b as se,c as te,d as oe,R as E,e as re}from"./index-916f1e45.js";import{e as le}from"./check-password-strength-48654609.js";import{p as ne}from"./password-strength-options-220cc0dc.js";import{R as H}from"./response-error-code-87d1097e.js";import{u as ie}from"./vue-router-c3388b6d.js";import{_ as ue}from"./validator-c0254ba9.js";import{b as pe,B as me,C as de,D as ce,E as fe,F as _e,G as we,H as ve,I as ge,J as be,N as he,_ as ke,K as Re,L as ye}from"./naive-ui-ab0dda7d.js";import{d as L,b as Ce,o as h,P as S,aO as o,a as k,Y as s,l as C,c as A,Q as qe}from"./vue_runtime-core-273b5003.js";import{u as xe}from"./vue-i18n-0da1582b.js";import{r as w,u as e}from"./vue_reactivity-852d8377.js";import{t as q}from"./vue_shared-7dcc3b7f.js";import"./vue_runtime-dom-5ad5ecb0.js";import"./unhead_vue-0787c3d6.js";import"./unhead-a4367481.js";import"./hookable-e7fd869b.js";import"./unhead_dom-b5f3dd9b.js";import"./unhead_shared-56c99682.js";import"./fawmi_vue-google-maps-439c501d.js";import"./googlemaps_markerclusterer-b718980f.js";import"./fast-deep-equal-1db9e660.js";import"./axios-96fb5abd.js";import"./process-93c0ea83.js";import"./supercluster-6504d485.js";import"./kdbush-ac640998.js";import"./browser-image-compression-a3ab6596.js";import"./lodash-a9971f22.js";import"./pinia-a2cac08c.js";import"./vue-demi-71ba0ef2.js";import"./moment-ea709ccd.js";import"./slugify-ce681755.js";import"./vueuse_core-d5cd9503.js";import"./vueuse_shared-835eca33.js";import"./parse-domain-01b1033a.js";import"./is-ip-33949ce5.js";import"./ip-regex-e6f9cbd8.js";import"./super-regex-a8a38319.js";import"./function-timeout-8f7724f6.js";import"./clone-regexp-3bc3d90c.js";import"./is-regexp-5fa9e804.js";import"./ckeditor_ckeditor5-vue-df7eee76.js";import"./vue-2044cde0.js";import"./strip-json-comments-680ed425.js";import"./vue-draggable-next-417126f1.js";import"./pinia_colada-2d4f4a8d.js";import"./vue-shepherd-6780f0ef.js";import"./shepherd.js-8a3687f6.js";import"./vue-tel-input-a68ee547.js";import"./vue3-map-chart-668e2d48.js";import"./crypto-js-eb39eca1.js";import"./pinia-persistence-plugin-50ba422c.js";/* empty css                    *//* empty css               *//* empty css                                      */import"./date-fns-eed65714.js";import"./seemly-5e1e6f41.js";import"./vueuc-d047f964.js";import"./evtd-b614532e.js";import"./css-render_vue3-ssr-68d47bbf.js";import"./vooks-6944b357.js";import"./vdirs-b0483831.js";import"./juggle_resize-observer-41516555.js";import"./css-render-9b607bf6.js";import"./emotion_hash-8a8e73f6.js";import"./lodash-es-a215867d.js";import"./treemate-25c27bff.js";import"./date-fns-tz-6c300683.js";import"./async-validator-dc9a4891.js";import"./css-render_plugin-bem-9dde7ffe.js";import"./intlify_shared-f7876323.js";import"./intlify_core-base-c423e336.js";import"./intlify_message-compiler-48af4dac.js";const Ie={class:"container h-full"},Se={class:"flex justify-center items-center flex-wrap h-full g-6 text-gray-800"},Ae={class:"md:w-10/12 lg:w-7/12 xl:w-6/12 2xl:w-5/12 sm:w-full"},Ee={class:"w-full flex justify-center"},Te={class:"px-20"},Ne={key:0},Pe={key:1},Ue={key:2},De={class:"w-full flex justify-end px-20"},Fe=L({name:E.SETUP.NAME}),ts=L({...Fe,setup(Ve){const{t:a}=xe(),{request:x}=re(),{displayFormErrors:O}=ee(),{userHasSuperAdminRole:B}=ae(),{defaultPrefs:M}=se(),T=ie(),v=pe(),N=te(),P=oe(),G=P.getSettingValue("disableInstaller","boolean"),n=w(1),m=w("process"),g=w(!1),U=w(null),r=w({lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""}),j={lastname:[{required:!0,message:a("fillRequired")}],firstname:[{required:!0,message:a("fillRequired")}],email:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(b,t){return t&&!ue.isEmail(t)?new Error(a("invalidEmail")):!0}}],password:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(b,t){return t&&["too-weak"].includes(le.passwordStrength(t,ne).value)?new Error(a("passwordTooWeak")):!0}}],passwordConfirmation:[{required:!0,message:a("fillRequired")},{trigger:["input"],validator(b,t){return t&&t!==r.value.password?new Error(a("nonCompliantPassword")):!0}}]},D=w(null),u=w({dbname:"",host:"",username:"",password:""}),z={dbname:[{required:!0,message:a("fillRequired")}],host:[{required:!0,message:a("fillRequired")}],username:[{required:!0,message:a("fillRequired")}],password:[{required:!1}]},$=()=>{n.value>2&&n.value--},J=()=>{var b,t;n.value==1?(b=D.value)==null||b.validate(async c=>{if(c)v.warning(a("invalidForm"));else{if(g.value=!0,m.value="wait",(await x({url:"/database/create",method:"post",data:u.value})).success){await new Promise(p=>setTimeout(p,3e3));const f=await x({url:"/database/migrate"}),i=await x({url:"/database/seed"});f.success&&i.success?(n.value=2,m.value="process"):(v.error(a("unableToInstallTablesInDb")),m.value="error")}else v.error(a("unableToCreateDbOrEditConfig")),m.value="error";g.value=!1}}):n.value==2?r.value.lastname||r.value.firstname||r.value.email||r.value.password?(t=U.value)==null||t.validate(async c=>{var R,f,i,p,y,_;if(c)v.warning(a("invalidForm"));else{g.value=!0,m.value="wait";const d=await x({url:"/auth/register",method:"post",data:{lastname:r.value.lastname,firstname:r.value.firstname,email:r.value.email,password:r.value.password,passwordConfirmation:r.value.passwordConfirmation,preferences:M.value}});if(d.failure&&d.error){switch((i=(f=(R=d.error)==null?void 0:R.response)==null?void 0:f.data)==null?void 0:i.errorCode){case H.AUTH_MISSING_DATA:v.error(a("missingData"));break;case H.FORM_INVALID_DATA:O((_=(y=(p=d.error)==null?void 0:p.response)==null?void 0:y.data)==null?void 0:_.data);break;default:v.error(a("registrationNotSuccessful"))}m.value="error"}else N.userData=d.result.data.user,B()&&P.initDefaultSettings(),N.userData=null,r.value={lastname:"",firstname:"",email:"",password:"",passwordConfirmation:""},n.value=3,m.value="finish";g.value=!1}}):(n.value=3,m.value="finish"):n.value==3&&T.replace(E.LOGIN.PATH)};return Ce(()=>{G&&T.replace(E.LOGIN.PATH)}),(b,t)=>{const c=me,R=de,f=ce,i=fe,p=_e,y=we,_=ve,d=ge,K=be,I=Z,F=he,V=ke,Q=Re,W=ye,Y=X;return h(),S(Y,{"display-server-alerts":!1},{default:o(()=>[k("div",Ie,[k("div",Se,[k("div",Ae,[s(W,{size:"medium",class:"w-full"},{header:o(()=>[k("div",Ee,[s(R,{current:e(n),status:e(m)},{default:o(()=>[s(c,{title:e(a)("database")},null,8,["title"]),s(c,{title:e(a)("admin")},null,8,["title"]),s(c,{title:e(a)("completion")},null,8,["title"])]),_:1},8,["current","status"])])]),action:o(()=>[k("section",De,[s(Q,null,{default:o(()=>[s(V,{loading:e(g),disabled:e(n)<3,onClick:$},{icon:o(()=>[s(F,null,{default:o(()=>[s(I,{icon:"carbon:arrow-left"})]),_:1})]),default:o(()=>[C(" "+q(e(a)("previous")),1)]),_:1},8,["loading","disabled"]),s(V,{"icon-placement":"right",loading:e(g),onClick:J},{icon:o(()=>[s(F,null,{default:o(()=>[e(n)==3?(h(),S(I,{key:0,icon:"carbon:checkmark-outline"})):(h(),S(I,{key:1,icon:"carbon:arrow-right"}))]),_:1})]),default:o(()=>[C(" "+q(e(n)==3?e(a)("validate"):e(a)("next")),1)]),_:1},8,["loading"])]),_:1})])]),default:o(()=>[k("div",Te,[e(n)==1?(h(),A("section",Ne,[s(f,{class:"text-center"},{default:o(()=>[C(q(e(a)("databaseConnectionInfo")),1)]),_:1}),s(y,{ref_key:"dbFormRef",ref:D,model:e(u),rules:z,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:o(()=>[s(p,{label:e(a)("dbname"),path:"dbname"},{default:o(()=>[s(i,{value:e(u).dbname,"onUpdate:value":t[0]||(t[0]=l=>e(u).dbname=l),placeholder:e(a)("dbname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{label:e(a)("username"),path:"username"},{default:o(()=>[s(i,{value:e(u).username,"onUpdate:value":t[1]||(t[1]=l=>e(u).username=l),placeholder:e(a)("username"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{label:e(a)("password"),path:"password"},{default:o(()=>[s(i,{value:e(u).password,"onUpdate:value":t[2]||(t[2]=l=>e(u).password=l),placeholder:e(a)("password"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{label:e(a)("host"),path:"host"},{default:o(()=>[s(i,{value:e(u).host,"onUpdate:value":t[3]||(t[3]=l=>e(u).host=l),placeholder:e(a)("host"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])):e(n)==2?(h(),A("section",Pe,[s(f,{class:"text-center"},{default:o(()=>[C(q(e(a)("createAdmin")),1)]),_:1}),s(y,{ref_key:"adminFormRef",ref:U,model:e(r),rules:j,"show-label":!1,"show-require-mark":!1,size:"medium"},{default:o(()=>[s(d,{"x-gap":"12",span:24},{default:o(()=>[s(_,{span:12,label:e(a)("lastname"),path:"lastname"},{default:o(()=>[s(i,{value:e(r).lastname,"onUpdate:value":t[4]||(t[4]=l=>e(r).lastname=l),placeholder:e(a)("lastname"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(_,{span:12,label:e(a)("firstname_s"),path:"firstname"},{default:o(()=>[s(i,{value:e(r).firstname,"onUpdate:value":t[5]||(t[5]=l=>e(r).firstname=l),placeholder:e(a)("firstname_s"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),s(p,{label:e(a)("addressEmail"),path:"email"},{default:o(()=>[s(i,{value:e(r).email,"onUpdate:value":t[6]||(t[6]=l=>e(r).email=l),placeholder:e(a)("addressEmail"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(d,{"x-gap":"12",span:24},{default:o(()=>[s(_,{span:12,label:e(a)("password"),path:"password"},{default:o(()=>[s(i,{value:e(r).password,"onUpdate:value":t[7]||(t[7]=l=>e(r).password=l),placeholder:e(a)("password"),"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(_,{span:12,label:e(a)("confirmPassword"),path:"passwordConfirmation"},{default:o(()=>[s(i,{value:e(r).passwordConfirmation,"onUpdate:value":t[8]||(t[8]=l=>e(r).passwordConfirmation=l),placeholder:e(a)("confirmPassword"),disabled:!e(r).password,"show-password-on":"mousedown",type:"password",class:"w-full"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1},8,["model"])])):e(n)==3?(h(),A("section",Ue,[s(K,{title:e(a)("installationCompleted"),type:"success"},{default:o(()=>[C(q(e(a)("confirmToReturnToLoginPage")),1)]),_:1},8,["title"])])):qe("",!0)])]),_:1})])])])]),_:1})}}});export{ts as default};
