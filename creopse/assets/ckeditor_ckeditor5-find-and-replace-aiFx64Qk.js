import{i as F,P as g,C as _}from"./ckeditor_ckeditor5-core-Ck1E_gMX.js";import{S as T,K as C,a as m,T as y,R as v,O as I,u as E,I as A}from"./ckeditor_ckeditor5-utils-CWV6iAXC.js";import"./ckeditor_ckeditor5-engine-Bp3orBjd.js";import{V as p,p as w,f as B,F as P,g as D,s as M,c as b,M as x,b as N,B as $,L as O,h as H,C as S}from"./ckeditor_ckeditor5-ui-0Cf30f_5.js";import"./color-name-B0-kzB5j.js";import"./color-convert-CPcGJsTp.js";import"./vanilla-colorful-CgSCOLsm.js";import{n as W,f as U}from"./lodash-es-DLvU2Xhi.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class L extends p{constructor(s){super(s);const e=s.t;this.set("matchCount",0),this.set("highlightOffset",0),this.set("isDirty",!1),this.set("_areCommandsEnabled",{}),this.set("_resultsCounterText",""),this.set("_matchCase",!1),this.set("_wholeWordsOnly",!1),this.bind("_searchResultsFound").to(this,"matchCount",this,"isDirty",(t,n)=>t>0&&!n),this._findInputView=this._createInputField(e("Find in text…")),this._replaceInputView=this._createInputField(e("Replace with…")),this._findButtonView=this._createButton({label:e("Find"),class:"ck-button-find ck-button-action",withText:!0}),this._findPrevButtonView=this._createButton({label:e("Previous result"),class:"ck-button-prev",icon:w,keystroke:"Shift+F3",tooltip:!0}),this._findNextButtonView=this._createButton({label:e("Next result"),class:"ck-button-next",icon:w,keystroke:"F3",tooltip:!0}),this._optionsDropdown=this._createOptionsDropdown(),this._replaceButtonView=this._createButton({label:e("Replace"),class:"ck-button-replace",withText:!0}),this._replaceAllButtonView=this._createButton({label:e("Replace all"),class:"ck-button-replaceall",withText:!0}),this._findFieldsetView=this._createFindFieldset(),this._replaceFieldsetView=this._createReplaceFieldset(),this._focusTracker=new T,this._keystrokes=new C,this._focusables=new B,this._focusCycler=new P({focusables:this._focusables,focusTracker:this._focusTracker,keystrokeHandler:this._keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-find-and-replace-form"],tabindex:"-1"},children:[new D(s,{label:e("Find and replace")}),this._findFieldsetView,this._replaceFieldsetView]})}render(){super.render(),M({view:this}),this._initFocusCycling(),this._initKeystrokeHandling()}destroy(){super.destroy(),this._focusTracker.destroy(),this._keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}reset(){this._findInputView.errorText=null,this.isDirty=!0}get _textToFind(){return this._findInputView.fieldView.element.value}get _textToReplace(){return this._replaceInputView.fieldView.element.value}_createFindFieldset(){const s=this.locale,e=new p(s);return this._findInputView.fieldView.on("input",()=>{this.isDirty=!0}),this._findButtonView.on("execute",this._onFindButtonExecute.bind(this)),this._findPrevButtonView.delegate("execute").to(this,"findPrevious"),this._findNextButtonView.delegate("execute").to(this,"findNext"),this._findPrevButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",({findPrevious:t})=>t),this._findNextButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",({findNext:t})=>t),this._injectFindResultsCounter(),e.setTemplate({tag:"fieldset",attributes:{class:["ck","ck-find-and-replace-form__find"]},children:[this._findInputView,this._findButtonView,this._findPrevButtonView,this._findNextButtonView]}),e}_onFindButtonExecute(){if(!this._textToFind){const s=this.t;this._findInputView.errorText=s("Text to find must not be empty.");return}this.isDirty=!1,this.fire("findNext",{searchText:this._textToFind,matchCase:this._matchCase,wholeWords:this._wholeWordsOnly})}_injectFindResultsCounter(){const s=this.locale,e=s.t,t=this.bindTemplate,n=new p(this.locale);this.bind("_resultsCounterText").to(this,"highlightOffset",this,"matchCount",(a,r)=>e("%0 of %1",[a,r])),n.setTemplate({tag:"span",attributes:{class:["ck","ck-results-counter",t.if("isDirty","ck-hidden")]},children:[{text:t.to("_resultsCounterText")}]});const i=()=>{const a=this._findInputView.fieldView.element;if(!a||!y(a))return;const r=new v(n.element).width,o=s.uiLanguageDirection==="ltr"?"paddingRight":"paddingLeft";r?a.style[o]=`calc( 2 * var(--ck-spacing-standard) + ${r}px )`:a.style[o]=""};this.on("change:_resultsCounterText",i,{priority:"low"}),this.on("change:isDirty",i,{priority:"low"}),this._findInputView.template.children[0].children.push(n)}_createReplaceFieldset(){const e=this.locale.t,t=new p(this.locale);return this._replaceButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replace:n},i)=>n&&i),this._replaceAllButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replaceAll:n},i)=>n&&i),this._replaceInputView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replace:n},i)=>n&&i),this._replaceInputView.bind("infoText").to(this._replaceInputView,"isEnabled",this._replaceInputView,"isFocused",(n,i)=>n||!i?"":e("Tip: Find some text first in order to replace it.")),this._replaceButtonView.on("execute",()=>{this.fire("replace",{searchText:this._textToFind,replaceText:this._textToReplace})}),this._replaceAllButtonView.on("execute",()=>{this.fire("replaceAll",{searchText:this._textToFind,replaceText:this._textToReplace}),this.focus()}),t.setTemplate({tag:"fieldset",attributes:{class:["ck","ck-find-and-replace-form__replace"]},children:[this._replaceInputView,this._optionsDropdown,this._replaceButtonView,this._replaceAllButtonView]}),t}_createOptionsDropdown(){const e=this.locale.t,t=b(this.locale);t.class="ck-options-dropdown",t.buttonView.set({withText:!1,label:e("Show options"),icon:F.cog,tooltip:!0});const n=new x({withText:!0,label:e("Match case"),_isMatchCaseSwitch:!0}),i=new x({withText:!0,label:e("Whole words only")});return n.bind("isOn").to(this,"_matchCase"),i.bind("isOn").to(this,"_wholeWordsOnly"),t.on("execute",a=>{a.source._isMatchCaseSwitch?this._matchCase=!this._matchCase:this._wholeWordsOnly=!this._wholeWordsOnly,this.isDirty=!0}),N(t,new m([{type:"switchbutton",model:n},{type:"switchbutton",model:i}])),t}_initFocusCycling(){[this._findInputView,this._findButtonView,this._findPrevButtonView,this._findNextButtonView,this._replaceInputView,this._optionsDropdown,this._replaceButtonView,this._replaceAllButtonView].forEach(e=>{this._focusables.add(e),this._focusTracker.add(e.element)})}_initKeystrokeHandling(){const s=t=>t.stopPropagation(),e=t=>{t.stopPropagation(),t.preventDefault()};this._keystrokes.listenTo(this.element),this._keystrokes.set("f3",t=>{e(t),this._findNextButtonView.fire("execute")}),this._keystrokes.set("shift+f3",t=>{e(t),this._findPrevButtonView.fire("execute")}),this._keystrokes.set("enter",t=>{const n=t.target;n===this._findInputView.fieldView.element?(this._areCommandsEnabled.findNext?this._findNextButtonView.fire("execute"):this._findButtonView.fire("execute"),e(t)):n===this._replaceInputView.fieldView.element&&!this.isDirty&&(this._replaceButtonView.fire("execute"),e(t))}),this._keystrokes.set("shift+enter",t=>{t.target===this._findInputView.fieldView.element&&(this._areCommandsEnabled.findPrevious?this._findPrevButtonView.fire("execute"):this._findButtonView.fire("execute"),e(t))}),this._keystrokes.set("arrowright",s),this._keystrokes.set("arrowleft",s),this._keystrokes.set("arrowup",s),this._keystrokes.set("arrowdown",s)}_createButton(s){const e=new $(this.locale);return e.set(s),e}_createInputField(s){const e=new O(this.locale,H);return e.label=s,e}}const z='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 13.786 1.532-1.286 3.857 4.596a1 1 0 1 1-1.532 1.286l-3.857-4.596z"/><path d="M16.004 8.5a6.5 6.5 0 0 1-9.216 5.905c-1.154-.53-.863-1.415-.663-1.615.194-.194.564-.592 1.635-.141a4.5 4.5 0 0 0 5.89-5.904l-.104-.227 1.332-1.331c.045-.046.196-.041.224.007a6.47 6.47 0 0 1 .902 3.306zm-3.4-5.715c.562.305.742 1.106.354 1.494-.388.388-.995.414-1.476.178a4.5 4.5 0 0 0-6.086 5.882l.114.236-1.348 1.349c-.038.037-.17.022-.198-.023a6.5 6.5 0 0 1 5.54-9.9 6.469 6.469 0 0 1 3.1.784z"/><path d="M4.001 11.93.948 8.877a.2.2 0 0 1 .141-.341h6.106a.2.2 0 0 1 .141.341L4.283 11.93a.2.2 0 0 1-.282 0zm11.083-6.789 3.053 3.053a.2.2 0 0 1-.14.342H11.89a.2.2 0 0 1-.14-.342l3.052-3.053a.2.2 0 0 1 .282 0z"/></svg>';/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class G extends g{static get pluginName(){return"FindAndReplaceUI"}constructor(s){super(s),this.formView=null}init(){const s=this.editor;s.ui.componentFactory.add("findAndReplace",e=>{const t=b(e),n=s.commands.get("find");return t.bind("isEnabled").to(n),t.once("change:isOpen",()=>{this.formView=new(S(L))(s.locale),t.panelView.children.add(this.formView),this._setupFormView(this.formView)}),t.on("change:isOpen",(i,a,r)=>{r?(this.formView.disableCssTransitions(),this.formView.reset(),this.formView._findInputView.fieldView.select(),this.formView.enableCssTransitions()):this.fire("searchReseted")},{priority:"low"}),this._setupDropdownButton(t),t})}_setupDropdownButton(s){const e=this.editor,t=e.locale.t;s.buttonView.set({icon:z,label:t("Find and replace"),keystroke:"CTRL+F",tooltip:!0}),e.keystrokes.set("Ctrl+F",(n,i)=>{s.isEnabled&&(s.isOpen=!0,i())})}_setupFormView(s){const t=this.editor.commands,i=this.editor.plugins.get("FindAndReplaceEditing").state,a={before:-1,same:0,after:1,different:1};s.bind("highlightOffset").to(i,"highlightedResult",h=>h?Array.from(i.results).sort((u,f)=>a[u.marker.getStart().compareWith(f.marker.getStart())]).indexOf(h)+1:0),s.listenTo(i.results,"change",()=>{s.matchCount=i.results.length});const r=t.get("findNext"),o=t.get("findPrevious"),d=t.get("replace"),c=t.get("replaceAll");s.bind("_areCommandsEnabled").to(r,"isEnabled",o,"isEnabled",d,"isEnabled",c,"isEnabled",(h,u,f,V)=>({findNext:h,findPrevious:u,replace:f,replaceAll:V})),s.delegate("findNext","findPrevious","replace","replaceAll").to(this),s.on("change:isDirty",(h,u,f)=>{f&&this.fire("searchReseted")})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class K extends _{constructor(s,e){super(s),this.isEnabled=!0,this.affectsData=!1,this._state=e}execute(s,{matchCase:e,wholeWords:t}={}){const{editor:n}=this,{model:i}=n,a=n.plugins.get("FindAndReplaceUtils");let r;typeof s=="string"?(r=a.findByTextCallback(s,{matchCase:e,wholeWords:t}),this._state.searchText=s):r=s;const o=i.document.getRootNames().reduce((d,c)=>a.updateFindResultFromRange(i.createRangeIn(i.document.getRoot(c)),i,r,d),null);return this._state.clear(i),this._state.results.addMany(o),this._state.highlightedResult=o.get(0),typeof s=="string"&&(this._state.searchText=s),this._state.matchCase=!!e,this._state.matchWholeWords=!!t,{results:o,findCallback:r}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class R extends _{constructor(s,e){super(s),this.isEnabled=!0,this._state=e,this._isEnabledBasedOnSelection=!1}_replace(s,e){const{model:t}=this.editor,n=e.marker.getRange();t.canEditAt(n)&&t.change(i=>{if(n.root.rootName==="$graveyard"){this._state.results.remove(e);return}let a={};for(const r of n.getItems())if(r.is("$text")||r.is("$textProxy")){a=r.getAttributes();break}t.insertContent(i.createText(s,a),n),this._state.results.has(e)&&this._state.results.remove(e)})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class j extends R{execute(s,e){this._replace(s,e)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class q extends R{execute(s,e){const{editor:t}=this,{model:n}=t,i=t.plugins.get("FindAndReplaceUtils"),a=e instanceof m?e:n.document.getRootNames().reduce((r,o)=>i.updateFindResultFromRange(n.createRangeIn(n.document.getRoot(o)),n,i.findByTextCallback(e,this._state),r),null);a.length&&[...a].forEach(r=>{this._replace(s,r)})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class k extends _{constructor(s,e){super(s),this.affectsData=!1,this._state=e,this.isEnabled=!1,this.listenTo(this._state.results,"change",()=>{this.isEnabled=this._state.results.length>1})}refresh(){this.isEnabled=this._state.results.length>1}execute(){const s=this._state.results,e=s.getIndex(this._state.highlightedResult),t=e+1>=s.length?0:e+1;this._state.highlightedResult=this._state.results.get(t)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Q extends k{execute(){const e=this._state.results.getIndex(this._state.highlightedResult),t=e-1<0?this._state.results.length-1:e-1;this._state.highlightedResult=this._state.results.get(t)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Z extends I(){constructor(s){super(),this.set("results",new m),this.set("highlightedResult",null),this.set("searchText",""),this.set("replaceText",""),this.set("matchCase",!1),this.set("matchWholeWords",!1),this.results.on("change",(e,{removed:t,index:n})=>{if(Array.from(t).length){let i=!1;if(s.change(a=>{for(const r of t)this.highlightedResult===r&&(i=!0),s.markers.has(r.marker.name)&&a.removeMarker(r.marker)}),i){const a=n>=this.results.length?0:n;this.highlightedResult=this.results.get(a)}}})}clear(s){this.searchText="",s.change(e=>{if(this.highlightedResult){const t=this.highlightedResult.marker.name.split(":")[1],n=s.markers.get(`findResultHighlighted:${t}`);n&&e.removeMarker(n)}[...this.results].forEach(({marker:t})=>{e.removeMarker(t)})}),this.results.clear()}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class J extends g{static get pluginName(){return"FindAndReplaceUtils"}updateFindResultFromRange(s,e,t,n){const i=n||new m;return e.change(a=>{[...s].forEach(({type:r,item:o})=>{if(r==="elementStart"&&e.schema.checkChild(o,"$text")){const d=t({item:o,text:this.rangeToText(e.createRangeIn(o))});if(!d)return;d.forEach(c=>{const h=`findResult:${E()}`,u=a.addMarker(h,{usingOperation:!1,affectsData:!1,range:a.createRange(a.createPositionAt(o,c.start),a.createPositionAt(o,c.end))}),f=X(i,u);i.add({id:h,label:c.label,marker:u},f)})}})}),i}rangeToText(s){return Array.from(s.getItems()).reduce((e,t)=>t.is("$text")||t.is("$textProxy")?e+t.data:`${e}
`,"")}findByTextCallback(s,e){let t="gu";e.matchCase||(t+="i");let n=`(${W(s)})`;if(e.wholeWords){const r="[^a-zA-ZÀ-ɏḀ-ỿ]";new RegExp("^"+r).test(s)||(n=`(^|${r}|_)${n}`),new RegExp(r+"$").test(s)||(n=`${n}(?=_|${r}|$)`)}const i=new RegExp(n,t);function a({text:r}){return[...r.matchAll(i)].map(Y)}return a}}function X(l,s){const e=l.find(({marker:t})=>s.getStart().isBefore(t.getStart()));return e?l.getIndex(e):l.length}function Y(l){const s=l.length-1;let e=l.index;return l.length===3&&(e+=l[1].length),{label:l[s],start:e,end:e+l[s].length}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ee="ck-find-result_selected";function te(l,s,e){const t=new Set,n=new Set,i=s.model;i.document.differ.getChanges().forEach(r=>{r.name==="$text"||i.schema.isInline(r.position.nodeAfter)?(t.add(r.position.parent),[...i.markers.getMarkersAtPosition(r.position)].forEach(o=>{n.add(o.name)})):r.type==="insert"&&t.add(r.position.nodeAfter)}),i.document.differ.getChangedMarkers().forEach(({name:r,data:{newRange:o}})=>{o&&o.start.root.rootName==="$graveyard"&&n.add(r)}),t.forEach(r=>{[...i.markers.getMarkersIntersectingRange(i.createRangeIn(r))].forEach(d=>n.add(d.name))}),i.change(r=>{n.forEach(o=>{l.has(o)&&l.remove(o),r.removeMarker(o)})}),t.forEach(r=>{s.plugins.get("FindAndReplaceUtils").updateFindResultFromRange(i.createRangeOn(r),i,e,l)})}class se extends g{static get requires(){return[J]}static get pluginName(){return"FindAndReplaceEditing"}init(){this._activeResults=null,this.state=new Z(this.editor.model),this._defineConverters(),this._defineCommands(),this.listenTo(this.state,"change:highlightedResult",(t,n,i,a)=>{const{model:r}=this.editor;r.change(o=>{if(a){const d=a.marker.name.split(":")[1],c=r.markers.get(`findResultHighlighted:${d}`);c&&o.removeMarker(c)}if(i){const d=i.marker.name.split(":")[1];o.addMarker(`findResultHighlighted:${d}`,{usingOperation:!1,affectsData:!1,range:i.marker.getRange()})}})});/* istanbul ignore next -- @preserve */const e=U(((t,n,i)=>{if(i){const a=this.editor.editing.view.domConverter,r=this.editor.editing.mapper.toViewRange(i.marker.getRange());A({target:a.viewRangeToDom(r),viewportOffset:40})}}).bind(this),32);this.listenTo(this.state,"change:highlightedResult",e,{priority:"low"}),this.listenTo(this.editor,"destroy",e.cancel)}find(s){const{editor:e}=this,{model:t}=e,{findCallback:n,results:i}=e.execute("find",s);return this._activeResults=i,this.listenTo(t.document,"change:data",()=>te(this._activeResults,e,n)),this._activeResults}stop(){this._activeResults&&(this.stopListening(this.editor.model.document),this.state.clear(this.editor.model),this._activeResults=null)}_defineCommands(){this.editor.commands.add("find",new K(this.editor,this.state)),this.editor.commands.add("findNext",new k(this.editor,this.state)),this.editor.commands.add("findPrevious",new Q(this.editor,this.state)),this.editor.commands.add("replace",new j(this.editor,this.state)),this.editor.commands.add("replaceAll",new q(this.editor,this.state))}_defineConverters(){const{editor:s}=this;s.conversion.for("editingDowncast").markerToHighlight({model:"findResult",view:({markerName:e})=>{const[,t]=e.split(":");return{name:"span",classes:["ck-find-result"],attributes:{"data-find-result":t}}}}),s.conversion.for("editingDowncast").markerToHighlight({model:"findResultHighlighted",view:({markerName:e})=>{const[,t]=e.split(":");return{name:"span",classes:[ee],attributes:{"data-find-result":t}}}})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class he extends g{static get requires(){return[se,G]}static get pluginName(){return"FindAndReplace"}init(){const s=this.editor.plugins.get("FindAndReplaceUI"),e=this.editor.plugins.get("FindAndReplaceEditing"),t=e.state;s.on("findNext",(n,i)=>{i?(t.searchText=i.searchText,this.editor.execute("find",i.searchText,i)):this.editor.execute("findNext")}),s.on("findPrevious",(n,i)=>{i&&t.searchText!==i.searchText?this.editor.execute("find",i.searchText):this.editor.execute("findPrevious")}),s.on("replace",(n,i)=>{t.searchText!==i.searchText&&this.editor.execute("find",i.searchText);const a=t.highlightedResult;a&&this.editor.execute("replace",i.replaceText,a)}),s.on("replaceAll",(n,i)=>{t.searchText!==i.searchText&&this.editor.execute("find",i.searchText),this.editor.execute("replaceAll",i.replaceText,t.results)}),s.on("searchReseted",()=>{t.clear(this.editor.model),e.stop()})}}export{he as F};
