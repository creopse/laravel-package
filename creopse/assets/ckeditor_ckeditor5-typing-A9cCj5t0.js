import{C as M,P as x}from"./ckeditor_ckeditor5-core-Ck1E_gMX.js";import{E as K,e as E,n as j,N as Q,P as Y,Q as V,o as _,O as J}from"./ckeditor_ckeditor5-utils-CWV6iAXC.js";import{O as z,d as R,B as G}from"./ckeditor_ckeditor5-engine-Bp3orBjd.js";import{n as X}from"./lodash-es-DLvU2Xhi.js";/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class W{constructor(e,t=20){this._batch=null,this.model=e,this._size=0,this.limit=t,this._isLocked=!1,this._changeCallback=(i,s)=>{s.isLocal&&s.isUndoable&&s!==this._batch&&this._reset(!0)},this._selectionChangeCallback=()=>{this._reset()},this.model.document.on("change",this._changeCallback),this.model.document.selection.on("change:range",this._selectionChangeCallback),this.model.document.selection.on("change:attribute",this._selectionChangeCallback)}get batch(){return this._batch||(this._batch=this.model.createBatch({isTyping:!0})),this._batch}get size(){return this._size}input(e){this._size+=e,this._size>=this.limit&&this._reset(!0)}get isLocked(){return this._isLocked}lock(){this._isLocked=!0}unlock(){this._isLocked=!1}destroy(){this.model.document.off("change",this._changeCallback),this.model.document.selection.off("change:range",this._selectionChangeCallback),this.model.document.selection.off("change:attribute",this._selectionChangeCallback)}_reset(e=!1){(!this.isLocked||e)&&(this._batch=null,this._size=0)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Z extends M{constructor(e,t){super(e),this._buffer=new W(e.model,t),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}destroy(){super.destroy(),this._buffer.destroy()}execute(e={}){const t=this.editor.model,i=t.document,s=e.text||"",n=s.length;let a=i.selection;if(e.selection?a=e.selection:e.range&&(a=t.createSelection(e.range)),!t.canEditAt(a))return;const r=e.resultRange;t.enqueueChange(this._buffer.batch,c=>{this._buffer.lock(),t.deleteContent(a),s&&t.insertContent(c.createText(s,i.selection.getAttributes()),a),r?c.setSelection(r):a.is("documentSelection")||c.setSelection(a),this._buffer.unlock(),this._buffer.input(n)})}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const O=["insertText","insertReplacementText"];class ee extends z{constructor(e){super(e),E.isAndroid&&O.push("insertCompositionText");const t=e.document;t.on("beforeinput",(i,s)=>{if(!this.isEnabled)return;const{data:n,targetRanges:a,inputType:r,domEvent:c}=s;if(!O.includes(r))return;const l=new K(t,"insertText");t.fire(l,new R(e,c,{text:n,selection:e.createSelection(a)})),l.stop.called&&i.stop()}),t.on("compositionend",(i,{data:s,domEvent:n})=>{!this.isEnabled||E.isAndroid||s&&t.fire("insertText",new R(e,n,{text:s,selection:t.selection}))},{priority:"lowest"})}observe(){}stopObserving(){}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class te extends x{static get pluginName(){return"Input"}init(){const e=this.editor,t=e.model,i=e.editing.view,s=t.document.selection;i.addObserver(ee);const n=new Z(e,e.config.get("typing.undoStep")||20);e.commands.add("insertText",n),e.commands.add("input",n),this.listenTo(i.document,"insertText",(a,r)=>{i.document.isComposing||r.preventDefault();const{text:c,selection:l,resultRange:d}=r,u=Array.from(l.getRanges()).map(f=>e.editing.mapper.toModelRange(f));let h=c;if(E.isAndroid){const f=Array.from(u[0].getItems()).reduce((y,p)=>y+(p.is("$textProxy")?p.data:""),"");f&&(f.length<=h.length?h.startsWith(f)&&(h=h.substring(f.length),u[0].start=u[0].start.getShiftedBy(f.length)):f.startsWith(h)&&(u[0].start=u[0].start.getShiftedBy(h.length),h=""))}const m={text:h,selection:t.createSelection(u)};d&&(m.resultRange=e.editing.mapper.toModelRange(d)),e.execute("insertText",m)}),E.isAndroid?this.listenTo(i.document,"keydown",(a,r)=>{s.isCollapsed||r.keyCode!=229||!i.document.isComposing||P(t,n)}):this.listenTo(i.document,"compositionstart",()=>{s.isCollapsed||P(t,n)})}}function P(o,e){if(!e.isEnabled)return;const t=e.buffer;t.lock(),o.enqueueChange(t.batch,()=>{o.deleteContent(o.document.selection)}),t.unlock()}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class I extends M{constructor(e,t){super(e),this.direction=t,this._buffer=new W(e.model,e.config.get("typing.undoStep")),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}execute(e={}){const t=this.editor.model,i=t.document;t.enqueueChange(this._buffer.batch,s=>{this._buffer.lock();const n=s.createSelection(e.selection||i.selection);if(!t.canEditAt(n))return;const a=e.sequence||1,r=n.isCollapsed;if(n.isCollapsed&&t.modifySelection(n,{direction:this.direction,unit:e.unit,treatEmojiAsSingleUnit:!0}),this._shouldEntireContentBeReplacedWithParagraph(a)){this._replaceEntireContentWithParagraph(s);return}if(this._shouldReplaceFirstBlockWithParagraph(n,a)){this.editor.execute("paragraph",{selection:n});return}if(n.isCollapsed)return;let c=0;n.getFirstRange().getMinimalFlatRanges().forEach(l=>{c+=j(l.getWalker({singleCharacters:!0,ignoreElementEnd:!0,shallow:!0}))}),t.deleteContent(n,{doNotResetEntireContent:r,direction:this.direction}),this._buffer.input(c),s.setSelection(n),this._buffer.unlock()})}_shouldEntireContentBeReplacedWithParagraph(e){if(e>1)return!1;const t=this.editor.model,s=t.document.selection,n=t.schema.getLimitElement(s);if(!(s.isCollapsed&&s.containsEntireContent(n))||!t.schema.checkChild(n,"paragraph"))return!1;const r=n.getChild(0);return!(r&&r.is("element","paragraph"))}_replaceEntireContentWithParagraph(e){const t=this.editor.model,s=t.document.selection,n=t.schema.getLimitElement(s),a=e.createElement("paragraph");e.remove(e.createRangeIn(n)),e.insert(a,n),e.setSelection(a,0)}_shouldReplaceFirstBlockWithParagraph(e,t){const i=this.editor.model;if(t>1||this.direction!="backward"||!e.isCollapsed)return!1;const s=e.getFirstPosition(),n=i.schema.getLimitElement(s),a=n.getChild(0);return!(s.parent!=a||!e.containsEntireContent(a)||!i.schema.checkChild(n,"paragraph")||a.name=="paragraph")}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ne="character",L="word",ie="codePoint",g="selection",v="backward",T="forward",$={deleteContent:{unit:g,direction:v},deleteContentBackward:{unit:ie,direction:v},deleteWordBackward:{unit:L,direction:v},deleteHardLineBackward:{unit:g,direction:v},deleteSoftLineBackward:{unit:g,direction:v},deleteContentForward:{unit:ne,direction:T},deleteWordForward:{unit:L,direction:T},deleteHardLineForward:{unit:g,direction:T},deleteSoftLineForward:{unit:g,direction:T}};class oe extends z{constructor(e){super(e);const t=e.document;let i=0;t.on("keydown",()=>{i++}),t.on("keyup",()=>{i=0}),t.on("beforeinput",(s,n)=>{if(!this.isEnabled)return;const{targetRanges:a,domEvent:r,inputType:c}=n,l=$[c];if(!l)return;const d={direction:l.direction,unit:l.unit,sequence:i};d.unit==g&&(d.selectionToRemove=e.createSelection(a[0])),c==="deleteContentBackward"&&(E.isAndroid&&(d.sequence=1),re(a)&&(d.unit=g,d.selectionToRemove=e.createSelection(a)));const u=new G(t,"delete",a[0]);t.fire(u,new R(e,r,d)),u.stop.called&&s.stop()}),E.isBlink&&se(this)}observe(){}stopObserving(){}}function se(o){const e=o.view,t=e.document;let i=null,s=!1;t.on("keydown",(r,{keyCode:c})=>{i=c,s=!1}),t.on("keyup",(r,{keyCode:c,domEvent:l})=>{const d=t.selection,u=o.isEnabled&&c==i&&n(c)&&!d.isCollapsed&&!s;if(i=null,u){const h=d.getFirstRange(),m=new G(t,"delete",h),f={unit:g,direction:a(c),selectionToRemove:d};t.fire(m,new R(e,l,f))}}),t.on("beforeinput",(r,{inputType:c})=>{const l=$[c];n(i)&&l&&l.direction==a(i)&&(s=!0)},{priority:"high"}),t.on("beforeinput",(r,{inputType:c,data:l})=>{i==_.delete&&c=="insertText"&&l==""&&r.stop()},{priority:"high"});function n(r){return r==_.backspace||r==_.delete}function a(r){return r==_.backspace?v:T}}function re(o){if(o.length!=1||o[0].isCollapsed)return!1;const e=o[0].getWalker({direction:"backward",singleCharacters:!0,ignoreElementEnd:!0});let t=0;for(const{nextPosition:i}of e){if(!i.parent.is("$text"))t++;else{const s=i.parent.data,n=i.offset;if(Q(s,n)||Y(s,n)||V(s,n))continue;t++}if(t>1)return!0}return!1}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ae extends x{static get pluginName(){return"Delete"}init(){const e=this.editor,t=e.editing.view,i=t.document,s=e.model.document;t.addObserver(oe),this._undoOnBackspace=!1;const n=new I(e,"forward");e.commands.add("deleteForward",n),e.commands.add("forwardDelete",n),e.commands.add("delete",new I(e,"backward")),this.listenTo(i,"delete",(a,r)=>{i.isComposing||r.preventDefault();const{direction:c,sequence:l,selectionToRemove:d,unit:u}=r,h=c==="forward"?"deleteForward":"delete",m={sequence:l};if(u=="selection"){const f=Array.from(d.getRanges()).map(y=>e.editing.mapper.toModelRange(y));m.selection=e.model.createSelection(f)}else m.unit=u;e.execute(h,m),t.scrollToTheSelection()},{priority:"low"}),this.editor.plugins.has("UndoEditing")&&(this.listenTo(i,"delete",(a,r)=>{this._undoOnBackspace&&r.direction=="backward"&&r.sequence==1&&r.unit=="codePoint"&&(this._undoOnBackspace=!1,e.execute("undo"),r.preventDefault(),a.stop())},{context:"$capture"}),this.listenTo(s,"change",()=>{this._undoOnBackspace=!1}))}requestUndoOnBackspace(){this.editor.plugins.has("UndoEditing")&&(this._undoOnBackspace=!0)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Te extends x{static get requires(){return[te,ae]}static get pluginName(){return"Typing"}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ce(o,e){let t=o.start;return{text:Array.from(o.getWalker({ignoreElementEnd:!1})).reduce((s,{item:n})=>n.is("$text")||n.is("$textProxy")?s+n.data:(t=e.createPositionAfter(n),""),""),range:e.createRange(t,o.end)}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class le extends J(){constructor(e,t){super(),this.model=e,this.testCallback=t,this._hasMatch=!1,this.set("isEnabled",!0),this.on("change:isEnabled",()=>{this.isEnabled?this._startListening():(this.stopListening(e.document.selection),this.stopListening(e.document))}),this._startListening()}get hasMatch(){return this._hasMatch}_startListening(){const t=this.model.document;this.listenTo(t.selection,"change:range",(i,{directChange:s})=>{if(s){if(!t.selection.isCollapsed){this.hasMatch&&(this.fire("unmatched"),this._hasMatch=!1);return}this._evaluateTextBeforeSelection("selection")}}),this.listenTo(t,"change:data",(i,s)=>{s.isUndo||!s.isLocal||this._evaluateTextBeforeSelection("data",{batch:s})})}_evaluateTextBeforeSelection(e,t={}){const i=this.model,n=i.document.selection,a=i.createRange(i.createPositionAt(n.focus.parent,0),n.focus),{text:r,range:c}=ce(a,i),l=this.testCallback(r);if(!l&&this.hasMatch&&this.fire("unmatched"),this._hasMatch=!!l,l){const d=Object.assign(t,{text:r,range:c});typeof l=="object"&&Object.assign(d,l),this.fire(`matched:${e}`,d)}}}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xe extends x{static get pluginName(){return"TwoStepCaretMovement"}constructor(e){super(e),this.attributes=new Set,this._overrideUid=null}init(){const e=this.editor,t=e.model,i=e.editing.view,s=e.locale,n=t.document.selection;this.listenTo(i.document,"arrowKey",(a,r)=>{if(!n.isCollapsed||r.shiftKey||r.altKey||r.ctrlKey)return;const c=r.keyCode==_.arrowright,l=r.keyCode==_.arrowleft;if(!c&&!l)return;const d=s.contentLanguageDirection;let u=!1;d==="ltr"&&c||d==="rtl"&&l?u=this._handleForwardMovement(r):u=this._handleBackwardMovement(r),u===!0&&a.stop()},{context:"$text",priority:"highest"}),this._isNextGravityRestorationSkipped=!1,this.listenTo(n,"change:range",(a,r)=>{if(this._isNextGravityRestorationSkipped){this._isNextGravityRestorationSkipped=!1;return}this._isGravityOverridden&&(!r.directChange&&S(n.getFirstPosition(),this.attributes)||this._restoreGravity())})}registerAttribute(e){this.attributes.add(e)}_handleForwardMovement(e){const t=this.attributes,s=this.editor.model.document.selection,n=s.getFirstPosition();return this._isGravityOverridden||n.isAtStart&&A(s,t)?!1:S(n,t)?(C(e),this._overrideGravity(),!0):!1}_handleBackwardMovement(e){const t=this.attributes,i=this.editor.model,s=i.document.selection,n=s.getFirstPosition();return this._isGravityOverridden?(C(e),this._restoreGravity(),B(i,t,n),!0):n.isAtStart?A(s,t)?(C(e),B(i,t,n),!0):!1:de(n,t)?n.isAtEnd&&!A(s,t)&&S(n,t)?(C(e),B(i,t,n),!0):(this._isNextGravityRestorationSkipped=!0,this._overrideGravity(),!1):!1}get _isGravityOverridden(){return!!this._overrideUid}_overrideGravity(){this._overrideUid=this.editor.model.change(e=>e.overrideSelectionGravity())}_restoreGravity(){this.editor.model.change(e=>{e.restoreSelectionGravity(this._overrideUid),this._overrideUid=null})}}function A(o,e){for(const t of e)if(o.hasAttribute(t))return!0;return!1}function B(o,e,t){const i=t.nodeBefore;o.change(s=>{i?s.setSelectionAttribute(i.getAttributes()):s.removeSelectionAttribute(e)})}function C(o){o.preventDefault()}function de(o,e){const t=o.getShiftedBy(-1);return S(t,e)}function S(o,e){const{nodeBefore:t,nodeAfter:i}=o;for(const s of e){const n=t?t.getAttribute(s):void 0;if((i?i.getAttribute(s):void 0)!==n)return!0}return!1}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const F={copyright:{from:"(c)",to:"©"},registeredTrademark:{from:"(r)",to:"®"},trademark:{from:"(tm)",to:"™"},oneHalf:{from:/(^|[^/a-z0-9])(1\/2)([^/a-z0-9])$/i,to:[null,"½",null]},oneThird:{from:/(^|[^/a-z0-9])(1\/3)([^/a-z0-9])$/i,to:[null,"⅓",null]},twoThirds:{from:/(^|[^/a-z0-9])(2\/3)([^/a-z0-9])$/i,to:[null,"⅔",null]},oneForth:{from:/(^|[^/a-z0-9])(1\/4)([^/a-z0-9])$/i,to:[null,"¼",null]},threeQuarters:{from:/(^|[^/a-z0-9])(3\/4)([^/a-z0-9])$/i,to:[null,"¾",null]},lessThanOrEqual:{from:"<=",to:"≤"},greaterThanOrEqual:{from:">=",to:"≥"},notEqual:{from:"!=",to:"≠"},arrowLeft:{from:"<-",to:"←"},arrowRight:{from:"->",to:"→"},horizontalEllipsis:{from:"...",to:"…"},enDash:{from:/(^| )(--)( )$/,to:[null,"–",null]},emDash:{from:/(^| )(---)( )$/,to:[null,"—",null]},quotesPrimary:{from:b('"'),to:[null,"“",null,"”"]},quotesSecondary:{from:b("'"),to:[null,"‘",null,"’"]},quotesPrimaryEnGb:{from:b("'"),to:[null,"‘",null,"’"]},quotesSecondaryEnGb:{from:b('"'),to:[null,"“",null,"”"]},quotesPrimaryPl:{from:b('"'),to:[null,"„",null,"”"]},quotesSecondaryPl:{from:b("'"),to:[null,"‚",null,"’"]}},q={symbols:["copyright","registeredTrademark","trademark"],mathematical:["oneHalf","oneThird","twoThirds","oneForth","threeQuarters","lessThanOrEqual","greaterThanOrEqual","notEqual","arrowLeft","arrowRight"],typography:["horizontalEllipsis","enDash","emDash"],quotes:["quotesPrimary","quotesSecondary"]},ue=["symbols","mathematical","typography","quotes"];class Ce extends x{static get requires(){return["Delete","Input"]}static get pluginName(){return"TextTransformation"}constructor(e){super(e),e.config.define("typing",{transformations:{include:ue}})}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTransformationWatchers()}_enableTransformationWatchers(){const e=this.editor,t=e.model,i=e.plugins.get("Delete"),s=ge(e.config.get("typing.transformations")),n=r=>{for(const c of s)if(c.from.test(r))return{normalizedTransformation:c}},a=new le(e.model,n);a.on("matched:data",(r,c)=>{if(!c.batch.isTyping)return;const{from:l,to:d}=c.normalizedTransformation,u=l.exec(c.text),h=d(u.slice(1)),m=c.range;let f=u.index;t.enqueueChange(y=>{for(let p=1;p<u.length;p++){const D=u[p],k=h[p-1];if(k==null){f+=D.length;continue}const w=m.start.getShiftedBy(f),U=t.createRange(w,w.getShiftedBy(D.length)),H=me(w);t.insertContent(y.createText(k,H),U),f+=k.length}t.enqueueChange(()=>{i.requestUndoOnBackspace()})})}),a.bind("isEnabled").to(this)}}function fe(o){return typeof o=="string"?new RegExp(`(${X(o)})$`):o}function he(o){return typeof o=="string"?()=>[o]:o instanceof Array?()=>o:o}function me(o){return(o.textNode?o.textNode:o.nodeAfter).getAttributes()}function b(o){return new RegExp(`(^|\\s)(${o})([^${o}]*)(${o})$`)}function ge(o){const e=o.extra||[],t=o.remove||[],i=n=>!t.includes(n),s=o.include.concat(e).filter(i);return pe(s).filter(i).map(n=>typeof n=="string"&&F[n]?F[n]:n).filter(n=>typeof n=="object").map(n=>({from:fe(n.from),to:he(n.to)}))}function pe(o){const e=new Set;for(const t of o)if(typeof t=="string"&&q[t])for(const i of q[t])e.add(i);else e.add(t);return Array.from(e)}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function be(o,e,t,i){return i.createRange(N(o,e,t,!0,i),N(o,e,t,!1,i))}function N(o,e,t,i,s){let n=o.textNode||(i?o.nodeBefore:o.nodeAfter),a=null;for(;n&&n.getAttribute(e)==t;)a=n,n=i?n.previousSibling:n.nextSibling;return a?s.createPositionAt(a,i?"before":"after"):o}/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Se(o,e,t,i){const s=o.editing.view,n=new Set;s.document.registerPostFixer(a=>{const r=o.model.document.selection;let c=!1;if(r.hasAttribute(e)){const l=be(r.getFirstPosition(),e,r.getAttribute(e),o.model),d=o.editing.mapper.toViewRange(l);for(const u of d.getItems())u.is("element",t)&&!u.hasClass(i)&&(a.addClass(i,u),n.add(u),c=!0)}return c}),o.conversion.for("editingDowncast").add(a=>{a.on("insert",r,{priority:"highest"}),a.on("remove",r,{priority:"highest"}),a.on("attribute",r,{priority:"highest"}),a.on("selection",r,{priority:"highest"});function r(){s.change(c=>{for(const l of n.values())c.removeClass(i,l),n.delete(l)})}})}export{ae as D,te as I,xe as T,Te as a,le as b,Ce as c,be as f,ce as g,Se as i};
