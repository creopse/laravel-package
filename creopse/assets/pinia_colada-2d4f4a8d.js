var W=Object.defineProperty;var z=(n,s,i)=>s in n?W(n,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[s]=i;var w=(n,s,i)=>(z(n,typeof s!="symbol"?s+"":s,i),i);import{d as F,s as I}from"./pinia-a2cac08c.js";import{h as V,s as C,m as T,j as Q,g as j}from"./vue_reactivity-852d8377.js";import{i as H}from"./vue_runtime-core-273b5003.js";var J=class D{constructor(...s){w(this,"value");w(this,"children");s.length&&this.set(...s)}set(s,i){var r;if(s.length===0)this.value=i;else{const[c,...l]=s,u=(r=this.children)==null?void 0:r.get(c);u?u.set(l,i):(this.children??(this.children=new Map),this.children.set(c,new D(l,i)))}}find(s){var i,r;if(s.length===0)return this;{const[c,...l]=s;return(r=(i=this.children)==null?void 0:i.get(c))==null?void 0:r.find(l)}}get(s){var i;return(i=this.find(s))==null?void 0:i.value}delete(s){var i,r,c;if(s.length===1)(i=this.children)==null||i.delete(s[0]);else{const[l,...u]=s;(c=(r=this.children)==null?void 0:r.get(l))==null||c.delete(u)}}*[Symbol.iterator](){if(this.value!=null&&(yield this.value),this.children)for(const s of this.children.values())yield*s}};function L(n,...s){return typeof n=="function"?n(...s):n}function g(n){return n&&typeof n=="object"?JSON.stringify(n,Object.keys(n).sort()):String(n)}var R={staleTime:1e3*5,gcTime:1e3*60*5,refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:!0,enabled:!0},M=Symbol(),X=()=>H(M,R),b={},$="_pc_query",B=F($,({action:n})=>{const s=new J,i=I(V(s)),r=j(),c=X(),l=n((e,t=null,a,o=null,h=0)=>r.run(()=>{const d=C({data:a,error:o,status:o?"error":a!==void 0?"success":"pending"}),Y=C("idle");return T({key:e,state:d,placeholderData:null,when:h,asyncStatus:Y,pending:null,deps:T(new Set),gcTimeout:void 0,ext:b,options:t,get stale(){return!this.when||Date.now()>=this.when+this.options.staleTime},get active(){return this.deps.size>0}})}));let u;const S=new WeakMap,k=n(e=>{var a;let t=S.get(e);if(!t)u=t=[[],null],t[1]=r.run(e),u=null,S.set(e,t);else for(const o of t[0])(a=o.options)!=null&&a.refetchOnMount&&(Q(o.options.refetchOnMount)==="always"?p(o):_(o));return t});function x(e,t){t&&(e.deps.add(t),clearTimeout(e.gcTimeout))}function U(e,t,a){t&&(e.deps.delete(t),!(e.deps.size>0||!e.options)&&(clearTimeout(e.gcTimeout),Number.isFinite(e.options.gcTime)&&(e.gcTimeout=setTimeout(()=>{a.remove(e)},e.options.gcTime))))}const y=n(e=>Promise.all(v(e).map(t=>(O(t),t.active&&p(t))))),v=n((e={})=>{const t=e.key?s.find(e.key.map(g)):s;return t?(e.exact?t.value?[t.value]:[]:[...t]).filter(a=>e.stale!=null?a.stale===e.stale:e.active!=null?a.active===e.active:e.status?a.state.value.status===e.status:e.predicate?e.predicate(a):!0):[]}),A=n(e=>{var h;const t={...c,...e},a=Q(t.key).map(g);let o=s.get(a);return o||s.set(a,o=l(a,t,(h=t.initialData)==null?void 0:h.call(t))),o.options=t,o.ext===b&&(o.ext={},E(o)),u==null||u[0].push(o),o}),E=n(e=>{}),O=n(e=>{e.when=0,m(e)}),_=n(async e=>{var t;return e.state.value.error||e.stale?((t=e.pending)==null?void 0:t.refreshCall)??p(e):e.state.value}),p=n(async e=>{var h;e.asyncStatus.value="loading";const t=new AbortController,{signal:a}=t;(h=e.pending)==null||h.abortController.abort();const o=e.pending={abortController:t,refreshCall:(async()=>e.options.query({signal:a}))().then(d=>(o===e.pending&&f(e,{data:d,error:null,status:"success"}),e.state.value)).catch(d=>{throw o===e.pending&&d&&(d.name!=="AbortError"||d===a.reason)&&f(e,{status:"error",data:e.state.value.data,error:d}),d}).finally(()=>{e.asyncStatus.value="idle",o===e.pending&&(e.pending=null,e.placeholderData=null,e.when=Date.now())}),when:Date.now()};return o.refreshCall}),m=n((e,t)=>{var a;(a=e.pending)==null||a.abortController.abort(t),e.asyncStatus.value="idle",e.pending=null}),K=n((e,t)=>{v(e).forEach(a=>m(a,t))}),f=n((e,t)=>{e.state.value=t,e.when=Date.now()}),N=n((e,t)=>{const a=e.map(g);let o=i.get(a);o||i.set(a,o=l(a)),f(o,{...o.state.value,data:L(t,o.state.value.data)})});function P(e){var t;return(t=i.get(e.map(g)))==null?void 0:t.state.value.data}const q=n(e=>i.delete(e.key));return{caches:i,ensureDefinedQuery:k,_s:T(r),setQueryData:N,getQueryData:P,invalidateQueries:y,cancelQueries:K,invalidate:O,fetch:p,refresh:_,ensure:A,extend:E,track:x,untrack:U,cancel:m,create:l,remove:q,setEntryState:f,getEntries:v}});function se(n,s={}){const{pinia:i=n.config.globalProperties.$pinia,plugins:r,...c}=s;n.provide(M,{...R,...c});const l=B(i);r==null||r.forEach(u=>u({scope:l._s,queryCache:l,pinia:i}))}export{se as P};
