import{i as q}from"./ckeditor_ckeditor5-vue-CmLqe3wy.js";import{u as pt,a as mt,b as ft,c as yt,d as P,M as _,e as vt,f as gt,g as ht,h as kt,i as wt,j as bt,k as Mt,l as Ct,_ as It,m as xt}from"./media-file-Dza5yqEv.js";import{_ as Ft}from"./PageLayout.vue_vue_type_script_setup_true_lang-DTucXQeE.js";import{u as Dt,W as St,_ as zt,R as Tt,X as Et,w as _e,Y as Ut,Z as At,$ as $t}from"./main-DH7x7JSJ.js";import{I as Ot}from"./iconify_vue-DXPEksg3.js";import{u as Pt}from"./vue-router-DS5MTONl.js";import{u as Rt}from"./vueuse_core-DKs1Kb2a.js";import{v as W}from"./uuid-8I8R7izr.js";import{u as Nt,t as Vt,_ as Bt,k as jt,B as Yt,h as Lt,W as Gt,X as Qt,a1 as Ht,d as Wt,o as qt,q as Xt,A as Kt,a2 as Zt,Q as Jt,l as en,F as tn,r as nn,U as ln,c as on,H as sn,a3 as an}from"./naive-ui-dfg6Ko-R.js";import{u as cn}from"./vue-i18n-B92nPylK.js";import{r as un}from"./vueuse_shared-B0wwFjQU.js";const{unref:rn}=await q("vue"),{defineComponent:dn}=await q("vue"),{unref:e,toDisplayString:i,createElementVNode:c,resolveComponent:rl,createVNode:n,withCtx:l,createTextVNode:k,openBlock:s,createBlock:v,createCommentVNode:f,createElementBlock:r,isRef:b,Fragment:U,renderList:ee,vShow:_n,withDirectives:pn,withModifiers:mn}=await q("vue"),fn={key:0,class:"flex items-center gap-3"},yn={key:1,class:"flex items-center gap-3"},vn={class:"flex justify-between items-center"},gn={class:"flex items-center gap-3"},hn={key:0},kn={key:0},wn={key:1},bn={key:2},Mn={key:3},Cn={key:4},In={key:0},xn={key:0},Fn={class:"flex items-center justify-center h-[200px] relative"},Dn=["onClick"],Sn={class:"absolute top-0 left-0 w-full h-full bg-black opacity-35 flex items-center justify-center"},zn={class:"text-center text-dimgray text-sm"},Tn={class:"flex items-center gap-2"},En={class:"flex items-center gap-2"},Un={key:1,class:"flex items-center justify-center"},An={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},$n=["src"],On={id:"video",autoplay:"",controls:"",style:{width:"100%"}},Pn=["src"],Rn={class:"w-[30%]"},Nn={key:0},Vn={key:1},Bn={key:2},jn={key:3},Yn={key:4},Ln={key:0},Gn={key:1},Qn={key:2},Hn={key:3},Wn={key:4},qn={key:5},Xn={key:6},{ref:y,h:Kn,computed:te,watch:pe}=await q("vue"),R=10,dl=dn({__name:"index",setup(Zn){const{t,locale:me}=cn(),{getVideoThumbnail:fe,isSmScreen:ne,isMdScreen:le,isLgScreen:ye}=Dt(),N=Nt(),S=Vt(),ve=Pt(),{mediaFileTypes:ge}=pt(),V=y(W()),B=y(""),he=y(null),ke=un(B,500),z=y([]),A=y(!1),h=y({}),x=y([]),M=y(0),we=u=>Kn("span",{},{default:()=>_e(u.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:me.value})}),oe=y(0),j=y(60),T=y(1),be=te(()=>({pageSize:j.value,query:ke.value,page:T.value,type:M.value,months:x.value})),Me=u=>{T.value=u,C()},Ce=u=>{j.value=u,C()},{data:Ie,refetch:C,isPending:se}=mt(be);pe(()=>Ie.value,u=>{z.value=u?.mediaFiles||[],oe.value=u?.meta?.total||0,T.value=u?.meta?.currentPage||1;let a=!0;z.value.length===0&&(a=!1);for(const d of z.value)if(d.id&&!h.value[d.id]){a=!1;break}A.value=a,V.value=W()},{deep:!0,immediate:!0});const{data:xe}=ft(),{data:ae}=yt(),{data:Fe}=P(_.IMAGE),{data:De}=P(_.VIDEO),{data:Se}=P(_.AUDIO),{data:ze}=P(_.DOCUMENT),{data:Te}=P(_.OTHER),{data:ie}=vt(),Y=te(()=>(xe.value||[]).map(u=>({label:u,value:u}))),{mutate:ce}=gt(),Ee=async u=>{S.warning({title:t("confirm"),content:t("confirmDeleteMediaFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{M.value==R?ce({...u,force:!0}):ce(u)}})},{mutate:Ue}=ht(),Ae=async u=>{S.warning({title:t("confirm"),content:t("confirmRestoreMediaFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{Ue(u)}})},{copy:$e,copied:Oe,isSupported:Pe}=Rt(),Re=async u=>{u.url&&$e(u.url)};pe(()=>Oe.value,u=>{u&&N.success(t("mediaLinkCopied"))});const $=y(null),L=y(!1),G=y(!1),ue=async u=>{switch($.value=u,u.type){case _.IMAGE:break;case _.VIDEO:G.value=!0;break;case _.AUDIO:L.value=!0;break;case _.DOCUMENT:window.open(u.url);break;default:N.info(t("cannotOpenThisFile"));break}},m=y(null),Q=y(!1),Ne=async u=>{m.value=u,Q.value=!0},X=y(null),F=y(null),D=y(!1),{mutate:Ve}=St(),{mutate:Be}=kt(),{mutate:je}=wt(),Ye=async u=>{F.value=u,Ve(u.path,{onSuccess(a,d,p){X.value=a,D.value=!0}})},Le=async(u,a)=>{var d=Ut(a);d=await At(d,{maxSizeMB:1});const p=new FormData;p.append("file",d),S.warning({title:t("registration"),content:t("confirmReplaceCurrentFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{F.value&&p.append("filename",F.value?.name),Be({id:F.value?.id,data:p},{onSuccess(g,O,K){D.value=!1}})},onNegativeClick:async()=>{F.value&&p.append("filename",$t(6)+"-"+F.value?.name),je(p,{onSuccess(g,O,K){D.value=!1}})}})},{mutate:Ge}=bt(),Qe=async()=>{S.warning({title:t("confirm"),content:t("confirmEmptyTrash"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{Ge()}})},E=te(()=>{let u=0;for(const a in h.value)h.value[a]&&u++;return u});function re(){h.value={},V.value=W(),A.value=!1,C()}const{mutate:He}=Mt(),We=async()=>(E.value?S.warning({title:t("confirm"),content:t("deleteSelectionWarningMessage",[E.value]),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{He({selectedItems:h.value,force:M.value==R},{onSuccess:()=>{re()}})}}):N.warning(t("noItemSelected")),!1),{mutate:qe}=Ct(),Xe=async()=>(E.value?S.warning({title:t("confirm"),content:t("restoreSelectionWarningMessage",[E.value]),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{qe(Object.keys(h.value).filter(u=>h.value[u]),{onSuccess:()=>{h.value={}}})}}):N.warning(t("noItemSelected")),!1);return(u,a)=>{const d=Ot,p=Lt,g=Yt,O=jt,K=nn,Ke=on,Ze=ln,Z=Qt,Je=Gt,J=Bt,et=Zt,tt=It,nt=Kt,lt=Xt,ot=zt,st=qt,at=Wt,it=Ht,ct=Jt,ut=en,rt=tn,dt=Ft,H=sn,de=an,_t=xt;return s(),r(U,null,[n(dt,null,{"header-extra":l(()=>[e(E)>0?(s(),r("section",fn,[c("span",null,i(e(t)("nbItemsSelected",[e(E)])),1),e(M)==R?(s(),v(g,{key:0,type:"success",size:"small",secondary:"",onClick:Xe},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"mdi:delete-restore"})]),_:1})]),default:l(()=>[k(" "+i(e(t)("restore")),1)]),_:1})):f("",!0),n(g,{type:"error",size:"small",secondary:"",onClick:We},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:trash-can"})]),_:1})]),default:l(()=>[k(" "+i(e(t)("delete")),1)]),_:1}),n(g,{type:"warning",size:"small",secondary:"",onClick:re},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:close"})]),_:1})]),default:l(()=>[k(" "+i(e(t)("cancelSelection")),1)]),_:1})])):(s(),r("section",yn,[!e(ne)&&!e(le)?(s(),r(U,{key:0},[n(K,{value:e(x),"onUpdate:value":[a[1]||(a[1]=o=>b(x)?x.value=o:null),a[2]||(a[2]=o=>e(C)())],"render-label":we,options:e(Y),placeholder:e(t)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:l(()=>[n(O,{size:"large",class:"w-full","default-checked":e(Y).length&&e(x).length===e(Y).length,"onUpdate:checked":a[0]||(a[0]=o=>{o?x.value=e(Y).map(w=>w.value):x.value=[],e(C)()})},{default:l(()=>[k(i(e(t)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),n(Ze,{class:"!w-[250px]"},{default:l(()=>[n(Ke,{ref_key:"searchInputRef",ref:he,value:e(B),"onUpdate:value":[a[3]||(a[3]=o=>b(B)?B.value=o:null),a[4]||(a[4]=o=>{o||e(C)()})],clearable:!0,placeholder:e(t)("search")},null,8,["value","placeholder"]),n(g,{type:"primary",secondary:"",onClick:a[5]||(a[5]=o=>e(C)())},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})],64)):f("",!0),n(g,{type:"primary",secondary:"",onClick:a[6]||(a[6]=()=>{e(ve).push(e(Tt).MEDIA_LIBRARY.PATH+"/add")})},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:add-alt"})]),_:1})]),default:l(()=>[k(" "+i(e(t)("add")),1)]),_:1})]))]),default:l(()=>[pn(n(J,{size:"small",class:"mb-5"},{default:l(()=>[c("div",vn,[c("div",gn,[n(O,{checked:e(A),"onUpdate:checked":[a[7]||(a[7]=o=>b(A)?A.value=o:null),a[8]||(a[8]=o=>{for(const w of e(z))w.id&&(e(h)[w.id]=o);V.value=("uuidv4"in u?u.uuidv4:rn(W))()})]},{default:l(()=>[k(i(e(t)("selectAll")),1)]),_:1},8,["checked"]),e(M)==R?(s(),v(g,{key:0,secondary:"",type:"error",size:"small",onClick:Qe},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"mdi:delete-forever"})]),_:1})]),default:l(()=>[k(" "+i(e(t)("emptyTrash")),1)]),_:1})):f("",!0)]),n(Je,{value:e(M),"onUpdate:value":[a[9]||(a[9]=o=>b(M)?M.value=o:null),a[10]||(a[10]=o=>e(C)())],name:"filtertyperadiobuttongroup",size:"medium"},{default:l(()=>[n(Z,{value:0},{default:l(()=>[k(i(e(t)("all"))+"  ",1),e(ae)?(s(),r("span",hn," ("+i(e(ae))+") ",1)):f("",!0)]),_:1}),(s(!0),r(U,null,ee(e(ge),o=>(s(),v(Z,{key:o.value,value:o.value},{default:l(()=>[k(i(o.label)+"  ",1),o.value==e(_).IMAGE?(s(),r("span",kn," ("+i(e(Fe))+") ",1)):o.value==e(_).VIDEO?(s(),r("span",wn," ("+i(e(De))+") ",1)):o.value==e(_).AUDIO?(s(),r("span",bn," ("+i(e(Se))+") ",1)):o.value==e(_).DOCUMENT?(s(),r("span",Mn," ("+i(e(ze))+") ",1)):(s(),r("span",Cn,"("+i(e(Te))+")",1))]),_:2},1032,["value"]))),128)),n(Z,{value:R},{default:l(()=>[k(i(e(t)("trash"))+"  ",1),e(ie)?(s(),r("span",In,"("+i(e(ie))+")",1)):f("",!0)]),_:1})]),_:1},8,["value"])])]),_:1},512),[[_n,!e(ne)&&!e(le)&&!e(ye)]]),n(J,{embedded:"",class:"py-2"},{default:l(()=>[e(z).length&&!e(se)?(s(),r("section",xn,[n(it,{"show-toolbar-tooltip":""},{default:l(()=>[n(at,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:3 900:4 1400:5"},{default:l(()=>[(s(!0),r(U,null,ee(e(z),(o,w)=>(s(),v(st,{key:w},{default:l(()=>[n(ot,{name:"slide-fade",appear:""},{default:l(()=>[n(J,{bordered:"",hoverable:""},{cover:l(()=>[c("div",Fn,[o.type==e(_).IMAGE?(s(),r(U,{key:0},[o.url?(s(),v(et,{key:0,src:o.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):f("",!0)],64)):o.type==e(_).VIDEO?(s(),r("div",{key:1,class:"flex items-center justify-center w-full h-full relative cursor-pointer",onClick:I=>ue(o)},[n(tt,{load:()=>e(fe)(o.url??""),class:"w-full h-[200px] object-cover"},{fallback:l(()=>[n(p,{size:"96"},{default:l(()=>[n(d,{icon:"carbon:document-video"})]),_:1})]),_:1},8,["load"]),c("div",Sn,[n(p,{size:72},{default:l(()=>[n(d,{icon:"carbon:play-outline-filled",class:"text-white"})]),_:1})])],8,Dn)):o.type==e(_).AUDIO?(s(),v(p,{key:2,size:"96"},{default:l(()=>[n(d,{icon:"carbon:document-audio"})]),_:1})):o.type==e(_).DOCUMENT?(s(),v(p,{key:3,size:"96"},{default:l(()=>[n(d,{icon:"carbon:document"})]),_:1})):(s(),v(p,{key:4,size:"96"},{default:l(()=>[n(d,{icon:"carbon:document-unknown"})]),_:1}))])]),header:l(()=>[c("div",zn,[n(nt,{"line-clamp":1},{default:l(()=>[o.id?(s(),v(O,{key:e(V)+o.id,checked:e(h)[o.id],"onUpdate:checked":I=>e(h)[o.id]=I,class:"mr-1",onClick:a[11]||(a[11]=mn(()=>{},["stop"]))},null,8,["checked","onUpdate:checked"])):f("",!0),k(" "+i(o.name),1)]),_:2},1024)])]),action:l(()=>[n(lt,{justify:"space-between",align:"center"},{default:l(()=>[c("div",Tn,[o.type!=e(_).IMAGE?(s(),v(g,{key:0,size:"small",type:"primary",secondary:"",title:e(t)("preview"),onClick:I=>ue(o)},{icon:l(()=>[n(p,null,{default:l(()=>[[e(_).AUDIO,e(_).VIDEO].includes(o.type)?(s(),v(d,{key:0,icon:"carbon:play"})):(s(),v(d,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):f("",!0),n(g,{size:"small",type:"primary",secondary:"",title:e(t)("details"),onClick:I=>Ne(o)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:information-filled"})]),_:1})]),_:1},8,["title","onClick"])]),c("div",En,[o.deletedAt?(s(),v(g,{key:0,size:"small",type:"primary",secondary:"",title:e(t)("restore"),onClick:I=>Ae(o)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"mdi:delete-restore"})]),_:1})]),_:1},8,["title","onClick"])):f("",!0),e(Pe)?(s(),v(g,{key:1,size:"small",type:"primary",secondary:"",title:e(t)("copy"),onClick:I=>Re(o)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:copy"})]),_:1})]),_:1},8,["title","onClick"])):f("",!0),o.type==e(_).IMAGE?(s(),v(g,{key:2,size:"small",type:"primary",secondary:"",title:e(t)("edit"),onClick:I=>Ye(o)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:edit"})]),_:1})]),_:1},8,["title","onClick"])):f("",!0),n(g,{size:"small",type:"error",secondary:"",title:e(t)("delete"),onClick:I=>Ee(o)},{icon:l(()=>[n(p,null,{default:l(()=>[n(d,{icon:"carbon:trash-can"})]),_:1})]),_:1},8,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n(ct,{page:e(T),"onUpdate:page":[a[12]||(a[12]=o=>b(T)?T.value=o:null),Me],class:"mt-10 justify-center","show-size-picker":"","page-size":e(j),"page-sizes":[12,24,36,48,60,72,84,96],"page-count":Math.ceil(e(oe)/e(j)),"onUpdate:pageSize":Ce},null,8,["page","page-size","page-count"])])):e(se)?(s(),r("section",Un,[n(ut,{size:"medium"})])):(s(),v(rt,{key:2,description:e(t)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),_:1}),n(H,{show:e(L),"onUpdate:show":a[13]||(a[13]=o=>b(L)?L.value=o:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e($)?.name},{default:l(()=>[c("audio",An,[c("source",{src:e($)?.url},null,8,$n)])]),_:1},8,["show","title"]),n(H,{show:e(G),"onUpdate:show":a[14]||(a[14]=o=>b(G)?G.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e($)?.name},{default:l(()=>[c("video",On,[c("source",{src:e($)?.url},null,8,Pn)])]),_:1},8,["show","title"]),n(H,{show:e(Q),"onUpdate:show":a[15]||(a[15]=o=>b(Q)?Q.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(m)?.name},{default:l(()=>[e(m)?(s(),v(de,{key:0,striped:"","single-line":!1,size:"small"},{default:l(()=>[c("tbody",null,[c("tr",null,[c("td",Rn,i(e(t)("name")),1),c("td",null,i(e(m).name),1)]),c("tr",null,[c("td",null,i(e(t)("link")),1),c("td",null,[c("small",null,i(e(m).url),1)])]),c("tr",null,[c("td",null,i(e(t)("type")),1),c("td",null,[e(m).type==e(_).IMAGE?(s(),r("span",Nn,i(e(t)("image")),1)):e(m).type==e(_).VIDEO?(s(),r("span",Vn,i(e(t)("video")),1)):e(m).type==e(_).AUDIO?(s(),r("span",Bn,i(e(t)("audio")),1)):e(m).type==e(_).DOCUMENT?(s(),r("span",jn,i(e(t)("document")),1)):(s(),r("span",Yn,i(e(t)("other")),1))])]),e(m).size?(s(),r("tr",Ln,[c("td",null,i(e(t)("size")),1),c("td",null,i(e(Et)(e(m).size,!0)),1)])):f("",!0),e(m).mimeType?(s(),r("tr",Gn,[c("td",null,i(e(t)("mimeType")),1),c("td",null,i(e(m).mimeType),1)])):f("",!0),e(m).sender?(s(),r("tr",Qn,[c("td",null,i(e(t)("sendBy")),1),c("td",null,i(e(m).sender.fullname),1)])):f("",!0),e(m).title?(s(),r("tr",Hn,[c("td",null,i(e(t)("title")),1),c("td",null,i(e(m).title),1)])):f("",!0),e(m).description?(s(),r("tr",Wn,[c("td",null,i(e(t)("description")),1),c("td",null,[c("small",null,i(e(m).description),1)])])):f("",!0),e(m).createdAt?(s(),r("tr",qn,[c("td",null,i(e(t)("date")),1),c("td",null,i(e(_e)(e(m).createdAt)),1)])):f("",!0),e(m).additionalMetadata?(s(),r("tr",Xn,[c("td",null,i(e(t)("metadata")),1),c("td",null,[n(de,{striped:"","single-line":"",size:"small"},{default:l(()=>[c("tbody",null,[(s(!0),r(U,null,ee(e(m).additionalMetadata||[],(o,w)=>(s(),r("tr",{key:w},[c("td",null,i(w),1),c("td",null,i(o),1)]))),128))])]),_:1})])])):f("",!0)])]),_:1})):f("",!0)]),_:1},8,["show","title"]),n(H,{show:e(D),"onUpdate:show":a[17]||(a[17]=o=>b(D)?D.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(F)?.name},{default:l(()=>[n(_t,{"cropper-ratio":void 0,"round-preview":!1,src:e(X)?e(X):void 0,onCancel:a[16]||(a[16]=o=>D.value=!1),onSave:Le},null,8,["src"])]),_:1},8,["show","title"])],64)}}});export{dl as default};
