import{t as R,w as S,c as f}from"./vueuse_shared-5de4c6d8.js";import{r as p}from"./vue_reactivity-852d8377.js";import{aK as K,i as L,b as O}from"./vue_runtime-core-4f5fb440.js";import{p as P}from"./p-defer-64bd7c04.js";import{d as k}from"./defu-573334b8.js";import{u as b}from"./unhead_vue-71da354f.js";function c(e,...t){K(`[vue-recaptcha]: ${e}`,...t)}function h(e,t){if(!e)throw c(t),new Error(`Invariant violation: ${t}`)}const y="vue-recaptcha-context";function w(){const e=L(y);if(!e)throw c("You may forget to `use` vue-recaptcha plugin"),new Error("useRecaptcha() is called without provider.");return e}function j(){return w().proxy}function A(){const e=w();return h(e.options.v2SiteKey,"Your config is not compatible with recaptcha v2, please provide v2SiteKey"),e.options.v2SiteKey}function C(e){var t;return h(e.v2SiteKey||e.v3SiteKey,"You didn't pass v2SiteKey or v3SiteKey to plugin, which may be a mistake"),{...e,loaderOptions:{...e.loaderOptions,params:{...(t=e.loaderOptions)==null?void 0:t.params,render:e.v3SiteKey??"explicit"}}}}function E(e){return t=>e(U(t))}function U(e){return{...e,recaptchaApiURL:e.recaptchaApiURL??(e.useRecaptchaNet?"https://www.recaptcha.net/recaptcha/api.js":"https://www.google.com/recaptcha/api.js")}}const l=P(),d="__vueRecaptchaLoaded";typeof window<"u"&&(window[d]=()=>{l.resolve()});function $(e){return new URLSearchParams(H(e)).toString()}function H(e){const t=k(e,{onload:d,render:"explicit"});return t.render==="onload"&&(c("passing `onload` as `render` param is not allowed"),t.render="explicit"),t.onload!==d&&(c("passing `onload` param with other value is not allowed"),t.onload=d),Y(t)}function Y(e){return Object.entries(e).filter(t=>typeof t[1]=="string")}function m(){if(typeof window>"u")return!1;const e=Object.hasOwn(window,"grecaptcha")&&Object.hasOwn(window.grecaptcha,"execute");return e&&l.resolve(),e}function z(e,t){function i(){h(e.value,"ReCAPTCHA is not loaded")}async function a(){await l.promise,e.value=!0}return{async render(r,n){return await a(),t().render(r,n)},reset(r){typeof r>"u"||(i(),t().reset(r))},async execute(r,n){if(!(typeof r>"u"))return await a(),t().execute(r,n)}}}function D(e,{getRecaptcha:t=()=>window.grecaptcha}={}){return{install(i,a){const r=p(!1);async function n(){await l.promise,r.value=!0}n().catch(s=>c("fail to load reCAPTCHA script",s)),m();const o=C(a);i.provide(y,{isReady:r,scriptInjected:!1,proxy:z(r,t),useScriptProvider:e(o.loaderOptions),options:o})}}}const I=E(e=>()=>{b({link:[{key:"vue-recaptcha-google",rel:"preconnect",href:e.useRecaptchaNet?"https://www.recaptcha.net":"https://www.google.com"},{key:"vue-recaptcha-gstatic",rel:"preconnect",href:"https://www.gstatic.com",crossorigin:""}],script:[{key:"vue-recaptcha",src:`${e.recaptchaApiURL}?${$(e.params)}`,async:!0,defer:!0,nonce:e.nonce}]})});function q({root:e=p(),options:t={}}){const i=A(),a=p(),r=j(),n=f(),o=f(),s=f(),v=R(e),u=p("init");return S(v,async g=>{const x=await r.render(g,{...t,sitekey:i,callback:n.trigger,"expired-callback":o.trigger,"error-callback":s.trigger});a.value=x}),n.on(()=>{u.value="verified"}),o.on(()=>{u.value="expired"}),s.on(()=>{u.value="error"}),{root:v,widgetID:a,execute(){typeof a.value<"u"&&r.execute(a.value)},reset(){u.value="init",typeof a.value<"u"&&r.reset(a.value)},state:u,onVerify:n.on,onExpired:o.on,onError:s.on}}function B(){const e=w();e.scriptInjected?c("`useRecaptchaProvider` is used multiple time"):(e.scriptInjected=!0,e.useScriptProvider(),O(()=>{m()}))}const F=D(I);export{B as a,q as b,F as p,w as u};
