import{_ as H}from"./PageLayout.vue_vue_type_script_setup_true_lang-1f1f845c.js";import{y as J,e as K,R as Q,r as M,U as P}from"./index-b7ce0b99.js";import{I as w}from"./iconify_vue-6750bec6.js";import{_ as b}from"./lodash-a9971f22.js";import{d as S,h as i,p as U,o as W,c as X,Y as r,aO as l,F as ee,l as te}from"./vue_runtime-core-4f5fb440.js";import{a as se,b as ae,c as oe,E as I,_ as L,N as h,a4 as ie,Z as re,g as le,a7 as ne,F as pe,j as me,G as ue}from"./naive-ui-1f55be4a.js";import{u as de}from"./vue-i18n-84a05dd5.js";import{r as d,u as s,c as O}from"./vue_reactivity-852d8377.js";import{t as ce}from"./vue_shared-7dcc3b7f.js";import"./vue-router-e670704e.js";import"./browser-image-compression-a3ab6596.js";import"./fawmi_vue-google-maps-52673af8.js";import"./vue_runtime-dom-c0cb2070.js";import"./googlemaps_markerclusterer-b718980f.js";import"./fast-deep-equal-1db9e660.js";import"./axios-96fb5abd.js";import"./process-93c0ea83.js";import"./supercluster-6504d485.js";import"./kdbush-ac640998.js";import"./pinia-5dd13ed8.js";import"./vue-demi-71ba0ef2.js";import"./moment-ea709ccd.js";import"./slugify-ce681755.js";import"./validator-c0254ba9.js";import"./vueuse_core-e3c6c607.js";import"./vueuse_shared-d1f69174.js";import"./parse-domain-418f0a59.js";import"./is-ip-33949ce5.js";import"./ip-regex-e6f9cbd8.js";import"./super-regex-a8a38319.js";import"./function-timeout-8f7724f6.js";import"./clone-regexp-3bc3d90c.js";import"./is-regexp-5fa9e804.js";import"./unhead_vue-71da354f.js";import"./unhead-a4367481.js";import"./hookable-e7fd869b.js";import"./unhead_dom-b5f3dd9b.js";import"./unhead_shared-56c99682.js";import"./ckeditor_ckeditor5-vue-13667b6e.js";import"./vue-83614a91.js";import"./strip-json-comments-680ed425.js";import"./vue-draggable-next-d31a77b2.js";import"./pinia_colada-25af8b56.js";import"./vue-shepherd-6780f0ef.js";import"./shepherd.js-8a3687f6.js";import"./vue-tel-input-40ca5c5d.js";import"./vue3-map-chart-612bd6db.js";import"./crypto-js-eb39eca1.js";import"./pinia-persistence-plugin-50ba422c.js";/* empty css                    *//* empty css               *//* empty css                                      */import"./date-fns-eed65714.js";import"./seemly-5e1e6f41.js";import"./vueuc-b49649f7.js";import"./evtd-b614532e.js";import"./css-render_vue3-ssr-b91bc731.js";import"./vooks-3c892a1c.js";import"./vdirs-b0483831.js";import"./juggle_resize-observer-41516555.js";import"./css-render-9b607bf6.js";import"./emotion_hash-8a8e73f6.js";import"./lodash-es-a215867d.js";import"./treemate-25c27bff.js";import"./date-fns-tz-6c300683.js";import"./async-validator-dc9a4891.js";import"./css-render_plugin-bem-9dde7ffe.js";import"./intlify_shared-f7876323.js";import"./intlify_core-base-c423e336.js";import"./intlify_message-compiler-48af4dac.js";const fe=S({name:Q.ROLES_MANAGEMENT.NAME}),zt=S({...fe,setup(_e){const g=se(),m=ae(),q=oe(),u=J(),{request:N}=K(),{t:e,locale:A}=de(),f=d(""),k=d(),x=d(!1),$={pageSize:12},T=[{title:e("name"),key:"displayName",resizable:!0,width:150,ellipsis:{tooltip:!0},fixed:"left",sortOrder:!1,sorter:"default"},{title:e("description"),key:"description",resizable:!0,width:250,ellipsis:{tooltip:!0}},{title:e("permissionList"),key:"permissions",resizable:!0,width:300,render(a){return i("div",{},{default:()=>{var n;return(n=a.permissions)==null?void 0:n.map(R=>i(re,{class:"mx-1 my-1",size:"small",type:"info",round:!1,strong:!0,bordered:!1},{default:()=>R.displayName}))}})},sortOrder:!1,sorter:"default"},{title:e("lastEdition"),key:"updatedAt",width:150,render(a){return i("div",{},{default:()=>M(a.updatedAt,{locale:A.value})})}},{title:e("creation"),key:"createdAt",width:150,render(a){return i("div",{},{default:()=>M(a.createdAt,{locale:A.value})})}},{title:()=>i(I,{ref:k,placeholder:e("search"),value:f.value,onInput:a=>{f.value=a}},{suffix:()=>i(h,{},{default:()=>i(w,{icon:"carbon:search"})})}),key:"actions",width:180,render(a){return i("div",{class:"flex justify-end items-center w-full"},[i(L,{size:"small",type:"warning",onClick:()=>{z(a)},renderIcon:()=>i(h,null,{default:()=>i(w,{icon:"carbon:edit"})})},{default:()=>e("edit")}),i("div",{class:"w-2"}),i(L,{size:"small",type:"error",onClick:()=>{q.warning({title:e("confirm"),content:e("confirmDeleteRole"),positiveText:e("yes"),negativeText:e("no"),onPositiveClick:async()=>{(await N({url:`/roles/${a.id}`,method:"delete"})).success?m.success(e("success")):m.error(e("anErrorOccurred")),y()}})},renderIcon:()=>i(h,null,{default:()=>i(w,{icon:"carbon:trash-can"})})})])},fixed:"right"}],B=U(()=>{if(!f.value)return u.roles.filter(t=>t.name!==P.SUPER_ADMIN);const a=u.roles.filter(t=>t.name!==P.SUPER_ADMIN&&(t.name.toLowerCase().includes(f.value.toLowerCase())||t.displayName.toLowerCase().includes(f.value.toLowerCase())||t.description.toLowerCase().includes(f.value.toLowerCase())));return k.value&&k.value.focus(),a}),y=async()=>{x.value=!0,await u.loadRoles(),await u.loadPermissions(),x.value=!1};y();const _=d(!1),c=d(!1),v=d(null),D=d(null),o=d({name:"",displayName:"",description:"",permissions:[]}),F={name:[{required:!0,message:e("fillRequired")}],displayName:[{required:!0,message:e("fillRequired")}]},z=a=>{v.value=b.cloneDeep(a),a?o.value=b.cloneDeep(a):o.value={name:"",displayName:"",description:"",permissions:[]},c.value=!0},V=async()=>{var a;return(a=D.value)==null||a.validate(async t=>{t||(v.value?v.value.name!==o.value.name&&u.roles.findIndex(n=>n.name==o.value.name)>-1?m.error(e("sameRoleNameMessage")):(g.start(),_.value=!0,(await N({url:`/roles/${v.value.id}`,method:"put",data:{displayName:o.value.displayName,description:o.value.description,permissions:o.value.permissions}})).success?m.success(e("success")):m.error(e("anErrorOccurred")),_.value=!1,g.finish(),y(),c.value=!1):u.roles.findIndex(n=>n.name==b.kebabCase(o.value.displayName))>-1?m.error(e("sameRoleNameMessage")):(g.start(),_.value=!0,(await N({url:"/roles",method:"post",data:{name:b.kebabCase(o.value.displayName),displayName:o.value.displayName,description:o.value.description,permissions:o.value.permissions}})).success?m.success(e("success")):m.error(e("anErrorOccurred")),_.value=!1,g.finish(),y(),c.value=!1))}),!1},C=U({get(){var a;try{return(a=o.value.permissions)==null?void 0:a.map(t=>t.name)}catch{return[]}},set(a){o.value.permissions=u.permissions.filter(t=>a.includes(t.name))}});return(a,t)=>{const n=le,R=ne,j=H,E=pe,G=me,Y=ue,Z=ie;return W(),X(ee,null,[r(j,null,{"header-extra":l(()=>[r(n,null,{default:l(()=>[r(s(L),{type:"primary",onClick:t[0]||(t[0]=p=>z(null))},{icon:l(()=>[r(s(h),{size:"18"},{default:l(()=>[r(s(w),{icon:"carbon:add-alt"})]),_:1})]),default:l(()=>[te(" "+ce(s(e)("add")),1)]),_:1})]),_:1})]),default:l(()=>[r(R,{columns:T,data:s(B),pagination:$,loading:s(x),"single-line":!1,"scroll-x":1200,striped:""},null,8,["data","loading"])]),_:1}),r(Z,{show:s(c),"onUpdate:show":t[4]||(t[4]=p=>O(c)?c.value=p:null),loading:s(_),preset:"dialog",style:{width:"500px"},bordered:!1,"show-icon":!1,"mask-closable":!1,title:s(v)?s(e)("edit"):s(e)("add"),"positive-text":s(e)("validate"),"negative-text":s(e)("cancel"),onPositiveClick:V,onNegativeClick:t[5]||(t[5]=p=>c.value=!1)},{default:l(()=>[r(Y,{ref_key:"formRef",ref:D,model:s(o),rules:F,"show-require-mark":!1,size:"medium"},{default:l(()=>[r(E,{label:s(e)("name"),path:"displayName"},{default:l(()=>[r(s(I),{value:s(o).displayName,"onUpdate:value":t[1]||(t[1]=p=>s(o).displayName=p),placeholder:s(e)("name"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),r(E,{label:s(e)("description"),path:"description"},{default:l(()=>[r(s(I),{value:s(o).description,"onUpdate:value":t[2]||(t[2]=p=>s(o).description=p),placeholder:s(e)("description"),type:"textarea",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),r(E,{label:s(e)("permissionList"),path:"permissions"},{default:l(()=>[r(G,{value:s(C),"onUpdate:value":t[3]||(t[3]=p=>O(C)?C.value=p:null),options:s(u).permissions,placeholder:s(e)("permissionList"),"max-tag-count":4,placement:"bottom",filterable:"",multiple:"","value-field":"name","label-field":"displayName",class:"w-full"},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show","loading","title","positive-text","negative-text"])],64)}}});export{zt as default};
