import{P as y,C as S}from"./ckeditor_ckeditor5-core-Cqajz_gD.js";import{W as Ut,a as Le,c as st,i as zt,t as jt}from"./ckeditor_ckeditor5-widget-l7jZmFCq.js";import{h as rt,f as Ae,a1 as $t,C as Ne,K as se,_ as re,R as We}from"./ckeditor_ckeditor5-utils-Bp8opE8z.js";import{a0 as Fe,a1 as Kt,a2 as Gt,a3 as qt,B as Jt,a4 as Xt,a5 as Yt,a6 as at,a7 as ct,a8 as Zt,a9 as Qt,aa as eo,d as to,b as oo,c as no,a as lo,G as io,I as so,H as ro}from"./ckeditor_ckeditor5-icons-BkOmZeoU.js";import{c as J,M as ao,q as co,f as Re,B as k,H as Q,t as ee,u as te,J as dt,S as uo,V as W,Y as ho,U as ut,m as Ve,o as ke,F as ht,O as A,s as mt,Z as I,L as R,X as bt,r as N,T as be,K as L,_ as mo,w as bo}from"./ckeditor_ckeditor5-ui-wSLROq0V.js";import{b as he,C as De}from"./ckeditor_ckeditor5-clipboard-3CV4NNCs.js";import{f as go,k as fo,o as gt,j as ft,p as po,D as wo,q as Co,i as pt,h as To}from"./ckeditor_ckeditor5-engine-CS7i4Bo_.js";import{l as wt,d as yo}from"./es-toolkit-RjqxEpf9.js";/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function xe(i,e){const{modelAttribute:t,styleName:o,attributeName:n,attributeType:l,viewElement:s,defaultValue:r,shouldUpcast:a=()=>!0,reduceBoxSides:c=!1}=e;i.for("upcast").attributeToAttribute({view:{name:s,styles:{[o]:/[\s\S]+/}},model:{key:t,value:(d,u,h)=>{if(!a(d))return;const b=V(r,"",h),m=d.getNormalizedStyle(o),g=c?Y(m):m;if(b!==g)return g;u.consumable.consume(d,{styles:o})}}}),n&&i.for("upcast").attributeToAttribute({view:{name:s,attributes:{[n]:/.+/}},model:{key:t,value:(d,u,h)=>{if(d.name=="figure"||d.hasStyle(o)||d.name=="table"&&d.parent.name=="figure"&&d.parent.hasStyle(o))return;const b=V(r,"",h);let m=d.getAttribute(n);if(m&&l=="length"&&!m.endsWith("px")&&(m+="px"),b!==m)return m;u.consumable.consume(d,{attributes:n})}}})}function ge(i,e,t,o){i.for("upcast").add(n=>n.on("element:"+e,(l,s,r)=>{if(!s.modelRange)return;const a=["border-top-width","border-top-color","border-top-style","border-bottom-width","border-bottom-color","border-bottom-style","border-right-width","border-right-color","border-right-style","border-left-width","border-left-color","border-left-style"].filter(g=>s.viewItem.hasStyle(g));if(!a.length)return;const c={styles:a};if(!r.consumable.test(s.viewItem,c))return;const d=[...s.modelRange.getItems({shallow:!0})].pop(),u=d.findAncestor("table",{includeSelf:!0});let h=o;u&&u.getAttribute("tableType")=="layout"&&(h={style:"none",color:"",width:""}),r.consumable.consume(s.viewItem,c);const b={style:s.viewItem.getNormalizedStyle("border-style"),color:s.viewItem.getNormalizedStyle("border-color"),width:s.viewItem.getNormalizedStyle("border-width")},m={style:Y(b.style),color:Y(b.color),width:Y(b.width)};m.style!==h.style&&r.writer.setAttribute(t.style,m.style,d),m.color!==h.color&&r.writer.setAttribute(t.color,m.color,d),m.width!==h.width&&r.writer.setAttribute(t.width,m.width,d)}))}function U(i,e){const{modelElement:t,modelAttribute:o,styleName:n}=e;i.for("downcast").attributeToAttribute({model:{name:t,key:o},view:l=>({key:"style",value:{[n]:l}})})}function X(i,e){const{modelAttribute:t,styleName:o}=e;i.for("downcast").add(n=>n.on(`attribute:${t}:table`,(l,s,r)=>{const{item:a,attributeNewValue:c}=s,{mapper:d,writer:u}=r;if(!r.consumable.consume(s.item,l.name))return;const h=[...d.toViewElement(a).getChildren()].find(b=>b.is("element","table"));c?u.setStyle(o,c,h):u.removeStyle(o,h)}))}function V(i,e,t){const o=t.modelRange&&Ae(t.modelRange.getItems({shallow:!0})),n=o&&o.is("element")&&o.findAncestor("table",{includeSelf:!0});return n&&n.getAttribute("tableType")==="layout"?e:i}function Y(i){if(!i)return;const e=["top","right","bottom","left"];if(!e.every(l=>i[l]))return i;const o=i.top;return e.every(l=>i[l]===o)?o:i}function T(i,e,t,o,n=1){e!=null&&n!==void 0&&n!==null&&e>n?o.setAttribute(i,e,t):o.removeAttribute(i,t)}function F(i,e,t={}){const o=i.createElement("tableCell",t);return i.insertElement("paragraph",o),i.insert(o,e),o}function fe(i,e){const t=e.parent.parent,o=parseInt(t.getAttribute("headingColumns")||"0"),{column:n}=i.getCellLocation(e);return!!o&&n<o}function Z(i,e,t){const{modelAttribute:o}=t;i.extend("tableCell",{allowAttributes:[o]}),i.setAttributeProperties(o,{isFormatting:!0}),xe(e,{viewElement:/^(td|th)$/,...t}),U(e,{modelElement:"tableCell",...t})}function P(i){const e=i.getSelectedElement();return e&&e.is("element","table")?e:i.getFirstPosition().findAncestor("table")}function _o(){return i=>{i.on("element:figure",(e,t,o)=>{if(!o.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const n=Ao(t.viewItem);if(!n||!o.consumable.test(n,{name:!0}))return;o.consumable.consume(t.viewItem,{name:!0,classes:"table"});const l=o.convertItem(n,t.modelCursor),s=Ae(l.modelRange.getItems());if(!s){o.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}o.convertChildren(t.viewItem,o.writer.createPositionAt(s,"end")),o.updateConversionResult(s,t)})}}function vo(){return i=>{i.on("element:table",(e,t,o)=>{const n=t.viewItem;if(!o.consumable.test(n,{name:!0}))return;const{rows:l,headingRows:s,headingColumns:r}=Ro(n),a={};r&&(a.headingColumns=r),s&&(a.headingRows=s);const c=o.writer.createElement("table",a);if(o.safeInsert(c,t.modelCursor)){if(o.consumable.consume(n,{name:!0}),l.forEach(d=>o.convertItem(d,o.writer.createPositionAt(c,"end"))),o.convertChildren(n,o.writer.createPositionAt(c,"end")),c.isEmpty){const d=o.writer.createElement("tableRow");o.writer.insert(d,o.writer.createPositionAt(c,"end")),F(o.writer,o.writer.createPositionAt(d,"end"))}o.updateConversionResult(c,t)}})}}function So(){return i=>{i.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&e.stop()},{priority:"high"})}}function Oe(i){return e=>{e.on(`element:${i}`,(t,o,{writer:n})=>{if(!o.modelRange)return;const l=o.modelRange.start.nodeAfter,s=n.createPositionAt(l,0);if(o.viewItem.isEmpty){n.insertElement("paragraph",s);return}const r=Array.from(l.getChildren());if(r.every(a=>a.is("element","$marker"))){const a=n.createElement("paragraph");n.insert(a,n.createPositionAt(l,0));for(const c of r)n.move(n.createRangeOn(c),n.createPositionAt(a,"end"))}},{priority:"low"})}}function Ao(i){for(const e of i.getChildren())if(e.is("element","table"))return e}function Ro(i){let e=0,t;const o=[],n=[];let l;for(const s of Array.from(i.getChildren())){if(s.name!=="tbody"&&s.name!=="thead"&&s.name!=="tfoot")continue;s.name==="thead"&&!l&&(l=s);const r=Array.from(s.getChildren()).filter(c=>c.is("element","tr"));let a=null;for(const c of r){const d=Array.from(c.getChildren()).filter(u=>u.is("element","td")||u.is("element","th"));if(l&&s===l||s.name==="tbody"&&d.length>0&&(a===null||d.length===a)&&d.every(u=>u.is("element","th")))e++,o.push(c);else{n.push(c);const u=Vo(c);(!t||u<t)&&(t=u)}a=Math.max(a||0,d.length)}}return{headingRows:e,headingColumns:t||0,rows:[...o,...n]}}function Vo(i){let e=0,t=0;const o=Array.from(i.getChildren()).filter(n=>n.name==="th"||n.name==="td");for(;t<o.length&&o[t].name==="th";){const n=o[t],l=parseInt(n.getAttribute("colspan")||"1");e=e+l,t++}return e}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class C{_table;_startRow;_endRow;_startColumn;_endColumn;_includeAllSlots;_skipRows;_row;_rowIndex;_column;_cellIndex;_spannedCells;_nextCellAtColumn;_jumpedToStartRow=!1;constructor(e,t={}){this._table=e,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0,value:void 0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const o=this._getSpanned();if(o)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(o.cell,o.row,o.column));else{const n=e.getChild(this._cellIndex);if(!n)return this._advanceToNextRow();const l=parseInt(n.getAttribute("colspan")||"1"),s=parseInt(n.getAttribute("rowspan")||"1");(l>1||s>1)&&this._recordSpans(n,s,l),this._shouldSkipSlot()||(t=this._formatOutValue(n)),this._nextCellAtColumn=this._column+l}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(e,t=this._row,o=this._column){return{done:!1,value:new ko(this,e,t,o)}}_shouldSkipSlot(){const e=this._skipRows.has(this._row),t=this._row<this._startRow,o=this._column<this._startColumn,n=this._endColumn!==void 0&&this._column>this._endColumn;return e||t||o||n}_getSpanned(){const e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,o){const n={cell:e,row:this._row,column:this._column};for(let l=this._row;l<this._row+t;l++)for(let s=this._column;s<this._column+o;s++)(l!=this._row||s!=this._column)&&this._markSpannedCell(l,s,n)}_markSpannedCell(e,t,o){this._spannedCells.has(e)||this._spannedCells.set(e,new Map),this._spannedCells.get(e).set(t,o)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const e=this._getRowLength(0);for(let t=this._startRow;!this._jumpedToStartRow;t--)e===this._getRowLength(t)&&(this._row=t,this._rowIndex=t,this._jumpedToStartRow=!0)}_getRowLength(e){return[...this._table.getChild(e).getChildren()].reduce((o,n)=>o+parseInt(n.getAttribute("colspan")||"1"),0)}}class ko{cell;row;column;cellAnchorRow;cellAnchorColumn;_cellIndex;_rowIndex;_table;constructor(e,t,o,n){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=o,this.cellAnchorColumn=n,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}function He(i,e){return(t,{writer:o})=>{const n=t.getAttribute("headingRows")||0,l=o.createContainerElement("table",null,[]),s=o.createContainerElement("figure",{class:"table"},l);n>0&&o.insert(o.createPositionAt(l,"end"),o.createContainerElement("thead",null,o.createSlot(r=>r.is("element","tableRow")&&r.index<n))),n<i.getRows(t)&&o.insert(o.createPositionAt(l,"end"),o.createContainerElement("tbody",null,o.createSlot(r=>r.is("element","tableRow")&&r.index>=n)));for(const{positionOffset:r,filter:a}of e.additionalSlots)o.insert(o.createPositionAt(l,r),o.createSlot(a));return o.insert(o.createPositionAt(l,"after"),o.createSlot(r=>r.is("element","tableRow")?!1:!e.additionalSlots.some(({filter:a})=>a(r)))),e.asWidget?Io(s,o):s}}function xo(){return(i,{writer:e})=>i.isEmpty?e.createEmptyElement("tr"):e.createContainerElement("tr")}function Me(i={}){return(e,{writer:t})=>{const o=e.parent,n=o.parent,l=n.getChildIndex(o),s=new C(n,{row:l}),r=n.getAttribute("headingRows")||0,a=n.getAttribute("headingColumns")||0;let c=null;for(const d of s)if(d.cell==e){const h=d.row<r||d.column<a?"th":"td";c=i.asWidget?st(t.createEditableElement(h),t,{withAriaRole:!1}):t.createContainerElement(h);break}return c}}function Ue(i={}){return(e,{writer:t})=>{if(!e.parent.is("element","tableCell")||!Ct(e))return null;if(i.asWidget)return t.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const o=t.createContainerElement("p");return t.setCustomProperty("dataPipeline:transparentRendering",!0,o),o}}}function Ct(i){return i.parent.childCount==1&&!Po(i)}function Io(i,e){return e.setCustomProperty("table",!0,i),jt(i,e,{hasSelectionHandle:!0})}function Po(i){for(const e of i.getAttributeKeys())if(!(e.startsWith("selection:")||e=="htmlEmptyBlock"))return!0;return!1}class Eo extends S{refresh(){const e=this.editor.model,t=e.document.selection,o=e.schema;this.isEnabled=Bo(t,o)}execute(e={}){const t=this.editor,o=t.model,n=t.plugins.get("TableUtils"),l=t.config.get("table.defaultHeadings.rows"),s=t.config.get("table.defaultHeadings.columns");e.headingRows===void 0&&l&&(e.headingRows=l),e.headingColumns===void 0&&s&&(e.headingColumns=s),o.change(r=>{const a=n.createTable(r,e);o.insertObject(a,null,null,{findOptimalPosition:"auto"}),r.setSelection(r.createPositionAt(a.getNodeByPath([0,0,0]),0))})}}function Bo(i,e){const t=i.getFirstPosition().parent,o=t===t.root?t:t.parent;return e.checkChild(o,"table")}class ze extends S{order;constructor(e,t={}){super(e),this.order=t.order||"below"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),n=this.order==="above",l=o.getSelectionAffectedTableCells(t),s=o.getRowIndexes(l),r=n?s.first:s.last,a=l[0].findAncestor("table");o.insertRows(a,{at:n?r:r+1,copyStructureFromAbove:!n})}}class je extends S{order;constructor(e,t={}){super(e),this.order=t.order||"right"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),n=this.order==="left",l=o.getSelectionAffectedTableCells(t),s=o.getColumnIndexes(l),r=n?s.first:s.last,a=l[0].findAncestor("table");o.insertColumns(a,{columns:1,at:n?r:r+1})}}class $e extends S{direction;constructor(e,t={}){super(e),this.direction=t.direction||"horizontally"}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length===1}execute(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?e.splitCellHorizontally(t,2):e.splitCellVertically(t,2)}}function Tt(i,e,t){const{startRow:o,startColumn:n,endRow:l,endColumn:s}=e,r=t.createElement("table"),a=i.getAttribute("tableType");a&&t.setAttribute("tableType",a,r);const c=l-o+1;for(let u=0;u<c;u++)t.insertElement("tableRow",r,"end");const d=[...new C(i,{startRow:o,endRow:l,startColumn:n,endColumn:s,includeAllSlots:!0})];for(const{row:u,column:h,cell:b,isAnchor:m,cellAnchorRow:g,cellAnchorColumn:f}of d){const p=u-o,w=r.getChild(p);if(!m)(g<o||f<n)&&F(t,t.createPositionAt(w,"end"));else{const v=t.cloneElement(b);t.append(v,w),At(v,u,h,l,s,t)}}return Lo(r,i,o,n,t),r}function yt(i,e,t=0){const o=[],n=new C(i,{startRow:t,endRow:e-1});for(const l of n){const{row:s,cellHeight:r}=l,a=s+r-1;s<e&&e<=a&&o.push(l)}return o}function _t(i,e,t){const o=i.parent,n=o.parent,l=o.index,s=parseInt(i.getAttribute("rowspan")),r=e-l,a={},c=s-r;c>1&&(a.rowspan=c);const d=parseInt(i.getAttribute("colspan")||"1");d>1&&(a.colspan=d);const u=l,h=u+r,b=[...new C(n,{startRow:u,endRow:h,includeAllSlots:!0})];let m=null,g;for(const f of b){const{row:p,column:w,cell:v}=f;v===i&&g===void 0&&(g=w),g!==void 0&&g===w&&p===h&&(m=F(t,f.getPositionBefore(),a))}return T("rowspan",r,i,t),m}function vt(i,e){const t=[],o=new C(i);for(const n of o){const{column:l,cellWidth:s}=n,r=l+s-1;l<e&&e<=r&&t.push(n)}return t}function St(i,e,t,o){const n=parseInt(i.getAttribute("colspan")),l=t-e,s={},r=n-l;r>1&&(s.colspan=r);const a=parseInt(i.getAttribute("rowspan")||"1");a>1&&(s.rowspan=a);const c=F(o,o.createPositionAfter(i),s);return T("colspan",l,i,o),c}function At(i,e,t,o,n,l){const s=parseInt(i.getAttribute("colspan")||"1"),r=parseInt(i.getAttribute("rowspan")||"1");if(t+s-1>n){const d=n-t+1;T("colspan",d,i,l,1)}if(e+r-1>o){const d=o-e+1;T("rowspan",d,i,l,1)}}function Lo(i,e,t,o,n){const l=parseInt(e.getAttribute("headingRows")||"0");if(l>0){const r=l-t;T("headingRows",r,i,n,0)}const s=parseInt(e.getAttribute("headingColumns")||"0");if(s>0){const r=s-o;T("headingColumns",r,i,n,0)}}function pe(i,e){const t=e.getColumns(i),o=new Array(t).fill(0);for(const{column:l}of new C(i))o[l]++;const n=o.reduce((l,s,r)=>s?l:[...l,r],[]);if(n.length>0){const l=n[n.length-1];return e.removeColumns(i,{at:l}),!0}return!1}function we(i,e){const t=[],o=e.getRows(i);for(let n=0;n<o;n++)i.getChild(n).isEmpty&&t.push(n);if(t.length>0){const n=t[t.length-1];return e.removeRows(i,{at:n}),!0}return!1}function Ie(i,e){pe(i,e)||we(i,e)}function Rt(i,e){const t=Array.from(new C(i,{startColumn:e.firstColumn,endColumn:e.lastColumn,row:e.lastRow}));if(t.every(({cellHeight:l})=>l===1))return e.lastRow;const n=t[0].cellHeight-1;return e.lastRow+n}function Vt(i,e){const t=Array.from(new C(i,{startRow:e.firstRow,endRow:e.lastRow,column:e.lastColumn}));if(t.every(({cellWidth:l})=>l===1))return e.lastColumn;const n=t[0].cellWidth-1;return e.lastColumn+n}class K extends S{direction;isHorizontal;constructor(e,t){super(e),this.direction=t.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,t=e.document,n=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(t.selection)[0],l=this.value,s=this.direction;e.change(r=>{const a=s=="right"||s=="down",c=a?n:l,d=a?l:n,u=d.parent;Fo(d,c,r);const h=this.isHorizontal?"colspan":"rowspan",b=parseInt(n.getAttribute(h)||"1"),m=parseInt(l.getAttribute(h)||"1");r.setAttribute(h,b+m,c),r.setSelection(r.createRangeIn(c));const g=this.editor.plugins.get("TableUtils"),f=u.findAncestor("table");Ie(f,g)})}_getMergeableCell(){const t=this.editor.model.document,o=this.editor.plugins.get("TableUtils"),n=o.getTableCellsContainingSelection(t.selection)[0];if(!n)return;const l=this.isHorizontal?No(n,this.direction,o):Wo(n,this.direction,o);if(!l)return;const s=this.isHorizontal?"rowspan":"colspan",r=parseInt(n.getAttribute(s)||"1");if(parseInt(l.getAttribute(s)||"1")===r)return l}}function No(i,e,t){const n=i.parent.parent,l=e=="right"?i.nextSibling:i.previousSibling,s=(n.getAttribute("headingColumns")||0)>0;if(!l)return;const r=e=="right"?i:l,a=e=="right"?l:i,{column:c}=t.getCellLocation(r),{column:d}=t.getCellLocation(a),u=parseInt(r.getAttribute("colspan")||"1"),h=fe(t,r),b=fe(t,a);return s&&h!=b?void 0:c+u===d?l:void 0}function Wo(i,e,t){const o=i.parent,n=o.parent,l=n.getChildIndex(o);if(e=="down"&&l===t.getRows(n)-1||e=="up"&&l===0)return null;const s=parseInt(i.getAttribute("rowspan")||"1"),r=n.getAttribute("headingRows")||0,a=e=="down"&&l+s===r,c=e=="up"&&l===r;if(r&&(a||c))return null;const d=parseInt(i.getAttribute("rowspan")||"1"),u=e=="down"?l+d:l,h=[...new C(n,{endRow:u})],m=h.find(f=>f.cell===i).column,g=h.find(({row:f,cellHeight:p,column:w})=>w!==m?!1:e=="down"?f===u:u===f+p);return g&&g.cell?g.cell:null}function Fo(i,e,t){Ke(i)||(Ke(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function Ke(i){const e=i.getChild(0);return i.childCount==1&&e.is("element","paragraph")&&e.isEmpty}class Do extends S{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const n=o.findAncestor("table"),s=e.getRows(n)-1,r=e.getRowIndexes(t),a=r.first===0&&r.last===s;this.isEnabled=!a}else this.isEnabled=!1}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(o),l=o[0],s=l.findAncestor("table"),r=t.getCellLocation(l).column;e.change(a=>{const c=n.last-n.first+1;t.removeRows(s,{at:n.first,rows:c});const d=Oo(s,n.first,r,t.getRows(s));a.setSelection(a.createPositionAt(d,0))})}}function Oo(i,e,t,o){const n=i.getChild(Math.min(e,o-1));let l=n.getChild(0),s=0;for(const r of n.getChildren()){if(s>t)return l;l=r,s+=parseInt(r.getAttribute("colspan")||"1")}return l}class Ho extends S{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const n=o.findAncestor("table"),l=e.getColumns(n),{first:s,last:r}=e.getColumnIndexes(t);this.isEnabled=r-s<l-1}else this.isEnabled=!1}execute(){const e=this.editor.plugins.get("TableUtils"),[t,o]=Uo(this.editor.model.document.selection,e),n=t.parent.parent,l=[...new C(n)],s={first:l.find(a=>a.cell===t).column,last:l.find(a=>a.cell===o).column},r=Mo(l,t,o,s);this.editor.model.change(a=>{const c=s.last-s.first+1;e.removeColumns(n,{at:s.first,columns:c}),a.setSelection(a.createPositionAt(r,0))})}}function Mo(i,e,t,o){return parseInt(t.getAttribute("colspan")||"1")>1?t:e.previousSibling||t.nextSibling?t.nextSibling||e.previousSibling:o.first?i.reverse().find(({column:l})=>l<o.first).cell:i.reverse().find(({column:l})=>l>o.last).cell}function Uo(i,e){const t=e.getSelectionAffectedTableCells(i),o=t[0],n=t.pop(),l=[o,n];return o.isBefore(n)?l:l.reverse()}class zo extends S{refresh(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection);if(o.length===0){this.isEnabled=!1,this.value=!1;return}const n=o[0].findAncestor("table");this.isEnabled=t.schema.checkAttribute(n,"headingRows"),this.value=o.every(l=>this._isInHeading(l,l.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,n=t.getSelectionAffectedTableCells(o.document.selection),l=n[0].findAncestor("table"),{first:s,last:r}=t.getRowIndexes(n),a=this.value?s:r+1,c=l.getAttribute("headingRows")||0;o.change(d=>{if(a){const u=a>c?c:0,h=yt(l,a,u);for(const{cell:b}of h)_t(b,a,d)}T("headingRows",a,l,d,0)})}_isInHeading(e,t){const o=parseInt(t.getAttribute("headingRows")||"0");return!!o&&e.parent.index<o}}class jo extends S{refresh(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection);if(o.length===0){this.isEnabled=!1,this.value=!1;return}const n=o[0].findAncestor("table");this.isEnabled=t.schema.checkAttribute(n,"headingColumns"),this.value=o.every(l=>fe(e,l))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,n=t.getSelectionAffectedTableCells(o.document.selection),l=n[0].findAncestor("table"),{first:s,last:r}=t.getColumnIndexes(n),a=this.value?s:r+1;o.change(c=>{if(a){const d=vt(l,a);for(const{cell:u,column:h}of d)St(u,h,a,c)}T("headingColumns",a,l,c,0)})}}function $o(i){if(i.is("element","tableColumnGroup"))return i;const e=i.getChildren();return Array.from(e).find(t=>t.is("element","tableColumnGroup"))}function Ko(i){const e=$o(i);return e?Array.from(e.getChildren()):[]}class _ extends y{static get pluginName(){return"TableUtils"}static get isOfficialPlugin(){return!0}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){const t=e.parent,o=t.parent,n=o.getChildIndex(t),l=new C(o,{row:n});for(const{cell:s,row:r,column:a}of l)if(s===e)return{row:r,column:a};/* istanbul ignore next -- @preserve */}createTable(e,t){const o=e.createElement("table"),n=t.rows||2,l=t.columns||2;return me(e,o,0,n,l),t.headingRows&&T("headingRows",Math.min(t.headingRows,n),o,e,0),t.headingColumns&&T("headingColumns",Math.min(t.headingColumns,l),o,e,0),o}insertRows(e,t={}){const o=this.editor.model,n=t.at||0,l=t.rows||1,s=t.copyStructureFromAbove!==void 0,r=t.copyStructureFromAbove?n-1:n,a=this.getRows(e),c=this.getColumns(e);if(n>a)throw new Ne("tableutils-insertrows-insert-out-of-range",this,{options:t});o.change(d=>{const u=e.getAttribute("headingRows")||0;if(u>n&&T("headingRows",u+l,e,d,0),!s&&(n===0||n===a)){me(d,e,n,l,c);return}const h=s?Math.max(n,r):n,b=new C(e,{endRow:h}),m=new Array(c).fill(1);for(const{row:g,column:f,cellHeight:p,cellWidth:w,cell:v}of b){const B=g+p-1,j=g<n&&n<=B,ue=g<=r&&r<=B;j?(d.setAttribute("rowspan",p+l,v),m[f]=-w):s&&ue&&(m[f]=w)}for(let g=0;g<l;g++){const f=d.createElement("tableRow");d.insert(f,e,n);for(let p=0;p<m.length;p++){const w=m[p],v=d.createPositionAt(f,"end");w>0&&F(d,v,w>1?{colspan:w}:void 0),p+=Math.abs(w)-1}}})}insertColumns(e,t={}){const o=this.editor.model,n=t.at||0,l=t.columns||1;o.change(s=>{const r=e.getAttribute("headingColumns");n<r&&s.setAttribute("headingColumns",r+l,e);const a=this.getColumns(e);if(n===0||a===n){for(const d of e.getChildren())d.is("element","tableRow")&&M(l,s,s.createPositionAt(d,n?"end":0));return}const c=new C(e,{column:n,includeAllSlots:!0});for(const d of c){const{row:u,cell:h,cellAnchorColumn:b,cellAnchorRow:m,cellWidth:g,cellHeight:f}=d;if(b<n){s.setAttribute("colspan",g+l,h);const p=m+f-1;for(let w=u;w<=p;w++)c.skipRow(w)}else M(l,s,d.getPositionBefore())}})}removeRows(e,t){const o=this.editor.model,n=t.rows||1,l=this.getRows(e),s=t.at,r=s+n-1;if(r>l-1)throw new Ne("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});o.change(a=>{const c={first:s,last:r},{cellsToMove:d,cellsToTrim:u}=Jo(e,c);if(d.size){const h=r+1;Xo(e,h,d,a)}for(let h=r;h>=s;h--)a.remove(e.getChild(h));for(const{rowspan:h,cell:b}of u)T("rowspan",h,b,a);qo(e,c,a),pe(e,this)||we(e,this)})}removeColumns(e,t){const o=this.editor.model,n=t.at,l=t.columns||1,s=t.at+l-1;o.change(r=>{Go(e,{first:n,last:s},r);const a=Ko(e);for(let c=s;c>=n;c--){for(const{cell:d,column:u,cellWidth:h}of[...new C(e)])u<=c&&h>1&&u+h>c?T("colspan",h-1,d,r):u===c&&r.remove(d);if(a[c]){const d=c===0?a[1]:a[c-1],u=parseFloat(a[c].getAttribute("columnWidth")),h=parseFloat(d.getAttribute("columnWidth"));r.remove(a[c]),r.setAttribute("columnWidth",u+h+"%",d)}}we(e,this)||pe(e,this)})}splitCellVertically(e,t=2){const o=this.editor.model,l=e.parent.parent,s=parseInt(e.getAttribute("rowspan")||"1"),r=parseInt(e.getAttribute("colspan")||"1");o.change(a=>{if(r>1){const{newCellsSpan:c,updatedSpan:d}=Ge(r,t);T("colspan",d,e,a);const u={};c>1&&(u.colspan=c),s>1&&(u.rowspan=s);const h=r>t?t-1:r-1;M(h,a,a.createPositionAfter(e),u)}if(r<t){const c=t-r,d=[...new C(l)],{column:u}=d.find(({cell:g})=>g===e),h=d.filter(({cell:g,cellWidth:f,column:p})=>{const w=g!==e&&p===u,v=p<u&&p+f>u;return w||v});for(const{cell:g,cellWidth:f}of h)a.setAttribute("colspan",f+c,g);const b={};s>1&&(b.rowspan=s),M(c,a,a.createPositionAfter(e),b);const m=l.getAttribute("headingColumns")||0;m>u&&T("headingColumns",m+c,l,a)}})}splitCellHorizontally(e,t=2){const o=this.editor.model,n=e.parent,l=n.parent,s=l.getChildIndex(n),r=parseInt(e.getAttribute("rowspan")||"1"),a=parseInt(e.getAttribute("colspan")||"1");o.change(c=>{if(r>1){const d=[...new C(l,{startRow:s,endRow:s+r-1,includeAllSlots:!0})],{newCellsSpan:u,updatedSpan:h}=Ge(r,t);T("rowspan",h,e,c);const{column:b}=d.find(({cell:f})=>f===e),m={};u>1&&(m.rowspan=u),a>1&&(m.colspan=a);let g=0;for(const f of d){const{column:p,row:w}=f,v=w>=s+h,B=p===b;g>=u&&B&&(g=0),v&&B&&(g||M(1,c,f.getPositionBefore(),m),g++)}}if(r<t){const d=t-r,u=[...new C(l,{startRow:0,endRow:s})];for(const{cell:m,cellHeight:g,row:f}of u)if(m!==e&&f+g>s){const p=g+d;c.setAttribute("rowspan",p,m)}const h={};a>1&&(h.colspan=a),me(c,l,s+1,d,1,h);const b=l.getAttribute("headingRows")||0;b>s&&T("headingRows",b+d,l,c)}})}getColumns(e){return[...e.getChild(0).getChildren()].filter(o=>o.is("element","tableCell")).reduce((o,n)=>{const l=parseInt(n.getAttribute("colspan")||"1");return o+l},0)}getRows(e){return Array.from(e.getChildren()).reduce((t,o)=>o.is("element","tableRow")?t+1:t,0)}createTableWalker(e,t={}){return new C(e,t)}getSelectedTableCells(e){const t=[];for(const o of this.sortRanges(e.getRanges())){const n=o.getContainedElement();n&&n.is("element","tableCell")&&t.push(n)}return t}getTableCellsContainingSelection(e){const t=[];for(const o of e.getRanges()){const n=o.start.findAncestor("tableCell");n&&t.push(n)}return t}getSelectionAffectedTableCells(e){const t=this.getSelectedTableCells(e);return t.length?t:this.getTableCellsContainingSelection(e)}getRowIndexes(e){const t=e.map(o=>o.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(e){const t=e[0].findAncestor("table"),n=[...new C(t)].filter(l=>e.includes(l.cell)).map(l=>l.column);return this._getFirstLastIndexesObject(n)}isSelectionRectangular(e){if(e.length<2||!this._areCellInTheSameTableSection(e))return!1;const t=new Set,o=new Set;let n=0;for(const s of e){const{row:r,column:a}=this.getCellLocation(s),c=parseInt(s.getAttribute("rowspan"))||1,d=parseInt(s.getAttribute("colspan"))||1;t.add(r),o.add(a),c>1&&t.add(r+c-1),d>1&&o.add(a+d-1),n+=c*d}return Zo(t,o)==n}sortRanges(e){return Array.from(e).sort(Yo)}_getFirstLastIndexesObject(e){const t=e.sort((l,s)=>l-s),o=t[0],n=t[t.length-1];return{first:o,last:n}}_areCellInTheSameTableSection(e){const t=e[0].findAncestor("table"),o=this.getRowIndexes(e),n=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(o,n))return!1;const l=this.getColumnIndexes(e),s=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(l,s)}_areIndexesInSameSection({first:e,last:t},o){const n=e<o,l=t<o;return n===l}}function me(i,e,t,o,n,l={}){for(let s=0;s<o;s++){const r=i.createElement("tableRow");i.insert(r,e,t),M(n,i,i.createPositionAt(r,"end"),l)}}function M(i,e,t,o={}){for(let n=0;n<i;n++)F(e,t,o)}function Ge(i,e){if(i<e)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(i/e),o=i-t*e+t;return{newCellsSpan:t,updatedSpan:o}}function Go(i,e,t){const o=i.getAttribute("headingColumns")||0;if(o&&e.first<o){const n=Math.min(o-1,e.last)-e.first+1;t.setAttribute("headingColumns",o-n,i)}}function qo(i,{first:e,last:t},o){const n=i.getAttribute("headingRows")||0;if(e<n){const l=t<n?n-(t-e+1):e;T("headingRows",l,i,o,0)}}function Jo(i,{first:e,last:t}){const o=new Map,n=[];for(const{row:l,column:s,cellHeight:r,cell:a}of new C(i,{endRow:t})){const c=l+r-1;if(l>=e&&l<=t&&c>t){const h=t-l+1,b=r-h;o.set(s,{cell:a,rowspan:b})}if(l<e&&c>=e){let h;c>=t?h=t-e+1:h=c-e+1,n.push({cell:a,rowspan:r-h})}}return{cellsToMove:o,cellsToTrim:n}}function Xo(i,e,t,o){const l=[...new C(i,{includeAllSlots:!0,row:e})],s=i.getChild(e);let r;for(const{column:a,cell:c,isAnchor:d}of l)if(t.has(a)){const{cell:u,rowspan:h}=t.get(a),b=r?o.createPositionAfter(r):o.createPositionAt(s,0);o.move(o.createRangeOn(u),b),T("rowspan",h,u,o),r=u}else d&&(r=c)}function Yo(i,e){const t=i.start,o=e.start;return t.isBefore(o)?-1:1}function Zo(i,e){const t=Array.from(i.values()),o=Array.from(e.values()),n=Math.max(...t),l=Math.min(...t),s=Math.max(...o),r=Math.min(...o);return(n-l+1)*(s-r+1)}class Qo extends S{refresh(){const e=this.editor.plugins.get(_),t=e.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=e.isSelectionRectangular(t)}execute(){const e=this.editor.model,t=this.editor.plugins.get(_);e.change(o=>{const n=t.getSelectedTableCells(e.document.selection),l=n.shift(),{mergeWidth:s,mergeHeight:r}=tn(l,n,t);T("colspan",s,l,o),T("rowspan",r,l,o);for(const c of n)en(c,l,o);const a=l.findAncestor("table");Ie(a,t),o.setSelection(l,"in")})}}function en(i,e,t){qe(i)||(qe(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function qe(i){const e=i.getChild(0);return i.childCount==1&&e.is("element","paragraph")&&e.isEmpty}function tn(i,e,t){let o=0,n=0;for(const c of e){const{row:d,column:u}=t.getCellLocation(c);o=Je(c,u,o,"colspan"),n=Je(c,d,n,"rowspan")}const{row:l,column:s}=t.getCellLocation(i),r=o-s,a=n-l;return{mergeWidth:r,mergeHeight:a}}function Je(i,e,t,o){const n=parseInt(i.getAttribute(o)||"1");return Math.max(t,e+n)}class on extends S{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(o),l=o[0].findAncestor("table"),s=[];for(let r=n.first;r<=n.last;r++)for(const a of l.getChild(r).getChildren())s.push(e.createRangeOn(a));e.change(r=>{r.setSelection(s)})}}class nn extends S{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection),n=o[0],l=o.pop(),s=n.findAncestor("table"),r=e.getCellLocation(n),a=e.getCellLocation(l),c=Math.min(r.column,a.column),d=Math.max(r.column,a.column),u=[];for(const h of new C(s,{startColumn:c,endColumn:d}))u.push(t.createRangeOn(h.cell));t.change(h=>{h.setSelection(u)})}}function ln(i){i.document.registerPostFixer(e=>sn(e,i))}function sn(i,e){const t=e.document.differ.getChanges();let o=!1;const n=new Set;for(const l of t){let s=null;l.type=="insert"&&l.name=="table"&&(s=l.position.nodeAfter),(l.type=="insert"||l.type=="remove")&&(l.name=="tableRow"||l.name=="tableCell")&&(s=l.position.findAncestor("table")),un(l)&&(s=l.range.start.findAncestor("table")),s&&!n.has(s)&&(o=rn(s,i)||o,o=an(s,i)||o,n.add(s))}return o}function rn(i,e){let t=!1;const o=cn(i);if(o.length){t=!0;for(const n of o)T("rowspan",n.rowspan,n.cell,e,1)}return t}function an(i,e){let t=!1;const o=dn(i),n=[];for(const[a,c]of o.entries())!c&&i.getChild(a).is("element","tableRow")&&n.push(a);if(n.length){t=!0;for(const a of n.reverse())e.remove(i.getChild(a)),o.splice(a,1)}const l=o.filter((a,c)=>i.getChild(c).is("element","tableRow")),s=l[0];if(!l.every(a=>a===s)){const a=l.reduce((c,d)=>d>c?d:c,0);for(const[c,d]of l.entries()){const u=a-d;if(u){for(let h=0;h<u;h++)F(e,e.createPositionAt(i.getChild(c),"end"));t=!0}}}return t}function cn(i){const e=parseInt(i.getAttribute("headingRows")||"0"),t=Array.from(i.getChildren()).reduce((n,l)=>l.is("element","tableRow")?n+1:n,0),o=[];for(const{row:n,cell:l,cellHeight:s}of new C(i)){if(s<2)continue;const a=n<e?e:t;if(n+s>a){const c=a-n;o.push({cell:l,rowspan:c})}}return o}function dn(i){const e=new Array(i.childCount).fill(0);for(const{rowIndex:t}of new C(i,{includeAllSlots:!0}))e[t]++;return e}function un(i){if(i.type!=="attribute")return!1;const e=i.attributeKey;return e==="headingRows"||e==="colspan"||e==="rowspan"}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function hn(i){i.document.registerPostFixer(e=>mn(e,i))}function mn(i,e){const t=e.document.differ.getChanges();let o=!1;for(const n of t)n.type=="insert"&&n.name=="table"&&(o=bn(n.position.nodeAfter,i)||o),n.type=="insert"&&n.name=="tableRow"&&(o=kt(n.position.nodeAfter,i)||o),n.type=="insert"&&n.name=="tableCell"&&(o=Ce(n.position.nodeAfter,i)||o),(n.type=="remove"||n.type=="insert")&&gn(n)&&(o=Ce(n.position.parent,i)||o);return o}function bn(i,e){let t=!1;for(const o of i.getChildren())o.is("element","tableRow")&&(t=kt(o,e)||t);return t}function kt(i,e){let t=!1;for(const o of i.getChildren())t=Ce(o,e)||t;return t}function Ce(i,e){if(i.childCount==0)return e.insertElement("paragraph",i),!0;const t=Array.from(i.getChildren()).filter(o=>o.is("$text"));for(const o of t)e.wrap(e.createRangeOn(o),"paragraph");return!!t.length}function gn(i){return i.position.parent.is("element","tableCell")?i.type=="insert"&&i.name=="$text"||i.type=="remove":!1}function fn(i,e){const t=i.document.differ;for(const o of t.getChanges()){let n,l=!1;if(o.type=="attribute"){const c=o.range.start.nodeAfter;if(!c||!c.is("element","table")||o.attributeKey!="headingRows"&&o.attributeKey!="headingColumns")continue;n=c,l=o.attributeKey=="headingRows"}else(o.name=="tableRow"||o.name=="tableCell")&&(n=o.position.findAncestor("table"),l=o.name=="tableRow");if(!n)continue;const s=n.getAttribute("headingRows")||0,r=n.getAttribute("headingColumns")||0,a=new C(n);for(const c of a){const u=c.row<s||c.column<r?"th":"td",h=e.mapper.toViewElement(c.cell);h&&h.is("element")&&h.name!=u&&e.reconvertItem(l?c.cell.parent:c.cell)}}}function pn(i,e){const t=i.document.differ,o=new Set;for(const n of t.getChanges()){const l=n.type=="attribute"?n.range.start.parent:n.position.parent;l.is("element","tableCell")&&o.add(l)}for(const n of o.values()){const l=Array.from(n.getChildren()).filter(s=>wn(s,e.mapper));for(const s of l)e.reconvertItem(s)}}function wn(i,e){if(!i.is("element","paragraph"))return!1;const t=e.toViewElement(i);return t?Ct(i)!==t.is("element","span"):!1}class ae extends y{_additionalSlots;static get pluginName(){return"TableEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[_]}constructor(e){super(e),this._additionalSlots=[]}init(){const e=this.editor,t=e.model,o=t.schema,n=e.conversion,l=e.plugins.get(_);o.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),o.register("tableRow",{allowIn:"table",isLimit:!0}),o.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),n.for("upcast").add(_o()),n.for("upcast").add(vo()),n.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:He(l,{asWidget:!0,additionalSlots:this._additionalSlots})}),n.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:He(l,{additionalSlots:this._additionalSlots})}),n.for("upcast").elementToElement({model:"tableRow",view:"tr"}),n.for("upcast").add(So()),n.for("downcast").elementToElement({model:"tableRow",view:xo()}),n.for("upcast").elementToElement({model:"tableCell",view:"td"}),n.for("upcast").elementToElement({model:"tableCell",view:"th"}),n.for("upcast").add(Oe("td")),n.for("upcast").add(Oe("th")),n.for("editingDowncast").elementToElement({model:"tableCell",view:Me({asWidget:!0})}),n.for("dataDowncast").elementToElement({model:"tableCell",view:Me()}),n.for("editingDowncast").elementToElement({model:"paragraph",view:Ue({asWidget:!0}),converterPriority:"high"}),n.for("dataDowncast").elementToElement({model:"paragraph",view:Ue(),converterPriority:"high"}),n.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),n.for("upcast").attributeToAttribute({model:{key:"colspan",value:Xe("colspan")},view:"colspan"}),n.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),n.for("upcast").attributeToAttribute({model:{key:"rowspan",value:Xe("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new Eo(e)),e.commands.add("insertTableRowAbove",new ze(e,{order:"above"})),e.commands.add("insertTableRowBelow",new ze(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new je(e,{order:"left"})),e.commands.add("insertTableColumnRight",new je(e,{order:"right"})),e.commands.add("removeTableRow",new Do(e)),e.commands.add("removeTableColumn",new Ho(e)),e.commands.add("splitTableCellVertically",new $e(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new $e(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new Qo(e)),e.commands.add("mergeTableCellRight",new K(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new K(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new K(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new K(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new jo(e)),e.commands.add("setTableRowHeader",new zo(e)),e.commands.add("selectTableRow",new on(e)),e.commands.add("selectTableColumn",new nn(e)),ln(t),hn(t),this.listenTo(t.document,"change:data",()=>{fn(t,e.editing),pn(t,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function Xe(i){return e=>{const t=parseInt(e.getAttribute(i));return Number.isNaN(t)||t<=0?null:t}}class Ye extends W{items;keystrokes;focusTracker;constructor(e){super(e);const t=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new se,this.focusTracker=new re,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(o,n)=>`${n} × ${o}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:t.to("label")}]}],on:{mousedown:t.to(o=>{o.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(o,n)=>{const{row:l,column:s}=n.target.dataset;this.items.get((parseInt(l,10)-1)*10+(parseInt(s,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(o,n,l)=>{if(!l)return;const{row:s,column:r}=l.dataset;this.set({rows:parseInt(s),columns:parseInt(r)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),ho({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const e of this.items)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const e=this.rows,t=this.columns;this.items.map((o,n)=>{const l=Math.floor(n/10),s=n%10,r=l<e&&s<t;o.set("isOn",r)})}_createGridButton(e,t,o,n){const l=new k(e);return l.set({label:n,class:"ck-insert-table-dropdown-grid-box"}),l.extendTemplate({attributes:{"data-row":t,"data-column":o}}),l}_createGridCollection(){const e=[];for(let t=0;t<100;t++){const o=Math.floor(t/10),n=t%10,l=`${o+1} × ${n+1}`;e.push(this._createGridButton(this.locale,o+1,n+1,l))}return this.createCollection(e)}}class Cn extends y{static get pluginName(){return"TableUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=this.editor.t,n=e.locale.contentLanguageDirection==="ltr";e.ui.componentFactory.add("insertTable",l=>{const s=e.commands.get("insertTable"),r=J(l);r.bind("isEnabled").to(s),r.buttonView.set({icon:Fe,label:t("Insert table"),tooltip:!0});let a;return r.on("change:isOpen",()=>{a||(a=new Ye(l),r.panelView.children.add(a),a.delegate("execute").to(r),r.on("execute",()=>{e.execute("insertTable",{rows:a.rows,columns:a.columns}),e.editing.view.focus()}))}),r}),e.ui.componentFactory.add("menuBar:insertTable",l=>{const s=e.commands.get("insertTable"),r=new ao(l),a=new Ye(l);return a.delegate("execute").to(r),r.on("change:isOpen",(c,d,u)=>{u||a.reset()}),a.on("execute",()=>{e.execute("insertTable",{rows:a.rows,columns:a.columns}),e.editing.view.focus()}),r.buttonView.set({label:t("Table"),icon:Fe}),r.panelView.children.add(a),r.bind("isEnabled").to(s),r}),e.ui.componentFactory.add("tableColumn",l=>{const s=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:n?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:n?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),Kt,s,l)}),e.ui.componentFactory.add("tableRow",l=>{const s=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),Gt,s,l)}),e.ui.componentFactory.add("mergeTableCells",l=>{const s=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:n?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:n?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),qt,s,l)})}_prepareDropdown(e,t,o,n){const l=this.editor,s=J(n),r=this._fillDropdownWithListOptions(s,o);return s.buttonView.set({label:e,icon:t,tooltip:!0}),s.bind("isEnabled").toMany(r,"isEnabled",(...a)=>a.some(c=>c)),this.listenTo(s,"execute",a=>{l.execute(a.source.commandName),a.source instanceof co||l.editing.view.focus()}),s}_prepareMergeSplitButtonDropdown(e,t,o,n){const l=this.editor,s=J(n,uo),r="mergeTableCells",a=l.commands.get(r),c=this._fillDropdownWithListOptions(s,o);return s.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),s.bind("isEnabled").toMany([a,...c],"isEnabled",(...d)=>d.some(u=>u)),this.listenTo(s.buttonView,"execute",()=>{l.execute(r),l.editing.view.focus()}),this.listenTo(s,"execute",d=>{l.execute(d.source.commandName),l.editing.view.focus()}),s}_fillDropdownWithListOptions(e,t){const o=this.editor,n=[],l=new rt;for(const s of t)Tn(s,o,n,l);return Re(e,l),n}}function Tn(i,e,t,o){if(i.type==="button"||i.type==="switchbutton"){const n=i.model=new ut(i.model),{commandName:l,bindIsOn:s}=i.model,r=e.commands.get(l);t.push(r),n.set({commandName:l}),n.bind("isEnabled").to(r),s&&n.bind("isOn").to(r,"value"),n.set({withText:!0})}o.add(i)}class E extends y{static get pluginName(){return"TableSelection"}static get isOfficialPlugin(){return!0}static get requires(){return[_,_]}init(){const e=this.editor,t=e.model,o=e.editing.view;this.listenTo(t,"deleteContent",(n,l)=>this._handleDeleteContent(n,l),{priority:"high"}),this.listenTo(o.document,"insertText",(n,l)=>this._handleInsertTextEvent(n,l),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const e=this.editor.plugins.get(_),t=this.editor.model.document.selection,o=e.getSelectedTableCells(t);return o.length==0?null:o}getSelectionAsFragment(){const e=this.editor.plugins.get(_),t=this.getSelectedTableCells();return t?this.editor.model.change(o=>{const n=o.createDocumentFragment(),{first:l,last:s}=e.getColumnIndexes(t),{first:r,last:a}=e.getRowIndexes(t),c=t[0].findAncestor("table");let d=a,u=s;if(e.isSelectionRectangular(t)){const m={firstColumn:l,lastColumn:s,firstRow:r,lastRow:a};d=Rt(c,m),u=Vt(c,m)}const b=Tt(c,{startRow:r,startColumn:l,endRow:d,endColumn:u},o);return o.insert(b,n,0),n}):null}setCellSelection(e,t){const o=this._getCellsToSelect(e,t);this.editor.model.change(n=>{n.setSelection(o.cells.map(l=>n.createRangeOn(l)),{backward:o.backward})})}getFocusCell(){const o=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return o&&o.is("element","tableCell")?o:null}getAnchorCell(){const e=this.editor.model.document.selection,o=Ae(e.getRanges()).getContainedElement();return o&&o.is("element","tableCell")?o:null}_defineSelectionConverter(){const e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(n=>n.on("selection",(l,s,r)=>{const a=r.writer;o(a);const c=this.getSelectedTableCells();if(!c)return;for(const u of c){const h=r.mapper.toViewElement(u);a.addClass("ck-editor__editable_selected",h),t.add(h)}const d=r.mapper.toViewElement(c[c.length-1]);a.setSelection(d,0)},{priority:"lowest"}));function o(n){for(const l of t)n.removeClass("ck-editor__editable_selected",l);t.clear()}}_enablePluginDisabling(){const e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;e.model.change(o=>{const n=o.createPositionAt(t[0],0),l=e.model.schema.getNearestSelectionRange(n);o.setSelection(l)})}})}_handleDeleteContent(e,t){const o=this.editor.plugins.get(_),n=t[0],l=t[1],s=this.editor.model,r=!l||l.direction=="backward",a=o.getSelectedTableCells(n);a.length&&(e.stop(),s.change(c=>{const d=a[r?a.length-1:0];s.change(h=>{for(const b of a)s.deleteContent(h.createSelection(b,"in"))});const u=s.schema.getNearestSelectionRange(c.createPositionAt(d,0));n.is("documentSelection")?c.setSelection(u):n.setTo(u)}))}_handleInsertTextEvent(e,t){const o=this.editor,n=this.getSelectedTableCells();if(!n)return;const l=o.editing.view,s=o.editing.mapper,r=n.map(a=>l.createRangeOn(s.toViewElement(a)));t.selection=l.createSelection(r),t.preventDefault()}_getCellsToSelect(e,t){const o=this.editor.plugins.get("TableUtils"),n=o.getCellLocation(e),l=o.getCellLocation(t),s=Math.min(n.row,l.row),r=Math.max(n.row,l.row),a=Math.min(n.column,l.column),c=parseInt(t.getAttribute("colspan")||"1")-1,d=Math.max(n.column,l.column+c),u=new Array(r-s+1).fill(null).map(()=>[]),h={startRow:s,endRow:r,startColumn:a,endColumn:d};for(const{row:g,cell:f}of new C(e.findAncestor("table"),h))u[g-s].push(f);const b=l.row<n.row,m=l.column<n.column;return b&&u.reverse(),m&&u.forEach(g=>g.reverse()),{cells:u.flat(),backward:b||m}}}class yn extends y{static get pluginName(){return"TableClipboard"}static get isOfficialPlugin(){return!0}static get requires(){return[he,De,E,_]}init(){const t=this.editor.editing.view.document;this.listenTo(t,"copy",(o,n)=>this._onCopyCut(o,n)),this.listenTo(t,"cut",(o,n)=>this._onCopyCut(o,n)),this._listenToContentInsertion(),this.decorate("_replaceTableSlotCell")}_listenToContentInsertion(){const{editor:e}=this,t=e.plugins.get(De),o=e.plugins.get(E);let n=!1;t.on("contentInsertion",(l,s)=>{n=s.method==="paste"}),this.listenTo(e.model,"insertContent",(l,[s,r])=>{(n||o.getSelectedTableCells()!==null)&&this._onInsertContent(l,s,r)},{priority:"high"}),t.on("contentInsertion",()=>{n=!1},{priority:"lowest"})}_onCopyCut(e,t){const o=this.editor.editing.view,n=this.editor.plugins.get(E),l=this.editor.plugins.get(he);n.getSelectedTableCells()&&(e.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection)||(t.preventDefault(),e.stop(),this.editor.model.enqueueChange({isUndoable:e.name==="cut"},()=>{const s=l._copySelectedFragmentWithMarkers(e.name,this.editor.model.document.selection,()=>n.getSelectionAsFragment());o.document.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:this.editor.data.toView(s),method:e.name})})))}_onInsertContent(e,t,o){if(o&&!o.is("documentSelection"))return;const n=this.editor.model,l=this.editor.plugins.get(_),s=this.editor.plugins.get(he),r=this.getTableIfOnlyTableInContent(t,n);if(!r)return;const a=l.getSelectionAffectedTableCells(n.document.selection);if(!a.length){Ie(r,l);return}e.stop(),t.is("documentFragment")?s._pasteMarkersIntoTransformedElement(t.markers,c=>this._replaceSelectedCells(r,a,c)):this.editor.model.change(c=>{this._replaceSelectedCells(r,a,c)})}_replaceSelectedCells(e,t,o){const n=this.editor.plugins.get(_),l={width:n.getColumns(e),height:n.getRows(e)},s=_n(t,l,o,n),r=s.lastRow-s.firstRow+1,a=s.lastColumn-s.firstColumn+1,c={startRow:0,startColumn:0,endRow:Math.min(r,l.height)-1,endColumn:Math.min(a,l.width)-1};e=Tt(e,c,o);const d=t[0].findAncestor("table"),u=this._replaceSelectedCellsWithPasted(e,l,d,s,o);if(this.editor.plugins.get("TableSelection").isEnabled){const h=n.sortRanges(u.map(b=>o.createRangeOn(b)));o.setSelection(h)}else o.setSelection(u[0],0);return d}_replaceSelectedCellsWithPasted(e,t,o,n,l){const{width:s,height:r}=t,a=Sn(e,s,r),c=[...new C(o,{startRow:n.firstRow,endRow:n.lastRow,startColumn:n.firstColumn,endColumn:n.lastColumn,includeAllSlots:!0})],d=[];let u;for(const f of c){const{row:p,column:w}=f;w===n.firstColumn&&(u=f.getPositionBefore());const v=p-n.firstRow,B=w-n.firstColumn,j=a[v%r][B%s],ue=j?l.cloneElement(j):null,$=this._replaceTableSlotCell(f,ue,u,l);$&&(At($,p,w,n.lastRow,n.lastColumn,l),d.push($),u=l.createPositionAfter($))}const h=parseInt(o.getAttribute("headingRows")||"0"),b=parseInt(o.getAttribute("headingColumns")||"0"),m=n.firstRow<h&&h<=n.lastRow,g=n.firstColumn<b&&b<=n.lastColumn;if(m){const f={first:n.firstColumn,last:n.lastColumn},p=Te(o,h,f,l,n.firstRow);d.push(...p)}if(g){const f={first:n.firstRow,last:n.lastRow},p=ye(o,b,f,l);d.push(...p)}return d}_replaceTableSlotCell(e,t,o,n){const{cell:l,isAnchor:s}=e;return s&&n.remove(l),t?(n.insert(t,o),t):null}getTableIfOnlyTableInContent(e,t){if(!e.is("documentFragment")&&!e.is("element"))return null;if(e.is("element","table"))return e;if(e.childCount==1&&e.getChild(0).is("element","table"))return e.getChild(0);const o=t.createRangeIn(e);for(const n of o.getItems())if(n.is("element","table")){const l=t.createRange(o.start,t.createPositionBefore(n));if(t.hasContent(l,{ignoreWhitespaces:!0}))return null;const s=t.createRange(t.createPositionAfter(n),o.end);return t.hasContent(s,{ignoreWhitespaces:!0})?null:n}return null}}function _n(i,e,t,o){const n=i[0].findAncestor("table"),l=o.getColumnIndexes(i),s=o.getRowIndexes(i),r={firstColumn:l.first,lastColumn:l.last,firstRow:s.first,lastRow:s.last},a=i.length===1;return a&&(r.lastRow+=e.height-1,r.lastColumn+=e.width-1,vn(n,r.lastRow+1,r.lastColumn+1,o)),a||!o.isSelectionRectangular(i)?An(n,r,t):(r.lastRow=Rt(n,r),r.lastColumn=Vt(n,r)),r}function vn(i,e,t,o){const n=o.getColumns(i),l=o.getRows(i);t>n&&o.insertColumns(i,{at:n,columns:t-n}),e>l&&o.insertRows(i,{at:l,rows:e-l})}function Sn(i,e,t){const o=new Array(t).fill(null).map(()=>new Array(e).fill(null));for(const{column:n,row:l,cell:s}of new C(i))o[l][n]=s;return o}function An(i,e,t){const{firstRow:o,lastRow:n,firstColumn:l,lastColumn:s}=e,r={first:o,last:n},a={first:l,last:s};ye(i,l,r,t),ye(i,s+1,r,t),Te(i,o,a,t),Te(i,n+1,a,t,o)}function Te(i,e,t,o,n=0){return e<1?void 0:yt(i,e,n).filter(({column:r,cellWidth:a})=>xt(r,a,t)).map(({cell:r})=>_t(r,e,o))}function ye(i,e,t,o){return e<1?void 0:vt(i,e).filter(({row:s,cellHeight:r})=>xt(s,r,t)).map(({cell:s,column:r})=>St(s,r,e,o))}function xt(i,e,t){const o=i+e-1,{first:n,last:l}=t,s=i>=n&&i<=l,r=i<n&&o>=n;return s||r}class Rn extends y{static get pluginName(){return"TableKeyboard"}static get isOfficialPlugin(){return!0}static get requires(){return[E,_]}init(){const e=this.editor,o=e.editing.view.document,n=e.t;this.listenTo(o,"arrowKey",(...l)=>this._onArrowKey(...l),{context:"table"}),this.listenTo(o,"tab",(...l)=>this._handleTabOnSelectedTable(...l),{context:"figure"}),this.listenTo(o,"tab",(...l)=>this._handleTab(...l),{context:["th","td"]}),e.accessibility.addKeystrokeInfoGroup({id:"table",label:n("Keystrokes that can be used in a table cell"),keystrokes:[{label:n("Move the selection to the next cell"),keystroke:"Tab"},{label:n("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:n("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:n("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(e,t){const o=this.editor,l=o.model.document.selection.getSelectedElement();!l||!l.is("element","table")||(t.preventDefault(),t.stopPropagation(),e.stop(),o.model.change(s=>{s.setSelection(s.createRangeIn(l.getChild(0).getChild(0)))}))}_handleTab(e,t){const o=this.editor,n=this.editor.plugins.get(_),l=this.editor.plugins.get("TableSelection"),s=o.model.document.selection,r=!t.shiftKey;let a=n.getTableCellsContainingSelection(s)[0];if(a||(a=l.getFocusCell()),!a)return;t.preventDefault(),t.stopPropagation(),e.stop();const c=a.parent,d=c.parent,u=d.getChildIndex(c),h=c.getChildIndex(a),b=h===0;if(!r&&b&&u===0){o.model.change(p=>{p.setSelection(p.createRangeOn(d))});return}const m=h===c.childCount-1,g=u===n.getRows(d)-1;if(r&&g&&m&&(o.execute("insertTableRowBelow"),u===n.getRows(d)-1)){o.model.change(p=>{p.setSelection(p.createRangeOn(d))});return}let f;if(r&&m)f=d.getChild(u+1).getChild(0);else if(!r&&b){const p=d.getChild(u-1);f=p.getChild(p.childCount-1)}else f=c.getChild(h+(r?1:-1));o.model.change(p=>{p.setSelection(p.createRangeIn(f))})}_onArrowKey(e,t){const o=this.editor,n=t.keyCode,l=$t(n,o.locale.contentLanguageDirection);this._handleArrowKeys(l,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){const o=this.editor.plugins.get(_),n=this.editor.plugins.get("TableSelection"),l=this.editor.model,s=l.document.selection,r=["right","down"].includes(e),a=o.getSelectedTableCells(s);if(a.length){let d;return t?d=n.getFocusCell():d=r?a[a.length-1]:a[0],this._navigateFromCellInDirection(d,e,t),!0}const c=s.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!c)return!1;if(!s.isCollapsed)if(t){if(s.isBackward==r&&!s.containsEntireContent(c))return!1}else{const d=s.getSelectedElement();if(!d||!l.schema.isObject(d))return!1}return this._isSelectionAtCellEdge(s,c,r)?(this._navigateFromCellInDirection(c,e,t),!0):!1}_isSelectionAtCellEdge(e,t,o){const n=this.editor.model,l=this.editor.model.schema,s=o?e.getLastPosition():e.getFirstPosition();if(!l.getLimitElement(s).is("element","tableCell"))return n.createPositionAt(t,o?"end":0).isTouching(s);const r=n.createSelection(s);return n.modifySelection(r,{direction:o?"forward":"backward"}),s.isEqual(r.focus)}_navigateFromCellInDirection(e,t,o=!1){const n=this.editor.model,l=e.findAncestor("table"),s=[...new C(l,{includeAllSlots:!0})],{row:r,column:a}=s[s.length-1],c=s.find(({cell:w})=>w==e);let{row:d,column:u}=c;switch(t){case"left":u--;break;case"up":d--;break;case"right":u+=c.cellWidth;break;case"down":d+=c.cellHeight;break}const h=d<0||d>r,b=u<0&&d<=0,m=u>a&&d>=r;if(h||b||m){n.change(w=>{w.setSelection(w.createRangeOn(l))});return}u<0?(u=o?0:a,d--):u>a&&(u=o?a:0,d++);const g=s.find(w=>w.row==d&&w.column==u).cell,f=["right","down"].includes(t),p=this.editor.plugins.get("TableSelection");if(o&&p.isEnabled){const w=p.getAnchorCell()||e;p.setCellSelection(w,g)}else{const w=n.createPositionAt(g,f?0:"end");n.change(v=>{v.setSelection(w)})}}}class Vn extends wo{domEventType=["mousemove","mouseleave"];onDomEvent(e){this.fire(e.type,e)}}class kn extends y{static get pluginName(){return"TableMouse"}static get isOfficialPlugin(){return!0}static get requires(){return[E,_]}init(){this.editor.editing.view.addObserver(Vn),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const e=this.editor,t=e.plugins.get(_);let o=!1;const n=e.plugins.get(E);this.listenTo(e.editing.view.document,"mousedown",(l,s)=>{const r=e.model.document.selection;if(!this.isEnabled||!n.isEnabled||!s.domEvent.shiftKey)return;const a=n.getAnchorCell()||t.getTableCellsContainingSelection(r)[0];if(!a)return;const c=this._getModelTableCellFromDomEvent(s);c&&Ze(a,c)&&(o=!0,n.setCellSelection(a,c),s.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{o=!1}),this.listenTo(e.editing.view.document,"selectionChange",l=>{o&&l.stop()},{priority:"highest"})}_enableMouseDragSelection(){const e=this.editor;let t,o,n=!1,l=!1;const s=e.plugins.get(E);this.listenTo(e.editing.view.document,"mousedown",(r,a)=>{!this.isEnabled||!s.isEnabled||a.domEvent.shiftKey||a.domEvent.ctrlKey||a.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(a))}),this.listenTo(e.editing.view.document,"mousemove",(r,a)=>{if(!a.domEvent.buttons||!t)return;const c=this._getModelTableCellFromDomEvent(a);c&&Ze(t,c)&&(o=c,!n&&o!=t&&(n=!0)),n&&(l=!0,s.setCellSelection(t,o),a.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{n=!1,l=!1,t=null,o=null}),this.listenTo(e.editing.view.document,"selectionChange",r=>{l&&r.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){const t=e.target,o=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(o).parent.findAncestor("tableCell",{includeSelf:!0})}}function Ze(i,e){return i.parent.parent==e.parent.parent}class Rl extends y{static get requires(){return[ae,Cn,E,kn,Rn,yn,Ut]}static get pluginName(){return"Table"}static get isOfficialPlugin(){return!0}}function oe(i){const e=It(i);return e||ce(i)}function It(i){const e=i.getSelectedElement();return e&&Pt(e)?e:null}function ce(i){const e=i.getFirstPosition();if(!e)return null;let t=e.parent;for(;t;){if(t.is("element")&&Pt(t))return t;t=t.parent}return null}function Pt(i){return!!i.getCustomProperty("table")&&zt(i)}class Vl extends y{static get requires(){return[Le]}static get pluginName(){return"TableToolbar"}static get isOfficialPlugin(){return!0}afterInit(){const e=this.editor,t=e.t,o=e.plugins.get(Le),n=e.config.get("table.contentToolbar"),l=e.config.get("table.tableToolbar");n&&o.register("tableContent",{ariaLabel:t("Table toolbar"),items:n,getRelatedElement:ce}),l&&o.register("table",{ariaLabel:t("Table toolbar"),items:l,getRelatedElement:It})}}class xn extends W{options;focusTracker;focusCycler;_focusables;dropdownView;inputView;keystrokes;_stillTyping;constructor(e,t){super(e),this.set("value",""),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isEmpty",!0),this.options=t,this.focusTracker=new re,this._focusables=new Ve,this.dropdownView=this._createDropdownView(),this.inputView=this._createInputTextView(),this.keystrokes=new se,this._stillTyping=!1,this.focusCycler=new ke({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-input-color"]},children:[this.dropdownView,this.inputView]}),this.on("change:value",(o,n,l)=>this._setInputValue(l))}render(){super.render(),[this.inputView,this.dropdownView.buttonView].forEach(e=>{this.focusTracker.add(e.element),this._focusables.add(e)}),this.keystrokes.listenTo(this.element)}focus(e){e===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createDropdownView(){const e=this.locale,t=e.t,o=this.bindTemplate,n=this._createColorSelector(e),l=J(e),s=new W;return s.setTemplate({tag:"span",attributes:{class:["ck","ck-input-color__button__preview"],style:{backgroundColor:o.to("value")}},children:[{tag:"span",attributes:{class:["ck","ck-input-color__button__preview__no-color-indicator",o.if("value","ck-hidden",r=>r!="")]}}]}),l.buttonView.extendTemplate({attributes:{class:"ck-input-color__button"}}),l.buttonView.children.add(s),l.buttonView.label=t("Color picker"),l.buttonView.tooltip=!0,l.panelPosition=e.uiLanguageDirection==="rtl"?"se":"sw",l.panelView.children.add(n),l.bind("isEnabled").to(this,"isReadOnly",r=>!r),l.on("change:isOpen",(r,a,c)=>{c&&(n.updateSelectedColors(),n.showColorGridsFragment())}),l}_createInputTextView(){const e=this.locale,t=new mo(e);return t.extendTemplate({on:{blur:t.bindTemplate.to("blur")}}),t.value=this.value,t.bind("isReadOnly","hasError").to(this),this.bind("isFocused","isEmpty").to(t),t.on("input",()=>{const o=t.element.value,n=this.options.colorDefinitions.find(l=>o===l.label);this._stillTyping=!0,this.value=n&&n.color||o}),t.on("blur",()=>{this._stillTyping=!1,this._setInputValue(t.element.value)}),t.delegate("input").to(this),t}_createColorSelector(e){const t=e.t,o=this.options.defaultColorValue||"",n=t(o?"Restore default":"Remove color"),l=new bo(e,{colors:this.options.colorDefinitions,columns:this.options.columns,removeButtonLabel:n,colorPickerLabel:t("Color picker"),colorPickerViewConfig:this.options.colorPickerConfig===!1?!1:{...this.options.colorPickerConfig,hideInput:!0}});l.appendUI(),l.on("execute",(r,a)=>{if(a.source==="colorPickerSaveButton"){this.dropdownView.isOpen=!1;return}this.value=a.value||o,this.fire("input"),a.source!=="colorPicker"&&(this.dropdownView.isOpen=!1)});let s=this.value;return l.on("colorPicker:cancel",()=>{this.value=s,this.fire("input"),this.dropdownView.isOpen=!1}),l.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{s=this.value}),l.bind("selectedColor").to(this,"value"),l}_setInputValue(e){if(!this._stillTyping){const t=Qe(e),o=this.options.colorDefinitions.find(n=>t===Qe(n.color));o?this.inputView.value=o.label:this.inputView.value=e||""}}}function Qe(i){return i.replace(/([(,])\s+/g,"$1").replace(/^\s+|\s+(?=[),\s]|$)/g,"").replace(/,|\s/g," ")}const Pe=i=>i==="";function Ee(i){return{none:i("None"),solid:i("Solid"),dotted:i("Dotted"),dashed:i("Dashed"),double:i("Double"),groove:i("Groove"),ridge:i("Ridge"),inset:i("Inset"),outset:i("Outset")}}function Et(i){return i('The color is invalid. Try "#FF0000" or "rgb(255,0,0)" or "red".')}function Bt(i){return i('The value is invalid. Try "10px" or "2em" or simply "2".')}function ne(i){return i=i.trim().toLowerCase(),Pe(i)||Co(i)}function z(i){return i=i.trim(),Pe(i)||Wt(i)||pt(i)||To(i)}function Lt(i){return i=i.trim(),Pe(i)||Wt(i)||pt(i)}function Nt(i,e){const t=new rt,o=Ee(i.t);for(const n in o){const l={type:"button",model:new ut({_borderStyleValue:n,label:o[n],role:"menuitemradio",withText:!0})};n==="none"?l.model.bind("isOn").to(i,"borderStyle",s=>e==="none"?!s:s===n):l.model.bind("isOn").to(i,"borderStyle",s=>s===n),t.add(l)}return t}function _e(i){const{view:e,icons:t,toolbar:o,labels:n,propertyName:l,nameToValue:s,defaultValue:r}=i;for(const a in n){const c=new k(e.locale);c.set({role:"radio",isToggleable:!0,label:n[a],icon:t[a],tooltip:n[a]});const d=s?s(a):a;c.bind("isOn").to(e,l,u=>{let h=u;return u===""&&r&&(h=r),d===h}),c.on("execute",()=>{!r&&d&&e[l]===d?e[l]=void 0:e[l]=d}),o.items.add(c)}}const le=[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}];function ie(i){return(e,t,o)=>{const n=new xn(e.locale,{colorDefinitions:In(i.colorConfig),columns:i.columns,defaultColorValue:i.defaultColorValue,colorPickerConfig:i.colorPickerConfig});return n.inputView.set({id:t,ariaDescribedById:o}),n.bind("isReadOnly").to(e,"isEnabled",l=>!l),n.bind("hasError").to(e,"errorText",l=>!!l),n.on("input",()=>{e.errorText=null}),e.bind("isEmpty","isFocused").to(n),n}}function Wt(i){const e=parseFloat(i);return!Number.isNaN(e)&&i===String(e)}function In(i){return i.map(e=>({color:e.model,label:e.label,options:{hasBorder:e.hasBorder}}))}class Pn extends W{options;focusTracker;keystrokes;children;borderStyleDropdown;borderWidthInput;borderColorInput;backgroundInput;paddingInput;widthInput;heightInput;horizontalAlignmentToolbar;verticalAlignmentToolbar;saveButtonView;cancelButtonView;_focusables;_focusCycler;constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",padding:"",backgroundColor:"",width:"",height:"",horizontalAlignment:"",verticalAlignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:n,borderColorInput:l,borderRowLabel:s}=this._createBorderFields(),{backgroundRowLabel:r,backgroundInput:a}=this._createBackgroundFields(),{widthInput:c,operatorLabel:d,heightInput:u,dimensionsLabel:h}=this._createDimensionFields(),{horizontalAlignmentToolbar:b,verticalAlignmentToolbar:m,alignmentLabel:g}=this._createAlignmentFields();this.focusTracker=new re,this.keystrokes=new se,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=n,this.borderColorInput=l,this.backgroundInput=a,this.paddingInput=this._createPaddingField(),this.widthInput=c,this.heightInput=u,this.horizontalAlignmentToolbar=b,this.verticalAlignmentToolbar=m;const{saveButtonView:f,cancelButtonView:p}=this._createActionButtons();this.saveButtonView=f,this.cancelButtonView=p,this._focusables=new Ve,this._focusCycler=new ke({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new ht(e,{label:this.t("Cell properties")})),this.children.add(new A(e,{labelView:s,children:[s,o,l,n],class:"ck-table-form__border-row"})),this.children.add(new A(e,{labelView:r,children:[r,a],class:"ck-table-form__background-row"})),this.children.add(new A(e,{children:[new A(e,{labelView:h,children:[h,c,d,u],class:"ck-table-form__dimensions-row"}),new A(e,{children:[this.paddingInput],class:"ck-table-cell-properties-form__padding-row"})]})),this.children.add(new A(e,{labelView:g,children:[g,b,m],class:"ck-table-cell-properties-form__alignment-row"})),this.children.add(new A(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-cell-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),mt({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.paddingInput,this.horizontalAlignmentToolbar,this.verticalAlignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableCellProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=ie({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color,colorPickerConfig:this.options.colorPickerConfig}),n=this.locale,l=this.t,s=l("Style"),r=new I(n);r.text=l("Border");const a=Ee(l),c=new R(n,bt);c.set({label:s,class:"ck-table-form__border-style"}),c.fieldView.buttonView.set({ariaLabel:s,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:s}),c.fieldView.buttonView.bind("label").to(this,"borderStyle",h=>a[h||"none"]),c.fieldView.on("execute",h=>{this.borderStyle=h.source._borderStyleValue}),c.bind("isEmpty").to(this,"borderStyle",h=>!h),Re(c.fieldView,Nt(this,t.style),{role:"menu",ariaLabel:s});const d=new R(n,N);d.set({label:l("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",G),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const u=new R(n,o);return u.set({label:l("Color"),class:"ck-table-form__border-color"}),u.fieldView.bind("value").to(this,"borderColor"),u.bind("isEnabled").to(this,"borderStyle",G),u.fieldView.on("input",()=>{this.borderColor=u.fieldView.value}),this.on("change:borderStyle",(h,b,m,g)=>{G(m)||(this.borderColor="",this.borderWidth=""),G(g)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:r,borderStyleDropdown:c,borderColorInput:u,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new I(e);o.text=t("Background");const n=ie({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableCellProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),l=new R(e,n);return l.set({label:t("Color"),class:"ck-table-cell-properties-form__background"}),l.fieldView.bind("value").to(this,"backgroundColor"),l.fieldView.on("input",()=>{this.backgroundColor=l.fieldView.value}),{backgroundRowLabel:o,backgroundInput:l}}_createDimensionFields(){const e=this.locale,t=this.t,o=new I(e);o.text=t("Dimensions");const n=new R(e,N);n.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),n.fieldView.bind("value").to(this,"width"),n.fieldView.on("input",()=>{this.width=n.fieldView.element.value});const l=new W(e);l.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const s=new R(e,N);return s.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),s.fieldView.bind("value").to(this,"height"),s.fieldView.on("input",()=>{this.height=s.fieldView.element.value}),{dimensionsLabel:o,widthInput:n,operatorLabel:l,heightInput:s}}_createPaddingField(){const e=this.locale,t=this.t,o=new R(e,N);return o.set({label:t("Padding"),class:"ck-table-cell-properties-form__padding"}),o.fieldView.bind("value").to(this,"padding"),o.fieldView.on("input",()=>{this.padding=o.fieldView.element.value}),o}_createAlignmentFields(){const e=this.locale,t=this.t,o=new I(e),n={left:lo,center:no,right:oo,justify:to,top:eo,middle:Qt,bottom:Zt};o.text=t("Table cell text alignment");const l=new be(e),s=e.contentLanguageDirection==="rtl";l.set({isCompact:!0,role:"radiogroup",ariaLabel:t("Horizontal text alignment toolbar")}),_e({view:this,icons:n,toolbar:l,labels:this._horizontalAlignmentLabels,propertyName:"horizontalAlignment",nameToValue:a=>{if(s){if(a==="left")return"right";if(a==="right")return"left"}return a},defaultValue:this.options.defaultTableCellProperties.horizontalAlignment});const r=new be(e);return r.set({isCompact:!0,role:"radiogroup",ariaLabel:t("Vertical text alignment toolbar")}),_e({view:this,icons:n,toolbar:r,labels:this._verticalAlignmentLabels,propertyName:"verticalAlignment",defaultValue:this.options.defaultTableCellProperties.verticalAlignment}),{horizontalAlignmentToolbar:l,verticalAlignmentToolbar:r,alignmentLabel:o}}_createActionButtons(){const e=this.locale,t=this.t,o=new k(e),n=new k(e),l=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.paddingInput];return o.set({label:t("Save"),icon:at,class:"ck-button-save",type:"submit",withText:!0}),o.bind("isEnabled").toMany(l,"errorText",(...s)=>s.every(r=>!r)),n.set({label:t("Cancel"),icon:ct,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:o,cancelButtonView:n}}get _horizontalAlignmentLabels(){const e=this.locale,t=this.t,o=t("Align cell text to the left"),n=t("Align cell text to the center"),l=t("Align cell text to the right"),s=t("Justify cell text");return e.uiLanguageDirection==="rtl"?{right:l,center:n,left:o,justify:s}:{left:o,center:n,right:l,justify:s}}get _verticalAlignmentLabels(){const e=this.t;return{top:e("Align cell text to the top"),middle:e("Align cell text to the middle"),bottom:e("Align cell text to the bottom")}}}function G(i){return i!=="none"}const ve=[L.defaultPositions.northArrowSouth,L.defaultPositions.northArrowSouthWest,L.defaultPositions.northArrowSouthEast,L.defaultPositions.southArrowNorth,L.defaultPositions.southArrowNorthWest,L.defaultPositions.southArrowNorthEast,L.defaultPositions.viewportStickyNorth];function Ft(i,e){const t=i.plugins.get("ContextualBalloon"),o=i.editing.view.document.selection;let n;e==="cell"?ce(o)&&(n=Ot(i)):oe(o)&&(n=Dt(i)),n&&t.updatePosition(n)}function Dt(i){const e=i.model.document.selection,t=P(e),o=i.editing.mapper.toViewElement(t);return{target:i.editing.view.domConverter.mapViewToDom(o),positions:ve}}function Ot(i){const e=i.editing.mapper,t=i.editing.view.domConverter,o=i.model.document.selection;if(o.rangeCount>1)return{target:()=>En(o.getRanges(),i),positions:ve};const n=Ht(o.getFirstPosition()),l=e.toViewElement(n);return{target:t.mapViewToDom(l),positions:ve}}function Ht(i){return i.nodeAfter&&i.nodeAfter.is("element","tableCell")?i.nodeAfter:i.findAncestor("tableCell")}function En(i,e){const t=e.editing.mapper,o=e.editing.view.domConverter,n=Array.from(i).map(l=>{const s=Ht(l.start),r=t.toViewElement(s);return new We(o.mapViewToDom(r))});return We.getBoundingRect(n)}function D(i){if(!i||!yo(i))return i;const{top:e,right:t,bottom:o,left:n}=i;if(e==t&&t==o&&o==n)return e}function O(i,e){const t=parseFloat(i);return Number.isNaN(t)||String(t)!==String(i)?i:`${t}${e}`}function de(i,e={}){const t={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...i};return e.includeAlignmentProperty&&!t.alignment&&(t.alignment="center"),e.includePaddingProperty&&!t.padding&&(t.padding=""),e.includeVerticalAlignmentProperty&&!t.verticalAlignment&&(t.verticalAlignment="middle"),e.includeHorizontalAlignmentProperty&&!t.horizontalAlignment&&(t.horizontalAlignment=e.isRightToLeftContent?"right":"left"),t}function Mt(i,e){return de({borderStyle:"double",borderColor:"hsl(0, 0%, 70%)",borderWidth:"1px",...i},e)}function Be(i,e){return de({borderStyle:"solid",borderColor:"hsl(0, 0%, 75%)",borderWidth:"1px",...i},e)}const Bn=500,et={borderStyle:"tableCellBorderStyle",borderColor:"tableCellBorderColor",borderWidth:"tableCellBorderWidth",height:"tableCellHeight",width:"tableCellWidth",padding:"tableCellPadding",backgroundColor:"tableCellBackgroundColor",horizontalAlignment:"tableCellHorizontalAlignment",verticalAlignment:"tableCellVerticalAlignment"};class Ln extends y{_defaultContentTableCellProperties;_defaultLayoutTableCellProperties;_balloon;view;_viewWithContentTableDefaults;_viewWithLayoutTableDefaults;_undoStepBatch;_isReady;static get requires(){return[Q]}static get pluginName(){return"TableCellPropertiesUI"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("table.tableCellProperties",{borderColors:le,backgroundColors:le})}init(){const e=this.editor,t=e.t;this._defaultContentTableCellProperties=Be(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"}),this._defaultLayoutTableCellProperties=de(void 0,{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"}),this._balloon=e.plugins.get(Q),this.view=null,this._isReady=!1,e.ui.componentFactory.add("tableCellProperties",o=>{const n=new k(o);n.set({label:t("Cell properties"),icon:Yt,tooltip:!0}),this.listenTo(n,"execute",()=>this._showView());const l=Object.values(et).map(s=>e.commands.get(s));return n.bind("isEnabled").toMany(l,"isEnabled",(...s)=>s.some(r=>r)),n})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(e){const t=this.editor,o=t.config.get("table.tableCellProperties"),n=ee(o.borderColors),l=te(t.locale,n),s=ee(o.backgroundColors),r=te(t.locale,s),a=o.colorPicker!==!1,c=new Pn(t.locale,{borderColors:l,backgroundColors:r,defaultTableCellProperties:e,colorPickerConfig:a?o.colorPicker||{}:!1}),d=t.t;c.render(),this.listenTo(c,"submit",()=>{this._hideView()}),this.listenTo(c,"cancel",()=>{this._undoStepBatch.operations.length&&t.execute("undo",this._undoStepBatch),this._hideView()}),c.keystrokes.set("Esc",(b,m)=>{this._hideView(),m()}),dt({emitter:c,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const u=Et(d),h=Bt(d);return c.on("change:borderStyle",this._getPropertyChangeCallback("tableCellBorderStyle")),c.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:c.borderColorInput,commandName:"tableCellBorderColor",errorText:u,validator:ne})),c.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:c.borderWidthInput,commandName:"tableCellBorderWidth",errorText:h,validator:Lt})),c.on("change:padding",this._getValidatedPropertyChangeCallback({viewField:c.paddingInput,commandName:"tableCellPadding",errorText:h,validator:z})),c.on("change:width",this._getValidatedPropertyChangeCallback({viewField:c.widthInput,commandName:"tableCellWidth",errorText:h,validator:z})),c.on("change:height",this._getValidatedPropertyChangeCallback({viewField:c.heightInput,commandName:"tableCellHeight",errorText:h,validator:z})),c.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:c.backgroundInput,commandName:"tableCellBackgroundColor",errorText:u,validator:ne})),c.on("change:horizontalAlignment",this._getPropertyChangeCallback("tableCellHorizontalAlignment")),c.on("change:verticalAlignment",this._getPropertyChangeCallback("tableCellVerticalAlignment")),c}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableCellBorderStyle");Object.entries(et).map(([o,n])=>{const l=o,s=this.view===this._viewWithContentTableDefaults?this._defaultContentTableCellProperties[l]||"":this._defaultLayoutTableCellProperties[l]||"";return[o,e.get(n).value||s]}).forEach(([o,n])=>{(o==="borderColor"||o==="borderWidth")&&t.value==="none"||this.view.set(o,n)}),this._isReady=!0}_showView(){const e=this.editor,t=oe(e.editing.view.document.selection),o=t&&e.editing.mapper.toModelElement(t),n=!o||o.getAttribute("tableType")!=="layout";n&&!this._viewWithContentTableDefaults?this._viewWithContentTableDefaults=this._createPropertiesView(this._defaultContentTableCellProperties):!n&&!this._viewWithLayoutTableDefaults&&(this._viewWithLayoutTableDefaults=this._createPropertiesView(this._defaultLayoutTableCellProperties)),this.view=n?this._viewWithContentTableDefaults:this._viewWithLayoutTableDefaults,this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:Ot(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,t=e.editing.view.document;ce(t.selection)?this._isViewVisible&&Ft(e,"cell"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,n)=>{this._isReady&&this.editor.execute(e,{value:n,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:n,errorText:l}=e,s=wt(()=>{o.errorText=l},Bn);return(r,a,c)=>{s.cancel(),this._isReady&&(n(c)?(this.editor.execute(t,{value:c,batch:this._undoStepBatch}),o.errorText=null):s())}}}class x extends S{attributeName;_defaultValue;_defaultContentTableValue;_defaultLayoutTableValue;constructor(e,t,o){switch(super(e),this.attributeName=t,this._defaultContentTableValue=o,t){case"tableCellBorderStyle":this._defaultLayoutTableValue="none";break;case"tableCellHorizontalAlignment":this._defaultLayoutTableValue="left";break;case"tableCellVerticalAlignment":this._defaultLayoutTableValue="middle";break;default:this._defaultLayoutTableValue=void 0}}refresh(){const t=this.editor.model.document.selection,n=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(t),l=P(t);this._defaultValue=!l||l.getAttribute("tableType")!=="layout"?this._defaultContentTableValue:this._defaultLayoutTableValue,this.isEnabled=!!n.length,this.value=this._getSingleValue(n)}execute(e={}){const{value:t,batch:o}=e,n=this.editor.model,s=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(n.document.selection),r=this._getValueToSet(t);n.enqueueChange(o,a=>{r?s.forEach(c=>a.setAttribute(this.attributeName,r,c)):s.forEach(c=>a.removeAttribute(this.attributeName,c))})}_getAttribute(e){if(!e)return;const t=e.getAttribute(this.attributeName);if(t!==this._defaultValue)return t}_getValueToSet(e){if(e!==this._defaultValue)return e}_getSingleValue(e){const t=this._getAttribute(e[0]);return e.every(n=>this._getAttribute(n)===t)?t:void 0}}class Nn extends x{constructor(e,t){super(e,"tableCellWidth",t)}_getValueToSet(e){if(e=O(e,"px"),e!==this._defaultValue)return e}}class Wn extends y{static get pluginName(){return"TableCellWidthEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[ae]}init(){const e=this.editor,t=Be(e.config.get("table.tableCellProperties.defaultProperties"));Z(e.model.schema,e.conversion,{modelAttribute:"tableCellWidth",styleName:"width",attributeName:"width",attributeType:"length",defaultValue:t.width}),e.commands.add("tableCellWidth",new Nn(e,t.width))}}class Fn extends x{constructor(e,t){super(e,"tableCellPadding",t)}_getAttribute(e){if(!e)return;const t=D(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}class Dn extends x{constructor(e,t){super(e,"tableCellHeight",t)}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}class On extends x{constructor(e,t){super(e,"tableCellBackgroundColor",t)}}class Hn extends x{constructor(e,t){super(e,"tableCellVerticalAlignment",t)}}class Mn extends x{constructor(e,t){super(e,"tableCellHorizontalAlignment",t)}}class Un extends x{constructor(e,t){super(e,"tableCellBorderStyle",t)}_getAttribute(e){if(!e)return;const t=D(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class zn extends x{constructor(e,t){super(e,"tableCellBorderColor",t)}_getAttribute(e){if(!e)return;const t=D(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class jn extends x{constructor(e,t){super(e,"tableCellBorderWidth",t)}_getAttribute(e){if(!e)return;const t=D(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}const tt=/^(top|middle|bottom)$/,ot=/^(left|center|right|justify)$/;class $n extends y{static get pluginName(){return"TableCellPropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[ae,Wn]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableCellProperties.defaultProperties",{});const n=Be(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"});e.data.addStyleProcessorRules(gt),Kn(t,o,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),e.commands.add("tableCellBorderStyle",new Un(e,n.borderStyle)),e.commands.add("tableCellBorderColor",new zn(e,n.borderColor)),e.commands.add("tableCellBorderWidth",new jn(e,n.borderWidth)),Z(t,o,{modelAttribute:"tableCellHeight",styleName:"height",attributeName:"height",attributeType:"length",defaultValue:n.height}),e.commands.add("tableCellHeight",new Dn(e,n.height)),e.data.addStyleProcessorRules(po),Z(t,o,{modelAttribute:"tableCellPadding",styleName:"padding",reduceBoxSides:!0,defaultValue:n.padding}),e.commands.add("tableCellPadding",new Fn(e,n.padding)),e.data.addStyleProcessorRules(ft),Z(t,o,{modelAttribute:"tableCellBackgroundColor",styleName:"background-color",attributeName:"bgcolor",attributeType:"color",defaultValue:n.backgroundColor}),e.commands.add("tableCellBackgroundColor",new On(e,n.backgroundColor)),Gn(t,o,n.horizontalAlignment),e.commands.add("tableCellHorizontalAlignment",new Mn(e,n.horizontalAlignment)),qn(t,o,n.verticalAlignment),e.commands.add("tableCellVerticalAlignment",new Hn(e,n.verticalAlignment))}}function Kn(i,e,t){const o={width:"tableCellBorderWidth",color:"tableCellBorderColor",style:"tableCellBorderStyle"};i.extend("tableCell",{allowAttributes:Object.values(o)});for(const n of Object.values(o))i.setAttributeProperties(n,{isFormatting:!0});ge(e,"td",o,t),ge(e,"th",o,t),U(e,{modelElement:"tableCell",modelAttribute:o.style,styleName:"border-style"}),U(e,{modelElement:"tableCell",modelAttribute:o.color,styleName:"border-color"}),U(e,{modelElement:"tableCell",modelAttribute:o.width,styleName:"border-width"})}function Gn(i,e,t){i.extend("tableCell",{allowAttributes:["tableCellHorizontalAlignment"]}),i.setAttributeProperties("tableCellHorizontalAlignment",{isFormatting:!0}),e.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellHorizontalAlignment"},view:o=>({key:"style",value:{"text-align":o}})}),e.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"text-align":ot}},model:{key:"tableCellHorizontalAlignment",value:(o,n,l)=>{const s=V(t,"left",l),r=o.getStyle("text-align");if(r!==s)return r;n.consumable.consume(o,{styles:"text-align"})}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{align:ot}},model:{key:"tableCellHorizontalAlignment",value:(o,n,l)=>{const s=V(t,"left",l),r=o.getAttribute("align");if(r!==s)return r;n.consumable.consume(o,{attributes:"align"})}}})}function qn(i,e,t){i.extend("tableCell",{allowAttributes:["tableCellVerticalAlignment"]}),i.setAttributeProperties("tableCellVerticalAlignment",{isFormatting:!0}),e.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellVerticalAlignment"},view:o=>({key:"style",value:{"vertical-align":o}})}),e.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"vertical-align":tt}},model:{key:"tableCellVerticalAlignment",value:(o,n,l)=>{const s=V(t,"middle",l),r=o.getStyle("vertical-align");if(r!==s)return r;n.consumable.consume(o,{styles:"vertical-align"})}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{valign:tt}},model:{key:"tableCellVerticalAlignment",value:(o,n,l)=>{const s=V(t,"middle",l),r=o.getAttribute("valign");if(r!==s)return r;n.consumable.consume(o,{attributes:"valign"})}}})}class kl extends y{static get pluginName(){return"TableCellProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[$n,Ln]}}class H extends S{attributeName;_defaultValue;_defaultContentTableValue;_defaultLayoutTableValue;constructor(e,t,o){super(e),this.attributeName=t,this._defaultContentTableValue=o,this._defaultLayoutTableValue=t==="tableBorderStyle"?"none":void 0}refresh(){const t=this.editor.model.document.selection,o=P(t);this._defaultValue=!o||o.getAttribute("tableType")!=="layout"?this._defaultContentTableValue:this._defaultLayoutTableValue,this.isEnabled=!!o,this.value=this._getValue(o)}execute(e={}){const t=this.editor.model,o=t.document.selection,{value:n,batch:l}=e,s=P(o),r=this._getValueToSet(n);t.enqueueChange(l,a=>{r?a.setAttribute(this.attributeName,r,s):a.removeAttribute(this.attributeName,s)})}_getValue(e){if(!e)return;const t=e.getAttribute(this.attributeName);if(t!==this._defaultValue)return t}_getValueToSet(e){if(e!==this._defaultValue)return e}}class Jn extends H{constructor(e,t){super(e,"tableBackgroundColor",t)}}class Xn extends H{constructor(e,t){super(e,"tableBorderColor",t)}_getValue(e){if(!e)return;const t=D(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class Yn extends H{constructor(e,t){super(e,"tableBorderStyle",t)}_getValue(e){if(!e)return;const t=D(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class Zn extends H{constructor(e,t){super(e,"tableBorderWidth",t)}_getValue(e){if(!e)return;const t=D(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}class Qn extends H{constructor(e,t){super(e,"tableWidth",t)}_getValueToSet(e){if(e=O(e,"px"),e!==this._defaultValue)return e}}class el extends H{constructor(e,t){super(e,"tableHeight",t)}_getValueToSet(e){if(e=O(e,"px"),e!==this._defaultValue)return e}}class tl extends H{constructor(e,t){super(e,"tableAlignment",t)}}const ol=/^(left|center|right)$/,nl=/^(left|none|right)$/;class ll extends y{static get pluginName(){return"TablePropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[ae]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableProperties.defaultProperties",{});const n=Mt(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0});e.data.addStyleProcessorRules(gt),il(t,o,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),e.commands.add("tableBorderColor",new Xn(e,n.borderColor)),e.commands.add("tableBorderStyle",new Yn(e,n.borderStyle)),e.commands.add("tableBorderWidth",new Zn(e,n.borderWidth)),sl(t,o,n.alignment),e.commands.add("tableAlignment",new tl(e,n.alignment)),nt(t,o,{modelAttribute:"tableWidth",styleName:"width",attributeName:"width",attributeType:"length",defaultValue:n.width}),e.commands.add("tableWidth",new Qn(e,n.width)),nt(t,o,{modelAttribute:"tableHeight",styleName:"height",attributeName:"height",attributeType:"length",defaultValue:n.height}),e.commands.add("tableHeight",new el(e,n.height)),e.data.addStyleProcessorRules(ft),rl(t,o,{modelAttribute:"tableBackgroundColor",styleName:"background-color",attributeName:"bgcolor",attributeType:"color",defaultValue:n.backgroundColor}),e.commands.add("tableBackgroundColor",new Jn(e,n.backgroundColor))}}function il(i,e,t){const o={width:"tableBorderWidth",color:"tableBorderColor",style:"tableBorderStyle"};i.extend("table",{allowAttributes:Object.values(o)});for(const n of Object.values(o))i.setAttributeProperties(n,{isFormatting:!0});ge(e,"table",o,t),X(e,{modelAttribute:o.color,styleName:"border-color"}),X(e,{modelAttribute:o.style,styleName:"border-style"}),X(e,{modelAttribute:o.width,styleName:"border-width"})}function sl(i,e,t){i.extend("table",{allowAttributes:["tableAlignment"]}),i.setAttributeProperties("tableAlignment",{isFormatting:!0}),e.for("downcast").attributeToAttribute({model:{name:"table",key:"tableAlignment",values:["left","center","right"]},view:{left:{key:"style",value:{float:"left"}},right:{key:"style",value:{float:"right"}},center:(o,n,l)=>({key:"style",value:l.item.getAttribute("tableType")!=="layout"?{float:"none"}:{"margin-left":"auto","margin-right":"auto"}})},converterPriority:"high"}),e.for("upcast").attributeToAttribute({view:{name:/^(table|figure)$/,styles:{float:nl}},model:{key:"tableAlignment",value:(o,n,l)=>{if(o.name=="figure"&&!o.hasClass("table"))return;const s=V(t,"",l);let r=o.getStyle("float");if(r==="none"&&(r="center"),r!==s)return r;n.consumable.consume(o,{styles:"float"})}}}).attributeToAttribute({view:{name:/^(table|figure)$/,styles:{"margin-left":"auto","margin-right":"auto"}},model:{key:"tableAlignment",value:(o,n,l)=>{if(o.name=="figure"&&!o.hasClass("table"))return;const s=V(t,"",l),r="center";if(r!==s)return r;n.consumable.consume(o,{styles:["margin-left","margin-right"]})}}}).attributeToAttribute({view:{name:"table",attributes:{align:ol}},model:{key:"tableAlignment",value:(o,n,l)=>{const s=V(t,"",l),r=o.getAttribute("align");if(r!==s)return r;n.consumable.consume(o,{attributes:"align"})}}})}function rl(i,e,t){const{modelAttribute:o}=t;i.extend("table",{allowAttributes:[o]}),i.setAttributeProperties(o,{isFormatting:!0}),xe(e,{viewElement:"table",...t}),X(e,t)}function nt(i,e,t){const{modelAttribute:o}=t;i.extend("table",{allowAttributes:[o]}),i.setAttributeProperties(o,{isFormatting:!0}),xe(e,{viewElement:/^(table|figure)$/,shouldUpcast:n=>!(n.name=="table"&&n.parent.name=="figure"||n.name=="figure"&&!n.hasClass("table")),...t}),U(e,{modelElement:"table",...t})}class al extends W{options;focusTracker;keystrokes;children;borderStyleDropdown;borderWidthInput;borderColorInput;backgroundInput;widthInput;heightInput;alignmentToolbar;saveButtonView;cancelButtonView;_focusables;_focusCycler;constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",alignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:n,borderColorInput:l,borderRowLabel:s}=this._createBorderFields(),{backgroundRowLabel:r,backgroundInput:a}=this._createBackgroundFields(),{widthInput:c,operatorLabel:d,heightInput:u,dimensionsLabel:h}=this._createDimensionFields(),{alignmentToolbar:b,alignmentLabel:m}=this._createAlignmentFields();this.focusTracker=new re,this.keystrokes=new se,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=n,this.borderColorInput=l,this.backgroundInput=a,this.widthInput=c,this.heightInput=u,this.alignmentToolbar=b;const{saveButtonView:g,cancelButtonView:f}=this._createActionButtons();this.saveButtonView=g,this.cancelButtonView=f,this._focusables=new Ve,this._focusCycler=new ke({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new ht(e,{label:this.t("Table properties")})),this.children.add(new A(e,{labelView:s,children:[s,o,l,n],class:"ck-table-form__border-row"})),this.children.add(new A(e,{labelView:r,children:[r,a],class:"ck-table-form__background-row"})),this.children.add(new A(e,{children:[new A(e,{labelView:h,children:[h,c,d,u],class:"ck-table-form__dimensions-row"}),new A(e,{labelView:m,children:[m,b],class:"ck-table-properties-form__alignment-row"})]})),this.children.add(new A(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),mt({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.alignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=ie({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color,colorPickerConfig:this.options.colorPickerConfig}),n=this.locale,l=this.t,s=l("Style"),r=new I(n);r.text=l("Border");const a=Ee(l),c=new R(n,bt);c.set({label:s,class:"ck-table-form__border-style"}),c.fieldView.buttonView.set({ariaLabel:s,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:s}),c.fieldView.buttonView.bind("label").to(this,"borderStyle",h=>a[h||"none"]),c.fieldView.on("execute",h=>{this.borderStyle=h.source._borderStyleValue}),c.bind("isEmpty").to(this,"borderStyle",h=>!h),Re(c.fieldView,Nt(this,t.style),{role:"menu",ariaLabel:s});const d=new R(n,N);d.set({label:l("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",q),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const u=new R(n,o);return u.set({label:l("Color"),class:"ck-table-form__border-color"}),u.fieldView.bind("value").to(this,"borderColor"),u.bind("isEnabled").to(this,"borderStyle",q),u.fieldView.on("input",()=>{this.borderColor=u.fieldView.value}),this.on("change:borderStyle",(h,b,m,g)=>{q(m)||(this.borderColor="",this.borderWidth=""),q(g)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:r,borderStyleDropdown:c,borderColorInput:u,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new I(e);o.text=t("Background");const n=ie({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),l=new R(e,n);return l.set({label:t("Color"),class:"ck-table-properties-form__background"}),l.fieldView.bind("value").to(this,"backgroundColor"),l.fieldView.on("input",()=>{this.backgroundColor=l.fieldView.value}),{backgroundRowLabel:o,backgroundInput:l}}_createDimensionFields(){const e=this.locale,t=this.t,o=new I(e);o.text=t("Dimensions");const n=new R(e,N);n.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),n.fieldView.bind("value").to(this,"width"),n.fieldView.on("input",()=>{this.width=n.fieldView.element.value});const l=new W(e);l.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const s=new R(e,N);return s.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),s.fieldView.bind("value").to(this,"height"),s.fieldView.on("input",()=>{this.height=s.fieldView.element.value}),{dimensionsLabel:o,widthInput:n,operatorLabel:l,heightInput:s}}_createAlignmentFields(){const e=this.locale,t=this.t,o=new I(e);o.text=t("Alignment");const n=new be(e);return n.set({role:"radiogroup",isCompact:!0,ariaLabel:t("Table alignment toolbar")}),_e({view:this,icons:{left:ro,center:so,right:io},toolbar:n,labels:this._alignmentLabels,propertyName:"alignment",defaultValue:this.options.defaultTableProperties.alignment}),{alignmentLabel:o,alignmentToolbar:n}}_createActionButtons(){const e=this.locale,t=this.t,o=new k(e),n=new k(e),l=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.widthInput,this.heightInput];return o.set({label:t("Save"),icon:at,class:"ck-button-save",type:"submit",withText:!0}),o.bind("isEnabled").toMany(l,"errorText",(...s)=>s.every(r=>!r)),n.set({label:t("Cancel"),icon:ct,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:o,cancelButtonView:n}}get _alignmentLabels(){const e=this.locale,t=this.t,o=t("Align table to the left"),n=t("Center table"),l=t("Align table to the right");return e.uiLanguageDirection==="rtl"?{right:l,center:n,left:o}:{left:o,center:n,right:l}}}function q(i){return i!=="none"}const cl=500,lt={borderStyle:"tableBorderStyle",borderColor:"tableBorderColor",borderWidth:"tableBorderWidth",backgroundColor:"tableBackgroundColor",width:"tableWidth",height:"tableHeight",alignment:"tableAlignment"};class dl extends y{_defaultContentTableProperties;_defaultLayoutTableProperties;_balloon;view=null;_viewWithContentTableDefaults=null;_viewWithLayoutTableDefaults=null;_undoStepBatch;_isReady;static get requires(){return[Q]}static get pluginName(){return"TablePropertiesUI"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("table.tableProperties",{borderColors:le,backgroundColors:le})}init(){const e=this.editor;this._defaultContentTableProperties=Mt(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0}),this._defaultLayoutTableProperties=de(),this._balloon=e.plugins.get(Q),e.ui.componentFactory.add("tableProperties",()=>this._createTablePropertiesButton())}_createTablePropertiesButton(){const e=this.editor,t=e.t,o=new k(e.locale);o.set({label:t("Table properties"),icon:Xt,tooltip:!0}),this.listenTo(o,"execute",()=>this._showView());const n=Object.values(lt).map(l=>e.commands.get(l));return o.bind("isEnabled").toMany(n,"isEnabled",(...l)=>l.some(s=>s)),o}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(e){const t=this.editor,o=t.config.get("table.tableProperties"),n=ee(o.borderColors),l=te(t.locale,n),s=ee(o.backgroundColors),r=te(t.locale,s),a=o.colorPicker!==!1,c=new al(t.locale,{borderColors:l,backgroundColors:r,defaultTableProperties:e,colorPickerConfig:a?o.colorPicker||{}:!1}),d=t.t;c.render(),this.listenTo(c,"submit",()=>{this._hideView()}),this.listenTo(c,"cancel",()=>{this._undoStepBatch.operations.length&&t.execute("undo",this._undoStepBatch),this._hideView()}),c.keystrokes.set("Esc",(b,m)=>{this._hideView(),m()}),dt({emitter:c,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const u=Et(d),h=Bt(d);return c.on("change:borderStyle",this._getPropertyChangeCallback("tableBorderStyle")),c.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:c.borderColorInput,commandName:"tableBorderColor",errorText:u,validator:ne})),c.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:c.borderWidthInput,commandName:"tableBorderWidth",errorText:h,validator:Lt})),c.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:c.backgroundInput,commandName:"tableBackgroundColor",errorText:u,validator:ne})),c.on("change:width",this._getValidatedPropertyChangeCallback({viewField:c.widthInput,commandName:"tableWidth",errorText:h,validator:z})),c.on("change:height",this._getValidatedPropertyChangeCallback({viewField:c.heightInput,commandName:"tableHeight",errorText:h,validator:z})),c.on("change:alignment",this._getPropertyChangeCallback("tableAlignment")),c}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableBorderStyle");Object.entries(lt).map(([o,n])=>{const l=o,s=this.view===this._viewWithContentTableDefaults?this._defaultContentTableProperties[l]||"":this._defaultLayoutTableProperties[l]||"";return[l,e.get(n).value||s]}).forEach(([o,n])=>{(o==="borderColor"||o==="borderWidth")&&t.value==="none"||this.view.set(o,n)}),this._isReady=!0}_showView(){const e=this.editor,t=oe(e.editing.view.document.selection),o=t&&e.editing.mapper.toModelElement(t),n=!o||o.getAttribute("tableType")!=="layout";n&&!this._viewWithContentTableDefaults?this._viewWithContentTableDefaults=this._createPropertiesView(this._defaultContentTableProperties):!n&&!this._viewWithLayoutTableDefaults&&(this._viewWithLayoutTableDefaults=this._createPropertiesView(this._defaultLayoutTableProperties)),this.view=n?this._viewWithContentTableDefaults:this._viewWithLayoutTableDefaults,this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:Dt(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,t=e.editing.view.document;oe(t.selection)?this._isViewVisible&&Ft(e,"table"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,n)=>{this._isReady&&this.editor.execute(e,{value:n,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:n,errorText:l}=e,s=wt(()=>{o.errorText=l},cl);return(r,a,c)=>{s.cancel(),this._isReady&&(n(c)?(this.editor.execute(t,{value:c,batch:this._undoStepBatch}),o.errorText=null):s())}}}class xl extends y{static get pluginName(){return"TableProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[ll,dl]}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ul(i){i.document.registerPostFixer(e=>hl(e,i))}function hl(i,e){const t=e.document.differ.getChanges();let o=!1;for(const n of t){if(n.type!="insert")continue;const l=n.position.parent;if(l.is("element","table")||n.name=="table"){const s=n.name=="table"?n.position.nodeAfter:l,r=Array.from(s.getChildren()).filter(c=>c.is("element","caption")),a=r.shift();if(!a)continue;for(const c of r)i.move(i.createRangeIn(c),a,"end"),i.remove(c);a.nextSibling&&(i.move(i.createRangeOn(a),s,"end"),o=!0),o=!!r.length||o}}return o}function it(i){return!!i&&i.is("element","table")}function Se(i){for(const e of i.getChildren())if(e.is("element","caption"))return e;return null}function ml(i){const e=P(i);return e?Se(e):null}function bl(i){const e=i.parent;return i.name=="figcaption"&&e&&e.is("element","figure")&&e.hasClass("table")?{name:!0}:i.name=="caption"&&e&&e.is("element","table")?{name:!0}:null}class gl extends S{refresh(){const e=this.editor,t=P(e.model.document.selection);this.isEnabled=!!t&&e.model.schema.checkChild(t,"caption"),this.isEnabled?this.value=!!Se(t):this.value=!1}execute({focusCaptionOnShow:e=!1}={}){this.editor.model.change(t=>{this.value?this._hideTableCaption(t):this._showTableCaption(t,e)})}_showTableCaption(e,t){const o=this.editor.model,n=P(o.document.selection),r=this.editor.plugins.get("TableCaptionEditing")._getSavedCaption(n)||e.createElement("caption");o.insertContent(r,n,"end"),t&&e.setSelection(r,"in")}_hideTableCaption(e){const t=this.editor.model,o=P(t.document.selection),n=this.editor.plugins.get("TableCaptionEditing"),l=Se(o);n._saveCaption(o,l),t.deleteContent(e.createSelection(l,"on"))}}class fl extends y{_savedCaptionsMap=new WeakMap;static get pluginName(){return"TableCaptionEditing"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.model.schema,o=e.editing.view,n=e.t,l=e.config.get("table.tableCaption.useCaptionElement");t.isRegistered("caption")?t.extend("caption",{allowIn:"table"}):t.register("caption",{allowIn:"table",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleTableCaption",new gl(this.editor)),l&&e.plugins.get("TableEditing").registerAdditionalSlot({filter:r=>r.is("element","caption"),positionOffset:"end"}),e.conversion.for("upcast").elementToElement({view:bl,model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(s,{writer:r})=>it(s.parent)?r.createContainerElement(l?"caption":"figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(s,{writer:r})=>{if(!it(s.parent))return null;const a=r.createEditableElement(l?"caption":"figcaption");return r.setCustomProperty("tableCaption",!0,a),a.placeholder=n("Enter table caption"),go({view:o,element:a,keepOnFocus:!0}),st(a,r)}}),ul(e.model)}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?fo.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}}class pl extends y{static get pluginName(){return"TableCaptionUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.editing.view,o=e.t;e.ui.componentFactory.add("toggleTableCaption",n=>{const l=e.commands.get("toggleTableCaption"),s=new k(n);return s.set({icon:Jt,tooltip:!0,isToggleable:!0}),s.bind("isOn","isEnabled").to(l,"value","isEnabled"),s.bind("label").to(l,"value",r=>o(r?"Toggle caption off":"Toggle caption on")),this.listenTo(s,"execute",()=>{if(e.execute("toggleTableCaption",{focusCaptionOnShow:!0}),l.value){const r=ml(e.model.document.selection),a=e.editing.mapper.toViewElement(r);if(!a)return;t.scrollToTheSelection(),t.change(c=>{c.addClass("table__caption_highlighted",a)})}e.editing.view.focus()}),s})}}class Il extends y{static get pluginName(){return"TableCaption"}static get isOfficialPlugin(){return!0}static get requires(){return[fl,pl]}}export{Rl as T,Vl as a,Il as b,xl as c,kl as d};
