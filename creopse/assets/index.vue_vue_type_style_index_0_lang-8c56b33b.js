var U=Object.defineProperty;var k=(r,t,e)=>t in r?U(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var x=(r,t,e)=>(k(r,typeof t!="symbol"?t+"":t,e),e);import{a as z}from"./index.vue_vue_type_script_setup_true_lang-41b86c15.js";import{M as b}from"./media-library-6b3a0d07.js";import{v as A,B as E,c as M,n as L}from"./index-a2e2de3a.js";import{e as w}from"./ckeditor_ckeditor5-core-c8d003a2.js";import{H as F}from"./ckeditor_ckeditor5-ui-a35c6a55.js";import{A as H}from"./ckeditor_ckeditor5-alignment-d6e8c5b6.js";import{A as _}from"./ckeditor_ckeditor5-autoformat-9f2dc9af.js";import{B as $,I as P,U as V,S as N,C as D,a as O,b as G}from"./ckeditor_ckeditor5-basic-styles-a9505c26.js";import{B as q}from"./ckeditor_ckeditor5-block-quote-3d12180a.js";import"./ckeditor_ckeditor5-build-classic-a5a6feb5.js";import{C as W}from"./ckeditor_ckeditor5-code-block-1effa76f.js";import{C as Q}from"./ckeditor_ckeditor5-editor-classic-6eebe087.js";import{E as j}from"./ckeditor_ckeditor5-essentials-4982141b.js";import{F as Y}from"./ckeditor_ckeditor5-find-and-replace-d20c852b.js";import{F as J,a as K}from"./ckeditor_ckeditor5-font-603d26b5.js";import{H as X}from"./ckeditor_ckeditor5-heading-08abeb34.js";import{H as Z}from"./ckeditor_ckeditor5-horizontal-line-f0252081.js";import{I as ee,a as te,b as oe,c as ae,d as le,e as ie,f as re,g as se}from"./ckeditor_ckeditor5-image-fe0f4d65.js";import{I as ne}from"./ckeditor_ckeditor5-indent-d36b38bc.js";import{L as de}from"./ckeditor_ckeditor5-link-8d87809e.js";import{L as me,T as ue}from"./ckeditor_ckeditor5-list-295bac13.js";import{M as pe}from"./ckeditor_ckeditor5-media-embed-952338e9.js";import{R as ce}from"./ckeditor_ckeditor5-remove-format-b8823d58.js";import{S as ge}from"./ckeditor_ckeditor5-source-editing-ff327da5.js";import{S as fe,a as be}from"./ckeditor_ckeditor5-special-characters-36dd01c3.js";import{T as ye,a as he,b as Ie,c as Ce,d as Te}from"./ckeditor_ckeditor5-table-79bdb612.js";import{c as Se}from"./ckeditor_ckeditor5-typing-70b03be4.js";import{B as xe}from"./ckeditor_ckeditor5-upload-37383558.js";import{b as Ee}from"./axios-96fb5abd.js";import{d as ve,p as v,i as Be,b as Ae,y as we,as as Fe,o as Re,c as Ue,Y as B}from"./vue_runtime-core-4f5fb440.js";import{u as ke}from"./vue-i18n-84a05dd5.js";import{r as ze,u as p,c as Me}from"./vue_reactivity-852d8377.js";const{t:Le}=A.global;class He extends w{init(){this.editor.ui.componentFactory.add("addCreopseMedia",e=>{const a=new F(e);return a.set({label:Le("addMedia"),withText:!0,tooltip:!0}),a.on("execute",()=>{const s=new Event("add-creopse-media");document.dispatchEvent(s)}),a})}}const{t:h}=A.global;class _e extends w{init(){const t=this.editor;t.ui.componentFactory.add("fullScreen",e=>{const a=new F(e);let s=0;return a.set({label:h("fullscreen"),withText:!0,tooltip:!0}),a.on("execute",()=>{s==1?(t.sourceElement.nextElementSibling.removeAttribute("id"),document.body.removeAttribute("id"),a.set({label:h("fullscreen"),withText:!0,tooltip:!0}),s=0):(t.sourceElement.nextElementSibling.setAttribute("id","fullscreeneditor"),document.body.setAttribute("id","fullscreenoverlay"),a.set({label:h("normalSize"),withText:!0,tooltip:!0}),s=1)}),a})}}class $e{constructor(t){x(this,"loader");this.loader=t}async upload(){return this.loader.file.then(t=>new Promise((e,a)=>{this._sendRequest(e,a,t)}))}abort(){}async _sendRequest(t,e,a){var m,f;const s=this.loader,c=(m=E)==null?void 0:m.apiRequestHeaders,y=M();c&&(c.Authorization=`Bearer ${y.accessToken}`);const g=new FormData,u=await L(a,{maxSizeMB:1});g.append("file",u),g.append("folder","ck"),Ee.post(`${(f=E)==null?void 0:f.apiUrl}/media-files/upload`,g,{headers:c,onUploadProgress:n=>{n.total!==null&&(s.uploadTotal=n.total,s.uploaded=n.loaded)}}).then(async n=>{const d=n.data;t({default:d.data.url})}).catch(n=>{e(n)})}}function Pe(r){r.plugins.get("FileRepository").createUploadAdapter=t=>new $e(t)}const I="{{BASE_URL}}",It=ve({__name:"index",props:{modelValue:{default:""},disabled:{type:Boolean,default:!1},tagName:{default:"div"},placeholder:{default:""},lang:{default:null},minHeight:{default:100},shouldNotGroupWhenFull:{type:Boolean,default:!0},toolbarItems:{default:()=>["heading","|","bold","italic","underline","strikethrough","code","codeBlock","subscript","superscript","removeFormat","selectAll","specialCharacters","|","fontSize","fontFamily","fontColor","fontBackgroundColor","|","horizontalLine","blockQuote","bulletedList","numberedList","todoList","alignment","|","outdent","indent","|","link","uploadImage","insertTable","mediaEmbed","findAndReplace","|","undo","redo","|","sourceEditing","addCreopseMedia","fullScreen"]},imageToolbarItems:{default:()=>["imageStyle:inline","imageStyle:block","imageStyle:side","|","imageStyle:alignLeft","imageStyle:alignCenter","imageStyle:alignRight","|","resizeImage:25","resizeImage:50","resizeImage:75","resizeImage:original","|","toggleImageCaption","imageTextAlternative"]},tableContentToolbar:{default:()=>["toggleTableCaption","tableColumn","tableRow","mergeTableCells"]},enableUpload:{type:Boolean,default:!1}},emits:["update:modelValue","ready","focus","blur","destroy"],setup(r,{emit:t}){const e=r,a=t,s=Q,{locale:c,t:y}=ke(),g=v(()=>{const d={language:e.lang||c.value,placeholder:e.placeholder,plugins:[j,_,$,P,V,N,D,O,G,q,X,ee,te,oe,ae,le,ie,re,se,de,me,H,ye,he,Ie,Ce,Te,pe,ne,Se,W,Y,J,K,Z,ue,ce,ge,fe,be,He,_e],extraPlugins:[],toolbar:{items:e.toolbarItems,shouldNotGroupWhenFull:e.shouldNotGroupWhenFull},image:{toolbar:e.imageToolbarItems,resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]},table:{contentToolbar:e.tableContentToolbar}};return e.enableUpload?d.extraPlugins.push(Pe):d.plugins.push(xe),d});v(()=>typeof e.minHeight=="number"?`${e.minHeight}px`:e.minHeight);const u=ze(!1),m=Be("appConfig"),f=()=>{u.value=!0};Ae(()=>{document.addEventListener("add-creopse-media",f)}),we(()=>{document.removeEventListener("add-creopse-media",f)});const n=d=>{if(d){let o=e.modelValue||"";d.forEach(l=>{l.type==b.IMAGE&&(o+=`<p><img src="${l.url}" /></p>`),l.type==b.DOCUMENT&&(o+=`<p><a href="${l.url}">${l.name}</a></p>`),l.type==b.AUDIO&&(o+=`<p style="text-align:center">[audio]${l.url}[/audio]</p>`),l.type==b.VIDEO&&(o+=`<p style="text-align:center">[video]${l.url}[/video]</p>`),l.type==b.OTHER&&(o+=`<p><a href="${l.url}">${l.name}</a></p>`)}),a("update:modelValue",o==null?void 0:o.replace(new RegExp(`${m==null?void 0:m.apiBaseUrl}/storage`,"g"),I))}u.value=!1};return(d,o)=>{var C,T;const l=Fe("ckeditor"),R=z;return Re(),Ue("section",null,[B(l,{editor:p(s),"tag-name":e.tagName,disabled:e.disabled,config:p(g),"model-value":(T=e.modelValue)==null?void 0:T.replace(new RegExp(I,"g"),`${(C=p(m))==null?void 0:C.apiBaseUrl}/storage`),class:"page-content-editor",onInput:o[0]||(o[0]=i=>{var S;return a("update:modelValue",i==null?void 0:i.replace(new RegExp(`${(S=p(m))==null?void 0:S.apiBaseUrl}/storage`,"g"),I))}),onDestroy:o[1]||(o[1]=i=>a("destroy",i)),onReady:o[2]||(o[2]=i=>a("ready",i)),onFocus:o[3]||(o[3]=i=>a("focus",i)),onBlur:o[4]||(o[4]=i=>a("blur",i))},null,8,["editor","tag-name","disabled","config","model-value"]),B(R,{show:p(u),"onUpdate:show":o[5]||(o[5]=i=>Me(u)?u.value=i:null),title:p(y)("add"),"selection-type":"item","selection-multiple":"",onSubmit:n},null,8,["show","title"])])}}});export{It as _};
