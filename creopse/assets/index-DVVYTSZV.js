import{i as H}from"./ckeditor_ckeditor5-vue-D9YIFk5Z.js";import{u as pt,a as mt,b as ft,c as vt,d as R,M as _,e as yt,f as gt,g as ht,h as kt,i as wt,j as bt,k as Mt,l as Ct,_ as It,m as xt}from"./media-file-DZbnU6_U.js";import{_ as Dt}from"./PageLayout.vue_vue_type_script_setup_true_lang-PAUYRhpU.js";import{u as Ft,K as St,_ as Tt,R as Et,L as Ut,y as de,M as zt,N as At,O as Ot}from"./index-BkcZCWEr.js";import{I as Rt}from"./iconify_vue-DK9FHL8l.js";import{a as Pt}from"./vue-router-JM7pifDK.js";import{u as $t}from"./vueuse_core-aA8IVeLX.js";import{v as X}from"./uuid-8I8R7izr.js";import{a as Nt,l as Vt,x as Bt,J as Lt,B as jt,q as Yt,a5 as Gt,a6 as Qt,aa as Ht,D as qt,M as Kt,O as Wt,R as Jt,ab as Zt,Z as Xt,o as en,$ as tn,t as nn,a3 as on,C as ln,a0 as sn,ac as an}from"./naive-ui-U3LV0D3Q.js";import{u as cn}from"./vue-i18n-DGGON2e6.js";import{r as un}from"./vueuse_shared-x2l23lLx.js";const{unref:rn}=await H("vue"),{defineComponent:dn}=await H("vue"),{unref:e,toDisplayString:i,createElementVNode:u,resolveComponent:io,createVNode:l,withCtx:n,createTextVNode:k,openBlock:s,createBlock:y,createCommentVNode:f,createElementBlock:r,isRef:b,Fragment:S,renderList:ee,vShow:_n,withDirectives:pn}=await H("vue"),mn={key:0,class:"flex items-center gap-3"},fn={key:1,class:"flex items-center gap-3"},vn={class:"flex justify-between items-center"},yn={class:"flex items-center gap-3"},gn={key:0},hn={key:0},kn={key:1},wn={key:2},bn={key:3},Mn={key:4},Cn={key:0},In={key:0},xn={class:"flex items-center justify-center h-[200px] relative"},Dn={class:"text-center text-dimgray text-sm"},Fn={class:"flex items-center gap-2"},Sn={class:"flex items-center gap-2"},Tn={key:1,class:"flex items-center justify-center"},En={id:"music",preload:"all",autoplay:"",controls:"",style:{width:"100%"}},Un=["src"],zn={id:"video",autoplay:"",controls:"",style:{width:"100%"}},An=["src"],On={class:"w-[30%]"},Rn={key:0},Pn={key:1},$n={key:2},Nn={key:3},Vn={key:4},Bn={key:0},Ln={key:1},jn={key:2},Yn={key:3},Gn={key:4},Qn={key:5},Hn={key:6},{ref:v,h:qn,computed:te,watch:_e}=await H("vue"),P=10,co=dn({__name:"index",setup(Kn){const{t,locale:pe}=cn(),{getVideoThumbnail:me,isSmScreen:ne,isMdScreen:oe,isLgScreen:fe}=Ft(),$=Nt(),T=Vt(),ve=Pt(),{mediaFileTypes:ye}=pt(),q=v(X()),N=v(""),ge=v(null),he=un(N,500),E=v([]),V=v(!1),h=v({}),I=v([]),M=v(0),ke=c=>qn("span",{},{default:()=>de(c.label,{inPattern:"YYYY-MM",outPattern:"MMMM YYYY",locale:pe.value})}),le=v(0),B=v(12),U=v(1),we=te(()=>({pageSize:B.value,query:he.value,page:U.value,type:M.value,months:I.value})),be=c=>{U.value=c,C()},Me=c=>{B.value=c,C()},{data:Ce,refetch:C,isPending:se}=mt(we);_e(()=>Ce.value,c=>{E.value=c?.mediaFiles||[],le.value=c?.meta?.total||0,U.value=c?.meta?.currentPage||1;let a=!0;E.value.length===0&&(a=!1);for(const d of E.value)if(d.id&&!h.value[d.id]){a=!1;break}V.value=a,q.value=X()},{deep:!0,immediate:!0});const{data:Ie}=ft(),{data:ae}=vt(),{data:xe}=R(_.IMAGE),{data:De}=R(_.VIDEO),{data:Fe}=R(_.AUDIO),{data:Se}=R(_.DOCUMENT),{data:Te}=R(_.OTHER),{data:ie}=yt(),L=te(()=>(Ie.value||[]).map(c=>({label:c,value:c}))),{mutate:ce}=gt(),Ee=async c=>{T.warning({title:t("confirm"),content:t("confirmDeleteMediaFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:()=>{M.value==P?ce({...c,force:!0}):ce(c)}})},{mutate:Ue}=ht(),ze=async c=>{T.warning({title:t("confirm"),content:t("confirmRestoreMediaFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{Ue(c)}})},{copy:Ae,copied:Oe,isSupported:Re}=$t(),Pe=async c=>{c.url&&Ae(c.url)};_e(()=>Oe.value,c=>{c&&$.success(t("mediaLinkCopied"))});const A=v(null),j=v(!1),Y=v(!1),$e=async c=>{switch(A.value=c,c.type){case _.IMAGE:break;case _.VIDEO:Y.value=!0;break;case _.AUDIO:j.value=!0;break;case _.DOCUMENT:window.open(c.url);break;default:$.info(t("cannotOpenThisFile"));break}},p=v(null),G=v(!1),Ne=async c=>{p.value=c,G.value=!0},K=v(null),x=v(null),D=v(!1),{mutate:Ve}=St(),{mutate:Be}=kt(),{mutate:Le}=wt(),je=async c=>{x.value=c,Ve(c.path,{onSuccess(a,d,m){K.value=a,D.value=!0}})},Ye=async(c,a)=>{var d=zt(a);d=await At(d,{maxSizeMB:1});const m=new FormData;m.append("file",d),T.warning({title:t("registration"),content:t("confirmReplaceCurrentFile"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{x.value&&m.append("filename",x.value?.name),Be({id:x.value?.id,data:m},{onSuccess(g,O,W){D.value=!1}})},onNegativeClick:async()=>{x.value&&m.append("filename",Ot(6)+"-"+x.value?.name),Le(m,{onSuccess(g,O,W){D.value=!1}})}})},{mutate:Ge}=bt(),Qe=async()=>{T.warning({title:t("confirm"),content:t("confirmEmptyTrash"),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{Ge()}})},z=te(()=>{let c=0;for(const a in h.value)h.value[a]&&c++;return c});function ue(){h.value={},C()}const{mutate:He}=Mt(),qe=async()=>(z.value?T.warning({title:t("confirm"),content:t("deleteSelectionWarningMessage",[z.value]),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{He({selectedItems:h.value,force:M.value==P},{onSuccess:()=>{ue()}})}}):$.warning(t("noItemSelected")),!1),{mutate:Ke}=Ct(),We=async()=>(z.value?T.warning({title:t("confirm"),content:t("restoreSelectionWarningMessage",[z.value]),positiveText:t("yes"),negativeText:t("no"),onPositiveClick:async()=>{Ke(Object.keys(h.value).filter(c=>h.value[c]),{onSuccess:()=>{h.value={}}})}}):$.warning(t("noItemSelected")),!1);return(c,a)=>{const d=Rt,m=Yt,g=jt,O=Lt,W=nn,Je=ln,Ze=on,J=Qt,Xe=Gt,Z=Bt,et=Zt,tt=It,nt=Jt,ot=Wt,lt=Tt,st=Kt,at=qt,it=Ht,ct=Xt,ut=en,rt=tn,dt=Dt,Q=sn,re=an,_t=xt;return s(),r(S,null,[l(dt,null,{"header-extra":n(()=>[e(z)>0?(s(),r("section",mn,[u("span",null,i(e(t)("nbItemsSelected",[e(z)])),1),e(M)==P?(s(),y(g,{key:0,type:"success",size:"small",secondary:"",onClick:We},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"mdi:delete-restore"})]),_:1})]),default:n(()=>[k(" "+i(e(t)("restore")),1)]),_:1})):f("",!0),l(g,{type:"error",size:"small",secondary:"",onClick:qe},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:trash-can"})]),_:1})]),default:n(()=>[k(" "+i(e(t)("delete")),1)]),_:1}),l(g,{type:"warning",size:"small",secondary:"",onClick:ue},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:close"})]),_:1})]),default:n(()=>[k(" "+i(e(t)("cancelSelection")),1)]),_:1})])):(s(),r("section",fn,[!e(ne)&&!e(oe)?(s(),r(S,{key:0},[l(W,{value:e(I),"onUpdate:value":[a[1]||(a[1]=o=>b(I)?I.value=o:null),a[2]||(a[2]=o=>e(C)())],"render-label":ke,options:e(L),placeholder:e(t)("months"),"max-tag-count":"responsive",filterable:"",multiple:"","label-field":"label","value-field":"value",class:"!w-[200px]"},{action:n(()=>[l(O,{size:"large",class:"w-full","default-checked":e(L).length&&e(I).length===e(L).length,"onUpdate:checked":a[0]||(a[0]=o=>{o?I.value=e(L).map(w=>w.value):I.value=[],e(C)()})},{default:n(()=>[k(i(e(t)("selectAll")),1)]),_:1},8,["default-checked"])]),_:1},8,["value","options","placeholder"]),l(Ze,{class:"!w-[250px]"},{default:n(()=>[l(Je,{ref_key:"searchInputRef",ref:ge,value:e(N),"onUpdate:value":[a[3]||(a[3]=o=>b(N)?N.value=o:null),a[4]||(a[4]=o=>{o||e(C)()})],clearable:!0,placeholder:e(t)("search")},null,8,["value","placeholder"]),l(g,{type:"primary",secondary:"",onClick:a[5]||(a[5]=o=>e(C)())},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:search"})]),_:1})]),_:1})]),_:1})],64)):f("",!0),l(g,{type:"primary",secondary:"",onClick:a[6]||(a[6]=()=>{e(ve).push(e(Et).MEDIA_LIBRARY.PATH+"/add")})},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:add-alt"})]),_:1})]),default:n(()=>[k(" "+i(e(t)("add")),1)]),_:1})]))]),default:n(()=>[pn(l(Z,{size:"small",class:"mb-5"},{default:n(()=>[u("div",vn,[u("div",yn,[l(O,{checked:e(V),"onUpdate:checked":[a[7]||(a[7]=o=>b(V)?V.value=o:null),a[8]||(a[8]=o=>{for(const w of e(E))w.id&&(e(h)[w.id]=o);q.value=("uuidv4"in c?c.uuidv4:rn(X))()})]},{default:n(()=>[k(i(e(t)("selectAll")),1)]),_:1},8,["checked"]),e(M)==P?(s(),y(g,{key:0,secondary:"",type:"error",size:"small",onClick:Qe},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"mdi:delete-forever"})]),_:1})]),default:n(()=>[k(" "+i(e(t)("emptyTrash")),1)]),_:1})):f("",!0)]),l(Xe,{value:e(M),"onUpdate:value":[a[9]||(a[9]=o=>b(M)?M.value=o:null),a[10]||(a[10]=o=>e(C)())],name:"filtertyperadiobuttongroup",size:"medium"},{default:n(()=>[l(J,{value:0},{default:n(()=>[k(i(e(t)("all"))+"  ",1),e(ae)?(s(),r("span",gn," ("+i(e(ae))+") ",1)):f("",!0)]),_:1}),(s(!0),r(S,null,ee(e(ye),o=>(s(),y(J,{key:o.value,value:o.value},{default:n(()=>[k(i(o.label)+"  ",1),o.value==e(_).IMAGE?(s(),r("span",hn," ("+i(e(xe))+") ",1)):o.value==e(_).VIDEO?(s(),r("span",kn," ("+i(e(De))+") ",1)):o.value==e(_).AUDIO?(s(),r("span",wn," ("+i(e(Fe))+") ",1)):o.value==e(_).DOCUMENT?(s(),r("span",bn," ("+i(e(Se))+") ",1)):(s(),r("span",Mn,"("+i(e(Te))+")",1))]),_:2},1032,["value"]))),128)),l(J,{value:P},{default:n(()=>[k(i(e(t)("trash"))+"  ",1),e(ie)?(s(),r("span",Cn,"("+i(e(ie))+")",1)):f("",!0)]),_:1})]),_:1},8,["value"])])]),_:1},512),[[_n,!e(ne)&&!e(oe)&&!e(fe)]]),l(Z,{embedded:"",class:"py-2"},{default:n(()=>[e(E).length&&!e(se)?(s(),r("section",In,[l(it,{"show-toolbar-tooltip":""},{default:n(()=>[l(at,{"x-gap":"12","y-gap":"12",cols:"1 400:2 600:3 900:4 1400:5"},{default:n(()=>[(s(!0),r(S,null,ee(e(E),(o,w)=>(s(),y(st,{key:w},{default:n(()=>[l(lt,{name:"slide-fade",appear:""},{default:n(()=>[l(Z,{bordered:"",hoverable:""},{cover:n(()=>[u("div",xn,[o.type==e(_).IMAGE?(s(),r(S,{key:0},[o.url?(s(),y(et,{key:0,src:o.url,"object-fit":"cover",class:"w-full h-[200px]"},null,8,["src"])):f("",!0)],64)):o.type==e(_).VIDEO?(s(),r(S,{key:1},[o.url?(s(),y(tt,{key:0,load:()=>e(me)(o.url??""),class:"w-full h-[200px] object-cover"},{fallback:n(()=>[l(m,{size:"96"},{default:n(()=>[l(d,{icon:"carbon:document-video"})]),_:1})]),_:2},1032,["load"])):f("",!0)],64)):o.type==e(_).AUDIO?(s(),y(m,{key:2,size:"96"},{default:n(()=>[l(d,{icon:"carbon:document-audio"})]),_:1})):o.type==e(_).DOCUMENT?(s(),y(m,{key:3,size:"96"},{default:n(()=>[l(d,{icon:"carbon:document"})]),_:1})):(s(),y(m,{key:4,size:"96"},{default:n(()=>[l(d,{icon:"carbon:document-unknown"})]),_:1}))])]),header:n(()=>[u("div",Dn,[l(nt,{"line-clamp":1},{default:n(()=>[o.id?(s(),y(O,{key:e(q),checked:e(h)[o.id],"onUpdate:checked":F=>e(h)[o.id]=F,class:"mr-1"},null,8,["checked","onUpdate:checked"])):f("",!0),k(" "+i(o.name),1)]),_:2},1024)])]),action:n(()=>[l(ot,{justify:"space-between",align:"center"},{default:n(()=>[u("div",Fn,[o.type!=e(_).IMAGE?(s(),y(g,{key:0,ternary:"",circle:"",title:e(t)("preview"),onClick:F=>$e(o)},{icon:n(()=>[l(m,null,{default:n(()=>[[e(_).AUDIO,e(_).VIDEO].includes(o.type)?(s(),y(d,{key:0,icon:"carbon:play-filled-alt"})):(s(),y(d,{key:1,icon:"carbon:content-view"}))]),_:2},1024)]),_:2},1032,["title","onClick"])):f("",!0),l(g,{ternary:"",circle:"",title:e(t)("details"),onClick:F=>Ne(o)},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:information-filled"})]),_:1})]),_:2},1032,["title","onClick"])]),u("div",Sn,[o.deletedAt?(s(),y(g,{key:0,ternary:"",circle:"",title:e(t)("restore"),onClick:F=>ze(o)},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"mdi:delete-restore"})]),_:1})]),_:2},1032,["title","onClick"])):f("",!0),e(Re)?(s(),y(g,{key:1,ternary:"",circle:"",title:e(t)("copy"),onClick:F=>Pe(o)},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:copy"})]),_:1})]),_:2},1032,["title","onClick"])):f("",!0),o.type==e(_).IMAGE?(s(),y(g,{key:2,ternary:"",circle:"",title:e(t)("edit"),onClick:F=>je(o)},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:edit"})]),_:1})]),_:2},1032,["title","onClick"])):f("",!0),l(g,{ternary:"",circle:"",title:e(t)("delete"),onClick:F=>Ee(o)},{icon:n(()=>[l(m,null,{default:n(()=>[l(d,{icon:"carbon:trash-can"})]),_:1})]),_:2},1032,["title","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(ct,{page:e(U),"onUpdate:page":[a[11]||(a[11]=o=>b(U)?U.value=o:null),be],class:"mt-10 justify-center","show-size-picker":"","page-size":e(B),"page-sizes":[12,24,36,48,60],"page-count":Math.ceil(e(le)/e(B)),"onUpdate:pageSize":Me},null,8,["page","page-size","page-count"])])):e(se)?(s(),r("section",Tn,[l(ut,{size:"medium"})])):(s(),y(rt,{key:2,description:e(t)("noMediaFile"),class:"my-10"},null,8,["description"]))]),_:1})]),_:1}),l(Q,{show:e(j),"onUpdate:show":a[12]||(a[12]=o=>b(j)?j.value=o:null),preset:"card",style:{width:"500px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(A)?.name},{default:n(()=>[u("audio",En,[u("source",{src:e(A)?.url},null,8,Un)])]),_:1},8,["show","title"]),l(Q,{show:e(Y),"onUpdate:show":a[13]||(a[13]=o=>b(Y)?Y.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(A)?.name},{default:n(()=>[u("video",zn,[u("source",{src:e(A)?.url},null,8,An)])]),_:1},8,["show","title"]),l(Q,{show:e(G),"onUpdate:show":a[14]||(a[14]=o=>b(G)?G.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(p)?.name},{default:n(()=>[e(p)?(s(),y(re,{key:0,striped:"","single-line":!1,size:"small"},{default:n(()=>[u("tbody",null,[u("tr",null,[u("td",On,i(e(t)("name")),1),u("td",null,i(e(p).name),1)]),u("tr",null,[u("td",null,i(e(t)("link")),1),u("td",null,[u("small",null,i(e(p).url),1)])]),u("tr",null,[u("td",null,i(e(t)("type")),1),u("td",null,[e(p).type==e(_).IMAGE?(s(),r("span",Rn,i(e(t)("image")),1)):e(p).type==e(_).VIDEO?(s(),r("span",Pn,i(e(t)("video")),1)):e(p).type==e(_).AUDIO?(s(),r("span",$n,i(e(t)("audio")),1)):e(p).type==e(_).DOCUMENT?(s(),r("span",Nn,i(e(t)("document")),1)):(s(),r("span",Vn,i(e(t)("other")),1))])]),e(p).size?(s(),r("tr",Bn,[u("td",null,i(e(t)("size")),1),u("td",null,i(e(Ut)(e(p).size,!0)),1)])):f("",!0),e(p).mimeType?(s(),r("tr",Ln,[u("td",null,i(e(t)("mimeType")),1),u("td",null,i(e(p).mimeType),1)])):f("",!0),e(p).sender?(s(),r("tr",jn,[u("td",null,i(e(t)("sendBy")),1),u("td",null,i(e(p).sender.fullname),1)])):f("",!0),e(p).title?(s(),r("tr",Yn,[u("td",null,i(e(t)("title")),1),u("td",null,i(e(p).title),1)])):f("",!0),e(p).description?(s(),r("tr",Gn,[u("td",null,i(e(t)("description")),1),u("td",null,[u("small",null,i(e(p).description),1)])])):f("",!0),e(p).createdAt?(s(),r("tr",Qn,[u("td",null,i(e(t)("date")),1),u("td",null,i(e(de)(e(p).createdAt)),1)])):f("",!0),e(p).additionalMetadata?(s(),r("tr",Hn,[u("td",null,i(e(t)("metadata")),1),u("td",null,[l(re,{striped:"","single-line":"",size:"small"},{default:n(()=>[u("tbody",null,[(s(!0),r(S,null,ee(e(p).additionalMetadata||[],(o,w)=>(s(),r("tr",{key:w},[u("td",null,i(w),1),u("td",null,i(o),1)]))),128))])]),_:1})])])):f("",!0)])]),_:1})):f("",!0)]),_:1},8,["show","title"]),l(Q,{show:e(D),"onUpdate:show":a[16]||(a[16]=o=>b(D)?D.value=o:null),preset:"card",style:{width:"600px"},bordered:!1,"mask-closable":!1,"close-on-esc":!1,title:e(x)?.name},{default:n(()=>[l(_t,{"cropper-ratio":void 0,"round-preview":!1,src:e(K)?e(K):void 0,onCancel:a[15]||(a[15]=o=>D.value=!1),onSave:Ye},null,8,["src"])]),_:1},8,["show","title"])],64)}}});export{co as default};
