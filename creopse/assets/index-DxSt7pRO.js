import{i as b}from"./css-render_vue3-ssr-Vbotx5Ir.js";import{_ as Q}from"./PageLayout.vue_vue_type_script_setup_true_lang-OixN3STA.js";import{_ as W}from"./NaiveMobileTableAdapter.vue_vue_type_script_setup_true_lang-DRZao2ZZ.js";import{z as X,r as M,e as Y,U as S,R as Z}from"./index-B2LlKIv2.js";import{I as y}from"./iconify_vue-BwapRRpV.js";import{_ as w}from"./lodash-DjP7BPMr.js";import{a as ee,b as se,c as ae,a0 as te,B as I,N,F as L,a7 as le,g as ne,a3 as oe,D as ie,E as re,j as ue}from"./naive-ui-CrTIpLJ9.js";import{u as ce}from"./vue-i18n-CWrb4u3f.js";const{defineComponent:de}=await b("vue"),{unref:a,createVNode:n,withCtx:i,toDisplayString:pe,createTextVNode:me,resolveComponent:Ie,isRef:B,Fragment:fe,openBlock:_e,createElementBlock:ve}=await b("vue"),{h:o}=await b("vue"),{defineComponent:ge,ref:d,computed:P}=await b("vue"),ye=ge({name:Z.ROLES_MANAGEMENT.NAME}),Le=de({...ye,setup(we){const v=ee(),u=se(),U=ae(),c=X(),{request:h}=Y(),{t:e,locale:A}=ce(),m=d(""),k=d(),x=d(!1),$={pageSize:12},T=[{title:e("name"),key:"displayName",resizable:!0,width:150,ellipsis:{tooltip:!0},fixed:"left",sortOrder:!1,sorter:"default"},{title:e("description"),key:"description",resizable:!0,width:250,ellipsis:{tooltip:!0}},{title:e("permissionList"),key:"permissions",resizable:!0,width:300,render(t){return o("div",{},{default:()=>t.permissions?.map(R=>o(te,{class:"mx-1 my-1",size:"small",type:"info",round:!1,strong:!0,bordered:!1},{default:()=>R.displayName}))})},sortOrder:!1,sorter:"default"},{title:e("lastEdition"),key:"updatedAt",width:150,render(t){return o("div",{},{default:()=>M(t.updatedAt,{locale:A.value})})}},{title:e("creation"),key:"createdAt",width:150,render(t){return o("div",{},{default:()=>M(t.createdAt,{locale:A.value})})}},{title:()=>o(L,{ref:k,placeholder:e("search"),value:m.value,onInput:t=>{m.value=t}},{suffix:()=>o(N,{},{default:()=>o(y,{icon:"carbon:search"})})}),key:"actions",width:180,render(t){return o("div",{class:"flex justify-end items-center w-full"},[o(I,{size:"small",type:"warning",onClick:()=>{z(t)},renderIcon:()=>o(N,null,{default:()=>o(y,{icon:"carbon:edit"})})},{default:()=>e("edit")}),o("div",{class:"w-2"}),o(I,{size:"small",type:"error",onClick:()=>{U.warning({title:e("confirm"),content:e("confirmDeleteRole"),positiveText:e("yes"),negativeText:e("no"),onPositiveClick:async()=>{(await h({url:`/roles/${t.id}`,method:"delete"})).success?u.success(e("success")):u.error(e("anErrorOccurred")),g()}})},renderIcon:()=>o(N,null,{default:()=>o(y,{icon:"carbon:trash-can"})})})])},fixed:"right"}],q=P(()=>{if(!m.value)return c.roles.filter(s=>s.name!==S.SUPER_ADMIN);const t=c.roles.filter(s=>s.name!==S.SUPER_ADMIN&&(s.name.toLowerCase().includes(m.value.toLowerCase())||s.displayName.toLowerCase().includes(m.value.toLowerCase())||s.description.toLowerCase().includes(m.value.toLowerCase())));return k.value&&k.value.focus(),t}),g=async()=>{x.value=!0,await c.loadRoles(),await c.loadPermissions(),x.value=!1};g();const f=d(!1),p=d(!1),_=d(null),D=d(null),l=d({name:"",displayName:"",description:"",permissions:[]}),O={name:[{required:!0,message:e("fillRequired")}],displayName:[{required:!0,message:e("fillRequired")}]},z=t=>{_.value=w.cloneDeep(t),t?l.value=w.cloneDeep(t):l.value={name:"",displayName:"",description:"",permissions:[]},p.value=!0},V=async()=>(D.value?.validate(async t=>{t||(_.value?_.value.name!==l.value.name&&c.roles.findIndex(s=>s.name==l.value.name)>-1?u.error(e("sameRoleNameMessage")):(v.start(),f.value=!0,(await h({url:`/roles/${_.value.id}`,method:"put",data:{displayName:l.value.displayName,description:l.value.description,permissions:l.value.permissions}})).success?u.success(e("success")):u.error(e("anErrorOccurred")),f.value=!1,v.finish(),g(),p.value=!1):c.roles.findIndex(s=>s.name==w.kebabCase(l.value.displayName))>-1?u.error(e("sameRoleNameMessage")):(v.start(),f.value=!0,(await h({url:"/roles",method:"post",data:{name:w.kebabCase(l.value.displayName),displayName:l.value.displayName,description:l.value.description,permissions:l.value.permissions}})).success?u.success(e("success")):u.error(e("anErrorOccurred")),f.value=!1,v.finish(),g(),p.value=!1))}),!1),C=P({get(){try{return l.value.permissions?.map(t=>t.name)}catch{return[]}},set(t){l.value.permissions=c.permissions.filter(s=>t.includes(s.name))}});return(t,s)=>{const R=ne,F=le,j=W,G=Q,E=re,H=ue,J=ie,K=oe;return _e(),ve(fe,null,[n(G,null,{"header-extra":i(()=>[n(R,null,{default:i(()=>[n(a(I),{type:"primary",onClick:s[0]||(s[0]=r=>z(null))},{icon:i(()=>[n(a(N),{size:"18"},{default:i(()=>[n(a(y),{icon:"carbon:add-alt"})]),_:1})]),default:i(()=>[me(" "+pe(a(e)("add")),1)]),_:1})]),_:1})]),default:i(()=>[n(j,null,{default:i(()=>[n(F,{columns:T,data:a(q),pagination:$,loading:a(x),"single-line":!1,"scroll-x":1200,striped:""},null,8,["data","loading"])]),_:1})]),_:1}),n(K,{show:a(p),"onUpdate:show":s[4]||(s[4]=r=>B(p)?p.value=r:null),loading:a(f),preset:"dialog",style:{width:"500px"},bordered:!1,"show-icon":!1,"mask-closable":!1,title:a(_)?a(e)("edit"):a(e)("add"),"positive-text":a(e)("validate"),"negative-text":a(e)("cancel"),onPositiveClick:V,onNegativeClick:s[5]||(s[5]=r=>p.value=!1)},{default:i(()=>[n(J,{ref_key:"formRef",ref:D,model:a(l),rules:O,"show-require-mark":!1,size:"medium"},{default:i(()=>[n(E,{label:a(e)("name"),path:"displayName"},{default:i(()=>[n(a(L),{value:a(l).displayName,"onUpdate:value":s[1]||(s[1]=r=>a(l).displayName=r),placeholder:a(e)("name"),class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),n(E,{label:a(e)("description"),path:"description"},{default:i(()=>[n(a(L),{value:a(l).description,"onUpdate:value":s[2]||(s[2]=r=>a(l).description=r),placeholder:a(e)("description"),type:"textarea",class:"w-full"},null,8,["value","placeholder"])]),_:1},8,["label"]),n(E,{label:a(e)("permissionList"),path:"permissions"},{default:i(()=>[n(H,{value:a(C),"onUpdate:value":s[3]||(s[3]=r=>B(C)?C.value=r:null),options:a(c).permissions,placeholder:a(e)("permissionList"),"max-tag-count":4,placement:"bottom",filterable:"",multiple:"","value-field":"name","label-field":"displayName",class:"w-full"},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show","loading","title","positive-text","negative-text"])],64)}}});export{Le as default};
